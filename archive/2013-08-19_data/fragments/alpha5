((idp10950208
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n        TODO use Cow.Html to generate a more complete Atom feed.\n      </blockquote>")))
 (idp10948720
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      TODO finish the atom example.\n    </blockquote>")))
 (idp10948288
  ((file xml-streams-and-trees.html)
   (html "<blockquote>\n      TODO antiquotations.\n    </blockquote>")))
 (idp10944848
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      There's another interesting bit of new syntax in the\n      <code>xml_of_date</code> function known as a\n      <span><em>quotation</em></span>. OCaml not only allows code to be\n      generated during pre-processing, but also to override the core\n      language grammar with new constructs. The most common way of doing\n      this is by embedding the custom grammars inside\n      <code>&lt;:foo&lt; ... &gt;&gt;</code> tags, where\n      <code>foo</code> represents the particular grammar being\n      used. In the case of COW, this lets you generate XMLM-compatible\n      OCaml values just by typing in XML tags.\n    </blockquote>")))
 (idp10943232
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The Atom date field is a good example. We define it as a tuple of\n      integers, but the format mandated by the specification is actually\n      a free-form text format and not XML. However, because the syntax\n      extension generates normal OCaml functions, we can just override\n      the <code>xml_of_date</code> function with a custom one\n      which returns the correct XML fragment. Any references further\n      down the module will just use our overridden version and ignore\n      the auto-generated one.\n    </blockquote>")))
 (idp10942528
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      We've now filled in more of the Atom schema with these records.\n      The first problem we run into is that occasionally there is a\n      mismatch between the syntax extension's idea of what the\n      auto-generated XML should look like, and the reality of the\n      protocol you are mapping to.\n    </blockquote>")))
 (idp10940480
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      This is convenient, but just one small portion of Atom. How do we\n      express the full Atom scheme from earlier? The answer is with just\n      a few more records that match the Atom XML schema.\n    </blockquote>")))
 (idp10938880
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      This will generate the following XML output on the terminal when\n      you execute it:\n    </blockquote>")))
 (idp10936128
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      If we run <code>xml_of_author</code> and convert the result\n      to a human-readable string, our complete example looks like:\n    </blockquote>")))
 (idp10931840
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Notice that the <code>with xml</code> clause has been\n      replaced with a new <code>xml_of_author</code> function that\n      has been generated for you. It accepts an\n      <code>author</code> value and returns an\n      <code>Xml.t</code> value. The generated code isn't really\n      meant to be human-readable, but you don't normally see it when\n      using the syntax extension (we've only dumped it out here to\n      illustrate how <code>camlp4</code> works).\n    </blockquote>")))
 (idp10928048
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Let's see the OCaml code that has been generated for our\n      <code>author</code> record after it has been preprocessed:\n    </blockquote>")))
 (idp10925808
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      You can supply <code>ocamlfind</code> with a number of\n      different predicates to define the type of build you are running\n      (preprocessing, compilation or linking). The final part of the\n      script invokes the <code>camlp4o</code> binary on your ML\n      source file and outputs the transformed source code to your\n      terminal.\n    </blockquote>")))
 (idp10921808
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The OCaml compiler can call <code>camlp4</code>\n      automatically during a compilation to preprocess the source files.\n      This is specified via the <code>-pp</code> flag to the\n      compiler. You don't normally need to specify this flag yourself.\n      Use the <code>ocamlfind</code> utility instead to generate\n      the right command-line flags for you. Here's a small shell script\n      which preprocesses a source file with the COW syntax extension:\n    </blockquote>")))
 (idp10919072
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      This is a standard record type definition with the addition of\n      <code>with xml</code> at the end. This uses a syntax\n      extension to signify that we wish to generate boilerplate code for\n      handling this record as an XML document.\n    </blockquote>")))
 (idp10916784
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Let's start to build up an Atom specification using Cow. First,\n      the <code>&lt;author&gt;</code> tag can be represented with\n      the following type:\n    </blockquote>")))
 (idp10915568
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      One caveat to bear in mind is that COW isn't fully compatible with\n      Core yet, and so you must use the syntax extension before opening\n      the Core modules. (<span><em>avsm</em></span>: we can fix this\n      easily, but the note is here as a warning to reviewers).\n    </blockquote>")))
 (idp10912800
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The COW library and syntax extension can be installed via OPAM via\n      <code>opam install cow</code>. There are two OCamlfind\n      packages installed: the library is called <code>cow</code>\n      and the syntax extension is activated with the\n      <code>cow.syntax</code> package.\n    </blockquote>")))
 (idp10911488
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      We want to build this by minimising the amount of repetitive XML\n      generation code. The &quot;Caml on the Web&quot; (COW) library\n      provides the syntax extension we need.\n    </blockquote>")))
 (idp10909248
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Here's an example of an Atom feed:\n    </blockquote>")))
 (idp10908448
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      We'll use the Atom 1.0 syndication format as our example. Atom\n      feeds allow web-based programs such as browsers to poll a website\n      for updates. The website owner publishes a feed of content in a\n      standardized XML format via HTTP. This feed is then parsed by\n      clients and compared against previously downloaded versions to\n      determine which contents are available.\n    </blockquote>")))
 (idp10906912
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      We use the Sexplib syntax extension earlier to generate\n      boilerplate code from type definitions. The quotation shown above\n      is a little different: it lets the syntax of an entire block of\n      code to be completely different from OCaml's usual one. Camlp4\n      loads a syntax extension module that transforms the Abstract\n      Syntax Tree (AST) of the code fragment (in this case,\n      <code>xml</code>), and converts it into the desired data\n      structure.\n    </blockquote>")))
 (idp10902544
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      This defines a couple of helper functions to construct\n      <code>Element</code> and <code>Data</code> values, and\n      then builds a <code>response</code> value. Wouldn't it be\n      nice if there were a way to write the XML we want directly?\n      Happily, OCaml's syntax extension mechanism comes to the rescue\n      via the <span><em>quotation</em></span> mechanism. It lets us write\n      this equivalent code:\n    </blockquote>")))
 (idp10900704
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      In the earlier JSON chapter, we explained how to construct values\n      by creating the data structures directly. While this works for\n      small documents, it can get really confusing with bigger\n      structures. For example, look at:\n    </blockquote>")))
 (idp10895840
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>filter_tag</code> function accepts a\n      <code>tree list</code> and also outputs a\n      <code>tree list</code> that contains the sub-tags that\n      match. This lets us chain together the results of one filter to\n      another, and hence select hierarchical XML tags very easily. When\n      we get to the <code>&lt;Text&gt;</code> tag, we iterate over\n      all the results, concatenate the data contents, and print each one\n      individually.\n    </blockquote>")))
 (idp10893264
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Once we have these helper functions, the selection of all the\n      <code>&lt;Text&gt;</code> tags is a matter of chaining the\n      filter functions we just defined together.\n    </blockquote>")))
 (idp10887728
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>filter_tag</code> function also folds over a\n      <code>tree list</code>, but uses a more specialised pattern\n      match. It looks for an <code>Element</code> value, but uses\n      the <code>when</code> clause to also check that the name of\n      the tag matches the <code>n</code> function argument. If it\n      does match then that pattern is selected, and otherwise matching\n      continues to the next option (in this case, a catch-all that\n      simply returns the accumulator and continues the fold). This use\n      of <code>when</code> in pattern matching is known as a\n      <span><em>guard pattern</em></span>.\n    </blockquote>")))
 (idp10883680
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>concat_data</code> function accepts a\n      <code>tree list</code> parameter and looks for\n      <code>Data</code> tags that it concatenates into a single\n      string. All other tags are ignored and discarded (a more\n      sophisticated implementation would recurse into sub-tags and\n      concatenate any data within them too).\n    </blockquote>")))
 (idp10878144
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>name</code> function is a good example of how\n      pattern-matching can make data structure manipulation very\n      succinct. An <code>Xmlm.tag</code> consists of a tuple of\n      the tag name and its attributes. The tag name is itself a tuple of\n      the namespace and the local name (which is what we actually want).\n      The pattern matching in the <code>name</code> function binds\n      the local name portion of these tuples to <code>n</code>,\n      and ignores the rest of the argument input. The function body just\n      returns <code>n</code> to the caller.\n    </blockquote>")))
 (idp10876688
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Let's look at the implementation of these functions in more\n      detail.\n    </blockquote>")))
 (idp10872992
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The type <code>tree</code> can be pattern-matched and\n      traversed like a normal OCaml data structure. Let's see how this\n      works by extracting all the &quot;RelatedTopics&quot; in the\n      example XML document. First, we'll need a few helper combinator\n      functions to filter through tags and trees, with the following\n      signature:\n    </blockquote>")))
 (idp10870736
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Signals enforce a very iterative style of parsing XML, as your\n      program has to deal with signals arriving serially. It's often\n      more convenient to deal with complete XML documents directly\n      in-memory as an OCaml tree data structure. We can convert a signal\n      stream into an OCaml structure by defining the following data type\n      and helper functions:\n    </blockquote>")))
 (idp10864512
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>pull</code> function isn't invoked immediately.\n      The first thing we need to do is consume the\n      <code>Dtd</code> signal, which is present in every\n      well-formed XML input. Then we invoke <code>pull</code> with\n      a depth of <code>0</code>, and it consumes the whole\n      document. The final action is to call <code>Xmlm.eoi</code>\n      to verify that the end of input has been reached, since the\n      earlier <code>pull</code> should have consumed all of the\n      XML signals.\n    </blockquote>")))
 (idp10858768
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>xml_id</code> function begins by defining a\n      recursive helper <code>pull</code> function. The\n      <code>pull</code> function iterates over the\n      <code>signal</code> values until there are none left. It\n      first uses <code>Xmlm.peek</code> to inspect the current\n      input signal and immediately outputs it. The rest of the function\n      is not strictly necessary, but tracks that all of the tags that\n      have been started via the <code>El_start</code> signal are\n      also closed by a corresponding <code>El_end</code> signal.\n    </blockquote>")))
 (idp10854368
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Only the opening <code>El_start</code> defines the tag name,\n      and the <code>El_end</code> signal closes the more recently\n      opened tag. The tag names are a little complicated due to the XML\n      facility for namespaces; just ignore the empty component of the\n      tag if you don't care about these. Now, let's define the\n      <code>xml_id</code> function that uses the input and output\n      values we defined above and parses this document.\n    </blockquote>")))
 (idp10852960
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      This will be converted into the following sequence of signals:\n    </blockquote>")))
 (idp10851312
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Regardless of which input method you choose, XMLM will convert it\n      into a sequence of signals. For example, take this simplified XML\n      fragment from our earlier search engine example.\n    </blockquote>")))
 (idp10847360
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Although we use <code>Channel</code> in this small example,\n      real applications will tend to use either\n      <code>String</code> or <code>Fun</code>. This is\n      because the <code>in_channel</code> interface is deprecated\n      in Core, and shouldn't be used in new code. <span><em>(avsm: this\n      is a somewhat unsatisfying explanation: what about adding a better\n      Core interface?)</em></span>.\n    </blockquote>")))
 (idp10845648
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n<code>Fun</code> is more general than the others, and\n          supplies a function which can be called repeatedly to obtain\n          the next character. The function can do this by any means it\n          chooses: for example from the network (hopefully with\n          buffering so it's not reading a single character at a time),\n          or from a list of strings from elsewhere in the application.\n        </blockquote>")))
 (idp10843312
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n<code>String</code> accepts the whole document as an\n          OCaml <code>string</code>, starting from an integer\n          offset and continuing until the whole document has been\n          parsed.\n        </blockquote>")))
 (idp10841696
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n<code>Channel</code> uses the OCaml standard library\n          channel system. When more data is required, a blocking read is\n          performed on that channel.\n        </blockquote>")))
 (idp10840688
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      Each of these sources uses a different strategy for obtaining\n      input data:\n    </blockquote>")))
 (idp10836800
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      We'll begin by defining the input source and output target for the\n      XML data. The <code>make_input</code> and\n      <code>make_output</code> functions use a polymorphic variant\n      to define how the library should use to read and write the XML.\n      <code>Channel</code> is used above, but there are several\n      others defined in the library:\n    </blockquote>")))
 (idp10833184
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>El_start</code> and <code>El_end</code>\n      signals indicate the opening and closing of tags, and\n      <code>Data</code> passes the data contained between tags.\n    </blockquote>")))
 (idp10829808
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      XMLM parses input XML documents into an ordered sequence of these\n      <code>signal</code> values. The first\n      <code>signal</code> that's received is always a\n      <code>Dtd</code>. The Document Type Description (DTD)\n      optionally defines which tags are allowed within the XML document.\n      Some XML parsers can validate a document against a DTD, but XMLM\n      is a <span><em>non-validating</em></span> parser that reads the DTD\n      if present but disregards its contents.\n    </blockquote>")))
 (idp10827600
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The <code>signal</code> type is at the heart of all XMLM\n      functions:\n    </blockquote>")))
 (idp10823920
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n        A well-formed sequence of <code>signal</code>s represents\n        an XML document tree traversal in depth-first order. Input pulls\n        a well-formed sequence of <code>signal</code>s from a data\n        source and output pushes a well-formed sequence of\n        <code>signal</code>s to a data destination. Functions are\n        provided to easily transform sequences of\n        <code>signal</code>s to/from arborescent data structures.\n      </blockquote>")))
 (idp10823136
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n      The XMLM documentation is a good place to read about the overall\n      layout of the library. It tells us that:\n    </blockquote>")))
 (idp10820816
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    These XML documents can be very large, and we don't want to have to\n    read it all into memory before starting to process it. Luckily there\n    exists a low-level <span><em>streaming</em></span> interface that\n    parses an XML document incrementally. This can be cumbersome to use\n    for quick tasks, so we'll build a simpler tree API on top of it.\n    We'll start with the streaming API first though.\n  </blockquote>")))
 (idp10817968
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    The XML document is structured as a set of opening\n    <code>&lt;tag&gt;</code> tokens that are closed by a\n    corresponding end <code>&lt;/tag&gt;</code> token. Opening\n    tags can have an optional set of key/value attributes, for example\n    <code>&lt;tag name=&quot;foo&quot; id=&quot;bar&quot;&gt;</code>.\n    A tag usually contains data that can contain further tags, thus\n    forming a tree structure.\n  </blockquote>")))
 (idp10813536
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    Since XML is such a common web format, we've taken our example\n    document from the\n    <a href=\"http://duckduckgo.com\" target=\"_top\">DuckDuckGo</a> search engine.\n    This is a smaller search engine than the usual suspects, but has the\n    advantage of a freely available API that doesn't require you to\n    register before using it. We'll talk more about how to use the live\n    API later in\n    <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>, but\n    for now here's what a shortened XML search response from DuckDuckGo\n    looks like:\n  </blockquote>")))
 (idp10812208
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    The library documentation is also available\n    <a href=\"http://erratique.ch/software/xmlm/doc/Xmlm\" target=\"_top\">online</a>.\n  </blockquote>")))
 (idp10809968
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    Once installed, the <code>xmlm</code> library will be\n    available in your toplevel.\n  </blockquote>")))
 (idp10807760
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    The remainder of this chapter uses the freely available XMLM\n    library. It's easiest to obtain it via OPAM. See\n    <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a> for installation\n    instructions if you don't have OPAM.\n  </blockquote>")))
 (idp10806080
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    We're going to explain the basics of XML manipulation here, and also\n    introduce the notion of a <span><em>visitor pattern</em></span> to\n    manipulate fragments of XML trees.\n  </blockquote>")))
 (idp10804704
  ((file xml-streams-and-trees.html)
   (html
    "<blockquote>\n    XML is a markup language designed to store tree-structured data in a\n    format that is (somewhat) human- and machine-readable. Like JSON, it\n    is a textual format commonly used in web technologies, with a\n    complete\n    <a href=\"http://www.w3.org/TR/REC-xml/\" target=\"_top\">specification</a>\n    available online.\n  </blockquote>")))
 (idp8304896
  ((file variants.html)
   (html
    "<blockquote>\n        Variants are most problematic exactly where you take full\n        advantage of their power; in particular, when you take advantage\n        of the ability of polymorphic variant types to overlap in the\n        tags they support. This ties into OCaml's support for subtyping.\n        As we'll discuss further when we cover objects in\n        <a href=\"object-oriented-programming.html\">Chapter\194\16010, <i>Object Oriented Programming</i></a>,\n        subtyping brings in a lot of complexity, and most of the time,\n        that's complexity you want to avoid.\n      </blockquote>")))
 (idp8303952
  ((file variants.html)
   (html
    "<blockquote>\n        Probably the safest and most common use-case for polymorphic\n        variants is where ordinary variants would be sufficient, but are\n        syntactically too heavyweight. For example, you often want to\n        create a variant type for encoding the inputs or outputs to a\n        function, where it's not worth declaring a separate type for it.\n        Polymorphic variants are very useful here, and as long as there\n        are type annotations that constrain these to have explicit,\n        exact types, this tends to work well.\n      </blockquote>")))
 (idp8303360
  ((file variants.html)
   (html
    "<blockquote>\n        All that said, polymorphic variants are still a useful and\n        powerful feature, but it's worth understanding their\n        limitations, and how to use them sensibly and modestly.\n      </blockquote>")))
 (idp8302032
  ((file variants.html)
   (html
    "<blockquote>\n<span><em>Efficiency:</em></span> This isn't a huge effect,\n            but polymorphic variants are somewhat heavier than regular\n            variants, and OCaml can't generate code for matching on\n            polymorphic variants that is quite as efficient as what it\n            generated for regular variants.\n          </blockquote>")))
 (idp8300656
  ((file variants.html)
   (html
    "<blockquote>\n<span><em>Error-finding:</em></span> Polymorphic variants are\n            type-safe, but the typing discipline that they impose is, by\n            dint of its flexibility, less likely to catch bugs in your\n            program.\n          </blockquote>")))
 (idp8298944
  ((file variants.html)
   (html
    "<blockquote>\n<span><em>Complexity:</em></span> As we've seen, the typing\n            rules for polymorphic variants are a lot more complicated\n            than they are for regular variants. This means that heavy\n            use of polymorphic variants can leave you scratching your\n            head trying to figure out why a given piece of code did or\n            didn't compile. It can also lead to absurdly long and hard\n            to decode error messages. Indeed, concision at the value\n            level is often balanced out by more verbosity at the type\n            level.\n          </blockquote>")))
 (idp8297824
  ((file variants.html)
   (html
    "<blockquote>\n        In reality, regular variants are the more pragmatic choice most\n        of the time. That's because the flexibility of polymorphic\n        variants comes at a price. Here are some of the downsides.\n      </blockquote>")))
 (idp8297184
  ((file variants.html)
   (html
    "<blockquote>\n        At first glance, polymorphic variants look like a strict\n        improvement over ordinary variants. You can do everything that\n        ordinary variants can do, plus it's more flexible and more\n        concise. What's not to like?\n      </blockquote>")))
 (idp8295584
  ((file variants.html)
   (html
    "<blockquote>\n        This is useful when you want to narrow down to a type whose\n        definition is long, and you don't want the verbosity of writing\n        the tags down explicitly in the match.\n      </blockquote>")))
 (idp8293104
  ((file variants.html)
   (html
    "<blockquote>\n        Once we have type definitions at our disposal, we can revisit\n        the question of how we write the pattern match that narrows the\n        type. In particular, we can explicitly use the type name as part\n        of the pattern match, by prefixing it with a\n        <code>#</code>.\n      </blockquote>")))
 (idp8290624
  ((file variants.html)
   (html
    "<blockquote>\n        In particular, the compiler will complain that the\n        <code>`Grey</code> case is unused.\n      </blockquote>")))
 (idp8288256
  ((file variants.html)
   (html
    "<blockquote>\n        If we add an explicit type annotation to the code itself (rather\n        than just in the <code>mli</code>), then the compiler has\n        enough information to warn us.\n      </blockquote>")))
 (idp8283456
  ((file variants.html)
   (html
    "<blockquote>\n        In the above code, we did something funny to the definition of\n        <code>extended_color_to_int</code>, that underlines some\n        of the downsides of polymorphic variants. In particular, we\n        added some special-case handling for the color gray, rather than\n        using <code>color_to_int</code>. Unfortunately, we\n        misspelled <code>Gray</code> as <code>Grey</code>.\n        This is exactly the kind of error that the compiler would catch\n        with ordinary variants, but with polymorphic variants, this\n        compiles without issue. All that happened was that the compiler\n        inferred a wider type for\n        <code>extended_color_to_int</code>, which happens to be\n        compatible with the narrower type that was listed in the\n        <code>mli</code>.\n      </blockquote>")))
 (idp8279152
  ((file variants.html)
   (html
    "<blockquote>\n        Here, <code>extended_color</code> is defined as an\n        explicit extension of <code>color</code>. Also, notice\n        that we defined all of these types as exact variants. We can\n        implement this library as follows.\n      </blockquote>")))
 (idp8274656
  ((file variants.html)
   (html
    "<blockquote>\n        Let's consider how we might turn our code into a proper library\n        with an implementation in an <code>ml</code> file and an\n        implementation in a separate <code>mli</code>, as we saw\n        in <a href=\"files-modules-and-programs.html\">Chapter\194\1604, <i>Files, Modules and Programs</i></a>. Let's\n        start with the <code>mli</code>.\n      </blockquote>")))
 (idp8273920
  ((file variants.html)
   (html
    "<blockquote>\n        With ordinary variants, such a typo would have been caught as an\n        unknown tag. As a general matter, one should be wary about\n        mixing catch-all cases and polymorphic variants.\n      </blockquote>")))
 (idp8270192
  ((file variants.html)
   (html
    "<blockquote>\n        Catch-all cases are error-prone even with ordinary variants, but\n        they are especially so with polymorphic variants. That's because\n        you have no way of bounding what tags your function might have\n        to deal with. Such code is particularly vulnerable to typos. For\n        instance, if code that uses\n        <code>is_positive_permissive</code> passes in\n        <code>Float</code> misspelled as <code>Floot</code>,\n        the erroneous code will compile without complaint.\n      </blockquote>")))
 (idp8267488
  ((file variants.html)
   (html
    "<blockquote>\n        As we saw with the definition of <code>is_positive</code>,\n        a match statement can lead to the inference of an upper bound on\n        a variant type, limiting the possible tags to those that can be\n        handled by the match. If we add a catch-all case to our match\n        statement, we end up with a function with a lower bound.\n      </blockquote>")))
 (idp8264320
  ((file variants.html)
   (html
    "<blockquote>\n        The above code is more delicately balanced than one might\n        imagine. In particular, if we use a catch-all case instead of an\n        explicit enumeration of the cases, the type is no longer\n        narrowed, and so compilation fails.\n      </blockquote>")))
 (idp8256608
  ((file variants.html)
   (html
    "<blockquote>\n        Now we can try writing <code>extended_color_to_int</code>.\n        The key issue with this code is that\n        <code>extended_color_to_int</code> needs to invoke\n        <code>color_to_int</code> with a narrower type,\n        <span><em>i.e.</em></span>, one that includes fewer tags. Written\n        properly, this narrowing can be done via a pattern match. In\n        particular, in the following code, the type of the variable\n        <code>color</code> includes only the tags\n        <code>`Basic</code>, <code>`RGB</code> and\n        <code>`Gray</code>, and not <code>`RGBA</code>.\n      </blockquote>")))
 (idp8252448
  ((file variants.html)
   (html
    "<blockquote>\n        What we want to do is to share tags between two different\n        variant types, and polymorphic variants let us do this in a\n        natural way. First, let's rewrite\n        <code>basic_color_to_int</code> and\n        <code>color_to_int</code> using polymorphic variants. The\n        translation here is pretty straightforward.\n      </blockquote>")))
 (idp8250032
  ((file variants.html)
   (html
    "<blockquote>\n        The problem is that <code>extended_color</code> and\n        <code>color</code> are in the compiler's view distinct and\n        unrelated types. The compiler doesn't, for example, recognize\n        any equality between the <code>Basic</code> tag in the two\n        types.\n      </blockquote>")))
 (idp8248032
  ((file variants.html)
   (html
    "<blockquote>\n        This looks reasonable enough, but it leads to the following type\n        error.\n      </blockquote>")))
 (idp8244896
  ((file variants.html)
   (html
    "<blockquote>\n        We want to write a function\n        <code>extended_color_to_int</code>, that works like\n        <code>color_to_int</code> for all of the old kinds of\n        colors, with new logic only for handling colors that include an\n        alpha channel. One might try to write such a function as\n        follows.\n      </blockquote>")))
 (idp8242976
  ((file variants.html)
   (html
    "<blockquote>\n        To see how to use polymorphic variants in practice, we'll return\n        to terminal colors. Imagine that we have a new terminal type\n        that adds yet more colors, say, by adding an alpha channel so\n        you can specify translucent colors. We could model this extended\n        set of colors as follows, using an ordinary variant.\n      </blockquote>")))
 (idp8238368
  ((file variants.html)
   (html
    "<blockquote>\n      Here, the inferred type states that the tags can be no more than\n      <code>`Float</code>, <code>`Int</code> and\n      <code>`Not_a_number</code>, and must contain at least\n      <code>`Float</code> and <code>`Int</code>. As you can\n      already start to see, polymorphic variants can lead to fairly\n      complex inferred types.\n    </blockquote>")))
 (idp8234496
  ((file variants.html)
   (html
    "<blockquote>\n      Perhaps surprisingly, we can also create polymorphic variant types\n      that have different upper and lower bounds. Note that\n      <code>Ok</code> and <code>Error</code> in the\n      following example come from the <code>Result.t</code> type\n      from Core.\n    </blockquote>")))
 (idp8231184
  ((file variants.html)
   (html
    "<blockquote>\n      We can think of these <code>&lt;</code> and\n      <code>&gt;</code> markers as indications of upper and lower\n      bounds on the tags involved. If the same set of tags are both an\n      upper and a lower bound, we end up with an\n      <span><em>exact</em></span> polymorphic variant type, which has\n      neither marker. For example:\n    </blockquote>")))
 (idp8228224
  ((file variants.html)
   (html
    "<blockquote>\n      The <code>&lt;</code> is there because\n      <code>is_positive</code> has no way of dealing with values\n      that have tags other than <code>`Float of float</code> or\n      <code>`Int of int</code>.\n    </blockquote>")))
 (idp8225872
  ((file variants.html)
   (html
    "<blockquote>\n      OCaml will in some cases infer a variant type with\n      <code>&lt;</code>, to indicate &quot;these tags or\n      less&quot;, as in the following example.\n    </blockquote>")))
 (idp8221792
  ((file variants.html)
   (html
    "<blockquote>\n      The <code>&gt;</code> at the beginning of the variant types\n      above is critical, because it marks the types as being open to\n      combination with other variant types. We can read the type\n      <code>[&gt; `Int of string | `Float of float]</code> as\n      describing a variant whose tags include\n      <code>`Int of string</code> and\n      <code>`Float of float</code>, but may include more tags as\n      well. In other words, you can roughly translate\n      <code>&gt;</code> to mean: &quot;these tags or more&quot;.\n    </blockquote>")))
 (idp8219904
  ((file variants.html)
   (html
    "<blockquote>\n      The type system will complain, if it sees incompatible uses of the\n      same tag:\n    </blockquote>")))
 (idp8217600
  ((file variants.html)
   (html
    "<blockquote>\n      As you can see, polymorphic variant types are inferred\n      automatically, and when we combine variants with different tags,\n      the compiler infers a new type that knows about all of those tags.\n      Note that in the above example, the tag name\n      (<span><em>e.g.</em></span>, <code>`Int</code>) matches the\n      type name (<code>int</code>). This is a common convention in\n      OCaml.\n    </blockquote>")))
 (idp8215344
  ((file variants.html)
   (html
    "<blockquote>\n      Syntactically, polymorphic variants are distinguished from\n      ordinary variants by the leading backtick. And unlike ordinary\n      variants, polymorphic variants can be used without an explicit\n      type declaration.\n    </blockquote>")))
 (idp8214272
  ((file variants.html)
   (html
    "<blockquote>\n      In addition to the ordinary variants we've seen so far, OCaml also\n      supports so-called <span><em>polymorphic variants</em></span>. As\n      we'll see, polymorphic variants are more flexible and\n      syntactically more lightweight than ordinary variants, but that\n      extra power comes at a cost.\n    </blockquote>")))
 (idp8212656
  ((file variants.html)
   (html
    "<blockquote>\n      More generally, using variants to build recursive data structures\n      is a common technique, and shows up everywhere from designing\n      little languages to building efficient data structures.\n    </blockquote>")))
 (idp8211440
  ((file variants.html)
   (html
    "<blockquote>\n      This example is more than a toy. There's a module very much in\n      this spirit in Core called <code>Blang</code>, and it gets a\n      lot of practical use in a variety of applications.\n    </blockquote>")))
 (idp8209888
  ((file variants.html)
   (html
    "<blockquote>\n      it's easy to see that we've missed an important case:\n      double-negation.\n    </blockquote>")))
 (idp8207488
  ((file variants.html)
   (html
    "<blockquote>\n      One thing to notice about the above code is that it uses a\n      catch-all case in the very last line within the\n      <code>Not</code> case. It's generally better to be explicit\n      about the cases you're ignoring. Indeed, if we change this snippet\n      of code to be more explicit:\n    </blockquote>")))
 (idp8205120
  ((file variants.html)
   (html
    "<blockquote>\n      Another useful operation on expressions is simplification. The\n      following function applies some basic simplification rules, most\n      of which are driven by the presence of constants.\n    </blockquote>")))
 (idp8203744
  ((file variants.html)
   (html
    "<blockquote>\n      The structure of the code is pretty straightforward --- we're just\n      pattern matching over the structure of the data, doing the\n      appropriate calculation based on which tag we see. To use this\n      evaluator on a concrete example, we just need to write the\n      <code>base_eval</code> function which is capable of\n      evaluating a base predicate.\n    </blockquote>")))
 (idp8200736
  ((file variants.html)
   (html
    "<blockquote>\n      Being able to construct such expressions isn't enough; we also\n      need to be able to evaluate such an expression. The following code\n      shows how you could write a general-purpose evaluator for\n      <code>blang</code>s.\n    </blockquote>")))
 (idp8198064
  ((file variants.html)
   (html
    "<blockquote>\n      Using the above, we can construct a simple expression with\n      <code>mail_predicate</code> as its base predicate.\n    </blockquote>")))
 (idp8195040
  ((file variants.html)
   (html
    "<blockquote>\n      The <code>Base</code> tag is what allows you to tie the\n      <code>blang</code> to your application, by letting you\n      specify an element of some base predicate type, whose truth or\n      falsehood is determined by your application. If you were writing a\n      filter language for an email processor, your base predicates might\n      specify the tests you would run against an email, as in the\n      following example.\n    </blockquote>")))
 (idp8190736
  ((file variants.html)
   (html
    "<blockquote>\n      The purpose of each tag is pretty straightforward.\n      <code>And</code>, <code>Or</code> and\n      <code>Not</code> are the basic operators for building up\n      Boolean expressions, and <code>Const</code> lets you enter\n      the constants <code>true</code> and\n      <code>false</code>.\n    </blockquote>")))
 (idp8186512
  ((file variants.html)
   (html
    "<blockquote>\n      Note that the definition of the type <code>blang</code> is\n      recursive, meaning that a <code>blang</code> may contain\n      other <code>blang</code>s. Also, <code>blang</code> is\n      parameterized by a polymorphic type <code>'a</code> which is\n      used for specifying the type of the value that goes under the\n      <code>Base</code> tag.\n    </blockquote>")))
 (idp8184064
  ((file variants.html)
   (html
    "<blockquote>\n      An expression in this language will be defined by the variant\n      <code>blang</code> (short for &quot;Boolean language&quot;)\n      with one tag for each kind of expression we want to support.\n    </blockquote>")))
 (idp8183296
  ((file variants.html)
   (html
    "<blockquote>\n      Another common application of variants is to represent tree-like\n      recursive data structures. We'll show how this can be done by\n      walking through the design of a simple Boolean expression\n      language. Such a language can be useful anywhere you need to\n      specify filters, which are used in everything from packet\n      analyzers to mail clients.\n    </blockquote>")))
 (idp8179408
  ((file variants.html)
   (html
    "<blockquote>\n      And it's explicit at the type level that\n      <code>handle_log_entry</code> sees only\n      <code>Log_entry</code> messages,\n      <code>handle_logon</code> sees only <code>Logon</code>\n      messages, etc.\n    </blockquote>")))
 (idp8175872
  ((file variants.html)
   (html
    "<blockquote>\n      In addition, this design allows us to essentially downcast to the\n      specific message type once we know what it is, and then dispatch\n      code to handle just that message type. In particular, while we use\n      the type <code>Common.t * details</code> to represent an\n      arbitrary message, we can use\n      <code>Common.t * Logon.t</code> to represent a logon\n      message. Thus, if we had functions for handling individual message\n      types, we could write a dispatch function as follows.\n    </blockquote>")))
 (idp8174704
  ((file variants.html)
   (html
    "<blockquote>\n      Note that the more complex match statement for computing the\n      session id has been replaced with the simple expression\n      <code>common.Common.session_id</code>.\n    </blockquote>")))
 (idp8170880
  ((file variants.html)
   (html
    "<blockquote>\n      A full message can then be represented as a pair of a\n      <code>Common.t</code> and a <code>details</code>.\n      Using this, we can rewrite our example above as follows:\n    </blockquote>")))
 (idp8169376
  ((file variants.html)
   (html
    "<blockquote>\n      Separately, we need a record that contains the fields that are\n      common across all messages.\n    </blockquote>")))
 (idp8167888
  ((file variants.html)
   (html
    "<blockquote>\n      We can then define a variant type that covers the different\n      possible unique components.\n    </blockquote>")))
 (idp8166016
  ((file variants.html)
   (html
    "<blockquote>\n      We can improve the code by refactoring our types to explicitly\n      separate the parts that are shared from those that are common. The\n      first step is to cut down the definitions of the per-message\n      records to just contain the unique components of each message.\n    </blockquote>")))
 (idp8164656
  ((file variants.html)
   (html
    "<blockquote>\n      This code effectively computes the session id for each underlying\n      message type. The repetition in this case isn't that bad, but\n      would become problematic in larger and more complicated examples.\n      Also, we had to include code for the <code>Logon</code>\n      case, even though it can't actually come up.\n    </blockquote>")))
 (idp8162880
  ((file variants.html)
   (html
    "<blockquote>\n      There's one awkward bit about the code above, which is the\n      calculation of the session ids. In particular, we have the\n      following repetitive snippet of code:\n    </blockquote>")))
 (idp8160528
  ((file variants.html)
   (html "<blockquote>\n      Here's the concrete code.\n    </blockquote>")))
 (idp8159792
  ((file variants.html)
   (html
    "<blockquote>\n          the set of messages so far that are associated with the user.\n        </blockquote>")))
 (idp8158912
  ((file variants.html)
   (html
    "<blockquote>\n          the set of session identifiers for the user that have been\n          seen thus far.\n        </blockquote>")))
 (idp8156944
  ((file variants.html)
   (html
    "<blockquote>\n      You can increase the precision of your types by using variants to\n      represent differences between types, and records to represent\n      shared structure. Consider the following function that takes a\n      list of <code>client_message</code>s and returns all\n      messages generated by a given user. The code in question is\n      implemented by folding over the list of messages, where the\n      accumulator is a pair of:\n    </blockquote>")))
 (idp8151648
  ((file variants.html)
   (html
    "<blockquote>\n      A <code>client_message</code> is a <code>Logon</code>\n<span><em>or</em></span> a <code>Heartbeat</code>\n<span><em>or</em></span> a <code>Log_entry</code>. If we want\n      to write code that processes messages generically, rather than\n      code specialized to a fixed message type, we need something like\n      <code>client_message</code> to act as one overarching type\n      for the different possible messages. We can then match on the\n      <code>client_message</code> to determine the type of the\n      particular message being dealt with.\n    </blockquote>")))
 (idp8145616
  ((file variants.html)
   (html
    "<blockquote>\n      This record type combines multiple pieces of data into one value.\n      In particular, a single <code>Log_entry.t</code> has a\n      <code>session_id</code> <span><em>and</em></span> a\n      <code>time</code> <span><em>and</em></span> an\n      <code>important</code> flag <span><em>and</em></span> a\n      <code>message</code>. More generally, you can think of\n      record types as acting as conjunctions. Variants, on the other\n      hand, are disjunctions, letting you represent multiple\n      possibilities, as in the following example.\n    </blockquote>")))
 (idp8142960
  ((file variants.html)
   (html
    "<blockquote>\n      Records and variants are most effective when used in concert.\n      Consider again the type <code>Log_entry.t</code> from\n      <a href=\"records.html\">Chapter\194\1605, <i>Records</i></a>:\n    </blockquote>")))
 (idp8140592
  ((file variants.html)
   (html
    "<blockquote>\n    But because the catch-all case encompasses all possibilities, the\n    type system will no longer warn us that we have missed the new\n    <code>Bold</code> case when we change the type to include it.\n    We can get this check back by being avoiding the catch-all case, and\n    instead being explicit about the tags that are ignored.\n  </blockquote>")))
 (idp8137248
  ((file variants.html)
   (html
    "<blockquote>\n    Here's an example that illustrates how catch-all cases interact with\n    exhaustion checks. Imagine we wanted a version of\n    <code>color_to_int</code> that works on older terminals by\n    rendering the first 16 colors (the 8 <code>basic_color</code>s\n    in regular and bold) in the normal way, but rendering everything\n    else as white. We might have written the function as follows.\n  </blockquote>")))
 (idp8136448
  ((file variants.html)
   (html
    "<blockquote>\n    As we've seen, the type errors identified the things that needed to\n    be fixed to complete the refactoring of the code. This is\n    fantastically useful, but for it to work well and reliably, you need\n    to write your code in a way that maximizes the compiler's chances of\n    helping you find the bugs. To this end, a useful rule of thumb is to\n    avoid catch-all cases in pattern matches.\n  </blockquote>")))
 (idp8134768
  ((file variants.html)
   (html
    "<blockquote>\n    Fixing this now leads us to the correct implementation.\n  </blockquote>")))
 (idp8131104
  ((file variants.html)
   (html
    "<blockquote>\n    Here, the compiler is complaining that the <code>Basic</code>\n    tag is used with the wrong number of arguments. If we fix that,\n    however, the compiler flag will flag a second problem, which is that\n    we haven't handled the new <code>Bold</code> tag.\n  </blockquote>")))
 (idp8126144
  ((file variants.html)
   (html
    "<blockquote>\n    We've essentially broken out the <code>Basic</code> case into\n    two cases, <code>Basic</code> and <code>Bold</code>, and\n    <code>Basic</code> has changed from having two arguments to\n    one. <code>color_to_int</code> as we wrote it still expects\n    the old structure of the variant, and if we try to compile that same\n    code again, the compiler will notice the discrepancy.\n  </blockquote>")))
 (idp8123936
  ((file variants.html)
   (html
    "<blockquote>\n    Consider what would happen if we were to change the definition of\n    <code>color</code> to the following.\n  </blockquote>")))
 (idp8123328
  ((file variants.html)
   (html
    "<blockquote>\n    OCaml's type system can act as a refactoring tool, by warning you of\n    places where your code needs to be updated to match an interface\n    change. This is particularly valuable in the context of variants.\n  </blockquote>")))
 (idp8121168
  ((file variants.html)
   (html
    "<blockquote>\n    Now, we can print text using the full set of available colors.\n  </blockquote>")))
 (idp8119232
  ((file variants.html)
   (html
    "<blockquote>\n    Once again, we'll use pattern matching to convert a color to a\n    corresponding integer. But in this case, the pattern matching does\n    more than separate out the different cases; it also allows us to\n    extract the data associated with each tag.\n  </blockquote>")))
 (idp8116720
  ((file variants.html)
   (html
    "<blockquote>\n    We'll also represent this more complicated color-space as a variant,\n    but this time, the different tags will have arguments which describe\n    the data available in each case. Note that variants can have\n    multiple arguments, which are separated by <code>*</code>'s.\n  </blockquote>")))
 (idp8116080
  ((file variants.html)
   (html
    "<blockquote>\n        A 24-level grayscale ramp\n      </blockquote>")))
 (idp8115184
  ((file variants.html)
   (html
    "<blockquote>\n        A 6\226\128\133\195\151\226\128\1336\226\128\133\195\151\226\128\1336 RGB color cube\n      </blockquote>")))
 (idp8114336
  ((file variants.html)
   (html
    "<blockquote>\n        The 8 basic colors, in regular and bold versions.\n      </blockquote>")))
 (idp8112256
  ((file variants.html)
   (html
    "<blockquote>\n    In this example, the cases of the variant are simple tag with no\n    associated data. This is substantively the same as the enumerations\n    found in languages like C and Java. But as we'll see, variants can\n    do considerably more than represent a simple enumeration. Indeed, an\n    enumeration isn't enough to effectively describe the full set of\n    colors that a modern terminal can display. Many terminals, including\n    the venerable <code>xterm</code>, support 256 different\n    colors, broken up into the following groups.\n  </blockquote>")))
 (idp8111648
  ((file variants.html)
   (html
    "<blockquote>\n    On most terminals, that word &quot;Blue&quot; will be rendered in\n    blue.\n  </blockquote>")))
 (idp8109584
  ((file variants.html)
   (html
    "<blockquote>\n    Using the above, we can generate escape codes to change the color of\n    a given string displayed in a terminal.\n  </blockquote>")))
 (idp8106864
  ((file variants.html)
   (html
    "<blockquote>\n    The following function uses pattern matching to convert a\n    <code>basic_color</code> to a corresponding integer. The\n    exhaustiveness checking on pattern matches means that the compiler\n    will warn us if we miss a color.\n  </blockquote>")))
 (idp8105072
  ((file variants.html)
   (html
    "<blockquote>\n    Let's consider a concrete example of how variants can be useful.\n    Almost all terminals support a set of 8 basic colors, and we can\n    represent those colors using a variant. Each color is declared as a\n    simple tag, with pipes used to separate the different cases. Note\n    that variant tags must be capitalized.\n  </blockquote>")))
 (idp8104256
  ((file variants.html)
   (html
    "<blockquote>\n    Variant types are one of the most useful features of OCaml, and also\n    one of the most unusual. They let you represent data that may take\n    on multiple different forms, where each form is marked by an\n    explicit tag. As we'll see, when combined with pattern matching,\n    variants give you a powerful way of representing complex data and of\n    organizing the case-analysis on that information.\n  </blockquote>")))
 (idp7498048
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          And indeed, when we provide the two positional arguments, the\n          <code>sep</code> argument is not erased, instead\n          returning a function that expects the <code>sep</code>\n          argument to be provided.\n        </blockquote>")))
 (idp7496128
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          An optional argument that doesn't have any following\n          positional arguments can't be erased at all, which leads to a\n          compiler warning.\n        </blockquote>")))
 (idp7494544
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          However, if all arguments to a function are presented at once,\n          then erasure of optional arguments isn't applied until all of\n          the arguments are passed in. This preserves our ability to\n          pass in optional arguments anywhere on the argument list.\n          Thus, we can write:\n        </blockquote>")))
 (idp7492720
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          then application of the first argument would not cause the\n          optional argument to be erased.\n        </blockquote>")))
 (idp7488896
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          The rule is: an optional argument is erased as soon as the\n          first positional (<span><em>i.e.</em></span>, neither labeled\n          nor optional) argument defined <span><em>after</em></span> the\n          optional argument is passed in. That explains the behavior of\n          <code>prepend_pound</code> above. But if we had instead\n          defined <code>concat</code> with the optional argument\n          in the second position:\n        </blockquote>")))
 (idp7488416
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          So when does OCaml decide to erase an optional argument?\n        </blockquote>")))
 (idp7485456
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          The optional argument <code>?sep</code> has now\n          disappeared, or been <span><em>erased</em></span>. Indeed, if\n          we try to pass in that optional argument now, it will be\n          rejected.\n        </blockquote>")))
 (idp7483888
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          But what happens if we partially apply just the first\n          argument?\n        </blockquote>")))
 (idp7482256
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Optional arguments can be tricky to think about in the\n          presence of partial application. We can of course partially\n          apply the optional argument itself:\n        </blockquote>")))
 (idp7477744
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          As suggested by the error message, we can get OCaml to accept\n          the fact that <code>f</code> is used with different\n          argument orders if we provide explicit type information. Thus,\n          the following code compiles without error, due to the type\n          annotation on <code>f</code>.\n        </blockquote>")))
 (idp7474544
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Note that these heuristics might at different points in the\n          source suggest different types. Here's a version of\n          <code>numeric_deriv</code> where different invocations\n          of <code>f</code> list the arguments in different\n          orders.\n        </blockquote>")))
 (idp7473840
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Since there are multiple plausible types to choose from, OCaml\n          needs some heuristic for choosing between them. The heuristic\n          the compiler uses is to prefer labels to options, and to\n          choose the order of arguments that shows up in the source\n          code.\n        </blockquote>")))
 (idp7470944
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Even worse, it would be perfectly consistent for\n          <code>f</code> to take an optional argument instead of a\n          labeled one, which could lead to this type signature for\n          <code>numeric_deriv</code>:\n        </blockquote>")))
 (idp7468432
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          In principle, it's not obvious how the order of the arguments\n          to <code>f</code> should be chosen. Since labeled\n          arguments can be passed in arbitrary order, it seems like it\n          could as well be\n          <code>y:float -&gt; x:float -&gt; float</code> as it is\n          <code>x:float -&gt; y:float -&gt; float</code>.\n        </blockquote>")))
 (idp7460352
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          One subtle aspect of labeled and optional arguments is how\n          they are inferred by the type system. Consider the following\n          example for computing numerical derivatives of a function of\n          two dimensions. The function takes an argument\n          <code>delta</code> which determines the scale at which\n          to compute the derivative, values <code>x</code> and\n          <code>y</code> which determine which point to compute\n          the derivative at, and the function <code>f</code> whose\n          derivative is being computed. The function\n          <code>f</code> itself takes two labeled arguments\n          <code>x</code> and <code>y</code>. Note that you\n          can use an apostrophe as part of a variable name, so\n          <code>x'</code> and <code>y'</code> are just\n          ordinary variables.\n        </blockquote>")))
 (idp7456384
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Now, if someone calls <code>uppercase_concat</code>\n          without an argument, an explicit <code>None</code> will\n          be passed to <code>concat</code>, leaving\n          <code>concat</code> to decide what the default behavior\n          should be.\n        </blockquote>")))
 (idp7452944
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Instead, we can have <code>uppercase_concat</code>\n          simply pass through the optional argument to\n          <code>concat</code> using the <code>?</code>\n          syntax.\n        </blockquote>")))
 (idp7451024
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          In the way we've written it, we've been forced to separately\n          make the decision as to what the default separator is. Thus,\n          if we later change <code>concat</code>'s default\n          behavior, we'll need to remember to change\n          <code>uppercase_concat</code> to match it.\n        </blockquote>")))
 (idp7447808
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          One use-case for this is when you want to define a wrapper\n          function that mimics the optional arguments of the function\n          it's wrapping. For example, imagine we wanted to create a\n          function called <code>uppercase_concat</code>, which is\n          the same as <code>concat</code> except that it converts\n          the first string that it's passed to uppercase. We could write\n          the function as follows.\n        </blockquote>")))
 (idp7444864
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          And the following two lines are equivalent ways of calling\n          <code>concat</code> without specifying\n          <code>sep</code>.\n        </blockquote>")))
 (idp7439824
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          But sometimes, passing in <code>Some</code> or\n          <code>None</code> explicitly is exactly what you want.\n          OCaml lets you do this by using <code>?</code> instead\n          of <code>~</code> to mark the argument. Thus, the\n          following two lines are equivalent ways of specifying the\n          <code>sep</code> argument to concat.\n        </blockquote>")))
 (idp7436672
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Under the covers, a function with an optional argument\n          receives <code>None</code> when the caller doesn't\n          provide the argument, and <code>Some</code> when it\n          does. But the <code>Some</code> and\n          <code>None</code> are normally not explicitly passed in\n          by the caller.\n        </blockquote>")))
 (idp7432976
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This means that rarely used functions should not have optional\n        arguments. A good rule of thumb is to avoid optional arguments\n        for functions internal to a module, <span><em>i.e.</em></span>,\n        functions that are not included in the module's interface, or\n        <code>mli</code> file. We'll learn more about\n        <code>mli</code>s in\n        <a href=\"files-modules-and-programs.html\">Chapter\194\1604, <i>Files, Modules and Programs</i></a>.\n      </blockquote>")))
 (idp7432240
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The downside is that the caller may be unaware that there is a\n        choice to be made, and so may unknowingly (and wrongly) pick\n        that default behavior. Optional arguments really only make sense\n        when the extra concision of omitting the argument overwhelms the\n        corresponding loss of explicitness.\n      </blockquote>")))
 (idp7431504
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Optional arguments are very useful, but they're also easy to\n        abuse. The key advantage of optional arguments is that they let\n        you write functions with multiple arguments that users can\n        ignore most of the time, only worrying about them when they\n        specifically want to invoke those options.\n      </blockquote>")))
 (idp7429136
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        In the above example, we had a bit of code to substitute in the\n        empty string when no argument was provided. This is a common\n        enough pattern that there's an explicit syntax for providing a\n        default value, which allows us to write\n        <code>concat</code> even more concisely.\n      </blockquote>")))
 (idp7423600
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Here, <code>?</code> is used in the definition of the\n        function to mark <code>sep</code> as optional. And while\n        the caller can pass a value of type <code>string</code>\n        for <code>sep</code>, internally to the function,\n        <code>sep</code> is seen as a\n        <code>string option</code>, with <code>None</code>\n        appearing when <code>sep</code> is not provided by the\n        caller.\n      </blockquote>")))
 (idp7421136
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Here's an example of a string concatenation function with an\n        optional separator. This function uses the <code>^</code>\n        operator for simple pairwise string concatenation.\n      </blockquote>")))
 (idp7420432
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        An optional argument is like a labeled argument that the caller\n        can choose whether or not to provide. Optional arguments are\n        passed in using the same syntax as labeled arguments, and, like\n        labeled arguments, optional arguments can be provided in any\n        order.\n      </blockquote>")))
 (idp7418624
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          So, even though the order of labeled arguments usually doesn't\n          matter, it will sometimes bite you in higher-ordered contexts,\n          where you're passing functions as arguments to other functions\n          as we were in the above examples.\n        </blockquote>")))
 (idp7416464
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          But, it works smoothly with the original\n          <code>apply_to_tuple</code>.\n        </blockquote>")))
 (idp7414176
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          we'll find that it can't be passed in to\n          <code>apply_to_tuple_2</code>.\n        </blockquote>")))
 (idp7412608
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          It turns out this order of listing matters. In particular, if\n          we define a function that has a different order\n        </blockquote>")))
 (idp7408336
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          Here, the definition of <code>apply_to_tuple</code> sets\n          up the expectation that its first argument is a function with\n          two labeled arguments, <code>first</code> and\n          <code>second</code>, listed in that order. We could have\n          defined <code>apply_to_tuple</code> differently to\n          change the order in which the labeled arguments were listed.\n        </blockquote>")))
 (idp7406144
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n          One surprising gotcha with labeled arguments is that while\n          order doesn't matter when calling a function with labeled\n          arguments, it does matter in a higher-order context,\n          <span><em>e.g.</em></span>, when passing a function with\n          labeled arguments to another function. Here's an example.\n        </blockquote>")))
 (idp7404288
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            In other cases, you want to put the function argument\n            second. One common reason is readability. In particular, a\n            multi-line function passed as an argument to another\n            function is easiest to read when it is the final argument to\n            that function.\n          </blockquote>")))
 (idp7401136
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            When you want flexibility on the order in which arguments\n            are passed. Consider a function like\n            <code>List.iter</code>, that takes two arguments: a\n            function, and a list of elements to call that function on. A\n            common pattern is to partially apply\n            <code>List.iter</code> by giving it just the function,\n            as in the following example from earlier in the chapter.\n            This requires putting the function argument first.\n          </blockquote>")))
 (idp7399168
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            but with labeled arguments, we can make the intent much\n            clearer.\n          </blockquote>")))
 (idp7397296
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            When the meaning of a particular argument is unclear from\n            the type alone. For example, consider a function for\n            creating a hashtable where the first argument is the initial\n            size of the table, and the second argument is a flag which,\n            when true, indicates that the hashtable will reduce its size\n            when the hashtable contains few elements. The following\n            signature doesn't give you much of a hint as to the meaning\n            of the arguments.\n          </blockquote>")))
 (idp7395648
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            This improves the readability of both the signature and of\n            client code that makes use of <code>substring</code>,\n            and makes it harder to accidentally swap the position and\n            the length.\n          </blockquote>")))
 (idp7394080
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            where the two ints are the starting position and length of\n            the substring to extract. Labeled arguments can make this\n            signature clearer:\n          </blockquote>")))
 (idp7392496
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            When defining functions that have multiple arguments that\n            might get confused with each other. This is most at issue\n            when the arguments are of the same type. For example,\n            consider this signature for a function for extracting a\n            substring of another string.\n          </blockquote>")))
 (idp7391536
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n            When defining a function with lots of arguments. Beyond a\n            certain number, arguments are easier to remember by name\n            than by position.\n          </blockquote>")))
 (idp7390560
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Labeled arguments are useful in a few different cases:\n      </blockquote>")))
 (idp7387856
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        OCaml also supports <span><em>label punning</em></span>, meaning\n        that you get to drop the text after the <code>:</code> if\n        the name of the label and the name of the variable being used\n        are the same. We've seen above how label punning works when\n        defining a function. The following shows how it can be used when\n        invoking a function.\n      </blockquote>")))
 (idp7386336
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        We can then provide a labeled argument using a similar\n        convention. As you can see, the arguments can be provided in any\n        order.\n      </blockquote>")))
 (idp7384080
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Up until now, we've written functions where the arguments are\n        specified positionally, <span><em>i.e.</em></span>, by the order\n        in which the arguments are passed to the function. OCaml also\n        supports labeled arguments, which let you identify a function\n        argument by name. Labels are marked by a leading tilde, and a\n        label (followed by a colon) are put in front of the variable to\n        be labeled.\n      </blockquote>")))
 (idp7380608
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Also, note the use of partial application to generate the\n        function passed to <code>List.map</code>. In other words,\n        <code>some_or_default 100</code> is a function that was\n        created by feeding just the first argument to\n        <code>some_or_default</code>.\n      </blockquote>")))
 (idp7378560
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        We can also combine the different styles of function declaration\n        together, as in the following example where we declare a two\n        argument (curried) function with a pattern match on the second\n        argument.\n      </blockquote>")))
 (idp7376416
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This is equivalent to combining an ordinary function definition\n        with a <code>match</code>.\n      </blockquote>")))
 (idp7373344
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Another way to define a function is using the\n        <code>function</code> keyword. Instead of having syntactic\n        support for declaring multi-argument (curried) functions,\n        <code>function</code> has built-in pattern matching.\n        Here's an example:\n      </blockquote>")))
 (idp7371264
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The type error aside, this example highlights the importance of\n        choosing the operator you use with care, particularly with\n        respect to associativity.\n      </blockquote>")))
 (idp7368080
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The above type error is a little bewildering at first glance.\n        What's going on is that, because <code>^!</code> is right\n        associative, the operator is trying to feed the value\n        <code>List.dedup ~compare:String.compare</code> to the\n        function <code>List.iter ~f:print_endline</code>. But\n        <code>List.iter ~f:print_endline</code> expects a list of\n        strings as its input, not a function.\n      </blockquote>")))
 (idp7365280
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Note that <code>|&gt;</code> only works in the intended\n        way because it is left-associative. Indeed, let's see what\n        happens if we try using a right associative operator, like (^!).\n      </blockquote>")))
 (idp7364192
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        It is this later form that we're using in the\n        <code>|&gt;</code> pipeline above.\n      </blockquote>")))
 (idp7362688
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Or, we can pass it just the function argument, leaving us with a\n        function for printing out a list of strings.\n      </blockquote>")))
 (idp7359712
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        An important part of what's happening here is partial\n        application. Normally, <code>List.iter</code> takes two\n        arguments: a function to be called on each element of the list,\n        and the list to iterate over. We can call\n        <code>List.iter</code> with all its arguments:\n      </blockquote>")))
 (idp7357248
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Note that we can do this without <code>|&gt;</code>, but\n        the result is a bit more verbose.\n      </blockquote>")))
 (idp7353696
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        It's not quite obvious at first what the purpose of this\n        operator is: it just takes some value and a function, and\n        applies the function to the value. But its utility is clearer\n        when you see it in action. It works as a kind of sequencing\n        operator, similar in spirit to using pipe in the UNIX shell.\n        Consider, for example, the following code for printing out the\n        unique elements of your <code>PATH</code>. Note that\n        <code>List.dedup</code> below removes duplicates from a\n        list by sorting the list using the provided comparison function.\n      </blockquote>")))
 (idp7352288
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Here's an example of a very useful operator that's defined in\n        Core, following these rules. Here's the definition:\n      </blockquote>")))
 (idp7349200
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        There's one important special case: <code>-</code> and\n        <code>-.</code>, which are the integer and floating point\n        subtraction operators, can act as both prefix operators (for\n        negation) and infix operators (for subtraction), So, both\n        <code>-x</code> and <code>x - y</code> are\n        meaningful expressions.\n      </blockquote>")))
 (idp7298304
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The syntactic role of an operator is typically determined by its\n        first character or two, though there are a few exceptions. This\n        table breaks the different operators and other syntactic forms\n        into groups from highest to lowest precedence, explaining how\n        each behaves syntactically. We write <code>!</code>... to\n        indicate the class of operators beginning with\n        <code>!</code>.\n      </blockquote>")))
 (idp7296704
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        We can define (or redefine) the meaning of an operator as\n        follows. Here's an example of a simple vector-addition operator\n        on int pairs.\n      </blockquote>")))
 (idp7294736
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        or is one of a handful of pre-determined strings, including\n        <code>mod</code>, the modulus operator, and\n        <code>lsl</code>, for &quot;logical shift left&quot;, a\n        bit-shifting operation.\n      </blockquote>")))
 (idp7293360
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        A function is treated syntactically as an operator if the name\n        of that function is chosen from one of a specialized set of\n        identifiers. This set includes any identifier that is a sequence\n        of characters from the following set\n      </blockquote>")))
 (idp7291472
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        In the second expression above, we've partially applied\n        <code>(+)</code> to gain a function that increments its\n        single argument by <code>3</code>, and then applied that\n        to all the elements of a list.\n      </blockquote>")))
 (idp7289152
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        You might not have thought of the second example as an ordinary\n        function, but it very much is. Infix operators like\n        <code>+</code> really only differ syntactically from other\n        functions. In fact, if we put parenthesis around an infix\n        operator, you can use it as an ordinary prefix function.\n      </blockquote>")))
 (idp7287696
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        So far, we've seen examples of functions used in both prefix and\n        infix style:\n      </blockquote>")))
 (idp7286112
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        In addition, having a non-recursive form makes it easier to\n        create a new definition that extends and supersedes an existing\n        one by shadowing it.\n      </blockquote>")))
 (idp7285264
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        But this decision has some good effects. For one thing,\n        recursive (and especially mutually recursive) definitions are\n        harder to reason about than non-recursive definitions that\n        proceed in order, each building on top of what has already been\n        defined. It's therefore useful that, in the absence of an\n        explicit marker, new definitions can only build upon ones that\n        were previously defined.\n      </blockquote>")))
 (idp7283232
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        OCaml distinguishes between non-recursive definitions (using\n        <code>let</code>) and recursive definitions (using\n        <code>let rec</code>) largely for technical reasons: the\n        type-inference algorithm needs to know when a set of function\n        definitions are mutually recursive, and for reasons that don't\n        apply to a pure language like Haskell, these have to be marked\n        explicitly by the programmer.\n      </blockquote>")))
 (idp7279552
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        We can also define multiple mutually recursive values by using\n        <code>let rec</code> combined with the\n        <code>and</code> keyword. Here's a (gratuitously\n        inefficient) example.\n      </blockquote>")))
 (idp7276560
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Note that in the above, the pattern\n        <code>| [] | [_]</code> is actually the combination of two\n        patterns; <code>[]</code>, matching the empty list, and\n        <code>[_]</code>, matching any single element list. The\n        <code>_</code> is there so we don't have to put an\n        explicit name on that single element.\n      </blockquote>")))
 (idp7274080
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        In order to define a recursive function, you need to mark the\n        let binding as recursive with the <code>rec</code>\n        keyword, as shown in this example:\n      </blockquote>")))
 (idp7271056
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        A function is <span><em>recursive</em></span> if it refers to\n        itself in its definition. Recursion is important in any\n        programming language, but is particularly important in\n        functional languages, because it is the fundamental building\n        block that is used for building looping constructs. (As we'll\n        see in <a href=\"a-guided-tour.html#imperative-programming\">the section called \226\128\156Imperative programming\226\128\157</a>, OCaml\n        also supports imperative looping constructs like\n        <code>for</code> and <code>while</code>, but these\n        are only useful when using OCaml's imperative features.)\n      </blockquote>")))
 (idp7269456
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        There are small tradeoffs between these two approaches, but most\n        of the time, one should stick to currying, since it's the\n        default style in the OCaml world.\n      </blockquote>")))
 (idp7268752
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        OCaml handles this calling convention efficiently as well. In\n        particular it does not generally have to allocate a tuple just\n        for the purpose of sending arguments to a tuple-style function.\n        (You can't, however, use partial application for this style of\n        function.)\n      </blockquote>")))
 (idp7267136
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Currying is not the only way of writing a multi-argument\n        function in OCaml. It's also possible to use the different arms\n        of a tuple as different arguments. So, we could write:\n      </blockquote>")))
 (idp7266448
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        You might worry that curried functions are terribly expensive,\n        but this is not the case. In OCaml, there is no penalty for\n        calling a curried function with all of its arguments. (Partial\n        application, unsurprisingly, does have a small extra cost.)\n      </blockquote>")))
 (idp7263760
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Note that the <code>fun</code> keyword supports its own\n        syntax for currying, so the following definition of\n        <code>abs_diff</code> is equivalent to the definition\n        above.\n      </blockquote>")))
 (idp7262864
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The practice of applying some of the arguments of a curried\n        function to get a new function is called <span><em>partial\n        application</em></span>.\n      </blockquote>")))
 (idp7259648
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Currying is more than just a theoretical curiosity. You can make\n        use of currying to specialize a function by feeding in some of\n        the arguments. Here's an example where we create a specialized\n        version of <code>abs_diff</code> that measures the\n        distance of a given number from <code>3</code>.\n      </blockquote>")))
 (idp7256288
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This style of function is called a <span><em>curried</em></span>\n        function. (Currying is named after Haskell Curry, a famous\n        logician who had a significant impact on the design and theory\n        of programming languages.) The key to interpreting the type\n        signature of a curried function is the observation that\n        <code>-&gt;</code> is right-associative. The type\n        signature of <code>abs_diff</code> can therefore be\n        parenthesized as follows. This doesn't change the meaning of the\n        signature, but it makes it easier to see how the currying fits\n        in.\n      </blockquote>")))
 (idp7253088
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This rewrite makes it explicit that <code>abs_diff</code>\n        is actually a function of one argument that returns another\n        function of one argument, which itself returns the final\n        computation. Because the functions are nested, the inner\n        expression <code>abs (x - y)</code> has access to both\n        <code>x</code>, which was captured by the first function\n        application, and <code>y</code>, which was captured by the\n        second one.\n      </blockquote>")))
 (idp7249616
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        You may find the type signature of <code>abs_diff</code>\n        with all of its arrows a little hard to parse. To understand\n        what's going on, let's rewrite <code>abs_diff</code> in an\n        equivalent form, using the <code>fun</code> keyword:\n      </blockquote>")))
 (idp7248128
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        OCaml of course also supports multi-argument functions, for\n        example:\n      </blockquote>")))
 (idp7245968
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This connection is important, and will come up more when\n        programming in a monadic style, as we'll see in\n        <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>.\n      </blockquote>")))
 (idp7244224
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Functions and let bindings have a lot to do with each other. In\n        some sense, you can think of the argument of a function as a\n        variable being bound to the value passed by the caller. Indeed,\n        the following two expressions are nearly equivalent:\n      </blockquote>")))
 (idp7241744
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This is the most common and convenient way to declare a\n        function, but syntactic niceties aside, the two styles of\n        function definition are entirely equivalent.\n      </blockquote>")))
 (idp7239600
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Defining named functions is so common that there is a built in\n        syntax for it. Thus, the following definition of\n        <code>plusone</code> is equivalent to the definition\n        above.\n      </blockquote>")))
 (idp7237760
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        The key thing to understand is that functions are ordinary\n        values in OCaml, and you can do everything with them that you'd\n        do with an ordinary value, including passing them to and\n        returning them from other functions and storing them in data\n        structures. We even name functions in the same way that we name\n        other values, by using a let binding.\n      </blockquote>")))
 (idp7233744
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        It's worth stopping for a moment to puzzle this example out,\n        since this kind of higher-order use of functions can be a bit\n        obscure at first. The first thing to understand is the function\n        <code>(fun f -&gt; f 5)</code>, which takes a function as\n        its argument and applies that function to the number\n        <code>5</code>. The invocation of\n        <code>List.map</code> applies\n        <code>(fun f -&gt; f 5)</code> to the elements of the\n        <code>increments</code> list (which are themselves\n        functions) and returns the list containing the results of these\n        function applications.\n      </blockquote>")))
 (idp7232208
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Or even stuff them into a data structure.\n      </blockquote>")))
 (idp7229920
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Or pass it to another function. Passing functions to iteration\n        functions like <code>List.map</code> is probably the most\n        common use-case for anonymous functions.\n      </blockquote>")))
 (idp7228352
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Anonymous functions aren't named, but they can be used for many\n        different purposes nonetheless. You can, for example, apply an\n        anonymous function to an argument.\n      </blockquote>")))
 (idp7225712
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        We'll start by looking at the most basic style of function\n        declaration in OCaml: the <span><em>anonymous</em></span>\n        function. An anonymous function is a function value that is\n        declared without being named. They can be declared using the\n        <code>fun</code> keyword, as shown here.\n      </blockquote>")))
 (idp7224032
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      OCaml being a functional language, it's no surprise that functions\n      are an important and pervasive element of programming in OCaml.\n      Indeed, we've seen functions pop up already in many of the\n      examples we've looked at thus far. But while we've introduced the\n      basics of functions, we're now going to cover them in more depth,\n      starting from the foundations.\n    </blockquote>")))
 (idp7220304
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        This case can't really come up in practice, because\n        <code>String.split</code> always returns a list with at\n        least one element. But the compiler doesn't know this, and so it\n        emits the warning. It's generally better to use a match\n        statement to handle such cases explicitly:\n      </blockquote>")))
 (idp7217136
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Using a pattern in a let-binding makes the most sense for a\n        pattern that is <span><em>irrefutable</em></span>,\n        <span><em>i.e.</em></span>, where any value of the type in\n        question is guaranteed to match the pattern. Tuple and record\n        patterns are irrefutable, but list patterns are not. Consider\n        the following code that implements a function for up-casing the\n        first element of a comma-separated list.\n      </blockquote>")))
 (idp7214640
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Here, <code>(ints,strings)</code> is a pattern, and the\n        <code>let</code> binding assigns values to both of the\n        identifiers that show up in that pattern. A pattern is\n        essentially a description of the shape of a data-structure,\n        where some components are identifiers to be bound. As we saw in\n        <a href=\"a-guided-tour.html#tuples-lists-options-and-pattern-matching\">the section called \226\128\156Tuples, Lists, Options and Pattern Matching\226\128\157</a>,\n        OCaml has patterns for a variety of different data-types.\n      </blockquote>")))
 (idp7211776
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n        Another useful feature of let bindings is that they support the\n        use of <span><em>patterns</em></span> on the left-hand side.\n        Consider the following code, which uses\n        <code>List.unzip</code>, a function for converting a list\n        of pairs into a pair of lists.\n      </blockquote>")))
 (idp7209664
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      The same is true in a functional language. A function can be\n      applied to different inputs, and thus its variables will take on\n      different values, even though there's absolutely no mutation.\n    </blockquote>")))
 (idp7206432
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      The answer to this is that variables in a functional language are\n      really more like variables in an equation. If you think about the\n      mathematical equation <code>x (y + z) = x y + x z</code>,\n      there's no notion of mutating the variables <code>x</code>,\n      <code>y</code> and <code>z</code>. They vary in the\n      sense that you can instantiate this equation with different\n      numbers for those variables, and it still holds.\n    </blockquote>")))
 (idp7205776
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      One source of confusion for people new to functional langauges is\n      the fact that variables are typically immutable. This seems pretty\n      surprising even on linguistic terms. Isn't the whole point of a\n      variable that it can vary?\n    </blockquote>")))
 (idp7204080
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      In OCaml, let bindings are immutable. As we'll see in\n      <a href=\"a-guided-tour.html#imperative-programming\">the section called \226\128\156Imperative programming\226\128\157</a>, there are\n      mutable values in OCaml, but no mutable variables.\n    </blockquote>")))
 (idp7198464
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      Here, we redefined <code>pi</code> to be zero after the\n      definition of <code>area_of_circle</code>. You might think\n      that this would mean that the result of the computation would now\n      be zero, but you'd be wrong. In fact, the behavior of the function\n      is unchanged. That's because the original definition of\n      <code>pi</code> wasn't changed, it was just shadowed, so\n      that any subsequent reference to <code>pi</code> would see\n      the new definition of <code>pi</code> as zero. But there is\n      no later use of <code>pi</code>, so the binding doesn't make\n      a difference. Indeed, if you type the example above into the\n      toplevel, OCaml will warn you that the definition is unused.\n    </blockquote>")))
 (idp7196096
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      It's important not to confuse a sequence of let bindings with the\n      modification of a mutable variable. For example, consider how\n      <code>area_of_ring</code> would work if we had instead\n      written this purposefully confusing bit of code.\n    </blockquote>")))
 (idp7193152
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      One common idiom is to use a series of nested\n      <code>let</code>/<code>in</code> expressions to build\n      up the components of a larger computation. Thus, we might write:\n    </blockquote>")))
 (idp7189104
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      This time, in the inner scope we called the list of strings\n      <code>languages</code> instead of\n      <code>language_list</code>, thus hiding the original\n      definition of <code>languages</code>. But once the\n      definition of <code>dashed_languages</code> is complete, the\n      inner scope has closed and the original definition of languages\n      reappears.\n    </blockquote>")))
 (idp7186224
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      A let binding in an inner scope can <span><em>shadow</em></span>,\n      or hide, the definition from an outer scope. So, for example, we\n      could have written the <code>dashed_languages</code> example\n      as follows:\n    </blockquote>")))
 (idp7183488
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      Note that the scope of <code>language_list</code> is just\n      the expression\n      <code>String.concat ~sep:&quot;-&quot; language_list</code>,\n      and is not available at the toplevel, as we can see if we try to\n      access it now.\n    </blockquote>")))
 (idp7178640
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      This first evaluates <span><em><code>expr1</code></em></span>\n      and then evaluates <span><em><code>expr2</code></em></span>\n      with <span><em><code>identifier</code></em></span> bound to\n      whatever value was produced by the evaluation of\n      <span><em><code>expr1</code></em></span>. Here's how it looks\n      in practice.\n    </blockquote>")))
 (idp7176608
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n<code>let</code> can also be used to create a variable\n      binding whose scope is limited to a particular expression, using\n      the following syntax.\n    </blockquote>")))
 (idp7175248
  ((file variables-and-functions.html)
   (html "<blockquote>\n      Here's a simple example.\n    </blockquote>")))
 (idp7173584
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      Every variable binding has a <span><em>scope</em></span>, which is\n      the portion of the code that can refer to that binding. The scope\n      of a top-level let binding is everything that follows it in the\n      session, when using <code>utop</code>, or, when using\n      modules, for the remainder of the module.\n    </blockquote>")))
 (idp7172528
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      As we'll see when we get to the module system in\n      <a href=\"files-modules-and-programs.html\">Chapter\194\1604, <i>Files, Modules and Programs</i></a>, this same\n      syntax is used for let bindings at the top-level of a module.\n    </blockquote>")))
 (idp7168704
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n      At its simplest, a variable is an identifier whose meaning is\n      bound to a particular value. In OCaml these bindings are often\n      introduced using the <code>let</code> keyword. We can type a\n      so-called <span><em>top-level</em></span> <code>let</code>\n      binding into <code>utop</code> with the following syntax to\n      bind a new variable. Note that variable names must start with a\n      lowercase letter.\n    </blockquote>")))
 (idp7167072
  ((file variables-and-functions.html)
   (html
    "<blockquote>\n    Variables and functions are fundamental ideas that show up in\n    virtually all programming languages. But OCaml has a different take\n    on these basic concepts, and so we'll spend some time digging into\n    the details so you can see how OCaml's variables and functions\n    differ from what you may have encountered in other languages.\n  </blockquote>")))
 (idp11621632
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n</blockquote>")))
 (idp11619872
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n</blockquote>")))
 (idp11617504
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        (<span><em>avsm</em></span>: I need to clarify this more,\n        possibly a diagram too. It's not really clear what the\n        implications of an impure heap are atm)\n      </blockquote>")))
 (idp11616272
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        If the marking is able to complete using just the gray list, it\n        will. Otherwise, once the gray list is emptied, the mark phase\n        will observe that the heap is impure and initiate a backup\n        approach to marking. In this approach it marks the heap as pure\n        and then walks through the entire heap block by block, in\n        increasing order of memory address. If it finds a gray block, it\n        adds it to the gray list and does a DFS marking using the gray\n        list as a stack in the usual way. Once the scan of the complete\n        heap is finished, the mark phase checks again whether the heap\n        has again become impure, and if so initiates another scan. These\n        full-heap scans will continue until a successful scan completes\n        without overflowing the gray list.\n      </blockquote>")))
 (idp11608320
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The <code>gray_vals</code> array initially has 2048\n        elements. <code>gray_vals_cur</code> starts at\n        <code>gray_vals</code>, and increases until it reachs\n        <code>gray_vals_end</code>, at which point the\n        <code>gray_vals</code> array is doubled, as long as its\n        size (in bytes) is less than 1/2^10th of the heap size\n        (<code>caml_stat_heap_size</code>). When the gray vals is\n        of its maximum allowed size, it isn't grown any further, and the\n        heap is marked as impure (<code>heap_is_pure=0</code>),\n        and last half of <code>gray_vals</code> is ignored (by\n        setting <code>gray_vals_cur</code> back to the middle of\n        the <code>gray_vals</code> array.\n      </blockquote>")))
 (idp11605024
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Marking maintains an array of gray blocks,\n        <code>gray_vals</code>. It uses as them as a stack,\n        pushing on a white block that is then colored gray, and popping\n        off a gray block when it is scanned and colored black. The\n        <code>gray_vals</code> array is allocated via\n        <span><em>malloc(3)</em></span>, and there is a pointer,\n        <code>gray_vals_cur</code>, to the next open spot in the\n        array.\n      </blockquote>")))
 (idp11602416
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n<code>Phase_sweep</code>\n</blockquote>")))
 (idp11600624
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n<code>Subphase_final</code>: initialise for the\n                sweep phase\n              </blockquote>")))
 (idp11599072
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n<code>Subphase_weak2</code>: remove dead weak\n                arrays, observe finalized values\n              </blockquote>")))
 (idp11597568
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n<code>Subphase_weak1</code>: clear weak pointers\n              </blockquote>")))
 (idp11596064
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n<code>Subphase_main</code>: main marking phase\n              </blockquote>")))
 (idp11594480
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n<code>Phase_mark</code>\n</blockquote>")))
 (idp11593024
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n<code>Phase_idle</code>\n</blockquote>")))
 (idp11591904
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The major heap collections operates incrementally, as the amount\n        of memory being tracked is a lot larger than the minor heap. The\n        major collector can be in any of a number of phases:\n      </blockquote>")))
 (idp11587952
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        (<span><em>avsm</em></span>: I dont think we've introduced weak\n        references yet, so this needs rearranging) At the end of the\n        depth-first search in minor collection, the collector scans the\n        <code>weak-ref</code> table, and clears any weak\n        references that are still pointing into the minor heap. The\n        collector then empties the <code>weak-ref</code> table and\n        the minor heap.\n      </blockquote>")))
 (idp11586176
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        (<span><em>avsm</em></span>: note from sweeks to investigate:\n        There is a hack for objects whose tag is\n        <code>Forward_tag</code> that does some kind of path\n        compression, or at least removal of one link, but I'm not sure\n        what's going on.)\n      </blockquote>")))
 (idp11584096
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Values that are known from the tag in their header to not\n        contain pointers are simply forwarded and completely copied, and\n        never placed on the <code>oldify_todo_list</code>. These\n        tags are all greater than <code>No_scan_tag</code> and\n        include strings and float arrays.\n      </blockquote>")))
 (idp11581184
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Each value on the <code>oldify_todo_list</code> is marked\n        as forwarded, and the first word points to the new block in the\n        major heap. That new version contains the actual value header,\n        the real first field of the value, and a link (pointer) to the\n        next value on the oldify_todo_list, or\n        <sub>NULL</sub> at the end of the list. Clearly this\n        approach won't work if an value has only one field, since there\n        will be no second field to store the link in. Values with\n        exactly one field are never put on the\n        <code>oldify_todo_list</code>; instead, the collector\n        immediately traverses them, essentially making a tail call in\n        the depth-first search.\n      </blockquote>")))
 (idp11578640
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Because a forwarded block might itself contain pointers, it must\n        at some point be scanned to see if those pointers point to\n        blocks in the minor heap, so that those blocks can also be\n        forwarded. The collector maintains a linked list (called the\n        <code>oldify_todo_list</code>) of forwarded objects that\n        it still needs to scan. That linked list looks like:\n      </blockquote>")))
 (idp11575984
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Moving a block between heaps is traditionally called\n        <span><em>forwarding</em></span>. The OCaml runtime code uses\n        that term as well as the term <span><em>oldify</em></span>, which\n        is useful to understand when profiling hotspots in your code.\n        The minor collector first visits all roots and forwards them if\n        they point to a block in the minor heap. When a block is\n        forwarded, the collector sets the tag of the original block to a\n        special <code>Forward_tag</code> (250), and the first\n        field of the original block to point to the new block. Then, if\n        the collector ever encounters a pointer to the original block\n        again, it can simply update the pointer directly into the\n        forwarded block.\n      </blockquote>")))
 (idp11574080
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            Intergenerational pointers in the\n            <code>caml_ref_table</code>\n            (<span><em>avsm</em></span>: xref above?)\n          </blockquote>")))
 (idp11572816
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            Finalized values (<span><em>avsm</em></span>: ?)\n          </blockquote>")))
 (idp11572000
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n            Global roots\n          </blockquote>")))
 (idp11569264
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            C stack(s), identified by <code>BeginRoots</code> or\n            <code>CAMLparam</code> in C code\n            (<span><em>avsm</em></span>: xref C bindings chapter)\n          </blockquote>")))
 (idp11568448
  ((file understanding-the-garbage-collector.html)
   (html "<blockquote>\n            OCaml stack(s)\n          </blockquote>")))
 (idp11566208
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The goal of minor collection is to empty the minor heap by\n        moving to the major heap every block in the minor heap that\n        might be used in the future, and updating each pointer to a\n        moved block to the new version of the block. A block is\n        <span><em>live</em></span> if is reachable by starting at some\n        <span><em>root</em></span> pointer into a block in the minor\n        heap,a nd then following pointers in blocks. There are many\n        different kinds of roots:\n      </blockquote>")))
 (idp11565424
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        For those familiar with garbage collection terminology, here is\n        OCaml's minor colection in one sentence. OCaml's minor\n        collection uses copying collection with forwarding pointers, and\n        does a depth-first traversal of the block graph using a stack\n        represented as a linked list threaded through blocks that need\n        to be scanned.\n      </blockquote>")))
 (idp11561696
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          (<span><em>avsm</em></span>: need to mention when a value is\n          allocated directly into the major heap somewhere)\n        </blockquote>")))
 (idp11560688
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          (<span><em>avsm</em></span>: it would be really nice to use a\n          benchmark suite here and shorten the example. Investigate the\n          options and edit this section)\n        </blockquote>")))
 (idp11559744
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          Notice the space/time tradeoff here. The mutable version runs\n          almost 4 times slower than the immutable one, but has\n          significantly fewer garbage collection cycles. Minor\n          collections in OCaml are very fast, and so it is often\n          acceptable to use immutable data structures in preference to\n          the more conventional mutable versions. On the other hand, if\n          you only rarely mutable a value, it can be faster to take the\n          write barrier hit and not allocate at all.\n        </blockquote>")))
 (idp11556832
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          This program defines a type <code>t1</code> that is\n          mutable, and <code>t2</code> that is immutable. The main\n          loop iterates over both fields and runs a simple counter. It\n          measures two things: the wallclock time that all the\n          iterations take, and the number of minor garbage collections\n          that occurred during the test. The results should look\n          something like this:\n        </blockquote>")))
 (idp11553472
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          Let's see this for ourselves with a simple test program:\n        </blockquote>")))
 (idp11551184
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          The write barrier is one of the reasons why using immutable\n          data structures can sometimes be faster than mutable records.\n          The OCaml compiler keeps track of any mutable types and adds a\n          call to <code>caml_modify</code> before making the\n          change. The <code>caml_modify</code> checks that the\n          remembered set is consistent, which, although reasonably\n          efficient, can be slower than simply allocating a fresh value\n          on the fast minor heap.\n        </blockquote>")))
 (idp11547808
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The same address can occur in <code>caml_ref_table</code>\n        multiple times if a block field is mutated repeatedly and\n        alternated between pointing at the minor heap and the major\n        heap. The field in <code>caml_ref_table</code> also may\n        not always point into the minor heap (if it was changed after\n        being added), since fields are never removed. The entire table\n        is cleared as part of the minor collection process.\n      </blockquote>")))
 (idp11545136
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        In that case the entry is added at\n        <code>caml_ref_table.ptr</code>, which is then\n        incremented. If <code>ptr</code> is already at\n        <code>limit</code>, the table is doubled in size before\n        adding the address.\n      </blockquote>")))
 (idp11544400
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            the field is being changed to point into the minor heap\n          </blockquote>")))
 (idp11543536
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            the field previously did not point to the minor heap\n          </blockquote>")))
 (idp11542688
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            a field in a block in the major heap is mutated\n          </blockquote>")))
 (idp11540976
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        An address is added to <code>caml_ref_table</code> when\n        all of these conditions are satisfied:\n      </blockquote>")))
 (idp11539472
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The relationships of the pointers are as follows:\n      </blockquote>")))
 (idp11535600
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Most incremental generational garbage collectors have to keep\n        careful track of values pointing from old generations to younger\n        ones. The OCaml runtime is no exception, and maintains a set of\n        addresses in the major heap that may point into the minor heap.\n        These addresses are <span><em>not</em></span> OCaml pointers, and\n        just literal memory addresses. The runtime ensures that it never\n        relocates values in the major heap unless this\n        &quot;remembered&quot; set is empty. The set is maintained as a\n        dynamically resized array of pointers, which is itself\n        maintained via a collection of pointers known as the\n        <code>caml_ref_table</code>.\n      </blockquote>")))
 (idp11532928
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          (<span><em>avsm</em></span>: 0 is the next-fit policy, which is\n          quite fast but can result in fragmentation. 1 is the first-fit\n          policy, which can be slower in some cases but can be better\n          for programs with fragmentation problems. )\n        </blockquote>")))
 (idp11531344
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          (<span><em>avsm</em></span>: this really needs a diagram)\n        </blockquote>")))
 (idp11522080
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          If we did manage to find something suitable in the\n          <code>flp</code> array, say at index\n          <code>i</code>, we need to update\n          <code>flp</code>. This update is rather complex, and the\n          reason why first-fit allocation is slower than next-fit. We\n          walk through the free list between <code>flp[i-1]</code>\n          and <code>flp[i]</code> and record every high point we\n          come across. Say we find <code>j</code> such points. We\n          move the upper portion of <code>flp</code> (from\n          <code>flp[i+1]</code> to the end) to the right by\n          <code>j</code> places and insert each new high point\n          into the array. There is a further corner case when adding in\n          <code>j</code> new high points would make\n          <code>flp</code> bigger than <code>FLP_MAX</code>.\n        </blockquote>")))
 (idp11519280
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          There's also the case when the <code>flp</code> array\n          has its ceiling size of <code>FLP_MAX</code> (default\n          100). Then we just start at the end of the\n          <code>flp</code> array and walk until we find something\n          big enough. This is known in the as a slow first-fit search,\n          since this linear walk may take a long time.\n        </blockquote>")))
 (idp11513600
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          If there's nothing big enough in the <code>flp</code>\n          array, we extend it by walking the free list starting at the\n          <span><em>last</em></span> pointer in the\n          <code>flp</code>-array, say <code>flp[N]</code>.\n          We extend the <code>flp</code> array along the way, so\n          that at each block, if this block is bigger than the current\n          last thing in <code>flp</code> (which is equivalent to\n          saying this is the biggest block we've ever seen, since the\n          blocks pointed to by the <sub>flp</sub> array are\n          increasing in size), we add it to the end of\n          <sub>flp</sub>. We stop this walk when we come\n          across a block big enough to house our desired new block.\n        </blockquote>")))
 (idp11511552
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          When allocating, we first check the flp-array. If\n          <code>flp[i]</code> is not big enough for our new block,\n          then we may as well skip to <code>flp[i+1]</code>,\n          because everything in the free list before then will also be\n          too small.\n        </blockquote>")))
 (idp11507088
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          The runtime maintains an ordered array of freelist chunks,\n          called the <code>flp</code> array. Imagine a function\n          mapping a block's index in the free list to its size. The flp\n          array pointers are to the high points of this graph. That is,\n          if you walk the free list between <code>flp[i]</code>\n          and <code>flp[i+1]</code>, you will come across blocks\n          that have sizes at most the size of <code>flp[i]</code>.\n          Furthermore this sequence of smaller-than-flp[i] blocks cannot\n          be extended, which is equivalent to saying\n          <code>size(flp[i+1]) &gt; size(flp[i])</code>.\n        </blockquote>")))
 (idp11505968
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          First-fit allocation focusses on reducing memory\n          fragmentation, at the expense of slower block allocation. For\n          some workloads, the reduction in the frequency in heap\n          compaction will outweigh the extra allocation cost.\n          (<span><em>avsm</em></span>: example?)\n        </blockquote>")))
 (idp11504064
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n          Next-fit allocation keeps a pointer to the block in the free\n          list that was most recently used to satisfy a request. When a\n          new request comes in, the allocator searches from the next\n          block until the end of the free list, and then from the\n          beginning of the free list up to that block.\n        </blockquote>")))
 (idp11502336
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Allocating a new block in the major heap always looks in the\n        free list. There are two allocation policies: first fit and next\n        fit (the default).\n      </blockquote>")))
 (idp11499872
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            If the free block is two or more words larger than the\n            requested block, it remains in the free list, with its\n            length shortened, and the end of the free block is returned\n            for the requested block. Since the allocated block is\n            right-justified within the free block, the linking of the\n            free list doesn't need to be changed at all as the block\n            that remains in the free list is the original one.\n          </blockquote>")))
 (idp11498800
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            If the free block is one word too large, it is unlinked from\n            the free list, and the first word is given a special header\n            recognizable to the collector as an unused word, while the\n            rest of the block is returned as the requested block.\n          </blockquote>")))
 (idp11497872
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            If the free block is exactly the right size, it is unlinked\n            from the free list and returned as the requested block.\n          </blockquote>")))
 (idp11496832
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        As soon as the runtime finds a free block that is larger than\n        the request, there are three possibilities:\n      </blockquote>")))
 (idp11494624
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The free space in the major heap's chunks is organized as a\n        singly linked list of OCaml blocks, ordered by increasing\n        virtual address. The runtime has a pointer to the first block in\n        the free list. A free list block is at least two words: a header\n        followed by a pointer to the next free-list block. The header\n        specifies the length of the block just as with a normal block.\n        (<span><em>avsm</em></span>: I'm not sure that this is quite\n        true. It seems from <code>freelist.c</code> that the\n        freelist blocks are normal OCaml blocks, with the first data\n        entry being the next pointer. when detached, they become normal\n        ocaml blocks)\n      </blockquote>")))
 (idp11492128
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        Allocating a block on the major heap first checks the free list\n        of blocks (see below). If there isn't enough room on the free\n        list, the runtime expands the major heap with a fresh block that\n        will be large enough. That block is then added to the free list,\n        and the free list is checked again (and this time will\n        definitely succeed).\n      </blockquote>")))
 (idp11489328
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The chunk's data area always starts on a page boundary, and its\n        size is a multiple of the page size (4KB). It contains a\n        contiguous sequence of heap blocks. These can be as small as one\n        or two 4KB pages, but are usually allocated in 1MB chunks (or\n        512KB on 32-bit architectures). You can modify these defaults by\n        editing <code>Heap_chunk_def</code> in\n        <code>byterun/config.h</code> and recompiling the runtime.\n        (<span><em>avsm</em></span>: talk about modifying the defaults in\n        a separate callout, as there are quite a few variables which can\n        be tweaked)\n      </blockquote>")))
 (idp11488608
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            a link to the next heap chunk in the list.\n          </blockquote>")))
 (idp11487680
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            an allocation size in bytes, used during heap compaction to\n            merge small blocks to defragment the heap.\n          </blockquote>")))
 (idp11486832
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            the size in bytes of the data area\n          </blockquote>")))
 (idp11485456
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n            the address of the memory that the chunk is in, as allocated\n            by <span><em>malloc(3)</em></span>. It is needed when the\n            chunk is freed.\n          </blockquote>")))
 (idp11483648
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The major heap is a singly linked list of contiguous memory\n        chunks, sorted in increasing order of virtual address. Each\n        chunk is a single memory chunk allocated via\n        <span><em>malloc(3)</em></span> and consists of a header and a\n        data area which contains OCaml blocks. A pointer to a heap chunk\n        points to the start of the data area, and access to the header\n        is done by a negative offset from this pointer. A chunk header\n        has:\n      </blockquote>")))
 (idp11479072
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        To force a minor gc to occur, one can set the\n        <code>caml_young_limit</code> to equal\n        <code>caml_young_end</code>, which causes signal handlers\n        to be run and to &quot;urge&quot; the runtime\n        (<span><em>avsm</em></span>: elaborate on this urging business,\n        and how to set young from within OCaml via\n        <code>Gc.??</code>).\n      </blockquote>")))
 (idp11472544
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        In a fresh minor heap, the <code>limit</code> will equal\n        the <code>start</code>, and the current\n        <code>ptr</code> will equal the <code>end</code>. As\n        blocks are allocated, <code>caml_young_ptr</code> will\n        decrease until it reaches <code>caml_young_limit</code>,\n        at which point a minor garbage collection is triggered. To\n        allocate a block in the minor heap, we decrement\n        <code>caml_young_ptr</code> by the size of the block\n        (including the header), and then set the the header to a valid\n        value. If there isn't enough space left for the block without\n        decrementing past the <code>limit</code>, a minor\n        collection is triggered.\n      </blockquote>")))
 (idp11469712
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The range of memory usable for allocation goes from the\n        <code>caml_young_start</code> to\n        <code>caml_young_end</code> C variables managed by the\n        runtime.\n      </blockquote>")))
 (idp11467216
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n        The minor heap is a contiguous chunk of virtual memory. Its size\n        is set on program startup and decided by the\n        <code>OCAMLRUNPARAM</code> environment variable\n        (<span><em>avsm</em></span>: xref), and then only changed later\n        by calls to <code>Gc.set</code>. The default size is 256k.\n      </blockquote>")))
 (idp11465472
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n      The page table starts with a size aiming to be between 25% and 50%\n      full of entries, and is automatically doubled in size if it\n      becomes half full. It is never shrunk.\n    </blockquote>")))
 (idp11449872
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n      The byte value stored is a bitwise <code>or</code> of the\n      following status bits:\n    </blockquote>")))
 (idp11447968
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n      Since the virtual memory space can be very large and sparsely used\n      (especially on a 64-bit CPU), the page table is implemented as a\n      hash table in which keys are page-aligned addresses and values are\n      a single byte. The hash table is represented as an array of words,\n      with each word being a key-value pair. The key-value pair is the\n      bitwise <code>or</code> of the virtual address of the start\n      of the page (which has zeros for its lower 12-bits due to being\n      aligned to 4KB), and the lower 8 bits are used for the value. To\n      look up an address, one masks out the lower 12-bits of the memory\n      address, compute a multiplicative hash to get a table index, and\n      then compares against the address (i.e. the key) at that index.\n      Linear probing is used to resolve collisions.\n    </blockquote>")))
 (idp11446832
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n      The runtime maintains a <span><em>page table</em></span> that\n      allows it to determine the status of any virtual memory address in\n      the operating system process. The status defines whether that\n      address is a page in use by the OCaml runtime, and if so, which of\n      the four purposes it is being used for.\n    </blockquote>")))
 (idp11445952
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n      The OCaml runtime divides the address space into memory pages of\n      4KB each (this is configurable by recompiling the runtime). At any\n      given time, every page that is in use is used for a single\n      purpose: major heap, minor heap, static data or code. The runtime\n      guarantees this by always allocating slightly more memory than\n      requested so that that it can choose align the memory it will\n      actually use at the beginning of a 4KB page.\n    </blockquote>")))
 (idp11443840
  ((file understanding-the-garbage-collector.html)
   (html
    "<blockquote>\n    (<span><em>avsm</em></span>: this chapter is still being chopped and\n    changed)\n  </blockquote>")))
 (idp8102464
  ((file records.html)
   (html
    "<blockquote>\n      This exhaustion guarntee is a valuable one. Field iterators are\n      useful for a variety of record-related tasks, from building record\n      validation functions to scaffolding the definition of a web-form\n      from a record type, and such applications can benefit from the\n      guarantee that all fields of the record type in question have been\n      considered.\n    </blockquote>")))
 (idp8099840
  ((file records.html)
   (html
    "<blockquote>\n      One nice side effect of this approach is that it helps you adapt\n      your code when the fields of a record change. If you were to add a\n      field to <code>Logon.t</code>, the type of\n      <code>Logon.Fields.iter</code> would change along with it,\n      acquiring a new argument. Any code using\n      <code>Logon.Fields.iter</code> won't compile until it's\n      fixed to take this new argument into account.\n    </blockquote>")))
 (idp8095968
  ((file records.html)
   (html
    "<blockquote>\n      Now, let's use <code>Logon.Fields.iter</code> and\n      <code>show_field</code> to print out all the fields of a\n      <code>Logon</code> record.\n    </blockquote>")))
 (idp8093248
  ((file records.html)
   (html
    "<blockquote>\n      This is a bit daunting to look at, largely because of the access\n      control markers, but the structure is actually pretty simple. Each\n      labeled argument is a function that takes a first-class field of\n      the necessary type as an argument. Note that\n      <code>iter</code> passes each of these callbacks the\n      <code>Field.t</code>, not the contents of the specific\n      record field. The contents of the field, though, can be looked up\n      using the combiation of the record and the\n      <code>Field.t</code>.\n    </blockquote>")))
 (idp8088672
  ((file records.html)
   (html
    "<blockquote>\n<code>fieldslib</code> also provides higher-level operators,\n      like <code>Fields.fold</code> and\n      <code>Fields.iter</code>, which let you iterate over all the\n      fields of a record. So, for example, in the case of\n      <code>Logon.t</code>, the field iterator has the following\n      type.\n    </blockquote>")))
 (idp8086672
  ((file records.html)
   (html
    "<blockquote>\n      As a side note, the above is our first use of the\n      <code>Fn</code> module (short for &quot;function&quot;)\n      which provides a collection of useful primitives for dealing with\n      functions. <code>Fn.id</code> is the identity function.\n    </blockquote>")))
 (idp8084032
  ((file records.html)
   (html
    "<blockquote>\n      Here's an example of <code>show_field</code> in action.\n    </blockquote>")))
 (idp8082864
  ((file records.html)
   (html
    "<blockquote>\n      This takes three arguments: the <code>Field.t</code>, a\n      function for converting the contents of the field in question to a\n      string, and a record from which the field can be grabbed.\n    </blockquote>")))
 (idp8081152
  ((file records.html)
   (html
    "<blockquote>\n      We can use first class fields to do things like write a generic\n      function for displaying a record field.\n    </blockquote>")))
 (idp8079264
  ((file records.html)
   (html
    "<blockquote>\n      The type is <code>Field.t_with_perm</code> rather than a\n      simple <code>Field.t</code> because fields have a notion of\n      access control associated with them because there are some special\n      cases where we may expose a field but not expose the ability to\n      read a field but not the ability to do a functional update.\n    </blockquote>")))
 (idp8077136
  ((file records.html)
   (html
    "<blockquote>\n      The type of <code>Field.get</code> is a little more\n      complicated than you might naively expect from the above, as you\n      can see below.\n    </blockquote>")))
 (idp8074736
  ((file records.html)
   (html
    "<blockquote>\n      Thus, first parameter of the <code>Field.t</code>\n      corresponds to the record you pass to <code>get</code>, and\n      the second argument corresponds to the value contained in the\n      field, which is also the return type of <code>get</code>.\n    </blockquote>")))
 (idp8067584
  ((file records.html)
   (html
    "<blockquote>\n      A <code>Field.t</code> has two type parameters: the first\n      for the type of the record, and the second for the type of the\n      field in question. Thus, the type of\n      <code>Logon.Fields.session_id</code> is\n      <code>(Logon.t, string) Field.t</code>, whereas the type of\n      <code>Logon.Fields.time</code> is\n      <code>(Logon.t, Time.t) Field.t</code>. Thus, if you call\n      <code>Field.get</code> on\n      <code>Logon.Fields.user</code>, you'll get a function for\n      extracting the <code>user</code> field from a\n      <code>Logon.t</code>.\n    </blockquote>")))
 (idp8064368
  ((file records.html)
   (html
    "<blockquote>\n<code>Field.setter</code>, which returns\n          <code>None</code> if the field is not mutable or\n          <code>Some f</code> if it is, where <code>f</code>\n          is a function for mutating that field.\n        </blockquote>")))
 (idp8062896
  ((file records.html)
   (html
    "<blockquote>\n<code>Field.fset</code>, which does a functional update\n          of a field\n        </blockquote>")))
 (idp8061424
  ((file records.html)
   (html
    "<blockquote>\n<code>Field.get</code>, which returns the content of a\n          field\n        </blockquote>")))
 (idp8060032
  ((file records.html)
   (html
    "<blockquote>\n<code>Field.name</code>, which returns the name of a\n          field\n        </blockquote>")))
 (idp8056448
  ((file records.html)
   (html
    "<blockquote>\n      In addition to generating field accessor functions,\n      <code>fieldslib</code> also creates a sub-module called\n      <code>Fields</code> that contains a first class\n      representative of each field, in the form of a value of type\n      <code>Field.t</code>. The <code>Field</code> module\n      provides the following functions:\n    </blockquote>")))
 (idp8054256
  ((file records.html)
   (html
    "<blockquote>\n      One of the functions we obtain is <code>Logon.user</code>,\n      which we can use to extract the user field from a logon message.\n    </blockquote>")))
 (idp8052016
  ((file records.html)
   (html
    "<blockquote>\n      Note that this will generate a <span><em>lot</em></span> of output,\n      because <code>fieldslib</code> generates a large collection\n      of helper functions for working with record fields. We'll only\n      discuss a few of these; you can learn about the remainder from the\n      documentation that comes with <code>fieldslib</code>.\n    </blockquote>")))
 (idp8047968
  ((file records.html)
   (html
    "<blockquote>\n      You can enable the syntax extension by typing\n      <code>#require &quot;fieldslib.syntax&quot;</code> into the\n      top-level, at which point the <code>with fields</code>\n      annotation at the end of the declaration of a record type will\n      cause the extension to be applied to a given type declaration. So,\n      for example, we could have defined <code>Logon</code> as\n      follows.\n    </blockquote>")))
 (idp8044848
  ((file records.html)
   (html
    "<blockquote>\n      Here, we wrote a small function\n      <code>(fun x -&gt; x.Logon.user)</code> to access the\n      <code>user</code> field. This kind of accessor function is a\n      common enough pattern that that it would be convenient to generate\n      them automatically. The <code>fieldslib</code> syntax\n      extension that ships with <code>Core</code> does just that.\n    </blockquote>")))
 (idp8042704
  ((file records.html)
   (html
    "<blockquote>\n      Consider the following function for extracting the usernames from\n      a list of <code>Logon</code> messages.\n    </blockquote>")))
 (idp8040592
  ((file records.html)
   (html
    "<blockquote>\n      OCaml's policy of immutable-by-default is a good one, but\n      imperative programming does have its place. We'll discuss more\n      about how (and when) to use OCaml's imperative features in\n      <a href=\"a-guided-tour.html#imperative-programming\">the section called \226\128\156Imperative programming\226\128\157</a>.\n    </blockquote>")))
 (idp8039328
  ((file records.html)
   (html
    "<blockquote>\n      Note that mutable assignment, and thus the\n      <code>&lt;-</code> operator, is not needed for\n      initialization, because all fields of a record, including mutable\n      ones, are specified when the record is created.\n    </blockquote>")))
 (idp8036320
  ((file records.html)
   (html
    "<blockquote>\n      We then use the <code>&lt;-</code> operator for actually\n      changing the state. The side-effecting version of\n      <code>register_heartbeat</code> would be written as follows.\n    </blockquote>")))
 (idp8033920
  ((file records.html)
   (html
    "<blockquote>\n      Like most OCaml values, records are immutable by default. You can,\n      however, declare individual record fields as mutable. For example,\n      we could take the <code>client_info</code> type and make the\n      fields that may need to change over time mutable, as follows.\n    </blockquote>")))
 (idp8030288
  ((file records.html)
   (html
    "<blockquote>\n      The original implementation of\n      <code>register_heartbeat</code> would now be invalid, and\n      thus the compiler would warn us to think about how to handle this\n      new field. But the version using a functional update continues to\n      compile as is, even though it incorrectly ignores the new field.\n      The correct thing to do would be to update the code as follows.\n    </blockquote>")))
 (idp8028304
  ((file records.html)
   (html
    "<blockquote>\n      Functional updates make your code independent of the identity of\n      the fields in the record that are not changing. This is often what\n      you want, but it has downsides as well. In particular, if you\n      change the definition of your record to have more fields, the type\n      system will not prompt you to reconsider whether your update code\n      should affect those fields. Consider what happens if we decided to\n      add a field for the status message received on the last heartbeat.\n    </blockquote>")))
 (idp8026160
  ((file records.html)
   (html
    "<blockquote>\n      Given this, we can rewrite <code>register_heartbeat</code>\n      more concisely.\n    </blockquote>")))
 (idp8025600
  ((file records.html)
   (html
    "<blockquote>\n      The purpose of the functional update is to create a new record\n      based on an existing one, with a set of field changes layered on\n      top.\n    </blockquote>")))
 (idp8022848
  ((file records.html)
   (html
    "<blockquote>\n      This is fairly verbose, given that there's only one field that we\n      actually want to change, and all the others are just being copied\n      over from <code>t</code>. We can use OCaml's\n      <span><em>functional update</em></span> syntax to do this more\n      tersely. The syntax of a functional update is as follows.\n    </blockquote>")))
 (idp8020272
  ((file records.html)
   (html
    "<blockquote>\n      Fairly often, you will find yourself wanting to create a new\n      record that differs from an existing record in only a subset of\n      the fields. For example, imagine our logging server had a record\n      type for representing the state of a given client, including when\n      the last heartbeat was received from that client. The following\n      defines a type for representing this information, as well as a\n      function for updating the client information when a new heartbeat\n      arrives.\n    </blockquote>")))
 (idp8018736
  ((file records.html)
   (html
    "<blockquote>\n      For functions defined within the module where a given record is\n      defined, the module qualification goes away entirely.\n    </blockquote>")))
 (idp8015984
  ((file records.html)
   (html
    "<blockquote>\n      The syntax here is a little surprising when you first encounter\n      it. The thing to keep in mind is that the dot is being used in two\n      ways: the first dot is a record field access, with everything to\n      the right of the dot being interpreted as a field name; the second\n      dot is accessing the contents of a module, referring to the record\n      field <code>important</code> from within the module\n      <code>Log_entry</code>. The fact that\n      <code>Log_entry</code> is capitalized and so can't be a\n      field name is what disambiguates the two uses.\n    </blockquote>")))
 (idp8014432
  ((file records.html)
   (html
    "<blockquote>\n      When using dot-notation for accessing record fields, we can\n      qualify the field by the module directly.\n    </blockquote>")))
 (idp8012704
  ((file records.html)
   (html
    "<blockquote>\n      This is not restricted to constructing a record; we can use the\n      same trick when pattern matching.\n    </blockquote>")))
 (idp8009424
  ((file records.html)
   (html
    "<blockquote>\n      The module name <code>Log_entry</code> is required to\n      qualify the fields, because this function is outside of the\n      <code>Log_entry</code> module where the record was defined.\n      OCaml only requires the module qualification for one record field,\n      however, so we can write this more concisely. Note that we are\n      allowed to insert whitespace between the module-path and the field\n      name.\n    </blockquote>")))
 (idp8007632
  ((file records.html)
   (html
    "<blockquote>\n      Now, our heartbeat-creation function can be rendered as follows.\n    </blockquote>")))
 (idp8004832
  ((file records.html)
   (html
    "<blockquote>\n      We can avoid this ambiguity altogether, either by using\n      non-overlapping field names or, more generally, by minting a\n      module for each type. Packing types into modules is a broadly\n      useful idiom (and one used quite extensively by Core), providing\n      for each type a name-space within which to put related values.\n      When using this style, it is standard practice to name the type\n      associated with the module <code>t</code>. Using this style\n      we would write:\n    </blockquote>")))
 (idp8000944
  ((file records.html)
   (html
    "<blockquote>\n      Why did the first definition succeed without a type annotation and\n      the second one fail? The difference is that in the first case, the\n      type-checker considered the <code>status_message</code>\n      field first and thus concluded that the record was a\n      <code>heartbeat</code>. When the order was switched, the\n      <code>session_id</code> field was considered first, and so\n      that drove the type to be considered to be a\n      <code>logon</code>, at which point\n      <code>t.status_message</code> no longer made sense.\n    </blockquote>")))
 (idp7998544
  ((file records.html)
   (html
    "<blockquote>\n      While it's possible to resolve ambiguous field names using type\n      annotations, the ambiguity can be a bit confusing. Consider the\n      following functions for grabbing the session id and status from a\n      heartbeat.\n    </blockquote>")))
 (idp7996256
  ((file records.html)
   (html
    "<blockquote>\n      In this case, OCaml just picks the most recent definition of that\n      record field. We can force OCaml to assume we're dealing with a\n      different type (say, a <code>heartbeat</code>) using a type\n      annotation.\n    </blockquote>")))
 (idp7994656
  ((file records.html)
   (html
    "<blockquote>\n      Reusing field names can lead to some ambiguity. For example, if we\n      want to write a function to grab the session_id from a record,\n      what type will it have?\n    </blockquote>")))
 (idp7988816
  ((file records.html)
   (html
    "<blockquote>\n      We'll describe three message types: <code>log_entry</code>,\n      <code>heartbeat</code> and <code>logon</code>. The\n      <code>log_entry</code> message is used to deliver a log\n      entry to the server; the <code>logon</code> message is sent\n      to initiate a connection, and includes the identity of the user\n      connecting and credentials used for authentication; and the\n      <code>heartbeat</code> message is periodically sent by the\n      client to demonstrate to the server that the client is alive and\n      connected. All of these messages include a session id and the time\n      the message was generated.\n    </blockquote>")))
 (idp7988224
  ((file records.html)
   (html
    "<blockquote>\n      Defining records with the same field names can be problematic.\n      Let's consider a simple example: building types to represent the\n      protocol used for a logging server.\n    </blockquote>")))
 (idp7986512
  ((file records.html)
   (html
    "<blockquote>\n      Together, labeled arguments, field names, and field and label\n      punning, encourage a style where you propagate the same names\n      throughout your code-base. This is generally good practice, since\n      it encourages consistent naming, which makes it easier to navigate\n      the source.\n    </blockquote>")))
 (idp7984416
  ((file records.html)
   (html
    "<blockquote>\n      This is considerably more concise than what you would get without\n      punning at all.\n    </blockquote>")))
 (idp7982464
  ((file records.html)
   (html
    "<blockquote>\n      You can take advantage of both field punning and label punning\n      when writing a function for constructing a record from labeled\n      arguments, as shown below.\n    </blockquote>")))
 (idp7981872
  ((file records.html)
   (html
    "<blockquote>\n      In the above code, we defined variables corresponding to the\n      record fields first, and then the record declaration itself simply\n      listed the fields that needed to be included.\n    </blockquote>")))
 (idp7978880
  ((file records.html)
   (html
    "<blockquote>\n      Field punning can also be used to construct a record. Consider the\n      following code for generating a <code>host_info</code>\n      record.\n    </blockquote>")))
 (idp7976416
  ((file records.html)
   (html
    "<blockquote>\n      When the name of a variable coincides with the name of a record\n      field, OCaml provides some handy syntactic shortcuts. For example,\n      the pattern in the following function binds all of the fields in\n      question to variables of the same name. This is called\n      <span><em>field punning</em></span>.\n    </blockquote>")))
 (idp7974256
  ((file records.html)
   (html
    "<blockquote>\n      It's a good idea to enable the warning for incomplete record\n      matches, and to explicitly disable it with an <code>_</code>\n      where necessary.\n    </blockquote>")))
 (idp7972352
  ((file records.html)
   (html
    "<blockquote>\n      We can disable the warning for a given pattern by explicitly\n      acknowledging that we are ignoring extra fields. This is done by\n      adding an underscore to the pattern, as shown below.\n    </blockquote>")))
 (idp7968960
  ((file records.html)
   (html
    "<blockquote>\n      Happily, OCaml does offer an optional warning for missing fields\n      in a record pattern. With that warning turned on (which you can do\n      in the toplevel by typing\n      <code>#warnings &quot;+9&quot;</code>), the compiler will\n      warn about the missing field.\n    </blockquote>")))
 (idp7966448
  ((file records.html)
   (html
    "<blockquote>\n      The code for <code>host_info_to_string</code> would continue\n      to compile without change. In this particular case, it's pretty\n      clear that you might want to update\n      <code>host_info_to_string</code> in order to include\n      <code>os_version</code>, and it would be nice if the type\n      system would give you a warning about the change.\n    </blockquote>")))
 (idp7963648
  ((file records.html)
   (html
    "<blockquote>\n      As an example, imagine that we wanted to add a new field to our\n      <code>host_info</code> record called\n      <code>os_version</code>, as shown below.\n    </blockquote>")))
 (idp7962816
  ((file records.html)
   (html
    "<blockquote>\n      Another important characteristic of record patterns is that they\n      don't need to be complete; a pattern can mention only a subset of\n      the fields in the record. This can be convenient, but it can also\n      be error prone. In particular, this means that when new fields are\n      added to the record, code that should be updated to react to the\n      presence of those new fields will not be flagged by the compiler.\n    </blockquote>")))
 (idp7960848
  ((file records.html)
   (html
    "<blockquote>\n      Note that the pattern that we used had only a single case, rather\n      than using several cases separated by <code>|</code>s. We\n      needed only one pattern because record patterns are\n      <span><em>irrefutable</em></span>, meaning that a record pattern\n      match will never fail at runtime. This makes sense, because the\n      set of fields available in a record is always the same. In\n      general, patterns for types with a fixed structure, like records\n      and tuples, are irrefutable, unlike types with variable structure\n      like lists and variants.\n    </blockquote>")))
 (idp7957872
  ((file records.html)
   (html
    "<blockquote>\n      Another way of getting information out of a record is by using a\n      pattern match, as in the definition of\n      <code>host_info_to_string</code> below.\n    </blockquote>")))
 (idp7955200
  ((file records.html)
   (html
    "<blockquote>\n    We can then write polymorphic functions that operate over this\n    parameterized type.\n  </blockquote>")))
 (idp7953568
  ((file records.html)
   (html
    "<blockquote>\n    When declaring an OCaml type, you always have the option of\n    parameterizing it by a polymorphic type. Records are no different in\n    this regard. So, for example, here's a type one might to timestamp\n    arbitrary items.\n  </blockquote>")))
 (idp7952096
  ((file records.html)
   (html
    "<blockquote>\n    Once we have a record value in hand, we can extract elements from\n    the record field using dot-notation.\n  </blockquote>")))
 (idp7950128
  ((file records.html)
   (html
    "<blockquote>\n    You might wonder how the compiler inferred that\n    <code>my_host</code> is of type <code>host_info</code>.\n    The hook that the compiler uses in this case to figure out the type\n    is the record field name. Later in the chapter, we'll talk about\n    what happens when there is more than one record type in scope with\n    the same field name.\n  </blockquote>")))
 (idp7944928
  ((file records.html)
   (html
    "<blockquote>\n    We can construct a <code>host_info</code> just as easily. The\n    following code uses the <code>Shell</code> module from\n    <code>Core_extended</code> to dispatch commands to the shell\n    to extract the information we need about the computer we're running\n    on, and the <code>Time.now</code> call from Core's\n    <code>Time</code> module.\n  </blockquote>")))
 (idp7942800
  ((file records.html)
   (html
    "<blockquote>\n    Here's a simple example, a <code>host_info</code> record that\n    summarizes information about a given computer.\n  </blockquote>")))
 (idp7942320
  ((file records.html)
   (html
    "<blockquote>\n    Note that record field names must start with a lower-case letter.\n  </blockquote>")))
 (idp7940704
  ((file records.html)
   (html
    "<blockquote>\n    A record represents a collection of values stored together as one,\n    where each component is identified by a different field name. The\n    basic syntax for a record type declaration is as follows.\n  </blockquote>")))
 (idp7938144
  ((file records.html)
   (html
    "<blockquote>\n    One of OCaml's best features is its concise and expressive system\n    for declaring new datatypes. Two key elements of that system are\n    <span><em>records</em></span> and <span><em>variants</em></span>, both\n    of which we discussed briefly in\n    <a href=\"a-guided-tour.html\">Chapter\194\1601, <i>A Guided Tour</i></a>. In this chapter we'll\n    cover records in more depth, covering more of the details of how\n    they work, as well as advice on how to use them effectively in your\n    software designs. Variants will be covered in more depth in\n    <a href=\"variants.html\">Chapter\194\1606, <i>Variants</i></a>.\n  </blockquote>")))
 (idp7937408
  ((file records.html)
   (html
    "<blockquote>\n    Once you make the switch, you'll need to install the packages you\n    need. Note that switching back and forth between different compilers\n    and their packages is a fast operation after the initial build.\n  </blockquote>")))
 (idp7935504
  ((file records.html)
   (html
    "<blockquote>\n<span><strong>IMPORTANT</strong></span>: This section is going\n    to describe how records and variants will behave in OCaml 4.01. If\n    you want to follow along fully with the examples here, you'll need\n    to make sure you install a bleeding-edge release, which you can do\n    as follows:\n  </blockquote>")))
 (idp192256
  ((file prologue.html)
   (html
    "<blockquote>\n        Yaron obtained his PhD in Computer Science from Cornell\n        University, where he studied distributed systems. Yaron has\n        lectured, blogged and written about OCaml for years, with\n        articles published in Communications of the ACM and the Journal\n        of Functional Programming. He chairs the steering committee of\n        the Commercial Users of Functional Programming, and is a member\n        of the steering committee for the International Conference on\n        Functional Programming.\n      </blockquote>")))
 (idp191424
  ((file prologue.html)
   (html
    "<blockquote>\n        Yaron Minsky heads the Technology group at Jane Street, a\n        proprietary trading firm that is the largest industrial user of\n        OCaml. He was responsible for introducing OCaml to the company\n        and for managing the company's transition to using OCaml for all\n        of its core infrastructure. Today, billions of dollars worth of\n        securities transactions flow each day through those systems.\n      </blockquote>")))
 (idp189312
  ((file prologue.html)
   (html
    "<blockquote>\n        Prior to obtaining his PhD in 2006 from the University of\n        Cambridge, Anil had a diverse background in industry at NetApp,\n        NASA and Internet Vision. He is an active member of the\n        open-source development community with the OpenBSD operating\n        system, is on the steering committee of the Commercial Uses of\n        Functional Programming ACM workshop, and serves on the boards of\n        startup companies where OCaml is extensively used. He has also\n        developed the Mirage unikernel system that is written entirely\n        in OCaml from the device drivers up.\n      </blockquote>")))
 (idp188432
  ((file prologue.html)
   (html
    "<blockquote>\n        Anil Madhavapeddy is a Senior Research Fellow at the University\n        of Cambridge, based in the Systems Research Group. He was on the\n        original team that developed the Xen hypervisor, and helped\n        develop an industry-leading cloud management toolstack written\n        entirely in OCaml. This XenServer product has been deployed on\n        millions of physical hosts, and drives critical infrastructure\n        for many Fortune 500 companies.\n      </blockquote>")))
 (idp185840
  ((file prologue.html)
   (html
    "<blockquote>\n        Prior to joining Google, Jason was an Assistant Professor of\n        Computer Science at Caltech, where his research was in reliable\n        and fault-tolerant computing systems, including programming\n        language design, formal methods, compilers, and new models of\n        distributed computation. He obtained his PhD in Computer Science\n        from Cornell University, where he studied programming languages.\n        He is the author of the MetaPRL system, a logical framework for\n        design and analysis of large software systems; and OMake, an\n        advanced build system for large software projects. He is the\n        author of the textbook, <span><em>An Introduction to Objective\n        Caml</em></span> (unpublished).\n      </blockquote>")))
 (idp185088
  ((file prologue.html)
   (html
    "<blockquote>\n        Jason Hickey is a Software Engineer at Google Inc. in Mountain\n        View, California. He is part of the team that designs and\n        develops the global computing infrastructure used to support\n        Google services, including the software systems for managing and\n        scheduling massively distributed computing resources.\n      </blockquote>")))
 (idp181952
  ((file prologue.html)
   (html
    "<blockquote>\n        At this stage, the Windows operating system is also unsupported,\n        and only Mac OS X, Linux, FreeBSD and OpenBSD can be expected to\n        work reliably. We realize this is a concern; there are no\n        fundamental barriers to Windows support, but we're focussed on\n        getting the main content finished before getting stuck into the\n        porting effort.\n      </blockquote>")))
 (idp180400
  ((file prologue.html)
   (html
    "<blockquote>\n        Real World OCaml uses some tools that we've developed while\n        writing this book. Some of these resulted in improvements to the\n        OCaml compiler, which means that you will need to ensure that\n        you have an up-to-date development environment (using the 4.01.0\n        compiler). We've automated everything you need via the OPAM\n        package manager, so please do follow the installation\n        instructions in <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a>\n        carefully.\n      </blockquote>")))
 (idp176896
  ((file prologue.html)
   (html
    "<blockquote>\n            Part III is all about understanding the runtime system in\n            OCaml. It's a remarkably simple system in comparison to\n            other language runtimes (such as Java or the .NET CLR), and\n            you'll need to read this to build very high performance\n            systems that have to minimise resource usage or interface to\n            C libraries. This is also where we talk about profiling and\n            debugging techniques using tools such as GNU\n            <code>gdb</code> and <code>gprof</code>.\n            Contributing your code back to the community is also\n            important (if only to get bug fixes from other people!), and\n            this part also explains how to do this via OPAM and GitHub.\n          </blockquote>")))
 (idp175568
  ((file prologue.html)
   (html
    "<blockquote>\n            Part II builds on the basics by working through complete\n            examples. Here you'll pick up useful techniques for building\n            networked systems, as well as functional design patterns\n            that help combine different features of the language to good\n            effect. The focus throughout this section is on networked\n            systems, and among other examples we'll build a running\n            example that will perform Internet queries using the\n            DuckDuckGo search engine.\n          </blockquote>")))
 (idp174048
  ((file prologue.html)
   (html
    "<blockquote>\n            Part I covers the basic concepts you'll need to know when\n            building OCaml programs. You won't need to memorise all of\n            this (objects, for example, are used rarely in practice),\n            but understanding the concepts and examples is important.\n            This part opens up with a guided tour to give you a quick\n            overview of the language. It then moves onto modules,\n            functors and objects, which may take some time to digest.\n            Persevere though; even though these concepts may be\n            difficult at first, they will put you in good stead even\n            when switching to other languages, many of which have drawn\n            inspiration from ML.\n          </blockquote>")))
 (idp173152
  ((file prologue.html)
   (html
    "<blockquote>\n        Real World OCaml is split into three parts and appendices:\n      </blockquote>")))
 (idp223744
  ((file prologue.html)
   (html
    "<blockquote>\n      At the same time, OCaml is not Haskell. It takes a much more\n      pragmatic approach by being strictly evaluated by default and\n      permitting arbitrary side-effects. In fact, you can write OCaml\n      code that looks very similar to imperative C but remains\n      completely type-safe. One of the major strengths of OCaml for\n      systems programming is that, with some experience, you can predict\n      the runtime behaviour of a block of code very easily, with very\n      little compiler magic involved. We'll explain some of these tricks\n      to you as we go through the book and gradually introduce more\n      complex concepts.\n    </blockquote>")))
 (idp221968
  ((file prologue.html)
   (html
    "<blockquote>\n      Real World OCaml is aimed at programmers who have some experience\n      with conventional programming languages, but not specifically with\n      <span><em>statically-typed functional programming</em></span>. The\n      world of dynamic scripting languages such as Javascript, Ruby and\n      Python have all adopted healthy elements of functional\n      programming, but not all of it. Real World OCaml takes you through\n      the full lifecycle of how to construct software with static\n      typing, including the powerful module system that makes code\n      re-use so much more robust.\n    </blockquote>")))
 (idp5198768
  ((file prologue.html)
   (html
    "<blockquote>\n        Another big improvement over the standard library is the\n        <code>utop</code> command-line interface. This is a modern\n        interactive tool that supports command history, macro expansion,\n        module completion, and other niceties that make it much more\n        pleasant to work with the language. We'll be using\n        <code>utop</code> throughout the book instead of the\n        normal OCaml toplevel. It can, of course, be installed using\n        OPAM, and <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a> guides you\n        through that process.\n      </blockquote>")))
 (idp5197552
  ((file prologue.html)
   (html
    "<blockquote>\n        Core is comprehensive and effective standard library, but\n        there's a lot more out there than Core. A large community of\n        programmers have been using OCaml since its first release in\n        1996 and have generated a lot of useful libraries and tools. In\n        Real World OCaml, we'll introduce some of these libraries for\n        you to experiment with realistic examples. The installation and\n        management of these third-party libraries is made much easier\n        via a package management tool known as OPAM. We'll explain more\n        about OPAM as the book unfolds, but it forms the basis of the\n        Platform, which is a set of tools and libraries that, along with\n        the OCaml compiler, let you build realistic applications quickly\n        and effectively.\n      </blockquote>")))
 (idp5195200
  ((file prologue.html)
   (html
    "<blockquote>\n        If you've learnt some OCaml before, this book may surprise you\n        with some differences from your past experience. The Core\n        standard library redefines most of the standard modules to be\n        much more consistent, and so you'll need to adapt older code. We\n        believe the Core model is worth learning; it's been successfully\n        used on large, million-line codebases, and removes a big barrier\n        to more widespread OCaml adoption. There will always exist code\n        that uses only the compiler standard library of course, but\n        there are other online resources available to learn that. Real\n        World OCaml focuses on the techniques the authors have used in\n        their personal experience to construct scalable, robust computer\n        systems.\n      </blockquote>")))
 (idp5194352
  ((file prologue.html)
   (html
    "<blockquote>\n        Core is also distributed with syntax extensions which provide\n        useful new functionality to OCaml, and there are additional\n        libraries such as the Async network communications library that\n        extend the reach of Core into building complex distributed\n        systems. All of these libraries are distributed under a liberal\n        Apache 2 license to permit free use in hobby, academic and\n        commercial settings.\n      </blockquote>")))
 (idp5193360
  ((file prologue.html)
   (html
    "<blockquote>\n        In the world of open-source software, nothing stops alternative\n        libraries from being written to supplement the compiler standard\n        library, and this exactly what the Core distribution is. Jane\n        Street, a company that has been using OCaml for more than a\n        decade, developed Core for its own internal use, but it was\n        designed from the start with an eye towards being a\n        general-purpose standard library, and has very broad\n        applicability. Core is also engineered with correctness,\n        reliability and performance very much in mind.\n      </blockquote>")))
 (idp5192448
  ((file prologue.html)
   (html
    "<blockquote>\n        A language on its own isn't enough. You also need a rich set of\n        libraries to base your applications on. A common source of\n        frustration for those learning OCaml is that the standard\n        library that ships with the compiler doesn't provide a lot of\n        features. The standard library was actually developed for use\n        within the compiler itself, and by design covers only a small\n        subset of the functionality you expect for more general-purpose\n        use.\n      </blockquote>")))
 (idp368320
  ((file prologue.html)
   (html
    "<blockquote>\n        The last decade has seen OCaml attract a significant user base,\n        and language improvements have been steadily added to support\n        the growing codebases that use the language both commercially\n        and for academic use. First-class modules, Generalized Algebraic\n        Data Types (GADTs) and dynamic linking have improved the\n        flexibility of the language, and there is fast native code\n        support for x86_64, ARM, PowerPC and Sparc64, making OCaml a\n        good choice for systems where resource usage, predictability and\n        performance matters.\n      </blockquote>")))
 (idp5189312
  ((file prologue.html)
   (html
    "<blockquote>\n        The modern OCaml emerged in 1996, when a powerful and elegant\n        object system was implemented by Didier R\195\169my and J\195\169r\195\180me\n        Vouillon. This object system was notable for supporting many\n        common OO idioms in a statically type-safe way, whereas the same\n        idioms required runtime checks in languages such as C++ or Java.\n        In 2000, Jacques Garrique extended OCaml with several new\n        features such as polymorphic methods and variants and labelled\n        and optional arguments.\n      </blockquote>")))
 (idp5188320
  ((file prologue.html)
   (html
    "<blockquote>\n        In 1990, Xavier Leroy and Damien Doligez built a new\n        implementation called Caml Light that was based on a bytecode\n        interpreter with a fast sequential garbage collector. Over the\n        next few years useful libraries appeared, such as Michel Mauny's\n        parsing system. Efficiency further improved with a fast native\n        code compiler that made OCaml's performance competitive with\n        mainstream languages such as C++. A module system inspired by\n        Standard ML also provided powerful facilities for abstraction\n        and larger scale programs.\n      </blockquote>")))
 (idp5187152
  ((file prologue.html)
   (html
    "<blockquote>\n        ML was originally the <span><em>meta language</em></span> of the\n        LCF proof assistant released by Robin Milner in 1972 (at\n        Stanford, and later at Cambridge). ML was turned into a compiler\n        in order to make it easier to use LCF on different machines, and\n        gradually turned into a fully fledged system of its own by the\n        1980s.\n      </blockquote>")))
 (idp5186160
  ((file prologue.html)
   (html
    "<blockquote>\n        OCaml was written in 1996 by Xavier Leroy, J\195\169r\195\180me Vouillon,\n        Damien Doligez and Didier R\195\169my at INRIA in France. It was\n        inspired by a long line of research into ML starting in the\n        1960s, and continues to have deep links to the academic\n        community.\n      </blockquote>")))
 (idp3676800
  ((file prologue.html)
   (html
    "<blockquote>\n      Among this worthy set of languages, OCaml stands apart because it\n      manages to provide a great deal of power while remaining highly\n      pragmatic. The compiler has a straightforward compilation strategy\n      without excessive optimization passes, and the strict evaluation\n      model makes runtime behaviour easy to predict. The garbage\n      collector is an incremental, precise implementation with no\n      dynamic JIT compilation, and the runtime is simple and portable\n      across platforms. It is all of this that makes OCaml a great\n      choice for programmers who want to step up to a better programming\n      language, and at the same time want to get practical work done.\n    </blockquote>")))
 (idp3004144
  ((file prologue.html)
   (html
    "<blockquote>\n      Some of you will know and love these features, and others will be\n      completely new to them. Most of you will have seen\n      <span><em>some</em></span> of them in other languages that you've\n      used. As we'll demonstrate over the course of this book, it turns\n      out that there is something transformative about having them all\n      together and able to interact in a single language. Despite their\n      importance, these ideas have made only limited inroads into\n      mainstream languages. And when they do arrive there, like\n      higher-order functions in C# or parametric polymorphism in Java,\n      it's typically in a limited and awkward form. The only languages\n      that support these ideas well are statically-typed functional\n      programming languages like OCaml, F#, Haskell, Scala and Standard\n      ML.\n    </blockquote>")))
 (idp3293888
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Automatic type inference</em></span> to avoid having\n          to laboriously define the type of every single variable in a\n          program, and instead have them inferred based on how a value\n          is used. Available in Standard ML, F# and even modern C++11\n          via its <code>auto</code> keyword.\n        </blockquote>")))
 (idp3846960
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Algebraic datatypes</em></span> and <span><em>pattern\n          matching</em></span> to define and manipulate complex data\n          structures, available in Miranda, F# and Standard ML.\n        </blockquote>")))
 (idp5378528
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Immutable data structures</em></span> that cannot be\n          destructively updated, famously enforced in Haskell but also a\n          common feature of many distributed big data frameworks.\n        </blockquote>")))
 (idp3725360
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Generics</em></span> to enable abstractions to be\n          constructed across different datatypes, available as C++\n          templates or in Java or C#.\n        </blockquote>")))
 (idp3919024
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Static type-checking</em></span> to reduce run-time\n          errors, such as Java or Scala interfaces or variable type\n          declarations in C#, Ada and Pascal.\n        </blockquote>")))
 (idp3725744
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Higher-order functions</em></span> that can be passed\n          around as first-class values, as seen in Javascript or Scala.\n        </blockquote>")))
 (idp3351488
  ((file prologue.html)
   (html
    "<blockquote>\n<span><em>Garbage collection</em></span> for automatic memory\n          management, now a feature of almost every modern high-level\n          language.\n        </blockquote>")))
 (idp3933968
  ((file prologue.html)
   (html
    "<blockquote>\n      But not all ideas about how to design a programming language are\n      created equal. Over the last 40 years, a few key language features\n      have emerged that together form a kind of sweet-spot in language\n      design. These features include:\n    </blockquote>")))
 (idp3828768
  ((file prologue.html)
   (html
    "<blockquote>\n      The programming languages that you use affect the software you\n      create. They influence your software's reliability, security and\n      efficiency, and how easy it is to read, refactor, and extend. The\n      languages you know can also deeply affect how you think about\n      programming and software design.\n    </blockquote>")))
 (idp10315024
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      With our simple error handling scheme, errors are fatal.\n    </blockquote>")))
 (idp10313088
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      Here is an example of a successful run on the following input\n      file.\n    </blockquote>")))
 (idp10311792
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      This approach, &quot;give up on the first error,&quot; is easy to\n      implement, but it isn't very friendly. In general, error handling\n      can be pretty intricate, and we won't discuss it here. However,\n      the menhir parser defines additional mechanisms you can use to try\n      and recover from errors, describe it its reference manual.\n    </blockquote>")))
 (idp10308320
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      This isn't quite right yet -- we need to handle parsing errors.\n      Currently there are two errors, <code>Parser.Error</code>\n      and <code>Lexer.SyntaxError</code>. A simple solution when\n      encountering an error is to print the error and give up.\n    </blockquote>")))
 (idp10298864
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      The standard lexing library <code>Lexing</code> provides a\n      function <code>from_channel</code> to read the input from a\n      channel. The following function describes the structure, where the\n      <code>Lexing.from_channel</code> function is used to\n      construct a <code>lexbuf</code>, which is passed with the\n      lexing function <code>Lexer.read</code> to the\n      <code>Parser.prog</code> function.\n      <code>Parsing.prog</code> returns <code>None</code>\n      when it reaches end of file. We define a function\n      <code>Json.output_value</code>, not shown here, to print a\n      <code>Json.value</code>.\n    </blockquote>")))
 (idp10295008
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      For the final part, we need to compose the lexer and parser. As we\n      saw the the type definition in <code>parser.mli</code>, the\n      parsing function expects a lexer of type\n      <code>Lexing.lexbuf -&gt; token</code>, and it also expects\n      a <code>lexbuf</code>.\n    </blockquote>")))
 (idp10293072
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        That covers the lexer. Next, we need to combine the lexer with\n        the parser to bring it all together.\n      </blockquote>")))
 (idp10289312
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        As specified by JSON, we also handle Unicode code points,\n        <code>'\\\\' 'u' hex hex hex hex</code>. Ocaml doesn't have\n        any built-in handling for Unicode, so in this case we choose to\n        represent the code point in UTF-8. We define the following\n        function for adding the UTF-8 encoding to the buffer.\n      </blockquote>")))
 (idp10287152
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The other cases are for handling the string contents. The action\n        <code>[^ '&quot;' '\\\\']+ { ... }</code> matches normal\n        input that does not contain a double-quote or backslash. The\n        actions beginning with a backslash <code>\\</code> define\n        what to do for escape sequences. In each of these cases, the\n        final step includes a recursive call to the lexer.\n      </blockquote>")))
 (idp10284448
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        This rule takes a <code>buf : Buffer.t</code> as an\n        argument. If we reach the terminating double quote\n        <code>&quot;</code>, then we return the contents of the\n        buffer as a <code>STRING</code>.\n      </blockquote>")))
 (idp10281056
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Unlike many other lexer generators, <code>ocamllex</code>\n        allows the definion of multiple lexer in the same file, and the\n        definitions can be recursive. In this case, we use recursion to\n        match string literals, using the following rule definition.\n      </blockquote>")))
 (idp10275408
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n            If all matches have the same length, then the first action\n            wins. If the input were <code>true: 167</code>, then\n            both <code>&quot;true&quot;</code> and\n            <code>id</code> match the first 4 characters;\n            <code>&quot;true&quot;</code> is first, so the return\n            value is <code>TRUE</code>.\n          </blockquote>")))
 (idp10271552
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n            The longest match always wins. For example, the first input\n            <code>trueX: 167</code> matches the regular expression\n            <code>&quot;true&quot;</code> for 4 characters, and it\n            matches <code>id</code> for 5 characters. The longer\n            match wins, and the return value is\n            <code>ID &quot;trueX&quot;</code>.\n          </blockquote>")))
 (idp10268320
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Some of these patterns overlap. For example, the regular\n        expression <code>&quot;true&quot;</code> is also matched\n        by the <code>id</code> pattern.\n        <code>ocamllex</code> used the following disambiguation\n        when a prefix of the input is matched by more than one pattern.\n      </blockquote>")))
 (idp10266272
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        There are actions for each different kind of token. The string\n        expressions like <code>&quot;true&quot; { TRUE }</code>\n        are used for keywords, and the special characters have actions\n        too, like <code>'{' { LEFT_BRACE }</code>.\n      </blockquote>")))
 (idp10261440
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Going back to the first actions, the first\n        <code>white { read lexbuf }</code> calls the lexer\n        recursively. That's, it skips the input whitespace and returns\n        the following token. The action\n        <code>newline { next_line lexbuf; read lexbuf }</code> is\n        similar, but we use it to advance the line number for the lexer.\n        Here is the definition of the <code>next_line</code>\n        function, which updates the line number in the\n        <code>lexbuf</code>.\n      </blockquote>")))
 (idp10257104
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        This action specifies that when the input matches the\n        <code>int</code> regular expression (defined as\n        <code>'-'? ['1'-'9'] ['0'-'9']*</code>, then the lexer\n        should return the expression\n        <code>INT (int_of_string (Lexing.lexeme lexbuf))</code>.\n        The expression <code>Lexing.lexeme lexbuf</code> returns\n        the complete string matched by the regular expression. In this\n        case, the string represents a number, so we use the\n        <code>int_of_string</code> function to convert it to a\n        number.\n      </blockquote>")))
 (idp10255024
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The OCaml code for the rules has a parameter called\n        <code>lexbuf</code> that defines the input, including the\n        position in the input file, as well as the text that was matched\n        by the regular expression. Let's skip to the third action.\n      </blockquote>")))
 (idp10251136
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The lexing rules are specified as a set of\n        <code>parse</code> rules. A <code>parse</code> rule\n        has a regular expression followed by OCaml code that defines a\n        semantic action. Let's write JSON parse rule.\n      </blockquote>")))
 (idp10248272
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Finally, let's define identifiers and whitespace. An identifier\n        (label), is an alphanumeric sequence not beginning with a digit.\n      </blockquote>")))
 (idp10237648
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The <code>digits</code> expression has a\n        <code>+</code> symbol, meaning that\n        <code>digits</code> has one or more occurrences of digits\n        in the range 0-9. A fractional part <code>frac</code> has\n        a decimal point followed by some digits; an exponent\n        <code>exp</code> begins with an <code>e</code>\n        followed by some digits; and a <code>float</code> has an\n        integer part, and one or both of a <code>frac</code> and\n        <code>exp</code> part. The vetical bar is a choice; the\n        expression <code>(frac | exp | frac exp)</code> is either\n        a <code>frac</code>, or an <code>exp</code>, or a\n        <code>frac</code> followed by an <code>exp</code>.\n      </blockquote>")))
 (idp10236272
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Floating-point numbers are similar, but we deal with decimal\n        points and exponents. We can use multiple let-definitions for\n        the different parts.\n      </blockquote>")))
 (idp10231840
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        An integer is a sequence of digits, optionally preceded by a\n        minus sign. Leading zeroes are not allowed. The question mark\n        means that the preceding symbol <code>-</code> is\n        optional. The square brackets ['1'-'9'] define a character\n        range, meaning that the first digit of the integer should be\n        1-9. The final range <code>['0'-'9']*</code> includes star\n        <code>*</code>, which means zero-or-more occurrences of\n        the characters 0-9. Read formally then, an\n        <code>int</code> has an optional minus sign, followed by a\n        digit in the range 1-9, followed by zero or more digits in the\n        range 0-9.\n      </blockquote>")))
 (idp10231072
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The OCaml code for the header and trailer is optional. The\n        let-definitions are used to ease the definition of regular\n        expressions. They are optional, but very useful. To get started,\n        we know that we'll need to match numbers and strings, so let's\n        define names for the regular expressions that specify their\n        form.\n      </blockquote>")))
 (idp10226256
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      For the next part, we need to define a lexer to tokenize the input\n      text, meaning that we break the input into a sequence of words or\n      tokens. For this, we'll define a lexer using\n      <code>ocamllex</code>. In this case, the specification is\n      placed in a file with a <code>.mll</code> suffix (we'll use\n      the name <code>lexer.mll</code>). A lexer file has several\n      parts in the following sequence.\n    </blockquote>")))
 (idp10223632
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        That's it. We can compile this with <code>menhir</code>,\n        which will now no longer complain about unused symbols.\n      </blockquote>")))
 (idp10216592
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Finally, we can finish off the grammar by defining the rules for\n        arrays, and adding a correct <code>%start</code>\n        production. For the <code>%start</code> production, we'll\n        return a <code>value option</code>, using\n        <code>None</code> to represent end of file. Here is the\n        complete file.\n      </blockquote>")))
 (idp10215072
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Alternatively, we could keep the left-recursive definition and\n        simply construct the returned value in left-to-right order. This\n        is fine, though less efficient. You will have to choose you\n        technique according to circumstances.\n      </blockquote>")))
 (idp10211920
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The <code>rev_</code> prefixed is intended to point out\n        that the fields are returned in reverse order. Why would we do\n        that? One reason is that the <code>menhir</code> parser\n        generator is left-recursive, which means that the constructed\n        pushdown automoton uses less stack space with left-recursive\n        definitions. The following right-recursive rule accepts the same\n        input, but during parsing it requires linear stack space to read\n        object field definitions.\n      </blockquote>")))
 (idp10209920
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The rule <code>rev_object_fields</code> is defined\n        recursively. It has either one key/value field, or it is a\n        sequence of fields, followed by a <code>COMMA</code> and\n        one more field definition.\n      </blockquote>")))
 (idp10206800
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Next, let's define the object fields. In the following rules,\n        the <code>opt_object_fields</code> are either empty, or a\n        non-empty sequence of fields in reverse order. Note that if you\n        wish to have comments in the rule definitions, you will have to\n        use C comment delimiters. By convention, the C comment\n        <code>/* empty */</code> is used to point out that a\n        production has an empty right hand side.\n      </blockquote>")))
 (idp10201824
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        That is, an object value starts with a\n        <code>LEFT_BRACE</code>, contains some optional object\n        field values (to be defined), and end with a\n        <code>RIGHT_BRACE</code>. The returned value is\n        <code>Object obj</code>, where <code>obj</code> is\n        the sequence of object fields. Note that we've left out bindings\n        for <code>LEFT_BRACE</code> and\n        <code>RIGHT_BRACE</code>, because their tokens don't have\n        values.\n      </blockquote>")))
 (idp10199568
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        We can read it like this, &quot;A JSON <code>value</code>\n        is either an object bracketed with curly braces, or an array\n        bracketed with square braces. or a string, integer, float, etc.\n        In each of the productions, the right hand side specfies the\n        expected sequence. For example, the object is specified with the\n        curly-bracket production.\n      </blockquote>")))
 (idp10194288
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        A production can be interpreted as follows: given values\n        <code>id1</code>, ..., <code>idN</code> for the\n        input symbols <code>symbol1</code>, ...,\n        <code>symbolN</code>; the OCaml code computes a value for\n        the target <code>symbol</code>. That's too abstract, so\n        let's get down to defining productions for parsing JSON. Here is\n        the main production for a JSON value.\n      </blockquote>")))
 (idp10192944
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The grammar itself is specified using a set of rules, where a\n        rule contains a set of productions. Abstractly, a production\n        looks like the following.\n      </blockquote>")))
 (idp10186928
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The <code>menhir</code> tool is a parser generator,\n        meaning it generates the code to perform parsing from the\n        <code>parser.mly</code> description. The\n        <code>parser.ml</code> contains an automaton\n        implementation, and is generally difficult to read. However, the\n        <code>parser.mli</code> contains declarations that we need\n        to build a lexer.\n      </blockquote>")))
 (idp10184880
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        Compile this file with <code>menhir</code>. It will issue\n        multiple warnings about unused tokens because we haven't\n        actually defined a grammar yet. It is ok to ignore the warnings\n        for now.\n      </blockquote>")))
 (idp10177568
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        The\n        <code>&lt;</code><span><em>type</em></span><code>&gt;</code>\n        specifications mean that a token carries a value. The\n        <code>INT</code> token carries an integer value with it,\n        <code>FLOAT</code> has a <code>float</code> value,\n        etc. Most of the remaning tokens, like <code>TRUE</code>,\n        <code>FALSE</code>, the punctuation, aren't associated\n        with any value, so we omit the\n        <code>&lt;</code><span><em>type</em></span><code>&gt;</code>\n        specification.\n      </blockquote>")))
 (idp10169888
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n        A token is declared using the syntax\n        <code>%token &lt;</code><span><em>type</em></span><code>&gt;</code>\n<span><em>uid</em></span>, where the\n        <code>&lt;type&gt;</code> is optional, and\n        <span><em>uid</em></span> is an capitalized identifier. For JSON,\n        we need tokens for numbers, strings, identifiers, and\n        punctuation. To start, let's define just the tokens in the\n        <code>parser.mly</code> file. For technical reasons, we\n        need to include a <code>%start</code> declaration. For\n        now, we'll include just a dummy grammer specification\n        <code>exp: { () }</code> (we'll replace this when we\n        implement the grammar below).\n      </blockquote>")))
 (idp10167488
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      The <code>%%</code> are section separators; they have to be\n      on a line by themselves. The declarations include token and type\n      specifications, precedence directives, and other things, but we\n      start by declaring the tokens.\n    </blockquote>")))
 (idp10164816
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      A parser file has suffix <code>.mly</code> (we'll use the\n      name <code>parser.mly</code>) and it contains several parts\n      in the following sequence:\n    </blockquote>")))
 (idp10163632
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n      The process of building a parser is interleaved between\n      constructing the lexer and parser; you will have to do them\n      simultaneously. The first step is to define the set of tokens that\n      will be produced by the lexer. For various reasons, the tokens are\n      specified by the parser (to specify what it expects as input), so\n      we'll start with the parser first.\n    </blockquote>")))
 (idp10159808
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    For illustration, let's continue with the JSON example. For lexing,\n    we'll use <code>ocamllex</code>, and for parsing, we'll use\n    <code>menhir</code>, which is somewhat easier to use than\n    <code>ocamlyacc</code>.\n  </blockquote>")))
 (idp10159008
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    Parsing is a broad and often intricate topic, and our purpose here\n    is not to teach all of the ins and outs of yacc and lex, but to show\n    how to use these tools in OCaml. There are online resources, and\n    most experience you may have using lex/yacc in other languages will\n    also apply in OCaml. However, there are differences, and we'll try\n    to point out the larger ones here.\n  </blockquote>")))
 (idp10156768
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    There are many techniques for lexing and parsing. In the lex/yacc\n    world, lexing is specified using regular expressions, and parsing is\n    specified using context-free grammars. These are concepts from\n    formal languages; the lex/yacc tools constructing the machinery for\n    you. For <code>lex</code>, this means constructing a finite\n    automaton; and for <code>yacc</code>, this means constructing\n    a pushdown automaton.\n  </blockquote>")))
 (idp10154064
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    The next step is to convert the token stream into a program value\n    that represents the abstract syntax tree, like the type\n    <code>value</code> above. This is called\n    <span><em>parsing</em></span>.\n  </blockquote>")))
 (idp10150864
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    The objective of <span><em>parsing</em></span> is to convert the text\n    input into a value of type <code>value</code>. This is\n    normally done in two phase. First, <span><em>lexical</em></span>\n    analysis (or lexing, for short) is used to convert the text input\n    into a sequence of tokens, or words. For example, the JSON input\n    would be tokenized into a sequence of tokens like the following. In\n    most cases (and in this example), lexical analysis will choose to\n    omit white space from the token stream.\n  </blockquote>")))
 (idp10148624
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    The input text is represented as a sequence of characters.\n    Manipulating it in that form would be really hard, so what we want\n    is to give it a structured type that is easier for our programs to\n    manipulate. For our example, we'll use the following type to\n    represent JSON <span><em>abstract syntax</em></span>.\n  </blockquote>")))
 (idp10145408
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    Let's be more precise about these terms. By\n    <span><em>parsing</em></span>, we mean reading a textual input into a\n    form that is easier for a program to manipulate. For example,\n    suppose we want to read a file containing a value in JSON format.\n    JSON has a variety of values, including numbers, strings, arrays,\n    and objects, and each of these has a precise textual representation.\n    For example, the following text represents an object containing a\n    string labeled <code>title</code>, and an array containing two\n    objects, each with a name and array of zip codes.\n  </blockquote>")))
 (idp10144752
  ((file parsing-with-ocamllex-and-menhir.html)
   (html
    "<blockquote>\n    OCaml provides lexer and parser generators modeled on lex and yacc.\n    Similar tools are available in a variety of languages, and with them\n    you can parse a variety of kinds of input, including web formats or\n    full blown programming languages.\n  </blockquote>")))
 (idp11442192
  ((file parsing-binary-protocols-with-bigarray.html)
   (html
    "<blockquote>This chapter is under construction and not yet ready for public review, and so omitted from this milestone. This chaper is present as a placeholder so that cross-references from other chapters resolve correctly in the print version.</blockquote>")))
 (idp11811408 ((file packaging.html) (html "<blockquote>\n</blockquote>")))
 (idp11809632 ((file packaging.html) (html "<blockquote>\n</blockquote>")))
 (idp11806880 ((file packaging.html) (html "<blockquote>\n</blockquote>")))
 (idp11805152 ((file packaging.html) (html "<blockquote>\n</blockquote>")))
 (idp11786416
  ((file packaging.html)
   (html
    "<blockquote>\n        To obtain a bytecode executable, you need to compile a set of\n        <code>cmo</code> object files, and then link them into an\n        executable\n      </blockquote>")))
 (idp11771152
  ((file packaging.html)
   (html
    "<blockquote>\n        Here are some of the intermediate files generated by\n        <code>ocamlc</code>:\n      </blockquote>")))
 (idp11768848
  ((file packaging.html)
   (html
    "<blockquote>\n        The simplest code generator is the <code>ocamlc</code>\n        compiler, which outputs bytecode that is interpreted via the\n        <code>ocamlrun</code> runtime. The OCaml bytecode virtual\n        machine is a stack machine (much like the Java Virtual Machine),\n        with the exception of a single register that stores the most\n        recent result. This provides a simple runtime model that is easy\n        to implement or embed within other systems, but executes rather\n        slowly due to being interpreted.\n      </blockquote>")))
 (idp11766256
  ((file packaging.html)
   (html
    "<blockquote>\n      There are two distinct compilers for OCaml code included in the\n      standard distribution. The first outputs bytecode that is\n      interpreted at runtime, and the second generates fast, efficient\n      native code directly. Both of these share the front-end\n      type-checking logic, and only diverge when it comes to code\n      generation.\n    </blockquote>")))
 (idp11763696
  ((file packaging.html)
   (html
    "<blockquote>\n    The OCaml toolchain is structured much like a C compiler, with\n    several tools that generate intermediate files and finally link\n    against a runtime. The final outputs don't have to be just\n    executables. Many people embed OCaml code as object files that are\n    called from other applications, or even compile it to Javascript and\n    other esoteric targets. Let's start by covering some of the standard\n    OCaml tools, and then move on to some of the higher level methods\n    for packaging and publishing your code online.\n  </blockquote>")))
 (idp9628624
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The mixin pattern isn't limited to non-polymorphic classes, of\n        course. We can use it to implement generic features as well. The\n        following mixin defines functional-style iteration in terms of\n        the imperative iterator pattern.\n      </blockquote>")))
 (idp9626464
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        In this particular case, the mixin works only for a collection\n        of integers, so we can't add the mixin to the polymorphic class\n        definition <code>['a] slist</code> itself. However, the\n        result of using the mixin is that the integer collection has a\n        method <code>sum</code>, and it is done with very little\n        of the fuss we would need if we used object composition instead.\n      </blockquote>")))
 (idp9623984
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The collections are different is some ways, but they share a\n        common pattern for iteration that we can re-use. For a simple\n        example, let's define a mixin that implements an arithmetic sum\n        for a collection of integers.\n      </blockquote>")))
 (idp9620544
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        That's too abstract, so let's give an example based on\n        collections. In Section XXX:Objecttypes, we introduced the\n        <span><em>iterator</em></span> pattern, where an\n        <span><em>iterator</em></span> object is used to enumerate the\n        elements of a collection. Lots of containers can have iterators,\n        singly-linked lists, dictionaries, vectors, etc.\n      </blockquote>")))
 (idp9616256
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        In any case, if you're programming with objects, there's one\n        general pattern for multiple inheritance that is both useful and\n        reasonably simple, the <span><em>mixin</em></span> pattern.\n        Generically, a <span><em>mixin</em></span> is just a virtual\n        class that implements a feature based on another one. If you\n        have a class that implements methods <span><em>A</em></span>, and\n        you have a mixin <span><em>M</em></span> that provides methods\n        <span><em>B</em></span> from <span><em>A</em></span>, then you can\n        inherit from <span><em>M</em></span> -- &quot;mixing&quot; it in\n        -- to get features <span><em>B</em></span>.\n      </blockquote>")))
 (idp9615376
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        When should you use multiple inheritance? If you ask multiple\n        people, you're likely to get multiple (perhaps heated) answers.\n        Some will argue that multiple inheritance is overly complicated;\n        others will argue that inheritance is problematic in general,\n        and one should use object composition instead. But regardless of\n        who you talk to, you will rarely hear that multiple inheritance\n        is great and you should use it widely.\n      </blockquote>")))
 (idp9606576
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        To reiterate, to understand what inheritance means, replace each\n        <code>inherit</code> directive with its definition, and\n        take the last definition of each method or field. This holds\n        even for private methods. However, it does\n        <span><em>not</em></span> hold for private methods that are\n        &quot;really&quot; private, meaning that they have been hidden\n        by a type constraint. In the following definitions, there are\n        three definitions of the private method <code>g</code>.\n        However, the definition of <code>g</code> in\n        <code>m8</code> is not overridden, because it is not part\n        of the class type for <code>m8</code>.\n      </blockquote>")))
 (idp9602832
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Of course, it is unlikely that you will define two methods or\n        two fields of the same name in the same class. However, the\n        rules for inheritance follow the same pattern: the last\n        definition wins. In the following definition, the\n        <code>inherit</code> declaration comes last, so the method\n        definition <code>method get = 2</code> overrides the\n        previous definition, always returning 2.\n      </blockquote>")))
 (idp9601008
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Fields have similar behavior, though the compiler produces a\n        warning message about the override.\n      </blockquote>")))
 (idp9598368
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        First, let's consider what happens when we define a method more\n        than once. In the following example, the method\n        <code>get</code> is defined twice; the second definition\n        &quot;wins,&quot; meaning that it overrides the first one.\n      </blockquote>")))
 (idp9597680
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        If there is one thing to remember about inheritance in OCaml, it\n        is this: inheritance is like textual inclusion. If there is more\n        than one definition for a name, the last definition wins. Let's\n        look at some artificial, but illustrative, examples.\n      </blockquote>")))
 (idp9596896
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The main &quot;trickiness&quot; of multiple inheritance is due\n        to naming -- what happens when a method or field with some name\n        is defined in more than one class?\n      </blockquote>")))
 (idp9594512
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      When a class inherits from more than one superclass, it is using\n      <span><em>multiple inheritance</em></span>. Multiple inheritance\n      extends the variety of ways in which classes can be combined, and\n      it can be quite useful, particularly with virtual classes.\n      However, it can be tricky to use, particularly when the\n      inheritance hierarchy is a graph rather than a tree, so it should\n      be used with care.\n    </blockquote>")))
 (idp9591792
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      This level of dependency on the implementation details is\n      possible, but it is hard to justify the use of a virtual class --\n      why not just define the <code>swap</code> method as part of\n      the concrete class? Virtual classes are better suited for\n      situations where there are multiple (useful) implementations of\n      the virtual parts. In most cases, this will be public virtual\n      methods.\n    </blockquote>")))
 (idp9589952
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      We've been mentioning that fields can be virtual too. Here is\n      another implementation of the swapper, this time with direct\n      access to the array of values.\n    </blockquote>")))
 (idp9588192
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      One way to view a <code>virtual</code> class is that it is\n      like a functor, where the &quot;inputs&quot; are the declared, but\n      not defined, virtual methods and fields. The functor application\n      is implemented through inheritance, when virtual methods are given\n      concrete implementations.\n    </blockquote>")))
 (idp9585696
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      Here's a different implementation using\n      <code>HashTbl</code>.\n    </blockquote>")))
 (idp9581504
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      At some future time, we may settle on a concrete implementation\n      for the vector. We can inherit from the\n      <code>abstract_swappable_bvector</code> to get the\n      <code>swap</code> method &quot;for free.&quot; Here's one\n      implementation using arrays.\n    </blockquote>")))
 (idp9576576
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      One way to do this is to declare the\n      <code>swappable_vector</code> abstractly, declaring the\n      methods <code>get</code> and <code>set</code>, but\n      leaving the implementation for later. However, the\n      <code>swap</code> method can be defined immediately.\n    </blockquote>")))
 (idp9571024
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      In the previous section, we defined a class\n      <code>swappable_vector</code> that inherits from\n      <code>array_vector</code> and adds a <code>swap</code>\n      method. In fact, the <code>swap</code> method could be\n      defined for any object with <code>get</code> and\n      <code>set</code> methods; it doesn't have to be the specific\n      class <code>array_vector</code>.\n    </blockquote>")))
 (idp9568432
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      A <span><em>virtual</em></span> class is a class where some methods\n      or fields are declared, but not implemented. This should not be\n      confused with the word &quot;virtual&quot; as it is used in C++.\n      In C++, a &quot;virtual&quot; method uses dynamic dispatch,\n      regular non-virtual methods use static dispatched. In OCaml,\n      <span><em>all</em></span> methods use dynamic dispatch, but the\n      keyword <span><em>virtual</em></span> means the method or field is\n      not implemented.\n    </blockquote>")))
 (idp9563776
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      The key property of private methods is that they are visible to\n      subclasses, but not anywhere else. If you want the stronger\n      guarantee that a method is <span><em>really</em></span> private,\n      not even accessible in subclasses, you can use an explicit typing\n      that omits the method. In the following code, the\n      <code>move_up</code> method is explicitly omitted from the\n      object type, and it can't be invoked in subclasses.\n    </blockquote>")))
 (idp9562496
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      The method <code>move_up</code> implements the process of\n      restoring heap order as a recursive method (though it would be\n      straightforward avoid the recursion and use iteration here).\n    </blockquote>")))
 (idp9557456
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      Yet another reason for private methods is to factor the\n      implementation and support recursion. Moving along with this\n      example, let's build a binary heap, which is a binary tree in heap\n      order: where the label of parent elements is smaller than the\n      labels of its children. One efficient implementation is to use an\n      array to represent the values, where the root is at index 0, and\n      the children of a parent node at index <code>i</code> are at\n      indexes <code>2 * i</code> and <code>2 * i + 1</code>.\n      To insert a node into the tree, we add it as a leaf, and then\n      recursively move it up the tree until we restore heap order.\n    </blockquote>")))
 (idp9552656
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      To be precise, the method <code>ensure_capacity</code> is\n      part of the class type, but it is not part of the object type.\n      This means the object <code>v</code> has no method\n      <code>ensure_capacity</code>. However, it is available to\n      subclasses. We can extend the class, for example, to include a\n      method <code>swap</code> that swaps two elements.\n    </blockquote>")))
 (idp9545712
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      To illustrate, let's build a class <code>vector</code> that\n      contains an array of integers, resizing the storage array on\n      demand. The field <code>values</code> contains the actual\n      values, and the <code>get</code>, <code>set</code>,\n      and <code>length</code> methods implement the array access.\n      For clarity, the resizing operation is implemented as a private\n      method <code>ensure_capacity</code> that resizes the array\n      if necessary.\n    </blockquote>")))
 (idp9544272
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      Methods can be declared <span><em>private</em></span>, which means\n      that they may be called by subclasses, but they are not visible\n      otherwise (similar to a <span><em>protected</em></span> method in\n      C++).\n    </blockquote>")))
 (idp9537760
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The binary method <code>equals</code> is now implemented\n        in terms of the concrete type <code>shape_repr</code>. In\n        fact, the objects are now isomorphic to the\n        <code>shape_repr</code> type. When using this pattern, you\n        will not be able to hide the <code>repr</code> method, but\n        you can hide the type definition using the module system.\n      </blockquote>")))
 (idp9534896
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        If we want to define equality for shapes in general, the\n        remaining solution is to use the same approach as we described\n        for narrowing. That is, introduce a\n        <span><em>representation</em></span> type implemented using\n        variants, and implement the comparison based on the\n        representation type.\n      </blockquote>")))
 (idp9534080
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The problem here is that the builtin polymorphic equality\n        compares the method implementations, not their return values.\n        The method implementations (the function values that implement\n        the methods) are different, so the equality comparison is false.\n        There are other reasons not to use the builtin polymorphic\n        equality, but these false negatives are a showstopper.\n      </blockquote>")))
 (idp9531664
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        One proposal we could consider is, since the problematic method\n        is equality, why not just drop it from the base type\n        <code>shape</code> and use polymorphic equality instead?\n        Unfortunately, the builtin equality has very poor behavior when\n        applied to objects.\n      </blockquote>")))
 (idp9531056
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        This problem is fundamental. Many languages solve it either with\n        narrowing (with dynamic type checking), or by method\n        overloading. Since OCaml has neither of these, what can we do?\n      </blockquote>")))
 (idp9528416
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The problem is that a <code>square</code> expects to be\n        compared with a <code>square</code>, not an arbitrary\n        shape; similarly for <code>rectangle</code>.\n      </blockquote>")))
 (idp9523376
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        This works, but there is a problem lurking here. The method\n        <code>equals</code> takes an object of the exact type\n        <code>square</code> or <code>rectangle</code>.\n        Because of this, we can't define a common base class\n        <code>shape</code> that also includes an equality method.\n      </blockquote>")))
 (idp9519504
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        A <span><em>binary method</em></span> is a method that takes an\n        object of <code>self</code> type. One common example is\n        defining a method for equality.\n      </blockquote>")))
 (idp9517680
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        This pattern works, but it has drawbacks. In particular, the\n        recursive type definition should make it clear that this pattern\n        is essentially equivalent to using variants, and that objects do\n        not provide much value here.\n      </blockquote>")))
 (idp9514496
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Regardless, there is a solution if you find yourself in this\n        situation, which is to augment the classes with variants. You\n        can define a method <code>variant</code> that injects the\n        actual object into a variant type.\n      </blockquote>")))
 (idp9512000
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        In this case, it is much less clear how to augment the\n        <code>Shape</code> class to support this kind of pattern\n        analysis. It is also not obvious that object-oriented\n        programming is well-suited for this situation. Pattern matching\n        seems like a better fit.\n      </blockquote>")))
 (idp9508912
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        However, the situation is not always so obvious. The following\n        code checks whether an array of shapes looks like a\n        &quot;barbell,&quot; composed to two <code>Circle</code>\n        objects separated by a <code>Line</code>, where the\n        circles have the same radius.\n      </blockquote>")))
 (idp9506432
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Most programmers would consider this code to be\n        &quot;wrong.&quot; Instead of performing a case analysis on the\n        type of object, it would be better to define a method to return\n        the name of the shape. Instead of calling\n        <code>GetShapeName(s)</code>, we should call\n        <code>s.Name()</code> instead.\n      </blockquote>")))
 (idp9504848
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        More commonly, narrowing leads to poor object-oriented style.\n        Consider the following Java code, which returns the name of a\n        shape object.\n      </blockquote>")))
 (idp9501984
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        The design argument is this: narrowing violates abstraction. In\n        fact, with a structural typing system like in OCaml, narrowing\n        would essentially provide the ability to enumerate the methods\n        in an object. To check whether an object <code>obj</code>\n        has some method <code>foo : int</code>, one would attempt\n        a coercion <code>(obj :&gt; &lt; foo : int &gt;)</code>.\n      </blockquote>")))
 (idp9501392
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Why? There are two reasonable explanations, one based on a\n        design principle, and another technical (the technical reason is\n        simple: it is hard to implement).\n      </blockquote>")))
 (idp9500512
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Narrowing is <span><em>not permitted</em></span> in OCaml.\n        Period.\n      </blockquote>")))
 (idp9493696
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Narrowing, also called <span><em>down casting</em></span>, is the\n        ability to coerce an object to one of its subtypes. For example,\n        if we have a list of shapes <code>shape slist</code>, we\n        might know (for some reason) what the actual type of each shape\n        is. Perhaps we know that all objects in the list have type\n        <code>square</code>. In this case,\n        <span><em>narrowing</em></span> would allow the re-casting of the\n        object from type <code>shape</code> to type\n        <code>square</code>. Many languages support narrowing\n        through dynamic type checking. For example, in Java, a coercion\n        <code>(Square) x</code> is allowed if the value\n        <code>x</code> has type <code>Square</code> or one\n        of its subtypes; otherwise the coercion throws an exception.\n      </blockquote>")))
 (idp9488160
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        OCaml supports an abbreviation in this case, but it works only\n        for classes, not object types. The type expression\n        <code># classname</code> is an abbreviation for an elided\n        type containing all of the methods in the named class, and more.\n        Since <code>shape</code> is an object type, we can't write\n        <code>#shape</code>. However, if a class definition is\n        available, this abbreviation can be useful. The following\n        definition is exactly equivalent to the preceeding.\n      </blockquote>")))
 (idp9486096
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        This works, and it removes the need for explicit coercions. This\n        type is still fairly simple, but it does have the drawback that\n        the programmer needs to remember that the types\n        <code>&lt; area : float; ..&gt;</code> and\n        <code>shape</code> are related.\n      </blockquote>")))
 (idp9482256
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        A solution is to use an elided type. Instead of\n        <code>shape</code>, we can use the elided type\n        <code>&lt; area : float; .. &gt;</code>. In fact, once we\n        do this, it also becomes possible to use the\n        <code>slist</code> type.\n      </blockquote>")))
 (idp9480144
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Before we move to the next topic, there is one more thing to\n        address. The typing we gave above, using\n        <code>readonly_shape_slist</code>, requires that the\n        caller perform an explicit coercion before calling the\n        <code>total_area</code> function. We would like to give a\n        better type that avoids the coercion.\n      </blockquote>")))
 (idp9474464
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        This reasoning may seem fairly long and complicated, but it\n        should be pointed out that this typing\n        <span><em>works</em></span>, and in the end the type annotations\n        are fairly minor. In most typed object-oriented languages, the\n        coercion would simply not be possible. For example, in C++, a\n        STL type <code>slist&lt;T&gt;</code> is invariant in\n        <code>T</code>, it is simply not possible to use\n        <code>slist&lt;square&gt;</code> where\n        <code>slist&lt;shape&gt;</code> is expected (at least\n        safely). The situation is similar in Java, although Java\n        supports has an escape hatch that allows the program to fall\n        back to dynamic typing. The situation in OCaml is much better;\n        it works, it is statically checked, and the annotations are\n        pretty simple.\n      </blockquote>")))
 (idp9468096
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        In this particular case, depth subtyping on the\n        <code>iterator</code> method requires that\n        <code>square iterator</code> be a subtype of\n        <code>shape iterator</code>. Expanding the type definition\n        for the type <code>iterator</code>, we again invoke depth\n        subtyping, and we need to show that the type\n        <code>&lt; get : square &gt;</code> is a subtype of\n        <code>&lt;get : shape &gt;</code>, which follows because\n        <code>square</code> is a subtype of\n        <code>shape</code>.\n      </blockquote>")))
 (idp9460784
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Why does this work, why is a <code>square slist</code> a\n        subtype of <code>readonly_shape_slist</code>. The\n        reasoning is in two steps. First, the easy part is width\n        subtyping: we can drop the other methods to see that\n        <code>square slist</code> is a subtype of\n        <code>&lt; iterator : square iterator &gt;</code>. The\n        next step is to use <span><em>depth</em></span> subtyping, which,\n        in its general form, says that an object type\n        <code>&lt; m : t1 &gt;</code> is a subtype of a type\n        <code>&lt; m : t2&gt;</code> iff <code>t1</code> is\n        a subtype of <code>t2</code>. In other words, instead of\n        reasoning about the number of methods in a type (the width), the\n        number of methods is fixed, and we look within the method types\n        themselves (the &quot;depth&quot;).\n      </blockquote>")))
 (idp9456400
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n        Still, the <code>total_area</code> function should be\n        fine, in principle. It doesn't call <code>insert</code>,\n        so it isn't making that error. To make it work, we need to use a\n        more precise type that indicates we are not going to be mutating\n        the list. We define a type\n        <code>readonly_shape_slist</code> and confirm that we can\n        coerce the list of squares.\n      </blockquote>")))
 (idp9448592
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      It might seem tempting to give up at this point, especially\n      because the subtyping is not even true -- the type\n      <code>square slist</code> is not a subtype of\n      <code>shape slist</code>. The problem is with the\n      <code>insert</code> method. For\n      <code>shape slist</code>, the <code>insert</code>\n      method takes an arbitrary <code>shape</code> and inserts it\n      into the list. So if we could coerce a\n      <code>square slist</code> to a\n      <code>shape slist</code>, then it would be possible to\n      insert an arbitrary shape into the list, which would be an error.\n    </blockquote>")))
 (idp9443616
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      We can also define a function to calculate the total area of a\n      list of shapes. There is no reason to restrict this to squares, it\n      should work for any list of shapes with type\n      <code>shape slist</code>. The problem is that doing so\n      raises some serious typing questions -- can a\n      <code>square slist</code> be passed to a function that\n      expects a <code>shape slist</code>? If we try it, the\n      compiler produces a verbose error message.\n    </blockquote>")))
 (idp9441104
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      Next, let's take a seemingly tiny step forward, and start building\n      collections of shapes. It is easy enough to define a\n      <code>slist</code> of squares.\n    </blockquote>")))
 (idp9440240
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      This may seem absurd, but this concept is expressible in all\n      object-oriented languages. The contradiction is semantic -- we\n      know that in the real world, not all rectangles are squares; but\n      in the programming world, rectangles have all of the features of\n      squares (according to our definition), so they can be used just\n      like squares. Suffice it to say that it is usually better to avoid\n      such apparent contradictions.\n    </blockquote>")))
 (idp9436112
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      The subtyping rules are purely technical, they have no relation to\n      object semantics. We can define a class\n      <code>rectangle</code> that has all of the methods of a\n      <code>square</code>, so it is a subtype of square and can be\n      used wherever a <code>square</code> is expected.\n    </blockquote>")))
 (idp9430016
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      What are the rules for subtyping? In general, object subtyping has\n      two general forms, called <span><em>width</em></span> and\n      <span><em>depth</em></span> subtyping. Width subtyping means that\n      an object type <span><em>A</em></span> is a a subtype of\n      <span><em>B</em></span>, if <span><em>A</em></span> has all of the\n      methods of <span><em>B</em></span>, and possibly more. A\n      <code>square</code> is a subtype of <code>shape</code>\n      because it implements all of the methods of\n      <code>shape</code> (the <code>area</code> method).\n    </blockquote>")))
 (idp9422928
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      A <code>square</code> has a method <code>area</code>\n      just like a <code>shape</code>, and an additional method\n      <code>width</code>. Still, we expect a\n      <code>square</code> to be a <code>shape</code>, and it\n      is. The coercion <code>:&gt;</code> must be explicit.\n    </blockquote>")))
 (idp9419696
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      To explore this, let's define some simple classes for geometric\n      shapes. The generic type <code>shape</code> has a method to\n      compute the area, and a <code>square</code> is a specific\n      kind of shape.\n    </blockquote>")))
 (idp9413296
  ((file object-subtyping-and-inheritance.html)
   (html
    "<blockquote>\n      Subtyping is a central concept in object-oriented programming. It\n      governs when an object with one type <span><em>A</em></span> can be\n      used in an expression that expects an object of another type\n      <span><em>B</em></span>. When this is true, we say that\n      <span><em>A</em></span> is a <span><em>subtype</em></span> of\n      <span><em>B</em></span>. Actually, more concretely, subtyping\n      determines when the coercion operator <code>e :&gt; t</code>\n      can be applied. This coercion works only if the expression\n      <code>e</code> has some type <code>s</code> and\n      <code>s</code> is a subtype of <code>t</code>.\n    </blockquote>")))
 (idp9406256
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      One more thing, in this example the function\n      <code>make</code> has type\n      <code>unit -&gt; 'a slist</code>. But wait, we've stressed\n      <span><em>classes are not types</em></span>, so what's up with\n      that? In fact, what we've said is entirely true, classes and class\n      names <span><em>are not</em></span> types. However, class names can\n      be used to stand for types. When the compiler sees a class name in\n      type position, it automatically constructs an object type from it\n      by erasing all the fields and keeping only the method types. In\n      this case, the type expression <code>'a slist</code> is\n      exactly equivalent to <code>'a t</code>.\n    </blockquote>")))
 (idp9401952
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In this signature, we've chosen to make nearly everything visible.\n      The class type for <code>slist</code> specifies the types of\n      the fields <code>first</code> and <code>last</code>,\n      as well as the types of each of the methods. We've also included a\n      class type for <code>slist_iterator</code>, which is of\n      somewhat more questionable value, since the type doesn't appear in\n      the type for <code>slist</code> at all.\n    </blockquote>")))
 (idp9397856
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The abstract signature is simple because we ignore the classes.\n      But what if we want to include them in the signature, so that\n      other modules can inherit from the class definitions? For this, we\n      need to specify types for the classes, called <span><em>class\n      types</em></span>. Class types do not appear in mainstream\n      object-oriented programming languages, so you may not be familiar\n      with them, but the concept is pretty simple. A class type\n      specifies the type of each of the visible parts of the class,\n      including both fields and methods. Just like for module types, you\n      don't have to give a type for everything; anything you omit will\n      be hidden.\n    </blockquote>")))
 (idp9396032
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We have multiple choices in defining the module type, depending on\n      how much of the implementation we want to expose. At one extreme,\n      a maximally-abstract signature would completely hide the class\n      definitions.\n    </blockquote>")))
 (idp9392192
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Before we begin, let's wrap up the implementation in an explicit\n      module (we'll use explicit modules for illustration, but the\n      process is similar when we want to define a\n      <code>.mli</code> file). In keeping with the usual style for\n      modules, we define a type <code>'a t</code> to represent the\n      type of list values.\n    </blockquote>")))
 (idp9390912
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Once we have defined the list implementation, the next step is to\n      wrap it in a module or <code>.ml</code> file and give it a\n      type so that it can be used in the rest of our code. What is the\n      type?\n    </blockquote>")))
 (idp9387120
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We use the same object type <code>iterator</code> for\n      iterators, but implement it differently.\n    </blockquote>")))
 (idp9385728
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      There are some restriction on the use of the expression\n      <code>{&lt; ... &gt;}</code>. It can be used only within a\n      method body, and only the values of fields may be updated. Method\n      implementations are fixed at the time the object is created, they\n      cannot be changed dynamically.\n    </blockquote>")))
 (idp9380784
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      A key part of the implementation is the definition of the method\n      <code>insert</code>. The expression\n      <code>{&lt; ... &gt;}</code> produces a copy of the current\n      object, with the same type, and the specified fields updated. In\n      other words, the <code>new_fst new_x</code> method produces\n      a copy of the object, with <code>x</code> replaced by\n      <code>new_x</code>. The original object is not modified, and\n      the value of <code>y</code> is also unaffected.\n    </blockquote>")))
 (idp9377728
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Indeed, in many programs, this makes sense, but it is by no means\n      required. Let's define an object-oriented version of lists similar\n      to the imperative list above. We'll implement it with a regular\n      list type <code>'a list</code>, and insertion will be to the\n      beginning of the list instead of to the end.\n    </blockquote>")))
 (idp9377072
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Many people consider object-oriented programming to be\n      intrinsically imperative, where an object is like a state machine.\n      Sending a message to an object causes it to change state,\n      possibily sending messages to other objects.\n    </blockquote>")))
 (idp9372256
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The solution is to use a type quantifier, as shown in the\n      following example. The method type must be specified directly\n      after the method name, which means that method parameters must be\n      expressed using a <code>fun</code> or\n      <code>function</code> expression.\n    </blockquote>")))
 (idp9365824
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      What about functional operations similar to\n      <code>List.map</code> or <code>List.fold</code>? In\n      general, these methods take a function that produces a value of\n      some other type than the elements of the set. For example, the\n      function <code>List.fold</code> has type\n      <code>'a list -&gt; ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b</code>,\n      where <code>'b</code> is an arbitrary type. To replicate\n      this in the <code>slist</code> class, we need a method type\n      <code>('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'b</code>, where\n      the method type is polymorphic over <code>'b</code>.\n    </blockquote>")))
 (idp9362864
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We may also wish to define functional-style methods,\n      <code>iter f</code> takes a function <code>f</code>\n      and applies it to each of the elements of the list.\n    </blockquote>")))
 (idp9357632
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Finally, we add a method <code>iterator</code> to the slist\n      class to produce an iterator. To do so, we construct an\n      <code>slist_iterator</code> that refers to the first node in\n      the list, but we want to return a value with the object type\n      <code>iterator</code>. This requires an explicit coercion\n      using the <code>:&gt;</code> operator.\n    </blockquote>")))
 (idp9354240
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Next, we'll define an actual iterator for the class\n      <code>slist</code>. We can represent the position in the\n      list with a field <code>current</code>, following links as\n      we traverse the list.\n    </blockquote>")))
 (idp9351920
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      First, we'll define an object type <code>iterator</code>\n      that specifies the methods in an iterator.\n    </blockquote>")))
 (idp9350736
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      OCaml support both styles. In fact, OCaml is more flexible than\n      these approaches because an object type can be implemented by any\n      object with the appropriate methods; it does not have to be\n      specified by the object's class <span><em>a priori</em></span>.\n      We'll leave abstract classes for later. Let's demonstrate the\n      technique using object types.\n    </blockquote>")))
 (idp9348032
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      There are two common styles for defining abstract interfaces like\n      this. In Java, an iterator would normally be specified with an\n      interface, which specifies a set of method types. In languages\n      without interfaces, like C++, the specification would normally use\n      <span><em>abstract</em></span> classes to specify the methods\n      without implementing them (C++ uses the &quot;= 0&quot; definition\n      to mean &quot;not implemented&quot;).\n    </blockquote>")))
 (idp9345776
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      This definition of the class <code>slist</code> is not\n      complete, we can construct lists, but we also need to add the\n      ability to traverse the elements in the list. One common style for\n      doing this is to define a class for an <code>iterator</code>\n      object. An iterator provides a generic mechanism to inspect and\n      traverse the elements of a collection. This pattern isn't\n      restricted to lists, it can be used for many different kinds of\n      collections.\n    </blockquote>")))
 (idp9340336
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Next, we can define the list itself. We'll keep a field\n      <code>head</code> that refers to the first element in the\n      list, and <code>last</code> that refers to the final element\n      in the list. The method <code>insert</code> adds an element\n      to the end of the list.\n    </blockquote>")))
 (idp9339424
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In general, we need to provide enough constraints so that the\n      compiler will infer the correct type. We can add type constraints\n      to the parameters, to the fields, and to the methods. It is a\n      matter of preference how many constraints to add. You can add type\n      constraints in all three places, but the extra text may not help\n      clarity. A convenient middle ground is to annotate the fields\n      and/or class parameters, and add constraints to methods only if\n      necessary.\n    </blockquote>")))
 (idp9333488
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The type annotations on the <code>val</code> declarations\n      are used to constrain type inference. If we omit these\n      annotations, the type inferred for the class will be &quot;too\n      polymorphic,&quot; <code>x</code> could have some type\n      <code>'b</code> and <code>next_node</code> some type\n      <code>'c option</code>.\n    </blockquote>")))
 (idp9329248
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The <code>value</code> is the value stored in the node, and\n      it can be retrieved and changed with the <code>get</code>\n      and <code>set</code> methods. The\n      <code>next_node</code> field is the link to the next element\n      in the stack. Note that the type parameter <code>['a]</code>\n      in the definition uses square brackets, but other uses of the type\n      can omit them (or use parentheses if there is more than one type\n      parameter).\n    </blockquote>")))
 (idp9325104
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Let's build an example of an imperative singly-linked list using\n      object-oriented techniques. First, we'll want to define a class\n      for a single element of the list. We'll call it a\n      <code>node</code>, and it will hold a value of type\n      <code>'a</code>. When defining the class, the type\n      parameters are placed in square brackets before the class name in\n      the class definition. We also need a parameter\n      <code>x</code> for the initial value.\n    </blockquote>")))
 (idp9323376
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      A class definition serves as the <span><em>constructor</em></span>\n      for the class. In general, a class definition may have parameters\n      that must be provided as arguments when the object is created with\n      <code>new</code>.\n    </blockquote>")))
 (idp9320624
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In this version, we don't use any references, and instead a\n      recursive function keeps track of the last digest in use and the\n      accumulated result string. This version isn't quite as efficient\n      as the previous one due to the careless use of string\n      concatenation for the accumulator, but this can easily be fixed by\n      using the <code>Buffer</code> module instead.\n    </blockquote>")))
 (idp9316704
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Notice how the encoder object is used as an accumulator, by using\n      the <code>put_string</code> and\n      <code>available_output</code> to keep track of progress.\n      Objects don't <span><em>require</em></span> an imperative style\n      though, and the same algorithm can be written more functionally:\n    </blockquote>")))
 (idp9315152
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The derivation algorithm takes an input password and desired total\n      length (the addition of the key and IV length). It initialises a\n      <code>Hexa.encode</code> transformer, which will accept\n      arbitrary binary data and output a hexadecimal string (with two\n      output bytes per input byte). A reference stores the last digest\n      that's been calculated, and then the algorithm iterates until it\n      has sufficient data to satisfy the required key length.\n    </blockquote>")))
 (idp9310064
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We've selected the <code>-nosalt</code> option here to make\n      the output deterministic, and the <code>-P</code> option\n      prints out the derived key and IV and exits. The algorithm used to\n      derive these results is described in the\n      <code>man EVP_BytesToKey</code> manual page (you may need to\n      install the OpenSSL documentation packages on your system first).\n      We can implement this derivation function using an imperative\n      style:\n    </blockquote>")))
 (idp9307632
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Now let's try something more advanced. The\n      <code>openssl</code> library is installed on most systems,\n      and can be used to encrypt plaintext using several encryption\n      strategies. At its simplest, it will take a secret phrase and\n      derive an appropriate key and initialisation vector.\n    </blockquote>")))
 (idp9303376
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We can extend this simple example by selecting either the\n      <code>md5</code> or <code>sha1</code> hash function at\n      runtime depending on the name of our binary.\n      <code>Sys.argv</code> is an array containing the arguments\n      the command was invoked with, and the first entry is the name of\n      the binary itself.\n    </blockquote>")))
 (idp9300496
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      After opening the right modules, we read in the entire standard\n      input into an OCaml string. This is then passed onto the MD5 hash\n      function, which returns a binary string. This binary is passed\n      through the <code>Hexa</code> hexadecimal encoder, which\n      returns an ASCII representation of the input. The output of this\n      command will be the same as the <code>md5</code> command (or\n      <code>md5sum</code> in some systems).\n    </blockquote>")))
 (idp9295664
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Hash objects hold state and are thus naturally imperative. Once\n      instantiated, data is fed into them by the addition functions, the\n      <code>result</code> is computed and finally the contents\n      erased via <code>wipe</code>. The\n      <code>hash_string</code> convenience function applies the\n      hash function fully to a string, and returns the result. The\n      <code>md5</code> command is quite straight-forward now:\n    </blockquote>")))
 (idp9293088
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Concrete hash objects can be instantiated from various sub-modules\n      in Cryptokit. The simplest ones such as MD5 or SHA1 do not take\n      any special input parameters to build the object. The\n      <code>hmac_sha1</code> takes a string key to initialise the\n      Message Authenticate Code for that particular hash function.\n    </blockquote>")))
 (idp9289456
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Our first example mimics the <code>md5</code> command, which\n      reads in an input file and returns a hexadecimal representation of\n      its MD5 cryptographic hash. Cryptokit defines a number of\n      different functions and collects them together under the\n      <code>Cryptokit.hash</code> class type:\n    </blockquote>")))
 (idp9287296
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The Cryptokit library can be installed via OPAM via\n      <code>opam install cryptokit</code>. Once that's finished\n      compiling and installing, you just need to\n      <code>#require &quot;cryptokit&quot;</code> in your toplevel\n      to load the library and make the modules available.\n    </blockquote>")))
 (idp9286048
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Let's take a break from describing the object system with a more\n      practical example that uses the OCaml cryptographic library.\n    </blockquote>")))
 (idp9279840
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      This new <code>movable_point</code> class also makes use of\n      the <code>(self : 'self)</code> binding after the\n      <code>object</code> keyword. The variable\n      <code>self</code> stands for the current object, allowing\n      self-invocation, and the type variable <code>'self</code>\n      stands for the type of the current object (which in general is a\n      subtype of <code>movable_point</code>).\n    </blockquote>")))
 (idp9277152
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Inheritance uses an existing class to define a new one. For\n      example, the following class definition supports an addition\n      method <code>moveby</code> that moves the point by a\n      relative amount.\n    </blockquote>")))
 (idp9274688
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      To produce an object, classes are instantiated with the keyword\n      <code>new</code>.\n    </blockquote>")))
 (idp9268864
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The type <code>class point : ... end</code> is a\n      <span><em>class type</em></span>. This particular type specifies\n      that the <code>point</code> class defines a mutable field\n      <code>x</code>, a method <code>get</code> that returns\n      an <code>int</code>, and a method <code>set</code>\n      with type <code>int -&gt; unit</code>.\n    </blockquote>")))
 (idp9266016
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In OCaml, class definitions must be defined as toplevel statements\n      in a module. A class is not an object, and a class definition is\n      not an expression. The syntax for a class definition uses the\n      keyword <code>class</code>.\n    </blockquote>")))
 (idp9264432
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Programming with objects directly is great for encapsulation, but\n      one of the main goals of object-oriented programming is code\n      re-use through inheritance. For inheritance, we need to introduce\n      <span><em>classes</em></span>. In object-oriented programming, a\n      class is a &quot;recipe&quot; for creating objects. The recipe can\n      be changed by adding new methods and fields, or it can be changed\n      by modifying existing methods.\n    </blockquote>")))
 (idp9257504
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      An object of type <code>&lt; get:int; .. &gt;</code> can be\n      any object with a method <code>get:int</code>, it doesn't\n      matter how it is implemented. So far, we've constructed two\n      objects with that type; the function <code>make</code>\n      constructed one, and so did <code>average</code>. When the\n      method <code>#get</code> is invoked, the actual method that\n      is run is determined by the object.\n    </blockquote>")))
 (idp9253952
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In other words, the type <code>'a point</code> is equal to\n      <code>'a</code>, where\n      <code>'a = &lt; get : int; .. &gt;</code>. That may seem\n      like an odd way to say it, and in fact, this type definition is\n      not really an abbreviation because <code>'a</code> refers to\n      the entire type.\n    </blockquote>")))
 (idp9249264
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      A <code>..</code> in an object type is called a\n      <span><em>row variable</em></span> and this typing scheme is called\n      <span><em>row polymorphism</em></span>. Even though\n      <code>..</code> doesn't look like a type variable, it\n      actually is. The error message suggests a solution, which is to\n      add the <code>as 'a</code> type constraint.\n    </blockquote>")))
 (idp9246448
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The <code>..</code> in an object type is an elision,\n      standing for &quot;possibly more methods.&quot; It may not be\n      apparent from the syntax, but an elided object type is actually\n      polymorphic. If we try to write a type definition, we get an\n      obscure error.\n    </blockquote>")))
 (idp9243072
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The potential extra parameters defined by the object are carefully\n      tracked by the OCaml type checker. If we manually try and\n      constrain the exact type <code>&lt; get : int &gt;</code>\n      for an object with more methods, type inference will fail.\n    </blockquote>")))
 (idp9240832
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      We can use the <code>average</code> using the normal object\n      invocation syntax:\n    </blockquote>")))
 (idp9236576
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      There's some new syntax in the type that's been inferred for\n      <code>average</code> here. The parameters have the object\n      type <code>&lt; get : int; .. &gt;</code>. The\n      <code>..</code> are ellipsis, standing for any other\n      methods. The type <code>&lt; get : int; .. &gt;</code>\n      specifies an object that must have at least a\n      <code>get</code> method, and possibly some others as well.\n    </blockquote>")))
 (idp9233504
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Functions can also take object arguments. Let's construct a new\n      object <code>average</code> that returns the average of any\n      two objects with a <code>get</code> method.\n    </blockquote>")))
 (idp9228928
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Note that the types of the function <code>make</code> and\n      the returned object now use the polymorphic type\n      <code>'a</code>. When make is invoked on a concrete value\n      <code>5</code>, we get the same object type as before, with\n      type <code>int</code> for the value.\n    </blockquote>")))
 (idp9226976
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Objects can also be constructed by functions. If we want to\n      specify the initial value of the object, we can define a function\n      that takes the value and returns an object.\n    </blockquote>")))
 (idp9223008
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The object type is enclosed in angle brackets\n      <code>&lt; ... &gt;</code>, containing just the types of the\n      methods. Fields, like <code>x</code>, are not part of the\n      public interface of an object. All interaction with an object is\n      through its methods. The syntax for a method invocation (also\n      called &quot;sending a message&quot; to the object) uses the\n      <code>#</code> character.\n    </blockquote>")))
 (idp9219792
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      The object has an integer value <code>x</code>, a method\n      <code>get</code> that returns x, and a method\n      <code>set</code> that updates the value of\n      <code>x</code>.\n    </blockquote>")))
 (idp9217536
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      OCaml is entirely different. Classes are used to construct objects\n      and support inheritance, including non-subtyping inheritance.\n      Classes are not types. Instead, objects have <span><em>object\n      types</em></span>, and if you want to use objects, you aren't\n      required to use classes at all. Here's an example of a simple\n      object.\n    </blockquote>")))
 (idp9215056
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      If you already know about object oriented programming in a\n      language like Java or C++, the OCaml object system may come as a\n      surprise. Foremost is the complete separation of subtyping and\n      inheritance in OCaml. In a language like Java, a class name is\n      also used as the type of objects created by instantiating it, and\n      the subtyping rule corresponds to inheritance. For example, if we\n      implement a class <code>Stack</code> in Java by inheriting\n      from a class <code>Deque</code>, we would be allowed to pass\n      a stack anywhere a deque is expected (this is a silly example of\n      course, practitioners will point out that we shouldn't do it).\n    </blockquote>")))
 (idp9212368
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In this chapter, we'll introduce you to the basics of object\n      definition and use in OCaml, and then demonstrate their use with\n      an example using Cryptokit. We'll return to the more advanced\n      areas of object use later on in the book in\n      <a href=\"object-subtyping-and-inheritance.html\">Chapter\194\16011, <i>Object Subtyping and Inheritance</i></a>.\n    </blockquote>")))
 (idp9210064
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In general, a rule of thumb is: use classes and objects in\n      situations where dynamic binding is a big win, for example if you\n      have many similar variations in the implementation of a concept.\n      Two good examples are Xavier Leroy's\n      <a href=\"http://gallium.inria.fr/~xleroy/software.html#cryptokit\" target=\"_top\">Cryptokit</a>,\n      which provides a variety of cryptographic primitives that can be\n      combined in building-block style, and the\n      <a href=\"http://cristal.inria.fr/camlimages/\" target=\"_top\">Camlimages</a>\n      library which manipulates various graphical file formats.\n    </blockquote>")))
 (idp9209360
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      In contrast, modules use static (lexical) scoping. If you want to\n      parameterize your module code so that some part of it can be\n      implemented later, you would write a function or functor. This is\n      more explicit, but often more verbose than overriding a method in\n      a class.\n    </blockquote>")))
 (idp9208016
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      Modules already provide these features in some form, but the main\n      focus of classes is on code re-use through inheritance and late\n      binding of methods. This is a critical property of classes: the\n      methods that implement an object are determined when the object is\n      instantiated, a form of <span><em>dynamic</em></span> binding. In\n      the meantime, while classes are being defined, it is possible (and\n      necessary) to refer to methods without knowing statically how they\n      will be implemented.\n    </blockquote>")))
 (idp9207152
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n      You might wonder when to use objects in OCaml, which has a\n      multitude of alternative mechanisms to express the same concept.\n      First-class modules are more expressive (a module can include\n      types, while classes and objects cannot). Modules, functors, and\n      algebraic data types also offer a wide range of ways to express\n      program structure. In fact, many seasoned OCaml programmers rarely\n      use classes and objects, if at all.\n    </blockquote>")))
 (idp9205280
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n    Almost every notable modern programming language has been influenced\n    by OOP, and you'll have run across these terms if you've ever used\n    C++, Java, C#, Ruby, Python or Javascript.\n  </blockquote>")))
 (idp9204000
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n<span><em>Inheritance</em></span>: the definition of one kind of\n        object can be re-used to produce a new kind of object. This new\n        definition can override some behaviour, but also share code with\n        its parent.\n      </blockquote>")))
 (idp9199936
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n<span><em>Subtyping</em></span>: if an object\n        <code>a</code> has all the functionality of an object\n        <code>b</code>, then we may use <code>a</code> in\n        any context where <code>b</code> is expected.\n      </blockquote>")))
 (idp9198448
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n<span><em>Dynamic lookup</em></span>: when a message is sent to\n        an object, the method to be executed is determined by the\n        implementation of the object, not by some static property of the\n        program. In other words, different objects may react to the same\n        message in different ways.\n      </blockquote>")))
 (idp9197088
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n<span><em>Abstraction</em></span>: the details of the\n        implementation are hidden in the object, and the external\n        interface is just the set of publically-accessible methods.\n      </blockquote>")))
 (idp9196080
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n    There are four fundamental properties that differentiate OOP from\n    other styles:\n  </blockquote>")))
 (idp9193472
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n    Object-oriented programming (often shorted to OOP) is a programming\n    style that encapsulates computation and data within logical\n    <span><em>objects</em></span>. Each object contains some data stored\n    in <span><em>fields</em></span>, and has <span><em>method</em></span>\n    functions that can be invoked against the data within the object.\n    The code definition behind an object is called a\n    <span><em>class</em></span>, and objects are constructed from a class\n    definition by calling a constructor with the data that the object\n    will use to build itself.\n  </blockquote>")))
 (idp9192032
  ((file object-oriented-programming.html)
   (html
    "<blockquote>\n    We've already seen several tools that OCaml provides for organizing\n    programs, particularly first-class modules. In addition, OCaml also\n    supports object-oriented programming. There are objects, classes,\n    and their associated types. Objects are good for encapsulation and\n    abstraction, and classes are good for code re-use.\n  </blockquote>")))
 (idp11439664
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        TODO Talk about &quot;alloc&quot; and &quot;float&quot;\n        qualifiers to <code>external</code>\n</blockquote>")))
 (idp11438416
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Records are never rearranged in memory, so the fields will\n        appear in the same order they are declared.\n      </blockquote>")))
 (idp11435632
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Tuples and records both have the same memory representation,\n        with the same tag value (<code>0</code>). This means that\n        you can change how you map these fields into OCaml, without\n        having to modify the C bindings. For example, our earlier\n        integer addition example can also look like this:\n      </blockquote>")))
 (idp11405856
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>caml/alloc.h</code> header file lists all of the\n        functions that allocate OCaml values.\n      </blockquote>")))
 (idp11402256
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Assignments to the fields of structured blocks must be done with\n        the <code>Store_field</code> macro (for normal blocks) or\n        <code>Store_double_field</code> macro (for arrays and\n        records of floating-point numbers). Other assignments must not\n        use <code>Store_field</code> nor\n        <code>Store_double_field</code>.\n      </blockquote>")))
 (idp11394464
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The tuple is then allocated via\n        <code>caml_alloc_tuple</code>, with the number of fields\n        representing the size of the tuple. This must\n        <span><em>immediately</em></span> be followed by the\n        <code>Store_field</code> macros to set the newly allocated\n        tuple to sensible values. In our example, we assign the first\n        two fields to the local integers. The <code>int32</code>\n        requires another allocation, and\n        <code>caml_copy_int32</code> is used which copies a C\n        <code>int32</code> into the correspondig OCaml\n        <code>value</code>. Once the tuple has been set, the\n        function returns via <code>CAMLreturn</code>, which frees\n        up the local roots that we registered at the beginning of the\n        function.\n      </blockquote>")))
 (idp11388624
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        A function that has parameters or local variables of type value\n        must begin with a call to one of the\n        <code>CAMLparam</code> macros and return with\n        <code>CAMLreturn</code>, <code>CAMLreturn0</code>,\n        or <code>CAMLreturnT</code>. Local variables of type\n        <code>value</code> must be declared with one of the\n        <code>CAMLlocal</code> macros. Arrays of values are\n        declared with <code>CAMLlocalN</code>. These macros must\n        be used at the beginning of the function, not in a nested block.\n      </blockquote>")))
 (idp11379344
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The stub now uses several new macros that are all defined in\n        <code>caml/memory.h</code>. The\n        <code>CAMLparam</code> macro registers its parameters as\n        <span><em>local roots</em></span> with the garbage collector.\n        This ensures that if the garbage collector is triggered during\n        the C binding, it will not relocate or free the value we just\n        allocated. We also need to allocate a tuple to store the result.\n        This is declared with the <code>CAMLlocal</code> macro,\n        and returned via <code>CAMLreturn</code>. For many simple\n        bindings, you can just follow the simple rule of replacing the C\n        <code>return</code> with <code>CAMLreturn</code> and\n        starting every function with <code>CAMLparam</code> and\n        <code>CAMLlocal</code>, and not have to worry about the\n        garbage collector.\n      </blockquote>")))
 (idp11374896
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>add_numbers</code> external now returns a more\n        complex data type that requires allocating an OCaml tuple from\n        within the C binding, storing the results within the tuple, and\n        returning that tuple. The contents of the tuple are also a mix\n        of immediate values (the two first <code>int</code> fields\n        in the tuple) and the last boxed <code>int32</code> that\n        also needs to be allocated on the OCaml heap.\n      </blockquote>")))
 (idp11372752
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Building OCaml values to return from C is a little more\n        involved, since we must ensure that any OCaml allocations aren't\n        immediately cleaned up by the garbage collector before they have\n        been registered as live values. Luckily, OCaml provides some\n        more macros to make this easier to enforce. Let's extend our\n        earlier example to return a tuple of integers instead of just\n        the result.\n      </blockquote>")))
 (idp11336064
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        TODO: buggy markdown below in table rendering\n      </blockquote>")))
 (idp11332160
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        OCaml provides macros to convert to and from all the basic OCaml\n        runtime values and C types, of the form\n        <code>to_from</code>. For example\n        <code>Val_long</code> means &quot;Value from long&quot;,\n        and <code>Long_val</code> means &quot;Long from\n        value&quot;. The table below summarises the macros to extract\n        various C types from OCaml <code>values</code> for 64-bit\n        architectures. Note that OCaml doesn't support a\n        single-precision float, so these are always double-precision.\n      </blockquote>")))
 (idp11330416
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Notice that both the input and output integers are incorrect in\n        the output, since they still have their tag bits set when being\n        added in the C code. Don't depend on the good graces of your C\n        compiler to always spot such errors though. It's also invalid to\n        add two <code>value</code>s together without converting\n        them into native C type, but the C compiler can't warn about\n        this and the result is silently incorrect. It's good practise to\n        immediately convert arguments to local C stack variables as\n        early as possible, so you don't get the types mixed up deep into\n        the C function.\n      </blockquote>")))
 (idp11328768
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The compiler will now complain of invalid format strings when\n        you compile this:\n      </blockquote>")))
 (idp11326240
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        You should keep an eye out for warnings from your compiler which\n        often indicate that you've forgotten to correctly convert a\n        <code>value</code>. For example, try a broken version of\n        the previous binding:\n      </blockquote>")))
 (idp11318960
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        OCaml passes the integers to <code>caml_add_numbers</code>\n        as <code>value</code> types, so the binding uses the\n        <code>Int_val</code> macro to convert them into local\n        stack variables. The <code>Int_val</code> macro converts a\n        <code>value</code> to an integer by removing the tag bit.\n        The C integers are then added together and the result\n        <code>value</code> is constructed by applying the\n        <code>Val_int</code> macro, which takes a C integer and\n        tags it into becoming an OCaml <code>value</code>. When\n        you compile and run this version of the code, you should see\n        this output:\n      </blockquote>")))
 (idp11315680
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>add_numbers</code> external function now takes\n        two arguments, and returns an integer instead of a simple\n        <code>unit</code>. The updated C stub looks like this:\n      </blockquote>")))
 (idp11311856
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The earlier hello world example is rather basic and only uses\n        <code>unit</code> types. Let's extend the signature to\n        take a couple of <code>int</code> arguments instead of a\n        single <code>unit</code> so that we can send more useful\n        data between OCaml and C:\n      </blockquote>")))
 (idp11308336
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        If you get an error that <code>libasmrund.a</code> is not\n        found, then this is probably because you're using OCaml 4.00 and\n        not 4.01. It's only installed by default in the very latest\n        version, which you should be using via the\n        <code>4.01.0dev+trunk</code> OPAM switch.\n      </blockquote>")))
 (idp11306160
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        To use this, just recompile with\n        <code>-runtime-variant d</code> set:\n      </blockquote>")))
 (idp11305312
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Despite your best efforts, it is easy to introduce a bug into C\n        bindings that cause heap invariants to be violated. OCaml\n        includes a variant of the runtime library that is compiled with\n        debugging symbols, and includes regular memory integrity checks\n        upon every garbage collection. Running these often will abort\n        the program near the point of corruption and helps track it down\n        quickly.\n      </blockquote>")))
 (idp11302784
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        You must be <span><em>very</em></span> careful that the value you\n        return from the C function corresponds exactly to the memory\n        representation of the types you declared earlier in the\n        <code>external</code> declaration of the ML file, or else\n        heap carnage and corruption will ensure.\n      </blockquote>")))
 (idp11300768
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        You can now recompile the <code>hello</code> binary with\n        this additional C file included in the compiler command-line,\n        and it should succeed:\n      </blockquote>")))
 (idp11295360
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        This external function has a single argument of type\n        <code>unit</code>, which is represented as an integer of\n        value 0 in memory. Our C function definition of\n        <code>caml_hello_world</code> must therefore accept a\n        single <code>value</code> parameter and return a\n        <code>value</code>. Let's create the\n        <code>hello_stubs.c</code> file now that implements this:\n      </blockquote>")))
 (idp11290080
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>value</code> typedef is a memory word that can\n        either be an integer if <code>Is_long</code> is true, or a\n        heap block if <code>Is_block</code> is true. All of the\n        arguments passed to the C bindings will be of type\n        <code>value</code>, since this is sufficient to represent\n        any valid OCaml value in memory. Let's look at the external\n        declaration for <code>hello_world</code> again:\n      </blockquote>")))
 (idp11287504
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n<code>mlvalues.h</code> is the basic header file that all\n        OCaml-C bindings need. It is also shared by the garbage\n        collector, and defines a few important typedefs early on that\n        should be familiar after the earlier explanation about the\n        memory representation of OCaml values:\n      </blockquote>")))
 (idp11283664
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        This is the system linker telling you that there is a missing\n        <code>caml_hello_world</code> symbol. We need to provide a\n        C file that will implement this function and make it available\n        to the linker before it creates a standalone executable. The\n        OCaml compiler uses file extensions to determine how to compile\n        each file. When it sees a <code>.c</code> extension, it\n        passes it to the system C compiler and appends an include\n        directory containing the OCaml runtime header files. You can\n        find these runtime header files by running\n        <code>ocamlc -where</code> and looking under the\n        <code>caml/</code> subdirectory.\n      </blockquote>")))
 (idp11281760
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        If you try to compile this module to an executable now, you\n        should receive a linker error:\n      </blockquote>")))
 (idp11279280
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Let's define a simple &quot;Hello World&quot; C binding to see\n        how this works. First create a <code>hello.ml</code> that\n        contains the external declaration:\n      </blockquote>")))
 (idp11275904
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      Now that you understand the runtime structure of the garbage\n      collector, you can interface it with C. OCaml defines an\n      <code>external</code> keyword that maps OCaml functions to a\n      C symbol. When the function is invoked from OCaml, the C function\n      will be called with the OCaml function arguments using their\n      native <code>value</code> representation. This corresponds\n      to the memory layout for OCaml values described earlier.\n    </blockquote>")))
 (idp11272976
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        When a custom block is allocated, you can also specify the\n        proportion of &quot;extra-heap resources&quot; consumed by the\n        block, which will affect the garbage collector's decision as to\n        how much work to do in the next major slice.\n        (<span><em>avsm</em></span>: TODO elaborate on this or move to\n        the C interface section)\n      </blockquote>")))
 (idp11269552
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The custom operations specify how the runtime should perform\n        polymorphic comparison, hashing and binary marshalling. They\n        also optionally contain a <span><em>finalizer</em></span> that\n        the runtime calls just before the block is garbage collected.\n        This finalizer has nothing to do with ordinary OCaml finalizers\n        (as created by <code>Gc.finalise</code> and explained in\n        <a href=\"tuning-the-runtime\" target=\"_top\">xref</a>). Instead, they are\n        used to call C cleanup functions such as\n        <code>free</code>.\n      </blockquote>")))
 (idp11266912
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The first word of the data within the custom block is a C\n        pointer to a <code>struct</code> of custom operations. The\n        custom block cannot have pointers to OCaml blocks and is opaque\n        to the garbage collector.\n      </blockquote>")))
 (idp11263472
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        OCaml supports <span><em>custom</em></span> heap blocks via a\n        <code>Custom_tag</code> that let the runtime perform\n        user-defined operations over OCaml values. A custom block lives\n        in the OCaml heap like an ordinary block and can be of whatever\n        size the user desires. The <code>Custom_tag</code> (255)\n        is higher than <code>No_scan_tag</code> and isn't scanned\n        by the garbage collector. This means that it cannot contain any\n        OCaml values, but is useful to track pointers into the external\n        C heap.\n      </blockquote>")))
 (idp11261520
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The guaranteed NULL-termination comes in handy when passing a\n        string to C, but is not relied upon to compute the length from\n        OCaml code. Thus, OCaml strings can contain null bytes at any\n        point within the string, but care should be taken that any C\n        library functions can also cope with this.\n      </blockquote>")))
 (idp11260112
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        This string representation is a clever way to ensure that the\n        string contents are always zero-terminated by the padding word,\n        and still compute its length efficiently without scanning the\n        whole string. The following formula is used:\n      </blockquote>")))
 (idp11247840
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        On a 32-bit machine, the padding is calculated based on the\n        modulo of the string length and word size to ensure the result\n        is word-aligned. A 64-bit machine extends the potential padding\n        up to 7 bytes instead of 3.\n      </blockquote>")))
 (idp11244496
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Strings are standard OCaml blocks with the header size defining\n        the size of the string in machine words. The\n        <code>String_tag</code> (252) is higher than the\n        <code>No_scan_tag</code>, indicating that the contents of\n        the block are opaque to the collector. The block contents are\n        the contents of the string, with padding bytes to align the\n        block on a word boundary.\n      </blockquote>")))
 (idp11242192
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Another inefficiency is when a polymorphic variant constructor\n        has more than one parameter. Normal variants hold parameters as\n        a single flat block with multiple fields for each entry, but\n        polymorphic variants must adopt a more flexible uniform memory\n        representation since they may be re-used in a different context.\n        They allocate a tuple block for the parameters that is pointed\n        to from the argument field of the variant. Thus, there are three\n        additional words for such variants, along with an extra memory\n        indirection due to the tuple.\n      </blockquote>")))
 (idp11240592
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Polymorphic variants use more memory space when parameters are\n        included in the datatype constructors. Normal variants use the\n        tag byte to encode the variant value, but this byte is\n        insufficient to encode the hashed value for polymoprhic\n        variants. Therefore, they must allocate a new block (with tag\n        <code>0</code>) and store the value in there instead. This\n        means that polymorphic variants with constructors use one word\n        of memory more than normal variant constructors.\n      </blockquote>")))
 (idp11240000
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The hash function is designed to give the same results on 32-bit\n        and 64-bit architectures, so the memory representation is stable\n        across different CPUs and host types.\n      </blockquote>")))
 (idp11236400
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Polymorphic variants are more flexible than normal variants when\n        writing code, but can be less efficient at runtime. This is\n        because there isn't as much static compile-time information\n        available to optimise their memory layout. This isn't always the\n        case, however. A polymorphic variant without any parameters is\n        stored as an unboxed integer and so only takes up one word of\n        memory. Unlike normal variants, the integer value is determined\n        by apply a hash function to the <span><em>name</em></span> of the\n        variant. The hash function isn't exposed directly by the\n        compiler, but the <code>type_conv</code> library from Core\n        provides an alternative implementation.\n      </blockquote>")))
 (idp11234384
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Due to this encoding, there is a limit around 240 variants with\n        parameters that applies to each type definition, but the only\n        limit on the number of variants without parameters is the size\n        of the native integer (either 31- or 63-bits). This limit arises\n        because of the size of the tag byte, and that some of the high\n        numbered tags are reserved.\n      </blockquote>")))
 (idp11232208
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Some theorem provers such as Coq do output code which uses\n        <code>Obj</code> internally, but the external module\n        signatures never expose it. Unless you too have a machine proof\n        of correctness to accompany your use of <code>Obj</code>,\n        stay away from it except for debugging!\n      </blockquote>")))
 (idp11230256
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>Obj</code> module is an undocumented module that\n        exposes the internals of the OCaml compiler and runtime. It is\n        very useful for examining and understanding how your code will\n        behave at runtime, but should <span><em>never</em></span> be used\n        for production code unless you understand the implications. The\n        module bypasses the OCaml type system, making memory corruption\n        and segmentation faults possible.\n      </blockquote>")))
 (idp11224720
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Lists are stored with a representation that is exactly the same\n        as if the list was written as a variant type with\n        <code>Head</code> and <code>Cons</code>. The empty\n        list <code>[]</code> is an integer <code>0</code>,\n        and subsequent blocks have tag <code>0</code> and two\n        parameters: a block with the current value, and a pointer to the\n        rest of the list.\n      </blockquote>")))
 (idp11216256
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        In the above example, the <code>Apple</code> and\n        <code>Kiwi</code> values are still stored as normal OCaml\n        integers with values <code>0</code> and\n        <code>1</code> respectively. The <code>Orange</code>\n        and <code>Pear</code> values both have parameters, and are\n        stored as blocks whose tags ascend from <code>0</code>\n        (and so <code>Pear</code> has a tag of\n        <code>1</code>, as the use of <code>Obj.tag</code>\n        verifies). Finally, the parameters are fields which contain\n        OCaml values within the block, and <code>Obj.field</code>\n        can be used to retrieve them.\n      </blockquote>")))
 (idp11213744
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Variants that have parameters arguments are a little more\n        complex. They are stored as blocks, with the value\n        <span><em>tags</em></span> ascending from 0 (counting from\n        leftmost variants with parameters). The parameters are stored as\n        words in the block.\n      </blockquote>")))
 (idp11210368
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n<code>Obj.magic</code> unsafely forces a type cast between\n        any two OCaml types; in this example the <code>int</code>\n        type hint retrieves the runtime integer value. The\n        <code>Obj.is_block</code> confirms that the value isn't a\n        more complex block, but just an OCaml <code>int</code>.\n      </blockquote>")))
 (idp11207920
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Basic variant types with no extra parameters for any of their\n        branches are simply stored as an OCaml integer, starting with\n        <code>0</code> for the first option and in ascending\n        order.\n      </blockquote>")))
 (idp11204960
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Notice that float tuples are <span><em>not</em></span> optimized\n        in the same way as float records or arrays, and so they have the\n        usual tuple tag value of <code>0</code>. Only records and\n        arrays can have the array optimization, and only if every single\n        field is a float.\n      </blockquote>")))
 (idp11201744
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        You can test this for yourself using the\n        <code>Obj.tag</code> function to check that the allocated\n        block has the expected runtime tag, and\n        <code>Obj.double_field</code> to retrieve a float from\n        within the block.\n      </blockquote>")))
 (idp11198256
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Since each floating-point value is boxed in a separate memory\n        block, it can be inefficient to handle large arrays of floats in\n        comparison to unboxed integers. OCaml therefore special-cases\n        records or arrays that contain <span><em>only</em></span>\n<code>float</code> types. These are stored in a block that\n        contains the floats packed directly in the data section, with\n        the <code>Double_array_tag</code> set to signal to the\n        collector that the contents are not OCaml values.\n      </blockquote>")))
 (idp11195760
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Floating point numbers in OCaml are always stored as full\n        double-precision values. Individual floating point values are\n        stored as a block with a single field that contains the number.\n        This block has the <code>Double_tag</code> set which\n        signals to the collector that the floating point value is not to\n        be scanned.\n      </blockquote>")))
 (idp11192528
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>Obj.repr</code> function retrieves the runtime\n        representation of any OCaml value.\n        <code>Obj.is_block</code> checks the bottom bit to\n        determine if the value is a block header or an unboxed integer.\n      </blockquote>")))
 (idp11190176
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        You can check the difference between a block and a direct\n        integer yourself using the <code>Obj</code> module, which\n        exposes the internal representation of values to OCaml code.\n      </blockquote>")))
 (idp11188704
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Tuples, records and arrays are all represented identically at\n        runtime as a block with tag <code>0</code>. Tuples and\n        records have constant sizes determined at compile-time, whereas\n        arrays can be of variable length. While arrays are restricted to\n        containing a single type of element in the OCaml type system,\n        this is not required by the memory representation.\n      </blockquote>")))
 (idp11184400
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Remember that since integers are never allocated on the heap,\n        all of these basic types such as empty lists and\n        <code>unit</code> are therefore very efficient to use.\n        They will often be passed in registers and never even appear on\n        the stack, if you don't have too many parameters to your\n        functions or are running on a modern architecture with lots of\n        spare registers (such as <code>x86_64</code>).\n      </blockquote>")))
 (idp11178768
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        Many basic types are stored directly as unboxed values at\n        runtime. The native <code>int</code> type is the most\n        obvious, although it drops a single bit of precision due to the\n        tag bit described earlier. Other atomic types such as the\n        <code>unit</code> and empty list <code>[]</code>\n        value are stored as constant integers. Boolean values have a\n        value of <code>0</code> and <code>1</code> for\n        <code>true</code> and <code>false</code>\n        respectively.\n      </blockquote>")))
 (idp11148112
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The exact representation of values inside a block depends on\n        their OCaml type. They are summarised in the table below, and\n        then we'll examine some of them in greater detail.\n      </blockquote>")))
 (idp11145936
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        A block's tag byte is multi-purpose, and indicates whether the\n        data array represents opaque bytes or fields. If a block's tag\n        is greater than or equal to <code>No_scan_tag</code>\n        (251), then the block's data are all opaque bytes, and are not\n        scanned by the collector. The most common such block is the\n        <code>string</code> type, which we describe more below.\n      </blockquote>")))
 (idp11134288
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The size field records the length of the block in memory words.\n        Note that it is limited to 22-bits on 32-bit platforms, which is\n        the reason why OCaml strings are limited to 16MB on that\n        architecture. If you need bigger strings, either switch to a\n        64-bit host, or use the <code>Bigarray</code> module\n        described in\n        <a href=\"managing-external-memory-with-bigarrays\" target=\"_top\">xref</a>.\n        The 2-bit color field is used by the garbage collector to keep\n        track of its state during mark-and-sweep, and is not exposed\n        directly to OCaml programs.\n      </blockquote>")))
 (idp11131280
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        An OCaml <span><em>block</em></span> is the basic unit of\n        allocation on the heap. A block consists of a one-word header\n        (either 32- or 64-bits) followed by variable-length data that is\n        either opaque bytes or an array of <span><em>fields</em></span>.\n        The header has a multi-purpose tag byte that defines whether to\n        interprete the subsequent data as opaque or OCaml fields. The\n        garbage collector never inspects opaque bytes, but the array of\n        fields are all treated as more valid OCaml values. The garbage\n        collector always inspects fields, and follows them as part of\n        the collection process described earlier.\n      </blockquote>")))
 (idp11127776
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      An even more alert reader will be wondering about the performance\n      implications are for integer arithmetic using this tagged\n      representation. Since the bottom bit is set, any operation on the\n      integer has to shift the bottom bit right to recover the\n      &quot;native&quot; value. The native code OCaml compiler generates\n      very efficient x86 assembly code in this case, and takes advantage\n      of modern processor instructions to either hide the extra work, or\n      get it for free from the instruction set. Addition and\n      substraction are a single instruction, and multiplication is only\n      a few more.\n    </blockquote>")))
 (idp11126912
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      Modern CISC processors such as the Intel x86 do support unaligned\n      memory accesses, but the chip still runs faster if accesses are\n      word-aligned. OCaml therefore simply mandates that all pointers be\n      word-aligned, which guarantees that the bottom few bits of any\n      valid pointer will be zero. Setting the bottom bit to a non-zero\n      value is a simple way to mark an integer, at the cost of losing\n      that single bit of precision.\n    </blockquote>")))
 (idp11126032
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      The alert reader may be wondering how OCaml can guarantee that all\n      of its pointers are word-aligned. In the old days when RISC chips\n      such as Sparc, MIPS and Alpha were commonplace, unaligned memory\n      accesses were forbidden by the instruction set architecture and\n      would result in a CPU exception that terminated the program. Thus,\n      all pointers were historically rounded off to the architecture\n      word-size (usually 32- or 64-bits).\n    </blockquote>")))
 (idp11123696
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      If the lowest bit of the <code>value</code> is zero, then\n      the value is a memory pointer. A pointer value is stored\n      unmodified, since pointers are guaranteed to be word-aligned and\n      so the bottom bits are always zero. If the pointer is inside a\n      memory chunk that is marked as being managed by the OCaml runtime,\n      it is assumed to point to an OCaml block (see below). If it points\n      outside the OCaml runtime area, it is is treated as an opaque C\n      pointer to some other system resource.\n    </blockquote>")))
 (idp11120608
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      If the lowest bit of the block word is non-zero, the value is an\n      unboxed integer. Several OCaml types map onto this integer\n      representation, including <code>bool</code>,\n      <code>int</code>, the empty list, <code>unit</code>,\n      and variants without constructors. Integers are the only unboxed\n      runtime values in OCaml, which means that they can be stored\n      directly without having to allocate a wrapper structure that will\n      take up more memory. They can also be passed directly to other\n      function calls in registers, and so are generally the cheapest and\n      fastest values to use in OCaml.\n    </blockquote>")))
 (idp11119040
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      So far, we've described the overall memory layout, but not what\n      the contents of each block contains. Every OCaml variable points\n      to a <code>value</code> at runtime, which is a single memory\n      word that is either an integer or a pointer. The OCaml runtime\n      needs to understand the difference between the two so that it can\n      follow pointers, but not integers (which directly hold the value\n      and don't point to anything meaningful).\n    </blockquote>")))
 (idp11115568
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The <code>Gc</code> module lets you control all these\n        parameters from your application. Although the defaults are\n        usually sensible, understanding them and tuning them is an\n        important concern we will discuss later in\n        <a href=\"tuning-and-profiling\" target=\"_top\">xref</a>.\n      </blockquote>")))
 (idp11114224
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        A major heap garbage collection must <span><em>stop the\n        world</em></span> (that is, halt the application) in order to\n        ensure that blocks can be safely moved around without this move\n        being observed by the live application. The mark and sweep\n        phases run incrementally over slices of memory, and are broken\n        up into a number of steps that are interspersed with the running\n        OCaml program. Only the compaction phase touches all the memory\n        in one go, and is a relatively rare operation.\n      </blockquote>")))
 (idp11112912
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n            The <span><em>compact</em></span> phase moves live blocks to\n            eliminate the gaps of free memory into a freshly allocated\n            heap, and ensures that memory does not fragment in\n            long-lived programs.\n          </blockquote>")))
 (idp11111552
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n            The <span><em>sweep</em></span> phase sequentially scans the\n            heap chunks and identifies dead blocks that weren't marked\n            earlier.\n          </blockquote>")))
 (idp11109712
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n            The <span><em>mark</em></span> phase traverses the block\n            graph and marks all live blocks by setting a bit in the tag\n            of the block header (known as the <span><em>color</em></span>\n            tag).\n          </blockquote>")))
 (idp11108352
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The major heap consists of any number of non-contiguous chunks\n        of virtual memory, each containing live blocks interspersed with\n        regions of free memory. The runtime system maintains a free list\n        data structure that indexes all the free memory, and this list\n        is used to satisfy allocation requests for OCaml blocks. The\n        major heap is cleaned via a mark and sweep garbage collection\n        algorithm.\n      </blockquote>")))
 (idp11104816
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        One complexity of generational collection is that in order to\n        know which blocks in the minor heap are live, the collector must\n        track which minor-heap blocks are directly pointed to by\n        major-heap blocks. Without this information, the minor\n        collection would require scanning the much larger major heap.\n        OCaml maintains a set of such <span><em>inter-generational\n        pointers</em></span>, and, through cooperation with the compiler,\n        introduces a write barrier to update this set whenever a\n        major-heap block is modified to point at a minor-heap block.\n        We'll talk more about the implications of the write barrier in\n        <a href=\"tuning-and-profiling\" target=\"_top\">xref</a>.\n      </blockquote>")))
 (idp11103360
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n        The minor heap is one contiguous chunk of virtual memory\n        containing a sequence of heap blocks that have been allocated.\n        If there is space, allocating a new block is a fast\n        constant-time operation in which the pointer to the end of the\n        heap is incremented by the desired size. To garbage collect the\n        minor heap, OCaml uses <span><em>copying collection</em></span>\n        to copy all live blocks in the minor heap to the major heap.\n        This only takes work proportional to the number of live blocks\n        in the minor heap, which is typically small according to the\n        generational hypothesis.\n      </blockquote>")))
 (idp11100800
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      OCaml uses different memory layouts and garbage collection\n      algorithms for the major and minor heaps to account for this\n      generational difference. We're going to describe the memory layout\n      in this chapter, and move onto the garbage collections algorithms\n      in <a href=\"inside-the-runtime\" target=\"_top\">xref</a>.\n    </blockquote>")))
 (idp11097792
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      The typical OCaml programming style typically involves allocating\n      many small blocks of memory that are used for a short period of\n      time and then never accessed again. OCaml takes advantage of this\n      fact to improve the performance of allocation and collection by\n      using a <span><em>generational</em></span> garbage collector. This\n      means that it has different memory regions to hold blocks based on\n      how long the blocks have been live. OCaml's heap is split in two;\n      there is a small, fixed-size <span><em>minor heap</em></span> where\n      most most blocks are initially allocated, and a large,\n      variable-sized <span><em>major heap</em></span> for blocks that\n      have been live longer or are larger than 4KB. A typical functional\n      programming style means that young blocks tend to die young, and\n      old blocks tend to stay around for longer than young ones (this is\n      referred to as the <span><em>generational hypothesis</em></span>).\n    </blockquote>")))
 (idp11093360
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      The garbage collector does not keep constant track of blocks as\n      they are allocated and used. Instead, it regularly scans blocks by\n      starting from a set of <span><em>roots</em></span>, which are\n      values that the application always has access to (such as the\n      stack). The GC maintains a directed graph in which heap blocks are\n      nodes, and there is an edge from heap block <code>b1</code>\n      to heap block <code>b2</code> if some field of\n      <code>b1</code> points to <code>b2</code>. All blocks\n      reachable from the roots by following edges in the graph must be\n      retained, and unreachable blocks can be reused. This strategy is\n      commonly known as &quot;mark and sweep&quot; collection.\n    </blockquote>")))
 (idp11091472
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      When there isn't enough memory available to satisfy an allocation\n      request from the allocated heap blocks, the runtime system invokes\n      the <span><em>garbage collector</em></span> (or GC). An OCaml\n      program does not explicitly free a heap block when it is done with\n      it, and the GC must determine which heap blocks are\n      &quot;live&quot; and which heap blocks are &quot;dead&quot;, i.e.\n      no longer in use. Dead blocks are collected and their memory made\n      available for re-use by the application.\n    </blockquote>")))
 (idp11087712
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      An expression such as the record above requires a new block of\n      memory with two words of available space. One word holds the\n      <code>foo</code> field and the second word holds the\n      <code>bar</code> field. The OCaml compiler translates such\n      an expression into an explicit allocation for the block from\n      OCaml's runtime system: a C library that provides a collection of\n      routines that can be called by running OCaml programs. The runtime\n      system manages a <span><em>heap</em></span>, which is a collection\n      of memory regions it obtains from the operating system using\n      <span><em>malloc(3)</em></span>. The OCaml runtime uses these\n      memory regions to hold <span><em>heap blocks</em></span>, which it\n      then fills up in response to allocation requests by the OCaml\n      program.\n    </blockquote>")))
 (idp11086304
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n      A running OCaml program uses blocks of memory (i.e. contiguous\n      sequences of words in RAM) to represent many of the values that it\n      deals with such as tuples, records, closures or arrays. An OCaml\n      program implicitly allocates a block of memory when such a value\n      is created.\n    </blockquote>")))
 (idp11083040
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n    Another reason to use the C interface directly is if you need to\n    build foreign-function interfaces directly instead of going through\n    the <code>ctypes</code> library described in\n    <a href=\"foreign-function-interface\" target=\"_top\">xref</a>. This could be\n    for performance reasons, or some more specialised embedded or kernel\n    environment. Let's start by explaining the memory layout, and then\n    move onto the details of how low-level C bindings work.\n  </blockquote>")))
 (idp11081376
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n    Since OCaml verifies these properties at compile time, it doesn't\n    need to keep track of as much information at runtime. Thus, later\n    stages of the compiler can discard and simplify the type\n    declarations to a much more minimal subset that's actually required\n    to distinguish polymorphic values at runtime. This is a major\n    performance win versus something like a Java or .NET method call,\n    where the runtime must look up the concrete instance of the object\n    and dispatch the method call. Those languages amortize some of the\n    cost via &quot;Just-in-Time&quot; dynamic patching, but OCaml\n    prefers runtime simplicity instead.\n  </blockquote>")))
 (idp11078032
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n    The OCaml compiler runs through several phases during the\n    compilation process. The first phase is syntax checking, during\n    which source files are parsed into Abstract Syntax Trees (ASTs). The\n    next stage is a <span><em>type checking</em></span> pass over the\n    AST. In a validly typed program, a function cannot be applied with\n    an unexpected type. For example, the\n    <code>print_endline</code> function must receive a single\n    <code>string</code> argument, and an <code>int</code>\n    will result in a type error.\n  </blockquote>")))
 (idp11076192
  ((file memory-representation-of-values.html)
   (html
    "<blockquote>\n    Much of the static type information contained within an OCaml\n    program is checked and discarded at compilation time, leaving a much\n    simpler <span><em>runtime</em></span> representation for values.\n    Understanding this difference is important for writing efficient\n    programs and profiling them at runtime.\n  </blockquote>")))
 (idp9633104
  ((file maps-and-hashtables.html)
   (html
    "<blockquote>This chapter is under construction and not yet ready for public review, and so omitted from this milestone. This chaper is present as a placeholder so that cross-references from other chapters resolve correctly in the print version.</blockquote>")))
 (idp7693648
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      As a side note, the above implementation of\n      <code>count_some</code> is longer than necessary, and to\n      boot is not tail recursive. For real work, you should probably\n      just use the<code>List.count</code> function from\n      <code>Core</code> as follows:\n    </blockquote>")))
 (idp7692448
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The takeaway from all of this is that, while\n      <code>when</code> clauses can be useful, one should prefer\n      patterns wherever they are sufficient.\n    </blockquote>")))
 (idp7690720
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      This is a little less clear, however, than the direct pattern\n      matching solution, where the meaning of each pattern is clearer on\n      its own.\n    </blockquote>")))
 (idp7688448
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Probably a better approach is to simply drop the second\n      <code>when</code> clause.\n    </blockquote>")))
 (idp7686064
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      If we add another redundant case without a <code>when</code>\n      clause, the compiler will stop complaining about exhaustiveness,\n      and won't produce a warning about the redundancy.\n    </blockquote>")))
 (idp7684736
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Despite the warning, the function does work fine.\n    </blockquote>")))
 (idp7680944
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Consider the following function which takes a list of optional\n      values, and returns the number of those values that are\n      <code>Some</code>. Because this implementation uses\n      <code>when</code> clauses, the compiler can't tell that the\n      code is exhaustive.\n    </blockquote>")))
 (idp7679488
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Note that <code>when</code> clauses have some downsides. As\n      we noted earlier, the static checks associated with pattern\n      matches rely on the fact that patterns are restricted in what they\n      can express. Once we add the ability to add an arbitrary condition\n      to a pattern, something will be lost. In particular, the ability\n      for the compiler to determine if a match is exhaustive, or if some\n      case is redundant, is compromised.\n    </blockquote>")))
 (idp7676384
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We can make the code slightly terser now by using a\n      <code>when</code> clause. A <code>when</code> clause\n      allows one to add an extra precondition on a pattern in the form\n      of an arbitrary OCaml expression. In this case, we can use it to\n      include the check on whether the first two elements are equal.\n    </blockquote>")))
 (idp7673248
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We can further collapse this by combining the first two cases into\n      one, using an or-pattern. At the same time, we'll use the more\n      concise <code>[_]</code> pattern to match a list with a\n      single element, rather than <code>_ :: []</code>.\n    </blockquote>")))
 (idp7668528
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      First, let's consider efficiency. One problem with the\n      <code>destutter</code> code above is that it in some cases\n      recreates on the right-hand side of the arrow a value that already\n      existed on the left hand side. Thus, the pattern\n      <code>hd :: [] -&gt; hd :: []</code> actually allocates a\n      new list element, which really, it should be able to just return\n      the list being matched. We can reduce allocation here by using an\n      <code>as</code> pattern, which allows us to declare a name\n      for the thing matched by a pattern or sub-pattern. While we're at\n      it, we'll use the <code>function</code> keyword to eliminate\n      the need for an explicit match.\n    </blockquote>")))
 (idp7668032
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We'll consider some ways of making this code more concise and more\n      efficient.\n    </blockquote>")))
 (idp7665408
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Now that we know more about how lists and patterns work, let's\n      consider how we can improve on an example from\n      (xref)(#recursive-list-functions): the function\n      <code>destutter</code>, which removes sequential duplicates\n      from a list. Here's the implementation that was described earlier.\n    </blockquote>")))
 (idp7663552
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Tail recursion are important for more than just lists. Ordinary\n      (non-tail) recursive calls are reasonable when the dealing with\n      data-structures like binary trees where the depth of the tree is\n      logarithmic in the size of your data. But when dealing with\n      situations where the depth of the sequence of nested calls is on\n      the order of the size of your data, tail recursion is usually the\n      right approach.\n    </blockquote>")))
 (idp7661792
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      So when is a call a tail call? Let's think about the situation of\n      one function (the <span><em>caller</em></span>) invokes another\n      (the <span><em>callee</em></span>). The invocation is considered a\n      tail call when the caller doesn't do anything with the value\n      returned by the callee except to return it. The tail-call\n      optimization makes sense because, when a caller makes a tail call,\n      the caller's stack frame need never be used again, and so you\n      don't need to keep it around. Thus, instead of allocating a new\n      stack frame for the callee, the compiler is free to resuse the\n      caller's stack frame.\n    </blockquote>")))
 (idp7657104
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The advantage of this approach is that the recursive call in\n      <code>length_plus_n</code> is a <span><em>tail\n      call</em></span>. We'll explain more precisely what it means to be\n      a tail call shortly, but the reason it's important is that tail\n      calls don't require the allocation of a new stack frame, due to\n      what is called the <span><em>tail-call optimization</em></span>. A\n      recursive function is said to be <span><em>tail\n      recursive</em></span> if all of its recursive calls are tail calls.\n      <code>length_plus_n</code> is indeed tail recursive, and as\n      a result, <code>length</code> can take a long list as input\n      without blowing the stack.\n    </blockquote>")))
 (idp7653792
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      This implementation depends on a helper function,\n      <code>length_plus_n</code>, that computes the length of a\n      given list plus a given <code>n</code>. In practice,\n      <code>n</code> acts as an accumulator in which the answer is\n      built up, step by step. As a result, we can do the additions along\n      the way rather than doing them as we unwind the nested sequence of\n      function calls, as we did in our first implemenation of\n      <code>length</code>.\n    </blockquote>")))
 (idp7651328
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      And that's the problem with our call to <code>length</code>:\n      it tried to allocate ten million stack frames, which exhausted the\n      available stack space. Happily, there's a way around this problem.\n      Consider the following alternative implementation.\n    </blockquote>")))
 (idp7649936
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      To understand what went wrong, you need to learn a bit more about\n      how function calls work. Typically, a function call needs some\n      space to keep track of information associated with the call, such\n      as the arguments passed to the function, or the location of the\n      code that needs to start executing when the function call is\n      complete. To allow for nested function calls, this information is\n      typically organized in a stack, where a new <span><em>stack\n      frame</em></span> is allocated for each nested function call, and\n      then deallocated when the function call is complete.\n    </blockquote>")))
 (idp7643536
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      This looks simple enough, but you'll discover that this\n      implementation runs into problems on very large lists. Here are\n      some examples, using another useful function from the\n      <code>List</code> module, <code>List.init</code>, to\n      create the lists. <code>List.init</code> takes an integer\n      <code>n</code> and a function <code>f</code> and\n      creates a list of length <code>n</code> where the data for\n      each element is created by calling <code>f</code> on the\n      index of that element.\n    </blockquote>")))
 (idp7641728
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The only way to compute the length of an OCaml list is to walk the\n      list from beginning to end. As a result, computing the length of a\n      list takes time linear in the size of the list. Here's a simple\n      function for doing so.\n    </blockquote>")))
 (idp7637136
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        The above combination of <code>List.map</code> and\n        <code>List.concat</code> is common enough that there is a\n        function <code>List.concat_map</code> that combines these\n        into one, more efficient operation.\n      </blockquote>")))
 (idp7633312
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n<code>ocaml # List.concat [[1;2];[3;4;5];[6];[]];; - : int list = [1; 2; 3; 4; 5; 6]</code>\n        Here's an example of using <code>List.concat</code> along\n        with <code>List.map</code> to compute a recursive listing\n        of a directory tree.\n      </blockquote>")))
 (idp7631056
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n<code>@</code> is just a synonym for\n        <code>List.append</code>. In addition, there is\n        <code>List.concat</code>, for concatenating a list of\n        lists.\n      </blockquote>")))
 (idp7628848
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Another very common operation on lists is concatenation. The\n        list module actually comes with a few different ways of doing\n        this. First, there's<code>List.append</code>, for\n        concatenating a pair of lists.\n      </blockquote>")))
 (idp7627760
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Note the use of a nested or-pattern in\n        <code>is_ocaml_source</code>.\n      </blockquote>")))
 (idp7622480
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Another function that is similar to <code>filter</code> is\n        <code>partition_tf</code>, which takes a list and\n        partitions it into a pair of lists based on a boolean condition.\n        <code>tf</code> is a mnemonic to remind the reader that\n        <code>true</code> elements go to the first bucket and\n        <code>false</code> ones go to the second. Thus, one could\n        write:\n      </blockquote>")))
 (idp7620736
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Another feature of OCaml's pattern language that we encounter\n        here is <span><em>or-patterns</em></span>, which allow you to\n        have multiple sub-patterns within a larger pattern. In this\n        case, <code>None | Some (&quot;&quot;,_)</code> is an\n        or-pattern. As we'll see later, or-patterns can be nested\n        anywhere within larger patterns.\n      </blockquote>")))
 (idp7620000
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        In the match statement above, you may notice that we for the\n        first time used an underscore in a pattern match. You use an\n        underscore when you want to indicate that the pattern doesn't\n        depend on some sub-component of the data structure, but that you\n        don't want to name it is an explicit variable.\n      </blockquote>")))
 (idp7614800
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Sometimes, you want to both transform and filter as part of the\n        same computation. <code>List.filter_map</code> allows you\n        to do just that. The following expression uses\n        <code>List.filter_map</code> to produce the list of file\n        extensions in the current directory, piping the results through\n        <code>List.dedup</code> to remove duplicates. Note that\n        this example also uses some functions from other modules,\n        including <code>Sys.ls_dir</code> to get a directory\n        listing, and <code>String.rsplit2</code> to split a string\n        on the rightmost appearance ofa given character.\n      </blockquote>")))
 (idp7612560
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Very often when processing lists, one wants to restrict\n        attention to just a subset of values. The\n        <code>List.filter</code> function does just that.\n      </blockquote>")))
 (idp7611280
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        The example we worked through above only touched on three of the\n        function in <code>List</code>. We won't cover the entire\n        interface, but there are a few more functions that are useful\n        enough to mention here.\n      </blockquote>")))
 (idp7608416
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Now we can bring this all together in a single function that\n      renders the table.\n    </blockquote>")))
 (idp7605952
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We can render a row of data by merging together the padded\n      strings. Again, we'll use <code>List.map2_exn</code> for\n      combining the list of data in the row with the list of widths.\n    </blockquote>")))
 (idp7603568
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Now we need code for rendering a row with data in it. We'll first\n      write a function <code>pad</code> for padding out a string\n      to a specified length plus one blank space on either side.\n    </blockquote>")))
 (idp7602816
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      allocates one string of size 7, as well as a list of length 7. At\n      these small sizes, the differences don't amount to much, but for\n      assembling of large strings, it can be a serious performance\n      issue.\n    </blockquote>")))
 (idp7601328
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      will allocate a string of length 2, 3, 4, 5, 6 and 7, whereas this\n      code:\n    </blockquote>")))
 (idp7597840
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      In the above, we're using two different ways of concatenating\n      strings, <code>String.concat</code>, which operates on lists\n      of strings, and <code>^</code>, which is a pairwise\n      operator. You should avoid <code>^</code> for joining long\n      numbers of strings, since, it allocates a new string every time it\n      runs. Thus, the following code:\n    </blockquote>")))
 (idp7595408
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Note that we make the line of dashes two larger than the provided\n      width to provide some whitespace around each entry in the table.\n    </blockquote>")))
 (idp7591232
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Now that we know how to compute column widths, we can write the\n      code to generate the line that separates the header from the rest\n      of the text table. We'll do this in part by mapping\n      <code>String.make</code> over the lengths of the columns to\n      generate a string of dashes of the appropriate length. We'll then\n      join these sequences of dashes together using\n      <code>String.concat</code>, which concatenates a list of\n      strings with an optional separator string, and\n      <code>^</code>, which is a pairwise string concatenation\n      function, to add the delimiters on the outside.\n    </blockquote>")))
 (idp7588080
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Using <code>List.map</code> we define the function\n      <code>lengths</code> which converts a list of strings to a\n      list of integer lengths. <code>List.fold</code> is then used\n      to iterate over the rows, using <code>map2_exn</code> to\n      take the max of the accumulator with the lengths of the strings in\n      each row of the table, with the accumulator initialized to the\n      lengths of the header row.\n    </blockquote>")))
 (idp7586400
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Let's bring our three functions together to compute the maximum\n      column widths.\n    </blockquote>")))
 (idp7583312
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      This example is particularly simple because the accumulator and\n      the list elements are of the same type. But\n      <code>fold</code> is not limited to such cases. We can for\n      example use <code>fold</code> to reverse a list, in which\n      case the accumulator is itself a list.\n    </blockquote>")))
 (idp7581360
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We can use <code>List.fold</code> for something as simple as\n      summing up a list:\n    </blockquote>")))
 (idp7577632
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n<code>List.fold</code> is the most complicated of the three,\n      takin three arguments: a list to process, an initial accumulator\n      value, and a function for updating the accumulator with the\n      information from a list element. <code>List.fold</code>\n      walks over the list from left to right, updating the accumulator\n      at each step and returning the final value of the accumulator when\n      it's done. You can see some of this by looking at the\n      type-signature for <code>fold</code>.\n    </blockquote>")))
 (idp7575472
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The <code>_exn</code> is there because the function throws\n      an exception if the lists are of mismatched length.\n    </blockquote>")))
 (idp7572784
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n<code>List.map2_exn</code> is similar to\n      <code>List.map</code>, except that it takes two lists and a\n      function for combining them. Thus, we might write:\n    </blockquote>")))
 (idp7570512
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n<code>List.map</code> is the simplest to explain. It takes a\n      list and a function for transforming elements of that list, and\n      returns a new list with the transformed elements. Thus, we can\n      write:\n    </blockquote>")))
 (idp7567184
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The first step is to write a function to compute the maximum width\n      of each column of data. We can do this by converting the header\n      and each row into a list of integer lengths, and then taking the\n      element-wise max of those lists of lengths. Writing the code for\n      all of this directly would be a bit of a chore, but we can do it\n      quite concisely by making use of three functions from the\n      <code>List</code> module: <code>map</code>,\n      <code>map2_exn</code>, and <code>fold</code>.\n    </blockquote>")))
 (idp7565888
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      it would generate the following output.\n    </blockquote>")))
 (idp7563328
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Let's work through a concrete example to see this in action. We'll\n      write a function <code>render_table</code> that, given a\n      list of column headers and a list of rows, prints them out in a\n      well formatted text table. So, if you were to write:\n    </blockquote>")))
 (idp7561984
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We've so far written a fair amount of list-munging code using\n      pattern matching and recursive functions. But in real life, you're\n      usually better off using the <code>List</code> module, which\n      is full of reusable functions that abstract out common patterns\n      for computing with lists.\n    </blockquote>")))
 (idp7558848
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        For simple examples like this, exhaustiveness checks are useful\n        enough. But as we'll see in\n        <a href=\"variants.html\">Chapter\194\1606, <i>Variants</i></a>, as you get to more\n        complicated examples, especially those involving user-defined\n        types, exhaustiveness checks become a lot more valuable. In\n        addition to catching outright errors, they act as a sort of\n        refactoring tool, guiding you to the locations where you need to\n        adapt your code to deal with changing types.\n      </blockquote>")))
 (idp7557312
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        The compiler will produce a warning that we've missed a case,\n        along with an example of an unmatched pattern.\n      </blockquote>")))
 (idp7555104
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        OCaml also checks match statements for exhaustiveness. Consider\n        what happens if we modify <code>drop_zero</code> by\n        deleting the handler for one of the cases.\n      </blockquote>")))
 (idp7553536
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        The error-detecting capabilities of match statements are if\n        anything more important than their performance. We've already\n        seen one example of OCaml's ability to find problems in a\n        pattern match: in our broken implementation of\n        <code>drop_value</code>, OCaml warned us that the final\n        case was redundant. There are no algorithms for determining if a\n        predicate written in a general-purpose language is redundant,\n        but it can be solved reliably in the context of patterns.\n      </blockquote>")))
 (idp7551824
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Generally, pattern matching is typically more efficient than the\n        alternatives you might code by hand. One notable exception is\n        matches over strings, which are in fact tested sequentially. But\n        most of the time, using pattern matching is a clear performance\n        win.\n      </blockquote>")))
 (idp7551008
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        In this case, the match-based implementation is 70% faster than\n        the one using if. The difference comes because we need to\n        effectively do the same work multiple times, since each function\n        we call has to re-examine the first element of the list to\n        determine whether or not it's the empty cell. With a match\n        statement, this work happens exactly once per list element.\n      </blockquote>")))
 (idp7545728
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Here's another less artificial example. We can rewrite the\n        <code>sum</code> function we described earlier in the\n        chapter using an <code>if</code> statement rather than a\n        match. We can then use the functions\n        <code>is_empty</code>, <code>hd_exn</code> and\n        <code>tl_exn</code> from the <code>List</code>\n        module to deconstruct the list, allowing us to implement the\n        entire function without pattern matching.\n      </blockquote>")))
 (idp7543920
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        If you benchmark these, you'll see that\n        <code>plus_one_slow</code> is about 35% slower than\n        <code>plus_one</code>, and the advantage gets larger as\n        the number of cases increases.\n      </blockquote>")))
 (idp7542016
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        As an example, consider the following rather silly functions for\n        incrementing an integer by one. The first is implemented with a\n        match statement, and the second with a sequence of if\n        statements.\n      </blockquote>")))
 (idp7540576
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n        Naively, you might think that it would be necessary to check\n        each case in a <code>match</code> in sequence to figure\n        out which one fires. If the cases of a match were guarded by\n        arbitrary code, that would be the case. But OCaml is often able\n        to generate machine code that jumps directly to the matched case\n        based on an efficiently chosen set of run-time checks.\n      </blockquote>")))
 (idp7538800
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      You can think of patterns as a specialized sub-language that can\n      express a limited (though still quite rich) set of conditions. The\n      fact that the pattern language is limited turns out to be a very\n      good thing, making it possible to build better support for\n      patterns in the compiler. In particular, both the efficiency of\n      match statements and the ability of the compiler to detect errors\n      in matches depend on the constrained nature of patterns.\n    </blockquote>")))
 (idp7537248
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The above example highlights an important fact about patterns,\n      which is that they can't be used to express arbitrary conditions.\n      Patterns can characterize the layout of a data-structure, and can\n      even include literals as in the <code>drop_zero</code>\n      example, but that's where they stop. A pattern can check if a list\n      has two elements, but it can't check if the first two elements are\n      equal to each other.\n    </blockquote>")))
 (idp7533824
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      Note that if we wanted to drop a particular literal value (rather\n      than a value that was passed in), we could do this using something\n      like our original implementation of <code>drop_value</code>.\n    </blockquote>")))
 (idp7531184
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      A better way to write this code is not to use pattern matching for\n      determining whether the first element is equal to\n      <code>to_drop</code>, but to instead use an ordinary\n      if-statement.\n    </blockquote>")))
 (idp7527216
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The key observation is that the appearance of\n      <code>to_drop</code> in the second case doesn't imply a\n      check that the first element is equal to the value\n      <code>to_drop</code> passed in as an argument to\n      <code>drop_value</code>. Instead, it just causes a new\n      variable <code>to_drop</code> to be bound to whatever\n      happens to be in the first element of the list, shadowing the\n      earlier definition of <code>to_drop</code>. The third case\n      is unused because it is essentially the same pattern as we had in\n      the second case.\n    </blockquote>")))
 (idp7526832
  ((file lists-and-patterns.html)
   (html "<blockquote>\n      So, what's going on?\n    </blockquote>")))
 (idp7525152
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      But when we type this in, the compiler will immediately warn us\n      that something is wrong. Moreover, the function clearly does the\n      wrong thing, filtering out all elements of the list rather than\n      just those equal to the provided value.\n    </blockquote>")))
 (idp7523232
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The fact that match statements can be used to bind new variables\n      can be a source of confusion. To see how, imagine we wanted to\n      write a function that filtered out from a list all elements equal\n      to a particular value. You might be tempted to write that code as\n      follows.\n    </blockquote>")))
 (idp7520448
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The match statement in <code>sum</code> is really doing two\n      things: first, it's acting as a case-analysis tool, breaking down\n      the possibilities into a pattern-indexed list of cases. Second, it\n      lets you name sub-structures within the data-structure being\n      matched. In this case, the variables <code>hd</code> and\n      <code>tl</code> are bound by the pattern that defines the\n      first case of the match statment. Variables that are bound in this\n      way can be used in the expression to the right of the arrow for\n      the pattern in question.\n    </blockquote>")))
 (idp7518736
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      This code follows the convention of using <code>hd</code> to\n      represent the first element (or head) of the list, and\n      <code>tl</code> to represent the remainder (or tail).\n    </blockquote>")))
 (idp7517008
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      We can read data out of a list using a match statement. Here's a\n      simple example of a recursive function that computes the sum of\n      all elements of a list.\n    </blockquote>")))
 (idp7512928
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The <code>::</code> operator essentially adds a new block to\n      the picture above. Such a block contains two things: a reference\n      to the data in that list element, and a reference to the remainder\n      of the list. This is why <code>::</code> can extend a list\n      without modifying it; extension allocates a new list element but\n      doesn't need to change any of the existing ones, as you can see:\n    </blockquote>")))
 (idp7509440
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      The <code>::</code> operator conveys something important\n      about the nature of lists, which is that they are implemented as\n      singly-linked lists. The following is a rough graphical\n      representation of how the list\n      <code>1 :: 2 :: 3 :: []</code> is laid out as a\n      data-structure. The final arrow (from the box containing\n      <code>3</code>) points to the empty list.\n    </blockquote>")))
 (idp7507680
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      As you can see, the <code>::</code> operator is\n      right-associative, which means that we can built up lists without\n      parenthesis. The empty list <code>[]</code> is used to\n      terminate a list.\n    </blockquote>")))
 (idp7505616
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      And they can also be generated using the equivalent\n      <code>::</code> notation.\n    </blockquote>")))
 (idp7504160
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n      An OCaml list is an immutable, finite sequence of elements of the\n      same type. As we've seen, OCaml lists can be generated using a\n      bracket-and-semicolon notation:\n    </blockquote>")))
 (idp7502096
  ((file lists-and-patterns.html)
   (html
    "<blockquote>\n    This chapter will focus on two common elements of programming in\n    OCaml: lists and pattern matching. Both of these were discussed in\n    <a href=\"a-guided-tour.html\">Chapter\194\1601, <i>A Guided Tour</i></a>, but we'll go into more\n    depth here, presenting the two topics together and using one to help\n    illustrate the other.\n  </blockquote>")))
 (idp11760848
  ((file installation.html)
   (html
    "<blockquote>\n          ODT is distributed as a set of plugins for the Eclipse IDE\n          environment from the\n          <a href=\"http://ocamldt.free.fr\" target=\"_top\">homepage</a>. You just\n          have to copy these plugins into your Eclipse distribution in\n          order to access the new OCaml facilities.\n        </blockquote>")))
 (idp11760176
  ((file installation.html)
   (html
    "<blockquote>\n          Eclipse is a popular IDE usually used for Java development.\n          The OCaml Development Tools (ODT) project provides equivalent\n          IDE features for editing and compiling OCaml code, such as\n          automatic compilation and name completion.\n        </blockquote>")))
 (idp11757824
  ((file installation.html)
   (html
    "<blockquote>\n          TODO: Vim users can use the built-in style, and\n          <a href=\"http://github.com/avsm/ocaml-annot\" target=\"_top\">ocaml-annot</a>\n          may also be useful.\n        </blockquote>")))
 (idp11754608
  ((file installation.html)
   (html
    "<blockquote>\n          Once this successfully loads in Emacs, you can run utop by\n          executing the command <code>utop</code> in Emacs. There\n          are more details instructions at the\n          <a href=\"https://github.com/diml/utop#integration-with-emacs\" target=\"_top\">utop\n          homepage</a>.\n        </blockquote>")))
 (idp11749664
  ((file installation.html)
   (html
    "<blockquote>\n          You also need to make the <code>utop.el</code> file\n          available to your Emacs installation. The OPAM version of\n          <code>utop</code> installs it into the\n          <code>~/.opam</code> hierarchy, for example in\n          <code>~/.opam/system/share/emacs/site-lisp/utop.el</code>.\n          You may need to replace <code>system</code> with your\n          current compiler switch, such as\n          <code>4.01.0dev+trunk</code>.\n        </blockquote>")))
 (idp11746704
  ((file installation.html)
   (html
    "<blockquote>\n          To use <code>utop</code> directly in Emacs, add the\n          following line to your <code>~/.emacs</code> file:\n        </blockquote>")))
 (idp11745536
  ((file installation.html)
   (html
    "<blockquote>\n          TODO: Emacs users have tuareg and\n          <a href=\"http://www.typerex.org/\" target=\"_top\">Typerex</a>.\n        </blockquote>")))
 (idp11742048
  ((file installation.html)
   (html
    "<blockquote>\n        When you run <code>utop</code> with this initialization\n        file, it should start up with Core opened and ready to use.\n      </blockquote>")))
 (idp11738128
  ((file installation.html)
   (html
    "<blockquote>\n        The <code>~/.ocamlinit</code> file in your home directory\n        initialises <code>utop</code> with common libraries and\n        syntax extensions so you don't need to type them in every time.\n        Now that you have Core installed, you should update it to load\n        it every time you start <code>utop</code>, by adding this\n        to it:\n      </blockquote>")))
 (idp11735136
  ((file installation.html)
   (html
    "<blockquote>\n        The <code>utop</code> tool provides a convenient\n        interactive toplevel, with full command history, command macros\n        and module name completion. When you first run\n        <code>utop</code>, you'll find yourself at an interactive\n        prompt with a bar at the bottom of the screen. The bottom bar\n        dynamically updates as you write text, and contains the possible\n        names of modules or variables that are valid at that point in\n        the phrase you are entering. You can press the\n        <code>&lt;tab&gt;</code> key to complete the phrase with\n        the first choice.\n      </blockquote>")))
 (idp11730064
  ((file installation.html)
   (html
    "<blockquote>\n        Remember from earlier that OPAM never installs files directly\n        into your system directories, and this applies to\n        <code>utop</code> too. You'll find the binary in\n        <code>~/.opam/4.01.0dev+trunk/bin</code>. However, just\n        typing in <code>utop</code> from your shell should just\n        work, due to the <code>opam config env</code> step that\n        configures your shell. Don't forget to automate this as\n        described earlier, as it makes life much easier when developing\n        OCaml code!\n      </blockquote>")))
 (idp11728720
  ((file installation.html)
   (html
    "<blockquote>\n        The <code>utop</code> package is an interactive\n        command-line interface to OCaml that has tab-completion,\n        persistent history and integration with Emacs so that you can\n        run it within your editing environment.\n      </blockquote>")))
 (idp11726624
  ((file installation.html)
   (html
    "<blockquote>\n        There's one last tool you need before getting started on the\n        examples. The default <code>ocaml</code> command gives us\n        an interactive command-line to experiment with code without\n        compiling it. However, it's quite a spartan experience and so we\n        use a more modern alternative.\n      </blockquote>")))
 (idp11723968
  ((file installation.html)
   (html
    "<blockquote>\n<code>async</code> is the network programming library\n          that we use in Part II to communicate with other hosts. You\n          can skip this for the initial installation until you get to\n          Part II, if you prefer.\n        </blockquote>")))
 (idp11722288
  ((file installation.html)
   (html
    "<blockquote>\n<code>core_extended</code> contains a number of\n          experimental, but useful, extension libraries that are under\n          review for inclusion in Core. We use some of these in places,\n          but much less than Core itself.\n        </blockquote>")))
 (idp11720736
  ((file installation.html)
   (html
    "<blockquote>\n<code>core</code> is the main, well-supported Core\n          distribution from Jane Street.\n        </blockquote>")))
 (idp11719600
  ((file installation.html)
   (html
    "<blockquote>\n      This will take about five or ten minutes to build, and will\n      install a series of packages. OPAM figures out the dependencies\n      you need automatically, but the three packages that really matter\n      are:\n    </blockquote>")))
 (idp11718400
  ((file installation.html)
   (html
    "<blockquote>\n      Finally, we're ready to install the Core libraries. Run this:\n    </blockquote>")))
 (idp11716256
  ((file installation.html)
   (html
    "<blockquote>\n      The new compiler will be installed into\n      <code>~/.opam/4.01.0dev+trunk</code> and any libraries you\n      install for it will be tracked separately from your system\n      installation. You can have any number of compilers installed\n      simultaneously, but only one can be active at any time. Browse\n      through the available compilers by running\n      <code>opam switch list</code>.\n    </blockquote>")))
 (idp11714560
  ((file installation.html)
   (html
    "<blockquote>\n      This step will take about 5-10 minutes on a modern machine, and\n      will download and install (within the <code>~/.opam</code>\n      directory) a custom OCaml compiler. OPAM supports multiple such\n      installations, and you'll find this very useful if you ever decide\n      to hack on the internals of the compiler itself, or you want to\n      experiment with the latest release without sacrificing your\n      current installation. You only need to install this compiler once,\n      and future updates will be much faster as they only recompile\n      libraries within the compiler installation.\n    </blockquote>")))
 (idp11712288
  ((file installation.html)
   (html
    "<blockquote>\n      The most important package we need to install is Core, which is\n      the replacement standard library that all of the examples in this\n      book use. Before doing this, let's make sure you have exactly the\n      right compiler version you need. We've made some minor\n      modifications to the way the OCaml compiler displays type\n      signatures, and the next command will install a patched\n      <code>4.01.0</code> compiler with this functionality\n      enabled.\n    </blockquote>")))
 (idp11707968
  ((file installation.html)
   (html
    "<blockquote>\n      OPAM 1.0.0 places the login commands into your\n      <code>~/.profile</code> directory, which isn't always\n      executed if your shell is <code>bash</code>. This has been\n      fixed in subsequent versions, but for now you'll need to manually\n      copy the contents of <code>~/.profile</code> over to\n      <code>~/.bash_profile</code> via:\n    </blockquote>")))
 (idp11704624
  ((file installation.html)
   (html
    "<blockquote>\n      If you answered <code>yes</code> to the auto-complete\n      scripts question during <code>opam init</code>, this should\n      have all been set up for you. You can verify this worked by\n      listing the available packages:\n    </blockquote>")))
 (idp11700752
  ((file installation.html)
   (html
    "<blockquote>\n      This evaluates the results of running\n      <code>opam config env</code> in your current shell, and sets\n      the variables so that subsequent commands will use them. This only\n      works with your current shell, and it can be automated for all\n      future shells by adding the line to your login scripts. On Mac OS\n      X or Debian, this is usually the\n      <code>~/.bash_profile</code> file if you're using the\n      default shell. If you've switched to another shell, it might be\n      <code>~/.zshrc</code> instead. OPAM isn't unusual in this\n      approach; the SSH <code>ssh-agent</code> also works\n      similarly, so if you're having any problems just hunt around in\n      your configuration scripts to see how that's being invoked.\n    </blockquote>")))
 (idp11697776
  ((file installation.html)
   (html
    "<blockquote>\n      When the <code>init</code> command finishes, you'll see some\n      instructions about environment variables. OPAM never installs\n      files into your system directories (which would require\n      administrator privileges). Instead, it puts them into your home\n      directory by default, and can output a set of shell commands which\n      configures your shell with the right <code>PATH</code>\n      variables so that packages will just work. This requires just one\n      command:\n    </blockquote>")))
 (idp11696496
  ((file installation.html)
   (html
    "<blockquote>\n      You only need to run this command once, and it will create the\n      <code>~/.opam</code> directory and sync with the latest\n      package list from the online OPAM database.\n    </blockquote>")))
 (idp11694048
  ((file installation.html)
   (html
    "<blockquote>\n      Let's begin by initialising the OPAM package database. This will\n      require an active Internet connection, and ask you a few\n      interactive questions at the end. It's safe to answer yes to these\n      unless you want to manually control the configuration steps\n      yourself as an advanced user.\n    </blockquote>")))
 (idp11690352
  ((file installation.html)
   (html
    "<blockquote>\n      The entire OPAM package database is held in the\n      <code>.opam</code> directory in your home directory,\n      including compiler installations. On Linux and Mac OS X, this will\n      be the <code>~/.opam</code> directory. You shouldn't switch\n      to an admin user to install packages as nothing will be installed\n      outside of this directory. If you run into problems, just delete\n      the whole <code>~/.opam</code> directory and follow the\n      installations instructions from the <code>opam init</code>\n      stage again.\n    </blockquote>")))
 (idp11688144
  ((file installation.html)
   (html
    "<blockquote>\n        The OPAM instructions will be simplified when integrated\n        upstream into Debian and Fedora, which is ongoing. Until then,\n        we're leaving source-code installation instructions here. Please\n        leave a comment with any amended instructions you encounter.\n      </blockquote>")))
 (idp11685088
  ((file installation.html)
   (html
    "<blockquote>\n        If the binary packages aren't available for your system, you'll\n        need to install the latest OPAM release from source. The\n        distribution only requires the OCaml compiler to be installed,\n        so this should be straightforward. Download the latest version\n        from the\n        <a href=\"https://github.com/OCamlPro/opam/tags\" target=\"_top\">homepage</a>.\n      </blockquote>")))
 (idp11682480
  ((file installation.html)
   (html
    "<blockquote>\n        Run these commands to install the stable OPAM package:\n      </blockquote>")))
 (idp11680960
  ((file installation.html)
   (html
    "<blockquote>\n<code>opam-git</code> builds the package from the\n            latest upstream source, and should only be used if you are\n            looking for a specific bleeding-edge feature.\n          </blockquote>")))
 (idp11679392
  ((file installation.html)
   (html
    "<blockquote>\n<code>opam</code> contains the most recent stable\n            release, and is the recommended package.\n          </blockquote>")))
 (idp11676928
  ((file installation.html)
   (html
    "<blockquote>\n        OPAM is available in the Arch User Repository (AUR) in two\n        packages. You'll need both <code>ocaml</code> and the\n        <code>base-devel</code> packages installed first:\n      </blockquote>")))
 (idp11675088
  ((file installation.html)
   (html
    "<blockquote>\n        There is currently no RPM available for Fedora or Red Hat, so\n        please install OPAM via the source code instructions for the\n        moment.\n      </blockquote>")))
 (idp11672544
  ((file installation.html)
   (html
    "<blockquote>\n        When this is done, update your packages and install OPAM. You\n        can ignore the warning about unsigned packages, which will\n        disappear when OPAM is upstreamed into Debian mainline.\n      </blockquote>")))
 (idp11670448
  ((file installation.html)
   (html
    "<blockquote>\n        There are experimental binary packages available for Debian\n        Wheezy/amd64. You should be able to use these on 64-bit Ubuntu\n        and other derivative distributions such as Linux Mint also. Just\n        add the following line to your\n        <code>/etc/apt/sources.list</code>:\n      </blockquote>")))
 (idp11668064
  ((file installation.html)
   (html
    "<blockquote>\n        And on MacPorts, install it like this:\n      </blockquote>")))
 (idp11666816
  ((file installation.html)
   (html
    "<blockquote>\n        Source installation of OPAM will take a minute or so on a modern\n        machine. There is a Homebrew package for the latest OPAM:\n      </blockquote>")))
 (idp11663472
  ((file installation.html)
   (html
    "<blockquote>\n      Before installing OPAM, make sure that you have the OCaml compiler\n      installed as described above. Once installed, the entire OPAM\n      database is held in your home directory (normally\n      <code>$HOME/.opam</code>). If something goes wrong, just\n      delete this <code>.opam</code> directory and start over from\n      a clean slate. If youre using a beta version of OPAM, please\n      upgrade it to at least version 1.0.0 or greater before proceeding.\n    </blockquote>")))
 (idp11662752
  ((file installation.html)
   (html
    "<blockquote>\n      OPAM manages multiple simultaneous OCaml compiler and library\n      installations, tracks library versions across upgrades, and\n      recompiles dependencies automatically if they get out of date.\n      It's used throughout Real World OCaml as the mechanism to retrieve\n      and use third-party libraries.\n    </blockquote>")))
 (idp11660192
  ((file installation.html)
   (html
    "<blockquote>\n        We instruct you install the unreleased trunk version of OCaml in\n        these instructions, as we take advantage of some recent\n        additions to the language that simplify explanations in the\n        book. The 4.01 release will happen before the book is released,\n        but you may run into &quot;bleeding edge&quot; bugs with the\n        trunk release. Leave a comment here if you do and we'll address\n        them.\n      </blockquote>")))
 (idp11656688
  ((file installation.html)
   (html
    "<blockquote>\n        Once the installation is completed into this custom location,\n        you will need to add <code>$HOME/my-ocaml/bin</code> to\n        your <code>PATH</code>, normally by editing the\n        <code>~/.bash_profile</code> file. You shouldn't really to\n        do this unless you have special reasons, so try to install\n        binary packages before trying a source installation.\n      </blockquote>")))
 (idp11654656
  ((file installation.html)
   (html
    "<blockquote>\n        The final step requires administrator privilege to install in\n        your system directory. You can also install it in your home\n        directory by passing the <code>prefix</code> option to the\n        configuration script:\n      </blockquote>")))
 (idp11651840
  ((file installation.html)
   (html
    "<blockquote>\n        To install OCaml from source code, first make sure that you have\n        a C compilation environment (usually either\n        <code>gcc</code> or <code>llvm</code> installed).\n      </blockquote>")))
 (idp11649920
  ((file installation.html)
   (html
    "<blockquote>\n        Windows is not currently supported by the examples in Real World\n        OCaml, although it is being worked on. Until that's ready, we\n        recommend using a virtual machine running Debian Linux on your\n        local machine.\n      </blockquote>")))
 (idp11646688
  ((file installation.html)
   (html
    "<blockquote>\n        Arch Linux provides OCaml 4.00.1 (or later) in the standard\n        repositories, so the easiest method of installation is using\n        <code>pacman</code>:\n      </blockquote>")))
 (idp11644944
  ((file installation.html)
   (html
    "<blockquote>\n        The PCRE package is used by Core and is just included here for\n        convenience later.\n      </blockquote>")))
 (idp11643696
  ((file installation.html)
   (html
    "<blockquote>\n        OCaml has been included in the basic distribution since Fedora\n        8. To install the latest compiler, just run:\n      </blockquote>")))
 (idp11640928
  ((file installation.html)
   (html
    "<blockquote>\n        Notice that we've installed a few more packages than just the\n        OCaml compiler here. The second command line installs enough\n        system packages to let you build your own OCaml packages. You\n        may find that some OCaml libraries require more system libraries\n        (for example, <code>libssl-dev</code>), but we'll\n        highlight these in the book when we introduce the library.\n      </blockquote>")))
 (idp11639296
  ((file installation.html)
   (html
    "<blockquote>\n        On Debian Linux, you should install OCaml via binary packages.\n        You'll need at least OCaml version 3.12.1 to bootstrap OPAM,\n        which means using Debian Wheezy or greater. Don't worry about\n        getting the absolute latest version of the compiler, as you just\n        need one new enough to compile the OPAM package manager, after\n        which you'll use OPAM to manage your compiler installation.\n      </blockquote>")))
 (idp11635968
  ((file installation.html)
   (html
    "<blockquote>\n        Another popular package manager on Mac OS X is\n        <a href=\"http://macports.org\" target=\"_top\">MacPorts</a>, which also\n        has an OCaml port. As with Homebrew, make sure you have XCode\n        installed and have followed the rest of the MacPorts\n        installation instructions, and then type in:\n      </blockquote>")))
 (idp11635328
  ((file installation.html)
   (html
    "<blockquote>\n        The Perl-compatible Regular Expression library (PCRE) is used by\n        the Core suite. It's not strictly needed to use OCaml, but is a\n        commonly used library that we're installing now to save time\n        later.\n      </blockquote>")))
 (idp11633168
  ((file installation.html)
   (html
    "<blockquote>\n        The\n        <a href=\"http://github.com/mxcl/homebrew\" target=\"_top\">Homebrew</a>\n        package manager has an OCaml installer, which is usually updated\n        pretty quickly to the latest stable release. Make sure that you\n        have the latest XCode (and Command Line Tools for XCode)\n        installed from the App Store before starting the OCaml\n        installation.\n      </blockquote>")))
 (idp11631440
  ((file installation.html)
   (html
    "<blockquote>\n      The OCaml compiler is available as a binary distribution on many\n      operating systems. This is the simplest and preferred installation\n      route, but we'll also describe how to do a manual installation as\n      a last resort.\n    </blockquote>")))
 (idp11629088
  ((file installation.html)
   (html
    "<blockquote>\n    Let's get started with how to install OCaml on various operating\n    systems, and we'll get OPAM and <code>utop</code> running\n    after that.\n  </blockquote>")))
 (idp11627600
  ((file installation.html)
   (html
    "<blockquote>\n        The <code>utop</code> interactive toplevel, a modern\n        interactive toplevel with command history and tab completion.\n      </blockquote>")))
 (idp11626704
  ((file installation.html)
   (html
    "<blockquote>\n        The OPAM source package manager, through which we'll install\n        several extra libraries.\n      </blockquote>")))
 (idp11625872
  ((file installation.html)
   (html
    "<blockquote>\n        The OCaml compiler itself.\n      </blockquote>")))
 (idp11624864
  ((file installation.html)
   (html
    "<blockquote>\n    To work through Real World OCaml, you'll need three major components\n    installed:\n  </blockquote>")))
 (idp11624016
  ((file installation.html)
   (html
    "<blockquote>\n    An important difference between OCaml and scripting languages such\n    as Python or Ruby is the static type safety that means that you\n    can't just mix-and-match compiled libraries. Interfaces are checked\n    when libraries are compiled, so when an interface is changed, all\n    the dependent libraries must also be recompiled. Source-based\n    package managers automate this process for you and make development\n    life much easier.\n  </blockquote>")))
 (idp11623312
  ((file installation.html)
   (html
    "<blockquote>\n    The easiest way to use OCaml is via the binary packages available\n    for many operating systems. For day-to-day code development however,\n    it's much easier to use a source-code manager that lets you modify\n    individual libraries and automatically recompile all the\n    dependencies.\n  </blockquote>")))
 (idp9017760
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Thus, if we replace <code>type 'a t</code> in the\n        interface with <code>type +'a t</code>, that will make it\n        explicit in the interface that the data-structure doesn't\n        contain any persistent references to values of type\n        <code>'a</code>, at which point, OCaml can infer\n        polymorphic types for expressions of this type that are not\n        simple values.\n      </blockquote>")))
 (idp9013808
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The issue here is that the signature, by virtue of being\n        abstract, has obscured the fact that\n        <code>Concat_list.t</code> is in fact an immutable\n        data-type. We can resolve this in one of two ways: either by\n        making the type concrete (<span><em>i.e.</em></span>, exposing\n        the implementation in the <code>mli</code>), which is\n        often not desirable; or by marking the type variable in question\n        as <span><em>covariant</em></span>. We'll learn more about\n        variance and covariance in\n        <a href=\"object-oriented-programming.html\">Chapter\194\16010, <i>Object Oriented Programming</i></a>, but for\n        now, you can think of it as an annotation which can be put in\n        the interface of a pure data structure.\n      </blockquote>")))
 (idp9011200
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The details of the implementation don't matter so much, but it's\n        important to note that a <code>Concat_list.t</code> is\n        unquestionably an immutable value. However, when it comes to the\n        value restriction, OCaml treats it as if it were mutable.\n      </blockquote>")))
 (idp9008160
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        A more important example of this comes up when defining abstract\n        data types. Consider the following simple data-structure for an\n        immutable list type that supports constant-time concatenation.\n      </blockquote>")))
 (idp9006624
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        On the other hand, if the returned type is potentially mutable,\n        then the result will be weakly polymorphic.\n      </blockquote>")))
 (idp9005072
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But that's not always the case. When the type of the returned\n        value is immutable, then OCaml can typically infer a fully\n        polymorphic type.\n      </blockquote>")))
 (idp9003376
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        For example, we saw above that a function application, even a\n        simple application of the identity function, is not a simple\n        value and thus can turn a polymorphic value into a weakly\n        polymorphic one.\n      </blockquote>")))
 (idp9002768
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But OCaml actually has a relaxed version of the value\n        restriction that can make some use of type information to allow\n        polymorphic types for things that are not simple values.\n      </blockquote>")))
 (idp9002032
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        OCaml is actually a little better at inferring polymorphic types\n        than is implied above. The value restriction as we described it\n        above is basically a syntactic check: there are a few operations\n        that you can do that count as simple values, and anything that's\n        a simple value can be generalized.\n      </blockquote>")))
 (idp8999792
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This transformation is referred to as <span><em>eta\n        expansion</em></span>, and is often useful to resolve problems\n        that arise from the value restriction.\n      </blockquote>")))
 (idp8995760
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        As you can see, we now infer a weakly polymorphic type for the\n        resulting function, and for good reason. There's nothing that\n        tells us that <code>List.init</code> isn't creating a\n        persistent <code>ref</code> somewhere inside of it that\n        would be shared across multiple calls to\n        <code>list_init_10</code>. We can eliminate this\n        possibility, and at the same time get the compiler to infer a\n        polymorphic type, by using explicit variables rather than\n        partial application.\n      </blockquote>")))
 (idp8993408
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Imagine we wanted to create a specialized version of\n        <code>List.init</code> that always created lists of length\n        10. We could do that using partial application, as follows.\n      </blockquote>")))
 (idp8990944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Consider the <code>List.init</code> function, which is\n        used for creating lists where each element is created by calling\n        a function on the index of that element.\n      </blockquote>")))
 (idp8989552
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Most of the time, when the value restriction kicks in, it's for\n        a good reason, <span><em>i.e.</em></span>, it's because the value\n        in question can actually only safely be used with a single type.\n        But sometimes, the value restriction kicks in when you don't\n        want it. The most common such case is partially applied\n        functions. A partially applied function, like any function\n        application, is not a simple value, and as such, functions\n        created by partial application are sometimes less general than\n        you might expect.\n      </blockquote>")))
 (idp8987696
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But a function that has a mutable cache that persists across\n        calls, like memoize, can only be weakly polymorphic.\n      </blockquote>")))
 (idp8985520
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The value restriction doesn't require that there is no mutable\n        state, only that there is no <span><em>persistent</em></span>\n        mutable state that could share values between uses of the same\n        function. Thus, a function that produces a fresh reference every\n        time it's called can have a fully polymorphic type:\n      </blockquote>")))
 (idp8984912
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        It would be safe to infer a weakly polymorphic variable here,\n        but because OCaml's type system doesn't distinguish between pure\n        and impure functions, it can't separate those two cases.\n      </blockquote>")))
 (idp8982704
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The memoized version of the function does in fact need to be\n        restricted to a single type, because it uses mutable state\n        behind the scenes to cache previous invocations of the function\n        it has passed. But OCaml would make the same determination even\n        if the function in question did no such thing. Consider this\n        example:\n      </blockquote>")))
 (idp8981008
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But, if we write down an expression that isn't a simple value by\n        the above definition, we'll get different results. For example,\n        consider what happens if we try to memoize the function defined\n        above.\n      </blockquote>")))
 (idp8979408
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Thus, the following expression is a simple value, and as a\n        result, the types of values contained within it are allowed to\n        be polymorphic.\n      </blockquote>")))
 (idp8975824
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>let</code> bindings of the form\n            <code>let var = &lt;expr1&gt; in &lt;expr2&gt;</code>,\n            where both <code>&lt;expr1&gt;</code> and\n            <code>&lt;expr2&gt;</code> are simple values.\n          </blockquote>")))
 (idp8972368
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            Function declarations, <span><em>i.e.</em></span>,\n            expressions that begin with <code>fun</code> or\n            <code>function</code>, or, the equivalent let binding,\n            <code>let f x = ...</code>.\n          </blockquote>")))
 (idp8971504
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            Constructors that contain only other simple values\n          </blockquote>")))
 (idp8970176
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            Constants (<span><em>i.e.</em></span>, things like integer\n            and floating point literals)\n          </blockquote>")))
 (idp8969104
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The core of the value restriction is the observation that some\n        kinds of simple values by their nature can't contain refs,\n        including:\n      </blockquote>")))
 (idp8967760
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        So, when does the compiler infer weakly polymorphic types? As\n        we've seen, we need weakly polymorphic types when a value of\n        unknown type is stored in a persistent mutable cell. Because the\n        type-system isn't precise enough to determine all cases where\n        this might happen, OCaml uses a rough rule to flag cases where\n        it's sure there are no persistent refs, and to only infer\n        polymorphic types in those cases. This rule is called\n        <span><em>the value restriction</em></span>.\n      </blockquote>")))
 (idp8964096
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Note that the type of <code>remember</code> was settled by\n      the definition of <code>remember_three</code>, even though\n      <code>remember_three</code> was never called!\n    </blockquote>")))
 (idp8962224
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      OCaml will convert a weakly polymorphic variable to a concrete\n      type as soon as it gets a clue as to what concrete type it is to\n      be used as, as you can see below.\n    </blockquote>")))
 (idp8958512
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The underscore in the type variable <code>'_a</code> tells\n      us that the variable is only <span><em>weakly\n      polymorphic</em></span>, which is to say that it can be used with\n      any <span><em>single</em></span> type. That makes sense, because,\n      unlike <code>identity</code>, <code>remember</code>\n      always returns the value it was passed on its first invocation,\n      which means it can only be used with one type.\n    </blockquote>")))
 (idp8956240
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      This is not what happens with <code>remember</code>, though.\n      Here's the type that OCaml infers for remember, which looks\n      almost, but not quite, like the type of the identity function.\n    </blockquote>")))
 (idp8955024
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      As you can see, the polymorphic type of\n      <code>identity</code> lets it operate on values with\n      different types.\n    </blockquote>")))
 (idp8948032
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      On its first call, <code>remember</code> returns the same\n      value its passed, which means its input type and return type\n      should match. Accordingly, <code>remember</code> should have\n      the type <code>t -&gt; t</code> for some type\n      <code>t</code>. There's nothing about\n      <code>remember</code> that ties the choice of\n      <code>t</code> to any particular type, so you might expect\n      OCaml to generalize, replacing <code>t</code> with a\n      polymorphic type variable. It's this kind of generalization that\n      gives us polymorphic types in the first place. The identity\n      function, as an example, gets a polymorphic type in this way.\n    </blockquote>")))
 (idp8946832
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>remember</code> is not a terribly useful function, but\n      it raises an interesting question: what type should it have?\n    </blockquote>")))
 (idp8943392
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>remember</code> simply caches the first value that's\n      passed to it, returning that value on every call. Note that we've\n      carefully written <code>remember</code> so that\n      <code>cache</code> is created and initialized once, and is\n      shared across invocations of <code>remember</code>.\n    </blockquote>")))
 (idp8941712
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Consider the following simple imperative function.\n    </blockquote>")))
 (idp8939056
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Here, you can see that the sub-expression that came last was\n      actually evaluated first! This is generally the case for many\n      different kinds of expressions. If you want to make sure of the\n      evaluation order of different sub-expressions, you should express\n      them as a series of <code>let</code> bindings.\n    </blockquote>")))
 (idp8937504
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Consider the following example.\n    </blockquote>")))
 (idp8936160
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      In a strict language, we know that expressions that are bound by a\n      sequence of let-bindings will be evaluated in the order that\n      they're defined. But what about the evaluation order within a\n      single expression? Officially, the answer is that evaluation order\n      within an expression is undefined. In practice, OCaml has only one\n      compiler, and that behavior is a kind of <span><em>de\n      facto</em></span> standard. Unfortunately, the evaluation order in\n      this case is often the oppose of what one might expect.\n    </blockquote>")))
 (idp8935408
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      OCaml is strict by default for a good reason: Lazy evaluation and\n      imperative programming generally don't mix well, because laziness\n      makes it harder to reason about when a given side effect is going\n      to occur. Understanding the order of side-effects is essential to\n      reasoning about the behavior of an imperative program.\n    </blockquote>")))
 (idp8932848
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      We can confirm that fact by a few well placed\n      <code>printf</code>s.\n    </blockquote>")))
 (idp8929728
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      It doesn't have to be this way. Using the <code>lazy</code>\n      keyword, we can write the original computation so that\n      <code>sin 128.</code> won't ever be computed.\n    </blockquote>")))
 (idp8927040
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      In some sense, we don't really need to compute the\n      <code>sin 128</code>, because <code>sin 75.</code> is\n      negative, so we could know the answer before even computing\n      <code>sin 128</code>.\n    </blockquote>")))
 (idp8925280
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Consider the following simple example. Here, we have a collection\n      of angles and we want to determine if any of them have a negative\n      `sin. The following snippet of code would answer that question.\n    </blockquote>")))
 (idp8923856
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The order in which expressions are evaluated is an important part\n      of the definition of a programming language, and it is\n      particularly important when programming imperatively. Most\n      programming languages you're likely to have encountered are\n      <span><em>strict</em></span>, and OCaml is too. In a strict\n      language, when you bind an identifier to the result of some\n      expression, the expression is evaluated before the variable is\n      defined. Similarly, if you call a function on a set of arguments,\n      those arguments are evaluated before they are passed to the\n      function.\n    </blockquote>")))
 (idp8920512
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This is just a taste of the functionality of\n        <code>In_channel</code> and\n        <code>Out_channel</code>. To get a fuller understanding\n        you should review the API documentation for those modules.\n      </blockquote>")))
 (idp8917024
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Another misfeature of our implementation of\n        <code>sum_file</code> is that we read the entire file into\n        memory before processing it. For a large file, it's more\n        efficient to process a line at a time. You can use the\n        <code>In_channel.fold_lines</code> function to do just\n        that.\n      </blockquote>")))
 (idp8913408
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>In_channel</code> also supports some idioms that\n        handle some of the details of this for you. For example, the\n        <code>with_file</code> function takes a filename and a\n        function for processing that file, and takes care of the opening\n        and closing of the file transparently.\n      </blockquote>")))
 (idp8912768
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This is really an example of a more general complexity of\n        imperative programming. When programming imperatively, you need\n        to be quite careful to make sure that exceptions don't leave you\n        in an awkward state.\n      </blockquote>")))
 (idp8911104
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And now, the file descriptor leak is gone:\n      </blockquote>")))
 (idp8907520
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        To avoid this, we need to make sure that our code cleans up\n        after itself. We can do this using the\n        <code>protect</code> function described in\n        <a href=\"error-handling.html\">Chapter\194\1607, <i>Error Handling</i></a>, as follows.\n      </blockquote>")))
 (idp8907008
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And now, you'll need to restart your toplevel if you want to\n        open any more files!\n      </blockquote>")))
 (idp8905296
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And if we do this over and over in a loop, we'll eventually run\n        out of file descriptors.\n      </blockquote>")))
 (idp8903600
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        One problem with the code above is that if it throws an\n        exception in the middle of its work, it won't actually close the\n        file. If we try to read a file that doesn't actually contain\n        numbers, we'll see such an error:\n      </blockquote>")))
 (idp8902864
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        For both of these functions we followed the same basic sequence:\n        we first create the channel, then use the channel, and finally\n        close the channel. The closing of the channel is important,\n        since without it, we won't release resources associated with the\n        file back to the operating system.\n      </blockquote>")))
 (idp8898304
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Another common use of <code>in_channel</code>s and\n        <code>out_channel</code>s is for working with files.\n        Here's a couple of functions, one that creates a file full of\n        numbers, and the other that reads in such a file and returns the\n        sum of those numbers.\n      </blockquote>")))
 (idp8895840
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        All of this, and a good deal more, is described in the API\n        documentation for the <code>Printf</code> module in the\n        OCaml Manual.\n      </blockquote>")))
 (idp8894448
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>sprintf</code>, which returns a formatted string\n          </blockquote>")))
 (idp8892240
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>fprintf</code>, which prints to an arbitrary\n            <code>out_channel</code>\n</blockquote>")))
 (idp8890016
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>eprintf</code>, which prints to\n            <code>stderr</code>.\n          </blockquote>")))
 (idp8887584
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        There are also <code>printf</code>-style functions that\n        target outputs other than <code>stdout</code>, including:\n      </blockquote>")))
 (idp8886880
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            precision of float conversions\n          </blockquote>")))
 (idp8886000
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            whether numbers should be formatted in decimal, hex or\n            binary\n          </blockquote>")))
 (idp8885168
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            escaping rules for strings\n          </blockquote>")))
 (idp8884336
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n            alignment and padding\n          </blockquote>")))
 (idp8882608
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>printf</code>'s formatting directives offer a\n        significant amount of control, allowing you to specify things\n        like:\n      </blockquote>")))
 (idp8879904
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        In the above example, we've used only two formatting directives:\n        <code>%s</code>, for including a string, and\n        <code>%!</code> which causes <code>printf</code> to\n        flush the channel.\n      </blockquote>")))
 (idp8876912
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Now let's see how we can rewrite our time conversion program to\n        be a little more concise using <code>printf</code>.\n      </blockquote>")))
 (idp8875248
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        If this looks different from everything else you've seen so far,\n        that's because it is. This is really a special case in the\n        type-system. Most of the time, you don't need to worry about\n        this special handling of format strings --- you can just use\n        <code>printf</code> and not worry about the details. But\n        it's useful to keep the broad outlines of the story in the back\n        of your head.\n      </blockquote>")))
 (idp8872976
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And accordingly, we can pass it to <code>printf</code>.\n      </blockquote>")))
 (idp8871072
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        If OCaml infers that a given string literal is a format string,\n        then it parses it at compile time as such, choosing its type in\n        accordance with the formatting directives it finds. Thus, if we\n        add a type-annotation indicating that the string we're defining\n        is actually a format string, it will be interpreted as such:\n      </blockquote>")))
 (idp8867984
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        To check this, OCaml needs to analyze the contents of the format\n        string at compile time, which means the format string needs to\n        be available as a string literal at compile time. Indeed, if you\n        try to pass an ordinary string to <code>printf</code>, the\n        compiler will complain.\n      </blockquote>")))
 (idp8865792
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The format strings used by <code>printf</code> turn out to\n        be quite different from ordinary strings. This difference ties\n        to the fact that OCaml format strings, unlike their equivalent\n        in C, are type-safe. In particular, the compiler checks that the\n        types referred to by the format string match the types of the\n        rest of the arguments passed to <code>printf</code>.\n      </blockquote>")))
 (idp8861536
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Importantly, and unlike C's <code>printf</code>, the\n        <code>printf</code> in OCaml is type-safe. In particular,\n        if we provide an argument whose type doesn't match what's\n        presented in the format string, we'll get a type error.\n      </blockquote>")))
 (idp8856176
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Generating output with functions like\n        <code>Out_channel.output_string</code> is simple and easy\n        to understand, but can be a bit verbose. OCaml also supports\n        formatted output using the <code>printf</code> function,\n        which is modeled after <code>printf</code> in the C\n        standard library. <code>printf</code> takes a\n        <span><em>format string</em></span> that describe what to print\n        and how to format it, as well as arguments to be printed, as\n        determined by the formatting directives embedded in the format\n        string. So, for example, we can write:\n      </blockquote>")))
 (idp8849520
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Note that <code>In_channel.input_line</code> returns a\n        <code>string option</code>, with <code>None</code>\n        indicating that the input stream has ended\n        (<span><em>i.e.</em></span>, an end-of-file condition).\n        <code>Out_channel.output_string</code> is used to print\n        the final output, and <code>Out_channel.flush</code> is\n        called to flush that output to the screen. The final flush is\n        not technically required, since the program ends after that\n        instruction, at which point all remaining output will be flushed\n        anyway, but the flush is nonetheless good practice.\n      </blockquote>")))
 (idp8845856
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We called <code>Out_channel.flush</code> on\n        <code>stdout</code> because\n        <code>out_channel</code>s are buffered, which is to say\n        that OCaml doesn't immediately do a write every time you call\n        <code>output_string</code>. Instead, writes are buffered\n        until either enough has been written to trigger the flushing of\n        the buffers, or until a flush is explicitly requested. This\n        greatly increases the efficiency of the writing process, by\n        reducing the number of system calls.\n      </blockquote>")))
 (idp8844544
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        You can then type in the name of a timezone and hit return, and\n        it will print out the current time in the timezone in question.\n      </blockquote>")))
 (idp8841120
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We can build this program (using <code>ocamlbuild</code>\n        with the <code>_tags</code> file described in\n        <a href=\"files-modules-and-programs.html#single-file-programs\">the section called \226\128\156Single File Programs\226\128\157</a>) and run it,\n        you'll see that it prompts you for input, as follows:\n      </blockquote>")))
 (idp8836768
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Let's see this in action in a simple interactive application.\n        The following program, <code>time_converter</code>,\n        prompts the user for a timezone, and then prints out the current\n        time in that timezone. Here, we use Core's\n        <code>Zone</code> module for looking up a timezone, and\n        the <code>Time</code> module for computing the current\n        time and printing it out in the timezone in question.\n      </blockquote>")))
 (idp8832672
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The values <code>stdin</code>, <code>stdout</code>\n        and <code>stderr</code> are useful enough that they are\n        also available in the global name-space directly, without having\n        to go through the <code>In_channel</code> and\n        <code>Out_channel</code> modules.\n      </blockquote>")))
 (idp8830480
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>Out_channel.stderr</code>. The &quot;standard\n            error&quot; channel. This is similar to\n            <code>stdout</code>, but is intended for error\n            messages.\n          </blockquote>")))
 (idp8827984
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>Out_channel.stdout</code>. The &quot;standard\n            output&quot; channel. By default, output written to\n            <code>stdout</code> appears on the user terminal.\n          </blockquote>")))
 (idp8826128
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>In_channel.stdin</code>. The &quot;standard\n            input&quot; channel. By default, input comes from the\n            terminal, which handles keyboard input.\n          </blockquote>")))
 (idp8824960
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We'll start our discussion of I/O by focusing on the terminal.\n        Following the UNIX model, communication with the terminal is\n        organized around three channels, which correspond to the three\n        standard file descriptors in Unix:\n      </blockquote>")))
 (idp8820688
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        OCaml's buffered I/O library is organized around two types:\n        <code>in_channel</code>, for channels you read from, and\n        <code>out_channel</code>, for channels you write to.\n        <code>In_channel</code> and <code>Out_channel</code>\n        modules only have direct support for channels corresponding to\n        files and terminals; other kinds of channels can be created\n        through the <code>Unix</code> module.\n      </blockquote>")))
 (idp8813968
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      There are multiple I/O libraries in OCaml. In this section we'll\n      discuss OCaml's buffered I/O library that can be used through the\n      <code>In_channel</code> and <code>Out_channel</code>\n      modules in Core. Other I/O primitives are also available through\n      the <code>Unix</code> module in Core as well as\n      <code>Async</code>, the asynchronous I/O library that is\n      covered in\n      <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>.\n      Most of the functionality in Core's <code>In_channel</code>,\n      <code>Out_channel</code> (and in Core's\n      <code>Unix</code> module) derives from the standard library,\n      but we'll use Core's interfaces here.\n    </blockquote>")))
 (idp8812592
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Imperative programming is about more than modifying in-memory\n      data-structures. Any function that doesn't boil down to a\n      deterministic transformation from its arguments to its return\n      value is imperative in nature. That includes not only things that\n      mutate your program's data, but also operations that interact with\n      the world outside of your program. An important example of this\n      kind of interaction is I/O, <span><em>i.e.</em></span>, operations\n      for reading or writing data to things like files, terminal input\n      and output, and network sockets.\n    </blockquote>")))
 (idp8810768
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Laziness is more constrained than explicit mutation, and so in\n        some cases can lead to code whose behavior is easier to think\n        about.\n      </blockquote>")))
 (idp8807616
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But we can also create useful recursive definitions with\n        <code>lazy</code>. In particular, we can use laziness to\n        make our definition of <code>memo_rec</code> work without\n        explicit mutation.\n      </blockquote>")))
 (idp8805520
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Of course, actually trying to compute this will fail. OCaml's\n        <code>lazy</code> throws an exception when a lazy value\n        tries to force itself as part of its own evaluation.\n      </blockquote>")))
 (idp8803328
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        It's worth noting that these restrictions don't show up in a\n        lazy language like Haskell. Indeed, we can make something like\n        our definition of <code>x</code> work if we use OCaml's\n        laziness:\n      </blockquote>")))
 (idp8800640
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        To avoid such cases, the compiler only allows three possible\n        constructs to show up on the right-hand side of a\n        <code>let rec</code>: a function definition, a\n        constructor, or the lazy keyword. This excludes some reasonable\n        things, like our definition of <code>memo_rec</code>, but\n        it also blocks things that don't make sense, like our definition\n        of <code>x</code>.\n      </blockquote>")))
 (idp8799360
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Note that <code>x</code> is an ordinary value, not a\n        function. As such, it's not clear how to execute this code. In\n        some sense, you could imagine it compiling down to an infinite\n        loop, but there's no looping control structure to make that\n        happen.\n      </blockquote>")))
 (idp8797216
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        OCaml rejects the definition because OCaml, as a strict\n        language, has limits on what it can put on the right hand side\n        of a <code>let rec</code>. In particular, imagine how the\n        following code snippet would be compiled.\n      </blockquote>")))
 (idp8793488
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        You might wonder why we didn't tie the recursive knot in\n        <code>memo_rec</code> using <code>let rec</code>, as\n        we did for <code>make_rec</code> earlier. Here's code that\n        tries to do just that:\n      </blockquote>")))
 (idp8790048
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This new version of <code>edit_distance</code> is much\n        more efficient than the one we started with; the following call\n        is about ten thousand times faster than it was without\n        memoization.\n      </blockquote>")))
 (idp8782976
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        But memoization is a good approach for optimizing\n        <code>edit_distance</code>, and we can apply the same\n        approach we used on <code>fib</code> here. We will need to\n        change <code>edit_distance</code> to take a pair of\n        strings as a single argument, since <code>memo_rec</code>\n        only works on single-argument functions. (We can always recover\n        the original interface with a wrapper function.) With just that\n        change and the addition of the <code>memo_rec</code> call,\n        we can get a memoized version of\n        <code>edit_distance</code>:\n      </blockquote>")))
 (idp8781008
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Memoization is overkill for implementing Fibonacci, and indeed,\n        the <code>fib</code> defined above is not especially\n        efficient, allocating space linear in the number passed in to\n        <code>fib</code>. It's easy enough to write a Fibonacci\n        function that takes a constant amount of space.\n      </blockquote>")))
 (idp8778112
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We can use <code>memo_rec</code> as part of a single\n        declaration that makes this look like it's little more than a\n        special form of <code>let rec</code>.\n      </blockquote>")))
 (idp8773424
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The memory behavior here is important. If you look back at the\n        definition of <code>memo_rec</code>, you'll see that the\n        call to memo_rec does not trigger a call to\n        <code>memoize</code>. Only when the final argument to\n        <code>fib</code> is presented does\n        <code>memoize</code> get called, and the result of that\n        call falls out of scope when the <code>fib</code> call\n        returns. That means that, unlike ordinary memoization, calling\n        <code>memo_rec</code> on a function does not create a\n        memory leak --- the memoization table is collected after the\n        computation completes.\n      </blockquote>")))
 (idp8772944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And as you can see, the exponential time complexity is now gone.\n      </blockquote>")))
 (idp8770176
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Using <code>memo_rec</code>, we can now build an efficient\n        version of <code>fib</code>.\n      </blockquote>")))
 (idp8768960
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We're using the reference here as a way of tying the recursive\n        knot without using a <code>let rec</code>, which for\n        reasons we'll describe later wouldn't work here.\n      </blockquote>")))
 (idp8767328
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Note that <code>memo_rec</code> has the same signature as\n        <code>make_rec</code>.\n      </blockquote>")))
 (idp8764144
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This is clever enough, but all we've really done is find a new\n        way to implement the same old slow Fibonacci function. To make\n        it faster, we need variant on <code>make_rec</code> that\n        inserts memoization when it ties the recursive knot. We'll call\n        that function <code>memo_rec</code>.\n      </blockquote>")))
 (idp8760272
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This is a pretty strange piece of code, and it may take a few\n        minutes of thought to figure out what's going on. Like\n        <code>fib_norec</code>, the function\n        <code>f_norec</code> passed into\n        <code>make_rec</code> is a function that isn't recursive,\n        but takes as an argument a function that it will call. What\n        <code>make_rec</code> does is to essentially feed\n        <code>f_norec</code> to itself, thus making it a true\n        recursive function.\n      </blockquote>")))
 (idp8757808
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We can even write a polymorphic function that we'll call\n        <code>make_rec</code> that can tie the recursive not for\n        any function of this form.\n      </blockquote>")))
 (idp8756304
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We can now turn this back into an ordinary Fibonacci function by\n        tying the recursive knot, as shown below.\n      </blockquote>")))
 (idp8752640
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        In order to make <code>fib</code> fast, our first step\n        will be to rewrite <code>fib</code> in a way that unwinds\n        the recursion. The following version expects as its first\n        argument a function (called <code>fib</code>) that will be\n        called in lieu of the usual recursive call.\n      </blockquote>")))
 (idp8748816
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        So, how can we use memoization to make this faster? The tricky\n        bit is that we need to insert the memoization before the\n        recursive calls within <code>fib</code>. We can't just\n        define <code>fib</code> in the ordinary way and memoize it\n        after the fact and expect the first call to\n        <code>fib</code> to be improved (though of course repeated\n        calls will be improved).\n      </blockquote>")))
 (idp8746720
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Here, <code>fib 40</code> takes almost a minute to\n        compute, as opposed to five <span><em>milliseconds</em></span>\n        for <code>fib 20</code>.\n      </blockquote>")))
 (idp8743760
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This is, however, exponentially slow, for the same reason that\n        <code>edit_distance</code> was slow: we end up making many\n        redundant calls to <code>fib</code>. It shows up quite\n        dramatically in the performance.\n      </blockquote>")))
 (idp8739440
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Memoization would be a huge help here, but to fix the problem,\n        we need to memoize the calls that\n        <code>edit_distance</code> makes to itself. This technique\n        is sometimes referred to as <span><em>dynamic\n        programming</em></span>. To see how to do this, let's step away\n        from <code>edit_distance</code>, and instead consider a\n        much simpler example: computing the nth element of the Fibonacci\n        sequence. The Fibonacci sequence by definition starts out with\n        two <code>1</code>'s, with every subsequent element being\n        the sum of the previous two. The classic recursive definition of\n        Fibonacci is as follows:\n      </blockquote>")))
 (idp8738944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Just those few extra characters made it almost four thousand\n        times slower!\n      </blockquote>")))
 (idp8737328
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And now we can use this to try out some examples.\n      </blockquote>")))
 (idp8734176
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        As you can see, some of these calls are repeats. For example,\n        there are two different calls to\n        <code>edit_distance &quot;OCam&quot; &quot;oca&quot;</code>.\n        The number of redundant calls grows exponentially with the size\n        of the strings, meaning that our implementation of\n        <code>edit_distance</code> is brutally slow for large\n        strings. We can see this by writing a small timing function.\n      </blockquote>")))
 (idp8732320
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        And these calls will in turn dispatch other calls:\n      </blockquote>")))
 (idp8730256
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The thing to note is that if you call\n        <code>edit_distance &quot;OCaml&quot; &quot;ocaml&quot;</code>,\n        then that will in turn dispatch the following calls:\n      </blockquote>")))
 (idp8727696
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Consider the following code for computing the edit distance.\n        Understanding the algorithm isn't important here, but you should\n        pay attention to the structure of the recursive calls.\n      </blockquote>")))
 (idp8726336
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Memoization is also useful for efficiently implementing some\n        recursive algorithms. One good example is the algorithm for\n        computing the <span><em>edit distance</em></span> (also called\n        the Levenshtein distance) between two strings. The edit distance\n        is the number of single-character changes (including letter\n        switches, insertions and deletions) required to convert one\n        string to the other. This kind of distance metric can be useful\n        for a variety of approximate string matching problems, like\n        spell checkers.\n      </blockquote>")))
 (idp8725520
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Memoization can be useful whenever you have a function that is\n        expensive to recompute, and you don't mind caching old values\n        indefinitely. One important caution: every time you create a\n        memoized function, there's something of a built-in memory leak.\n        As long as you hold on to the memoized function, you're holding\n        every result it has returned thus far.\n      </blockquote>")))
 (idp8719328
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        The code above is a bit tricky. <code>memoize</code> takes\n        as its argument a function <code>f</code>, and then\n        allocates a hashtable (called <code>table</code>) and\n        returns a new function as the memoized version of\n        <code>f</code>. When called, this new function looks in\n        <code>table</code> first, and if it fails to find a value,\n        calls <code>f</code> and stashes the result in\n        <code>table</code>. Note that <code>table</code>\n        doesn't go out of scope as long as the function returned by\n        <code>memoize</code> is in scope.\n      </blockquote>")))
 (idp8716112
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Here's a function that takes as an argument an arbitrary\n        single-argument function and returns a memoized version of that\n        function. Here we'll use Core's <code>Hashtbl</code>\n        module, rather than our toy <code>Dictionary</code>.\n      </blockquote>")))
 (idp8715120
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Another benign effect is <span><em>memoization</em></span>. A\n        memoized function remembers the result of previous invocations\n        of the function so that they can be returned without further\n        computation when the same arguments are presented again.\n      </blockquote>")))
 (idp8711824
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The main user-visisble difference between our implementation of\n      laziness and the built-in version is syntax. Rather than writing\n      <code>create_lazy (fun () -&gt; sqrt 16.)</code>, we can\n      with the built-in <code>lazy</code> just write\n      <code>lazy (sqrt 16.)</code>.\n    </blockquote>")))
 (idp8709856
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Which we can use in the same way we used\n      <code>Lazy.force</code>:\n    </blockquote>")))
 (idp8708112
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now we just need a way to force a lazy value. The following\n      function does just that.\n    </blockquote>")))
 (idp8705888
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      We can create a lazy value based on a thunk,\n      <span><em>i.e.</em></span>, a function that takes a unit argument.\n      Wrapping an expression in a thunk is another way to suspend the\n      computation of an expression.\n    </blockquote>")))
 (idp8698208
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      A <code>lazy_state</code> represents the possible states of\n      a lazy value. A lazy value is <code>Delayed</code> before it\n      has been run, where <code>Delayed</code> holds a function\n      for computing the value in question. A lazy value is in the\n      <code>Value</code> state when it has been forced and the\n      computation ended normally. The <code>Exn</code> case is for\n      when the lazy value has been forced, but the computation ended\n      with an exception. A lazy value is simply a <code>ref</code>\n      containing a <code>lazy_state</code>, where the\n      <code>ref</code> makes it possible to change from being in\n      the <code>Delayed</code> state to being in the\n      <code>Value</code> or <code>Exn</code> states.\n    </blockquote>")))
 (idp8696416
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      To better understand how laziness works, let's walk through the\n      implementation of our own lazy type. We'll start by declaring\n      types to represent a lazy value.\n    </blockquote>")))
 (idp8695280
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      You can see from the print statement that the actual computation\n      was performed only once, and only after <code>force</code>\n      had been called.\n    </blockquote>")))
 (idp8691200
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      One of the simplest benign effect is\n      <span><em>laziness</em></span>. A lazy value is one that is not\n      computed until it is actually needed. In OCaml, lazy values are\n      created using the <code>lazy</code> keyword, which can be\n      used to prefix any expression, returning a value of type\n      <code>'a Lazy.t</code>. The evaluation of that expression is\n      delayed until forced with the <code>Lazy.force</code>\n      function.\n    </blockquote>")))
 (idp8689968
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      There are many instances where you basically want to program in a\n      pure style, but you want to make limited use of side-effects to\n      improve the performance of your code, without really changing\n      anything else. Such side effects are sometimes called\n      <span><em>benign effects</em></span>, and they are a useful way of\n      leveraging OCaml's imperative features while still maintaining\n      most of the benefits of pure programming.\n    </blockquote>")))
 (idp8681136
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>Dlist</code> has two such iterators:\n        <code>iter</code>, the goal of which is to call a\n        <code>unit</code> producing function on every element of\n        the list, in order; and <code>find_el</code>, which runs a\n        provided test function on each values stored in the list,\n        returning the first <code>element</code> that passes the\n        test. Both <code>iter</code> and\n        <code>find_el</code> are implemented using simple\n        recursive loops that use <code>next</code> to walk from\n        element to element, and <code>value</code> to extract the\n        element from a given node.\n      </blockquote>")))
 (idp8678608
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        When defining containers like lists, dictionaries and trees,\n        you'll typically want to define a set of iteration functions,\n        like <code>iter</code>, <code>map</code>, and\n        <code>fold</code>, which let you concisely express common\n        iteration patterns.\n      </blockquote>")))
 (idp8676000
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        This shouldn't be a big surprise. Complex imperative data\n        structures can be quite tricky; considerably trickier than their\n        pure equivalents. The issues described above can be dealt with\n        by more careful error detection, and such error correction is\n        taken care of in modules like Core's\n        <code>Doubly_linked</code>. You should use imperative data\n        structures from a well-designed library when you can. And when\n        you can't, you should make sure that the code you write is\n        careful about error detection.\n      </blockquote>")))
 (idp8674592
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        These functions are more fragile than they may seem. In\n        particular, misuse of the interface may lead to corrupted data.\n        For example, double-removing an element will cause the main list\n        reference to be set to <code>None</code>, thus emptying\n        the list. Similar problems arise from removing an element from a\n        list it doesn't belong to.\n      </blockquote>")))
 (idp8672016
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Note that the above code is careful to change the\n        <code>prev</code> pointer of the following element, and\n        the <code>next</code> pointer of the previous element, if\n        they exist. If there's no previous element, then the list\n        pointer itself is updated. In any case, the next and previous\n        pointers of the element itself are set to\n        <code>None</code>.\n      </blockquote>")))
 (idp8669728
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Finally, we need a <code>remove</code> function.\n      </blockquote>")))
 (idp8666208
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        We can use <code>insert_after</code> to insert elements\n        later in the list. <code>insert_after</code> takes as\n        arguments both an <code>element</code> after which to\n        insert the new node, and a value to insert.\n      </blockquote>")))
 (idp8661040
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>insert_first</code> first defines a new element\n        <code>new_elt</code>, and then links it into the list,\n        finally setting the list itself to point to\n        <code>new_elt</code>. Note that the precedence of a\n        <code>match</code> expression is very low, so to separate\n        it from the following assignment\n        (<code>t := Some new_elt</code>) we surround the match\n        with <code>begin ... end</code>. We could have used\n        parenthesis for the same purpose. Without some kind of\n        bracketing, the final assignment would incorrectly become part\n        of the <code>None -&gt; ...</code> case.\n      </blockquote>")))
 (idp8658704
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Now, we'll start considering operations that mutate the list,\n        starting with <code>insert_first</code>, which inserts an\n        element at the front of the list.\n      </blockquote>")))
 (idp8657184
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      This approach is quite limited, however. General purpose cyclic\n      data structures require mutation.\n    </blockquote>")))
 (idp8654912
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      There is an exception to this, though: you can construct\n      fixed-size cyclic data-structures using\n      <code>let rec</code>.\n    </blockquote>")))
 (idp8654144
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Doubly-linked lists are a cyclic data structure, meaning that it\n      is possible to follow a nontrivial sequence of pointers that\n      closes in on itself. In general, building cyclic data structures\n      requires the use of side-effects. This is done by constructing the\n      data elements first, and then adding cycles using assignment\n      afterwards.\n    </blockquote>")))
 (idp8653136
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      These all follow relatively straight-forwardly from our type\n      definitions.\n    </blockquote>")))
 (idp8651616
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now we can define a few basic functions that operate on lists and\n      elements.\n    </blockquote>")))
 (idp8648736
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The type of the list itself, <code>'a t</code>, is an\n      mutable reference to an optional <code>element</code>. This\n      reference is <code>None</code> if the list is empty, and\n      <code>Some</code> otherwise.\n    </blockquote>")))
 (idp8645024
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      An <code>'a element</code> is a record containing the value\n      to be stored in that node as well as optional (and mutable) fields\n      pointing to the previous and next elements. At the beginning of\n      the list, the <code>prev</code> field is\n      <code>None</code>, and at the end of the list, the\n      <code>next</code> field is <code>None</code>.\n    </blockquote>")))
 (idp8642224
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now let's look at the implementation. We'll start by defining\n      <code>'a element</code> and <code>'a t</code>.\n    </blockquote>")))
 (idp8640304
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Note that there are two types defined here:\n      <code>'a t</code>, the type of a list, and\n      <code>'a element</code>, the type of an element. Elements\n      act as pointers to the interior of a list, and allow us to\n      navigate the list and give us a point at which to apply mutating\n      operations.\n    </blockquote>")))
 (idp8637216
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Here's the <code>mli</code> of the module we'll build.\n    </blockquote>")))
 (idp8635808
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Another common imperative data structure is the doubly-linked\n      list. Doubly-linked lists can be traversed in both directions and\n      elements can be added and removed from the list in constant time.\n      Core defines a doubly-linked list (the module is called\n      <code>Doubly_linked</code>), but we'll define our own linked\n      list library as an illustration.\n    </blockquote>")))
 (idp8632448
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      In the above, we used <code>incr</code> and\n      <code>decr</code>, which are build-in functions for\n      incrementing and decrementing an <code>int ref</code> by\n      one, respectively.\n    </blockquote>")))
 (idp8629424
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      OCaml also supports <code>while</code> loops, which include\n      a condition and a body. The loop first evaluates the condition,\n      and then, if it evaluates to true, evaluates the body and starts\n      the loop again. Here's a simple example of a function for\n      reversing an array in-place.\n    </blockquote>")))
 (idp8627184
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      As you can see, the upper and lower bounds are inclusive. We can\n      also use <code>downto</code> to iterate in the other\n      direction.\n    </blockquote>")))
 (idp8622480
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The <code>for</code> loop is the simpler of the two. Indeed,\n      we've already seen the <code>for</code> loop in action ---\n      the <code>iter</code> function in\n      <code>Dictionary</code> is built using it. Here's a simple\n      example of <code>for</code>.\n    </blockquote>")))
 (idp8620736
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Nonetheless, explicit <code>for</code> and\n      <code>while</code> loops are both more idiomatic for\n      imperative programming and often more concise.\n    </blockquote>")))
 (idp8618144
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      OCaml provides support for traditional imperative looping\n      constructs, in particular, <code>for</code> and\n      <code>while</code> loops, even though neither of them is\n      strictly necessary. Anything you can do with such a loop you can\n      also do with a recursive function, and you can also write\n      higher-order functions like <code>Array.iter</code> that\n      cover much of the same ground.\n    </blockquote>")))
 (idp8613776
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        Another source of imperative operations in OCaml is resources\n        that come from interfacing with external libraries through\n        OCaml's foreign function interface (FFI). The FFI opens OCaml up\n        to imperative constructs that are exported by system calls or\n        other external libraries. Many of these come built in, like\n        access to the <code>write</code> system call, or to the\n        <code>clock</code>; while others come from user libraries,\n        like LAPACK bindings.\n      </blockquote>")))
 (idp8611088
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          The above are just ordinary OCaml functions which could be\n          defined as follows.\n        </blockquote>")))
 (idp8609696
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          You can see these in action below.\n        </blockquote>")))
 (idp8608336
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>refcell := expr</code> replaces the contents\n              of the reference cell.\n            </blockquote>")))
 (idp8606864
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>!refcell</code> returns the contents of the\n              reference cell.\n            </blockquote>")))
 (idp8604720
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>ref expr</code> constructs a reference cell\n              containing the value defined by the expression\n              <code>expr</code>.\n            </blockquote>")))
 (idp8603696
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          The standard library defines the following operators for\n          working with refs.\n        </blockquote>")))
 (idp8602368
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          The definition for the ref type is as follows:\n        </blockquote>")))
 (idp8600864
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          Variables in OCaml are never mutable --- they can refer to\n          mutable data, but what the variable points to can't be\n          changed. Sometimes, though, you want to do exactly what you\n          would do with a mutable variable in another language: define a\n          single, mutable value. In OCaml this is typically achieved\n          using a <code>ref</code>, which is essentially a\n          container with a single mutable polymorphic field.\n        </blockquote>")))
 (idp8598944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        As we'll see in\n        <a href=\"object-oriented-programming.html\">Chapter\194\16010, <i>Object Oriented Programming</i></a>, fields\n        of an object can similarly be declared as mutable, and can then\n        be modified in much the same way as record fields.\n      </blockquote>")))
 (idp8596736
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        As we've seen, records are immutable by default, but individual\n        record fields can be declared as mutable. These mutable fields\n        can be set using the <code>&lt;-</code> operator,\n        <span><em>i.e.</em></span>,\n        <code>record.field &lt;- expr</code>.\n      </blockquote>")))
 (idp8592544
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          A <code>Bigarray.t</code> is a handle to a block of\n          memory stored outside of the OCaml heap. These are mostly\n          useful for interacting with C or Fortran libraries, and are\n          discussed in\n          <a href=\"memory-representation-of-values.html\">Chapter\194\16022, <i>Memory Representation of Values</i></a>.\n          Bigarrays too have their own getting and setting syntax:\n          <code>bigarray.{index}</code> and\n          <code>bigarray.{index} &lt;- expr</code>. There is no\n          literal syntax for bigarrays.\n        </blockquote>")))
 (idp8588960
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          Strings also come with their own syntax for getting and\n          setting values: <code>string.[index]</code> and\n          <code>string.[index] &lt;- expr</code> respectively, and\n          string literals are bounded by quotes. There's also a module\n          <code>String</code> where you'll find useful functions\n          for working with strings.\n        </blockquote>")))
 (idp8586160
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          Strings are essentially byte-arrays which are often used for\n          textual data. The main advantage of using a\n          <code>string</code> in place of a\n          <code>Char.t array</code> (a <code>Char.t</code>\n          is an 8-bit character) is that the former is considerably more\n          space efficient; an array uses one word --- 8 bytes on a\n          64-bit machine --- to store a single entry, whereas strings\n          use one byte per character.\n        </blockquote>")))
 (idp8582896
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          Array literals are written using <code>[|</code> and\n          <code>|]</code> as delimiters. Thus,\n          <code>[| 1; 2; 3 |]</code> is a literal integer array.\n        </blockquote>")))
 (idp8581568
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          and for setting an element in an array:\n        </blockquote>")))
 (idp8580192
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          Arrays also come with special syntax for retrieving an element\n          from an array:\n        </blockquote>")))
 (idp8576944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n          The <code>array</code> type is used for general purpose\n          polymorphic arrays. The <code>Array</code> module has a\n          variety of utility functions for interacting with arrays,\n          including a number of mutating operations. These include\n          <code>Array.set</code>, for setting an individual\n          element, and <code>Array.blit</code>, for efficiently\n          copying values from one range of indices to another.\n        </blockquote>")))
 (idp8575040
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n        OCaml supports a number of array-like data structures;\n        <span><em>i.e.</em></span>, mutable integer-indexed containers\n        that provide constant-time access to their elements. We'll\n        discuss several of them below.\n      </blockquote>")))
 (idp8573376
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now that we've looked at a complete example, let's take a more\n      systematic look at imperative programming in OCaml. We encountered\n      two different forms of mutable data above: records with mutable\n      fields and arrays. We'll now discuss these in more detail, along\n      with the other primitive forms of mutable data that are available\n      in OCaml.\n    </blockquote>")))
 (idp8571680
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Note also that we do all of the side-effecting operations at the\n      very end of each function. This is good practice because it\n      minimizes the chance that such operations will be interrupted with\n      an exception, leaving the data structure in an inconsistent state.\n    </blockquote>")))
 (idp8565360
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      When a sequence expression <code>expr1; expr2</code> is\n      evaluated, <code>expr1</code> is evaluated first, and then\n      <code>expr2</code>. The expression <code>expr1</code>\n      should have type <code>unit</code> (though this is a warning\n      rather than a hard restriction), and the value of\n      <code>expr2</code> is returned as the value of the entire\n      sequence. For example, the sequence\n      <code>print_string &quot;hello world&quot;; 1 + 2</code>\n      first prints the string\n      <code>&quot;hello world&quot;</code>, then returns the\n      integer <code>3</code>.\n    </blockquote>")))
 (idp8564016
  ((file imperative-programming-1.html)
   (html "<blockquote>\n      is eqivalent to\n    </blockquote>")))
 (idp8562064
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      but <code>;</code> is more concise and idiomatic. More\n      generally,\n    </blockquote>")))
 (idp8559760
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      We also use a single semicolon, <code>;</code>, as a\n      sequencing operator, to allow us to do a sequence of\n      side-effecting operations in a row: first, update the bucket, then\n      update the count. We could have done this using let bindings:\n    </blockquote>")))
 (idp8556256
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Another piece of syntax shows up in both <code>add</code>\n      and <code>remove</code>: the use of the\n      <code>&lt;-</code> operator to update elements of an array\n      (<code>array.(i) &lt;- expr</code>) and for updating a\n      record field (<code>record.field &lt;- expression</code>).\n    </blockquote>")))
 (idp8554432
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      This above code is made more complicated by the fact that we need\n      to detect whether we are overwriting or removing an existing\n      binding, so we can decide whether <code>t.length</code>\n      needs to be changed. The helper function\n      <code>bucket_has_key</code> is used for this purpose.\n    </blockquote>")))
 (idp8552336
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The following code is for adding and removing mappings from the\n      dictionary.\n    </blockquote>")))
 (idp8548432
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The code for <code>iter</code> uses two forms of iteration:\n      a <code>for</code> loop to walk over the array of buckets;\n      and within that loop, and a call to <code>List.iter</code>\n      to walk over the list of values in a given bucket. We could have\n      done the outer loop with a recursive function instead of a\n      <code>for</code> loop, but <code>for</code> loops are\n      syntactically convenient, and are more familiar and idiomatic in\n      the context of imperative code.\n    </blockquote>")))
 (idp8542832
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>iter</code> is designed to walk over all the entries\n      in the dictionary. In particular, <code>iter t ~f</code>\n      will call <code>f</code> for each key/value pair in\n      dictionary <code>t</code>. Note that <code>f</code>\n      must return <code>unit</code>, since it is expected to work\n      by side effect rather than by returning a value, and the overall\n      <code>iter</code> function returns <code>unit</code>\n      as well.\n    </blockquote>")))
 (idp8540720
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now let's look at the implementation of <code>iter</code>:\n    </blockquote>")))
 (idp8534096
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>List.find_map</code> iterates over the elements of the\n      list, calling <code>f</code> on each one until a\n      <code>Some</code> is returned by <code>f</code>, at\n      which point the value returned by <code>f</code> is returned\n      by <code>find_map</code>. If <code>f</code> returns\n      <code>None</code> on all values, then\n      <code>None</code> is returned by\n      <code>find_map</code>.\n    </blockquote>")))
 (idp8530080
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Another bit of syntax has popped up in <code>find</code>: we\n      write <code>array.(index)</code> to grab a value from an\n      array. Also, <code>find</code> uses\n      <code>List.find_map</code>, which you can see the type of by\n      typing it into the toplevel:\n    </blockquote>")))
 (idp8528688
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>find</code> looks for a matching key in the table\n          and returns the corresponding value if found as an option.\n        </blockquote>")))
 (idp8527136
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>length</code> grabs the length from the\n          corresponding record field, thus returning the number of\n          entries stored in the dictionary.\n        </blockquote>")))
 (idp8525744
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n<code>create</code> creates an empty dictionary.\n        </blockquote>")))
 (idp8524752
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The other functions defined above are fairly straightforward:\n    </blockquote>")))
 (idp8522848
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      While <code>Hashtbl.hash</code> can be used with any type,\n      it won't necessarily succeed for all values.\n      <code>Hashtbl.hash</code> will throw an exception if it\n      encounters a value it can't handle, like a function or a value\n      from a C libraries that lives outside the OCaml heap.\n    </blockquote>")))
 (idp8520240
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The function <code>hash_bucket</code> is used throughout the\n      rest of the module to choose the position in the array that a\n      given key should be stored at. It is implemented on top of\n      <code>Hashtbl.hash</code>, which is a hash function provided\n      by the OCaml runtime that can be applied to values of any type.\n      Thus, its own type is polymorphic:\n      <code>'a -&gt; int</code>.\n    </blockquote>")))
 (idp8518944
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Note that <code>num_buckets</code> is a constant. That's\n      because, for simplicity's sake, we're using a fixed-length bucket\n      array. For a practical implementation, the length of the array\n      would have to be able to grow as the number of elements in the\n      dictionary increases.\n    </blockquote>")))
 (idp8517008
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Now we'll start putting together the basic functions for\n      manipulating a dictionary.\n    </blockquote>")))
 (idp8515072
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The first field, <code>length</code> is declared as mutable.\n      In OCaml, records are immutable by default, but individual fields\n      are mutable when marked as such. The second field,\n      <code>buckets</code>, is immutable, but contains an array,\n      which is itself a mutable data structure, as we'll see.\n    </blockquote>")))
 (idp8513536
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Our first step is to define the type of a dictionary as a record\n      with two fields.\n    </blockquote>")))
 (idp8512320
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      We'll now walk through the implementation (contained in the\n      corresponding <code>ml</code> file) piece by piece,\n      explaining different imperative constructs as they come up.\n    </blockquote>")))
 (idp8510320
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      The <code>mli</code> also includes a collection of helper\n      functions whose purpose and behavior should be largely inferrable\n      from their names and type signatures. Notice that a number of the\n      functions, in particular, ones like <code>add</code> that\n      modify the dictionary, return unit. This is typical of functions\n      that act by side-effect.\n    </blockquote>")))
 (idp8506144
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Here's the interface we'll match, provided as an\n      <code>mli</code>. Here, the type\n      <code>('a, 'b) t</code> is used for a dictionary with keys\n      of type <code>'a</code> and data of type\n      <code>'b</code>.\n    </blockquote>")))
 (idp8505024
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      Our dictionary, like those in Core and the standard library, will\n      be implemented as a hash table. In particular, we'll use an\n      <span><em>open hashing</em></span> scheme, which is to say the hash\n      table will be an array of buckets, each bucket containing a list\n      of key/value pairs that have been hashed into that bucket.\n    </blockquote>")))
 (idp8503888
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n      We'll start with the implementation of a simple imperative\n      dictionary, <span><em>i.e.</em></span>, a mutable mapping from keys\n      to values. This is really for illustration purposes; both Core and\n      the standard library provide imperative dictionaries, and for most\n      real world tasks, you should use one of those implementations.\n    </blockquote>")))
 (idp8502304
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n    OCaml offers a happy compromise here, making it easy and natural to\n    program in a pure style, but also providing great support for\n    imperative programming where you need it. This chapter will walk you\n    through OCaml's imperative features, and help you use them to their\n    fullest.\n  </blockquote>")))
 (idp8501328
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n    Pure code is the default in OCaml, and for good reason --- it's\n    generally easier to reason about, less error prone and more\n    composable. But imperative code is of fundamental importance to any\n    practical programming language because real-world tasks require that\n    you interact with the outside world, which is by its nature\n    imperative. Imperative programming can also be important for\n    performance. While pure code is quite efficient in OCaml, there are\n    many algorithms that can only be implemented efficiently using\n    imperative techniques.\n  </blockquote>")))
 (idp8499376
  ((file imperative-programming-1.html)
   (html
    "<blockquote>\n    Most of the code shown so far in this book, and indeed, most OCaml\n    code in general, is <span><em>pure</em></span>. Pure code works\n    without mutating the program's internal state, performing I/O,\n    reading the clock, or in any other way interacting with changeable\n    parts of the world. Thus, a pure function behaves like a\n    mathematical function, always returning the same results when given\n    the same inputs, and never affecting the world except insofar as it\n    returns the value of its computation.\n    <span><em>Imperative</em></span> code, on the other hand, operates by\n    side-effects that modify a program's internal state or interact with\n    the outside world. An imperative function has a new effect, and\n    potentially returns different results, every time it's called.\n  </blockquote>")))
 (idp10141280
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        Our example shells out to <code>curl</code> on the\n        command-line to obtain the JSON, which is rather inefficient.\n        We'll explain how to integrate the HTTP fetch directly into your\n        OCaml application later on in\n        <a href=\"concurrent-programming-with-async\" target=\"_top\">xref</a>.\n      </blockquote>")))
 (idp10139456
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        While this tool is obviously quite simple, the ability to\n        specify optional and default fields is very powerful. Take a\n        look at the full ATD specification for the GitHub API in the\n        <a href=\"http://github.com/avsm/ocaml-github\" target=\"_top\"><code>ocaml-github</code></a>\n        repository online, which has lots of quirks typical in\n        real-world web APIs.\n      </blockquote>")))
 (idp10136528
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        The JSON returned from the <code>janestreet</code> query\n        is missing an organization name, but this is explicitly\n        reflected in the OCaml type since the ATD spec marked\n        <code>name</code> as an optional field. Our OCaml code\n        explicitly handles this case and doesn't have to worry about\n        null-pointer exceptions. Similarly, the JSON integer for the\n        <code>id</code> is mapped into a native OCaml integer via\n        the ATD conversion.\n      </blockquote>")))
 (idp10134592
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        You can now run the command-line tool with a single argument to\n        specify the name of the organization, and it will dynamically\n        fetch the JSON from the web, parse it, and render the summary to\n        your console.\n      </blockquote>")))
 (idp10131712
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        Finally, write a short shell script to generate the OCaml\n        <code>Github_org</code> parsers via\n        <code>atdgen</code>, and build the OCaml command-line\n        interface.\n      </blockquote>")))
 (idp10127248
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        The OCaml program that uses this will fetch the JSON and output\n        a one-line summary. You'll also need the <code>curl</code>\n        tool installed on your system to fetch the HTTP web pages, as\n        our example below calls <code>curl</code> via the\n        <code>Core_extended.Shell</code> interface.\n      </blockquote>")))
 (idp10124816
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        Let's finish up with an example of some live JSON parsing from\n        Github, and build a tool to query organization information via\n        their API. Look at the online\n        <a href=\"http://developer.github.com/v3/orgs/\" target=\"_top\">API\n        documentation</a> for Github to see what the JSON schema\n        looks like retrieving the organization information. Then create\n        an ATD file that covers the fields we need. Any extra fields\n        present in the response will be ignored by the ATD parser.\n      </blockquote>")))
 (idp10121216
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The full ATD specification is quite sophisticated (and well\n      documented online at its homepage). The ATD compiler can also\n      target formats other than JSON, and outputs code for other\n      languages such as Java if you need more interoperability. There\n      are also several similar projects you can investigate which\n      automate the code generation process:\n      <a href=\"http://piqi.org\" target=\"_top\">Piqi</a> uses the Google protobuf\n      format, and <a href=\"http://thrift.apache.org\" target=\"_top\">Thrift</a>\n      supports many other programming languages and includes OCaml\n      bindings.\n    </blockquote>")))
 (idp10119696
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>-j-defaults</code>: always explicitly output a\n          JSON value if possible. This requires the default value for\n          that field to be defined in the ATD specification.\n        </blockquote>")))
 (idp10118080
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>-j-custom-fields FUNCTION</code>: call a custom\n          function for every unknown field encountered, instead of\n          raising a parsing exception.\n        </blockquote>")))
 (idp10116512
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>-j-std</code>: work in standard JSON mode, and\n          never print non-standard JSON extensions.\n        </blockquote>")))
 (idp10114592
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This is pretty convenient! We've written a single ATD file, and\n      all the OCaml boilerplate to convert between JSON and a strongly\n      typed record has been generated for us. You can control various\n      aspects of the serializer by passing flags to\n      <code>atdgen</code>. The important ones for JSON are:\n    </blockquote>")))
 (idp10110048
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>Github_t</code> module only contains the type\n      definitions, while <code>Github_j</code> provides\n      serialization functions to and from JSON. You can read the\n      <code>github_j.mli</code> to see the full interface, but the\n      important functions for most uses are the conversion functions to\n      and from a string. For our example above, this looks like:\n    </blockquote>")))
 (idp10107072
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      There is an obvious correspondence to the ATD definition. Note\n      that field names in OCaml records in the same module cannot shadow\n      each other, and so we instruct ATDgen to prefix every field with a\n      name that distinguishes it from other records in the same module.\n      For example,\n      <code>&lt;ocaml field_prefix=&quot;auth_req_&quot;&gt;</code>\n      in the ATD spec prefixes every field name in the generated\n      <code>authorization_request</code> record with\n      <code>auth_req</code>.\n    </blockquote>")))
 (idp10103648
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This will generate some new files in your current directory.\n      <code>Github_t.ml</code> and <code>Github_t.mli</code>\n      will contain an OCaml module with types defines that correspond to\n      the ATD file. The signature looks like this:\n    </blockquote>")))
 (idp10102080
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The ATD spec can be compiled to a number of OCaml targets. Let's\n      run the compiler twice, to generate some OCaml type definitions,\n      and a JSON serialiser.\n    </blockquote>")))
 (idp10100608
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      ATD specifications are deliberately similar to OCaml type\n      definitions. Each field can include extra annotations to customise\n      the parsing code for a particular backend. For example, the GitHub\n      <code>scope</code> field above is defined as a variant type,\n      but with the actual JSON values being defined explicitly (as\n      lower-case versions).\n    </blockquote>")))
 (idp10097488
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Let's go straight into looking at an example of how this works, by\n      using a small portion of the GitHub API. GitHub is a popular code\n      hosting and sharing website that provides a JSON-based web\n      <a href=\"http://developer.github.com\" target=\"_top\">API</a>. The ATD code\n      fragment below describes the GitHub authorization API. It is based\n      on a pseudo-standard web protocol known as OAuth, and is used to\n      authorize users for GitHub services.\n    </blockquote>")))
 (idp10096112
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The idea behind ATD is to specify the format of the JSON in a\n      separate file, and then run a compiler (<code>atdgen</code>)\n      that outputs OCaml code to construct and parse JSON values. This\n      means that you don't need to write any OCaml parsing code at all,\n      as it will all be auto-generated for you.\n    </blockquote>")))
 (idp10092608
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The command-line tool will be installed within your\n      <code>~/.opam</code> directory, and will already be on your\n      <code>PATH</code> from running\n      <code>opam config env</code>. See\n      <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a> if this isn't working.\n    </blockquote>")))
 (idp10091312
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      ATDgen installs some OCaml libraries that interface with Yojson,\n      and also a command-line tool that generates code. It can all be\n      installed via OPAM:\n    </blockquote>")))
 (idp10088352
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The combinators described earlier make it easy to write functions\n      that extract fields from JSON records, but the process is still\n      pretty manual. When you implement larger specifications, it's much\n      easier to generate the mappings from JSON schemas to OCaml values\n      more mechanically than writing conversion functions individually.\n      We'll cover an alternative JSON processing method that is better\n      for larger-scale JSON handling now, using the\n      <a href=\"http://mjambon.com/atd-biniou-intro.html\" target=\"_top\">ATD</a>\n      tool. This will introduce our first <span><em>Domain Specific\n      Language</em></span> that ccompiles JSON specifications into OCaml\n      modules, which are then used throughout your application.\n    </blockquote>")))
 (idp10082608
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The only purpose of these extensions is to make the data\n      representation more expressive without having to refer to the\n      original OCaml types. You can always cast a\n      <code>Safe.json</code> to a <code>Basic.json</code>\n      type by using the <code>to_basic</code> function as follows:\n    </blockquote>")))
 (idp10079696
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          The <code>Variant</code> type encodes OCaml variants\n          more explicitly, as <code>&lt;&quot;Foo&quot;&gt;</code>\n          or <code>&lt;&quot;Bar&quot;:123&gt;</code> for a\n          variant with parameters.\n        </blockquote>")))
 (idp10077424
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          The <code>Tuple</code> type is stored as\n          <code>(&quot;abc&quot;, 123)</code> instead of a list.\n        </blockquote>")))
 (idp10073632
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          The <code>lit</code> suffix denotes that the value is\n          stored as a JSON string. For example, a\n          <code>Floatlit</code> will be stored as\n          <code>&quot;1.234&quot;</code> instead of\n          <code>1.234</code>.\n        </blockquote>")))
 (idp10072656
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Yojson supports the following JSON extensions:\n    </blockquote>")))
 (idp10067584
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>Safe.json</code> type includes all of the variants\n      from <code>Basic.json</code> and extends it with a few more\n      useful ones. A standard JSON type such as a\n      <code>String</code> will type-check against both the\n      <code>Basic</code> module and also the non-standard\n      <code>Safe</code> module. If you use the extension values\n      with the <code>Basic</code> module however, the compiler\n      will reject your code until you make it compliant with the\n      portable subset of JSON.\n    </blockquote>")))
 (idp10063760
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The standard JSON types are <span><em>really</em></span> basic, and\n      OCaml types are far more expressive. Yojson supports an extended\n      JSON format for those times when you're not interoperating with\n      external systems and just want a convenient human-readable local\n      format. The <code>Yojson.Safe.json</code> type is a superset\n      of the <code>Basic</code> polymorphic variant, and looks\n      like this:\n    </blockquote>")))
 (idp10059312
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      In this case, we've marked the <code>x</code> as being of\n      type <code>Yojson.Basic.json</code>, and the compiler\n      immediately spots that the argument to the\n      <code>Assoc</code> variant has the incorrect type. This\n      illustrates the strengths and weaknesses of polymorphic variants:\n      they make it possible to easily subtype across module boundaries,\n      but the error messages can be more confusing. However, a bit of\n      careful manual type annotation is all it takes to make tracking\n      down such issues much easier.\n    </blockquote>")))
 (idp10056848
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The type error above isn't <span><em>wrong</em></span> as such, but\n      can be inconvenient to wade through for larger values. An easy way\n      to narrow down this sort of type error is to add explicit type\n      annotations as a compiler hint about your intentions:\n    </blockquote>")))
 (idp10053664
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      One difficulty you will encounter is that type errors involving\n      polymorphic variants can be quite verbose if you make a mistake in\n      your code. For example, suppose you build an\n      <code>Assoc</code> and mistakenly include a single value\n      instead of a list of keys:\n    </blockquote>")))
 (idp10050112
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      In this case, there are no problems. Our <code>x</code>\n      value has an inferred type that is a valid sub-type of\n      <code>json</code>, and the function application just works\n      without us ever having to explicitly specify a type for\n      <code>x</code>. Type inference lets you write more succinct\n      code without sacrificing runtime reliability, as all the uses of\n      polymorphic variants are still checked at compile-time.\n    </blockquote>")))
 (idp10044064
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>pretty_to_string</code> has a more explicit signature\n      that wants an argument of type\n      <code>Yojson.Basic.json</code>. When <code>x</code> is\n      applied to <code>pretty_to_string</code>, the inferred type\n      of <code>x</code> is statically checked against the\n      structure of the <code>json</code> type to ensure that\n      they're compatible.\n    </blockquote>")))
 (idp10038640
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      In the example above, we've constructed a value\n      <code>x</code> that represents a simple JSON object. We\n      haven't actually defined the type of <code>x</code>\n      explicitly here, as we're relying on the magic of polymorphic\n      variants to make this all work. The OCaml type system infers a\n      type for <code>x</code> based on how you construct the\n      value. In this case only the <code>Assoc</code> and\n      <code>String</code> variants are used, and the inferred type\n      only contains these fields without knowledge of the other possible\n      variants that you haven't used yet.\n    </blockquote>")))
 (idp10036080
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      We can directly build a JSON value against this type, and use the\n      pretty-printing functions in the <code>Yojson.Basic</code>\n      module to lay the output out in the JSON format.\n    </blockquote>")))
 (idp10031536
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Building and printing JSON values is pretty straightforward given\n      the <code>Yojson.Basic.json</code> type. You can just\n      construct values of type <code>json</code> and call the\n      <code>to_string</code> function] on them. Let's remind\n      ourselves of the <code>Yojson.Basic.type</code> again:\n    </blockquote>")))
 (idp10029648
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This technique of using chained parsing functions is very powerful\n      in combination with the OCaml type system. Many errors that don't\n      make sense at runtime (for example, mixing up lists and objects)\n      will be caught statically via a type error.\n    </blockquote>")))
 (idp10028160
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This style of programming which omits variable names and chains\n      functions together is known as &quot;point-free programming&quot;.\n      It's a succinct style, but shouldn't be overused due to the\n      increased difficulty of debugging intermediate values. If an\n      explicit name is assigned to each stage of the transformations,\n      debuggers in particular have an easier time making the program\n      flow easier to represent to the programer.\n    </blockquote>")))
 (idp10022896
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The final use of JSON combinators is to extract all the\n      <code>name</code> fields from the list of authors. We first\n      construct the <code>author list</code>, and then\n      <code>map</code> it into a <code>string list</code>.\n      Notice that the example explicitly binds\n      <code>authors</code> to a variable name. It can also be\n      written more succinctly using the pipe-forward operator:\n    </blockquote>")))
 (idp10016128
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>is_online</code> and\n      <code>is_translated</code> fields are optional in our JSON\n      schema, so no error should be raised if they are not present. The\n      OCaml type is a <code>string option</code> to reflect this,\n      and can be extracted via <code>to_bool_option</code>. In our\n      example JSON, only <code>is_online</code> is present and\n      <code>is_translated</code> will be <code>None</code>.\n    </blockquote>")))
 (idp10008448
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>tags</code> field is similar to\n      <code>title</code>, but the field is a list of strings\n      instead of a single one. Converting this to an OCaml\n      <code>string list</code> is a two stage process. First, we\n      convert the JSON <code>List</code> to an OCaml list of JSON\n      values, and then filter out the <code>String</code> values\n      as an OCaml <code>string list</code>. Remember that OCaml\n      lists must contain values of the same type, so any JSON values\n      that cannot be converted to a <code>string</code> will be\n      skipped from the output of <code>filter_string</code>.\n    </blockquote>")))
 (idp10002880
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>member</code> function accepts a JSON object and\n      named key and returns the JSON field associated with that key, or\n      <code>Null</code>. Since we know that the\n      <code>title</code> value is always a string in our example\n      schema, we want to convert it to an OCaml string. The\n      <code>to_string</code> function performs this conversion,\n      and raises an exception if there is an unexpected JSON type. The\n      <code>|&gt;</code> operator provides a convenient way to\n      chain these operations together.\n    </blockquote>")))
 (idp10000432
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      We'll go through each of these uses one-by-one. Core provides the\n      <code>|&gt;</code> pipe-forward which can chain combinators\n      together, and the example code uses this to select and convert\n      values out of the JSON structure. Let's examine some of them in\n      more detail:\n    </blockquote>")))
 (idp9997280
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>Yojson</code> provides several combinators in the\n      <code>Yojson.Basic.Util</code> module, such as:\n    </blockquote>")))
 (idp9995744
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>iter</code> is a more specialised combinator that is\n      only useful in OCaml due to side-effects being allowed. The input\n      function is applied to every value, but no result is supplied. The\n      function must instead apply some side-effect such as changing a\n      mutable record field or printing to the standard output.\n    </blockquote>")))
 (idp9991216
  ((file handling-json-data.html)
   (html
    "<blockquote>\n<code>map</code> and <code>fold</code> are extremely\n      common combinators that transform an input list by applying a\n      function to each value of the list. The <code>map</code>\n      combinator is simplest, with the resulting list being output\n      directly. <code>fold</code> applies each value in the input\n      list to a function that accumulates a single result, and returns\n      that instead.\n    </blockquote>")))
 (idp9988944
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      You've already run across several of these in the\n      <code>List</code> module:\n    </blockquote>")))
 (idp9987712
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Combinators are a design pattern that crops up quite often in\n      functional programming. John Hughes defines them as &quot;a\n      function which builds program fragments from program\n      fragments&quot;. In a functional language, this generally means\n      higher-order functions that combine other functions to apply\n      useful transformations over values.\n    </blockquote>")))
 (idp9985312
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This code introduces the <code>Yojson.Basic.Util</code>\n      module, which contains <span><em>combinator</em></span> functions\n      that let you easily map a JSON object into a more strongly-typed\n      OCaml value.\n    </blockquote>")))
 (idp9982256
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Build this with the same <code>_tags</code> file as the\n      earlier example, and run <code>ocamlbuild</code> on the new\n      file.\n    </blockquote>")))
 (idp9979296
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Now that we've figured out how to parse the example JSON into an\n      OCaml value, let's manipulate it from OCaml code and extract\n      specific fields.\n    </blockquote>")))
 (idp9975984
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      If you feel like hanging your OCaml interpreter, you can verify\n      what happens with recursive values and structural equality for\n      yourself:\n    </blockquote>")))
 (idp9970880
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      It's quite easy to mix up the use of <code>=</code> and\n      <code>==</code>, so Core disables the <code>==</code>\n      operator and provides the more explicit\n      <code>phys_equal</code> function instead. You'll see a type\n      error if you use <code>==</code> anywhere:\n    </blockquote>")))
 (idp9968512
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>=</code> structural equality operator recursively\n      inspects each field in the two values and tests them individually\n      for equality. In the JSON parsing example, every field will be\n      traversed and checked, and they will check out as equal.\n      Crucially, if your data structure is cyclical (that is, a value\n      recursively points back to another field within the same\n      structure), the <code>=</code> operator will never\n      terminate, and your program will hang! In this situation, you must\n      use the physical equality operator, or write a custom comparison\n      function that breaks the recursion.\n    </blockquote>")))
 (idp9965632
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>==</code> physical equality test will match if two\n      data structures have precisely the same pointer in memory. Two\n      data structures that have identical contents, but are constructed\n      separately, will not match using this operator. In the JSON\n      example, the <code>json1</code> and <code>json2</code>\n      values are not identical and so would fail the physical equality\n      test.\n    </blockquote>")))
 (idp9962160
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      If you come from a C/C++ background, you will probably reflexively\n      use <code>==</code> to test two values for equality. In\n      OCaml, <code>==</code> tests for\n      <span><em>physical</em></span> equality, and <code>=</code>\n      tests for <span><em>structural</em></span> equality.\n    </blockquote>")))
 (idp9956416
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>from_file</code> function accepts an input\n      filename and takes care of opening and closing it for you. It's\n      far more common to use <code>from_string</code> to construct\n      JSON values though, since these strings come in via a network\n      connection (we'll see more of this in\n      <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>) or\n      a database. Finally, the example checks that the two input\n      mechanisms actually resulted in the same OCaml data structure.\n    </blockquote>")))
 (idp9953680
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      You can build this by writing a <code>_tags</code> file to\n      define the package dependencies, and then running\n      <code>ocamlbuild</code>.\n    </blockquote>")))
 (idp9949712
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The <code>in_channel</code> constructor is from the original\n      OCaml standard library, and its use is considered deprecated when\n      using the Core standard library. This leaves us with two ways of\n      parsing the JSON: either from a string or from a file on a\n      filesystem. The next example shows both in action, assuming the\n      JSON record is stored in a file called\n      <code>book.json</code>.\n    </blockquote>")))
 (idp9948064
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The type signature for these functions with the optional elements\n      removed makes their purpose much clearer:\n    </blockquote>")))
 (idp9947280
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      When first reading these interfaces, you can generally ignore the\n      optional arguments (which have the question marks in the type\n      signature), as they will be filled in with sensible values. In the\n      above signature, the optional arguments offer finer control over\n      the memory buffer allocation and error messages from parsing\n      incorrect JSON.\n    </blockquote>")))
 (idp9944064
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Let's parse the earlier JSON example into this type now. The first\n      stop is the <code>Yojson.Basic</code> documentation, where\n      we find these helpful functions:\n    </blockquote>")))
 (idp9943200
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          The type definition uses polymorphic variants and not normal\n          variants. This will become significant later when we extend it\n          with custom extensions to the JSON format.\n        </blockquote>")))
 (idp9941520
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          The definition specifically includes a <code>Null</code>\n          variant for empty fields. OCaml doesn't allow null values by\n          default, so this must be encoded like any other value.\n        </blockquote>")))
 (idp9937744
  ((file handling-json-data.html)
   (html
    "<blockquote>\n          Some of the type definitions are\n          <span><em>recursive</em></span> (that is, one of the algebraic\n          data types includes a reference to the name of the type being\n          defined). Fields such as <code>Assoc</code> can contain\n          references to more JSON fields, and thus precisely describe\n          the underlying JSON data structure. The JSON\n          <code>List</code> can contain fields of different types,\n          unlike the OCaml <code>list</code> whose contents must\n          be uniform.\n        </blockquote>")))
 (idp9936736
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Some interesting properties should leap out at you after reading\n      this definition:\n    </blockquote>")))
 (idp9934384
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The JSON specification has very few data types, and the\n      <code>Yojson.Basic.json</code> type shown below is\n      sufficient to express any valid JSON structure.\n    </blockquote>")))
 (idp9930272
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      See <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a> for installation\n      instructions if you haven't already got OPAM. Once installed, you\n      can open it in the <code>utop</code> toplevel by:\n    </blockquote>")))
 (idp9927888
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      There are several JSON libraries available for OCaml. For this\n      chapter, we've picked the\n      <a href=\"http://mjambon.com/yojson.html\" target=\"_top\"><code>Yojson</code></a>\n      library by Martin Jambon. It's easiest to install via OPAM.\n    </blockquote>")))
 (idp9925152
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      Our first task is to parse the JSON into a more structured OCaml\n      type so that we can use static typing more effectively. When\n      manipulating JSON in Python or Ruby, you might write unit tests to\n      check that you have handled unusual inputs. The OCaml model\n      prefers compile-time static checking as well as unit tests. For\n      example, using pattern matching can warn you if you've not checked\n      that a value can be <code>Null</code> as well as contain an\n      actual value.\n    </blockquote>")))
 (idp9922992
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      This free-form nature of JSON types is both a blessing and a\n      curse. It's very easy to generate JSON values, but code that\n      parses them also has to handle subtle variations in how the values\n      are represented. For example, what if the <code>pages</code>\n      value above is actually represented as a string value of\n      <code>&quot;450&quot;</code> instead of an integer?\n    </blockquote>")))
 (idp9920768
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      The outermost JSON value is usually a record (delimited by the\n      curly braces) and contains an unordered set of key/value pairs.\n      The keys must be strings but values can be any JSON type. In the\n      example above, <code>tags</code> is a string list, while the\n      <code>authors</code> field contains a list of records.\n      Unlike OCaml lists, JSON lists can contain multiple different JSON\n      types within a single list.\n    </blockquote>")))
 (idp9918784
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      JSON consists of two basic structures: an unordered collection of\n      key/value pairs, and an ordered list of values. Values can be\n      strings, booleans, floats, integers or null. Let's see what a JSON\n      record for an example book description looks like:\n    </blockquote>")))
 (idp9917296
  ((file handling-json-data.html)
   (html
    "<blockquote>\n      JSON is a lightweight data-interchange format often used in web\n      services and browsers. It's described in\n      <a href=\"http://www.ietf.org/rfc/rfc4627.txt\" target=\"_top\">RFC4627</a>,\n      and is easier to parse and generate than alternatives such as XML.\n      You'll run into JSON very often when working with modern web APIs,\n      so we'll cover several different ways to manipulate it in this\n      chapter.\n    </blockquote>")))
 (idp9915360
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        Using external tools to generate boilerplate OCaml modules and\n        signatures from external specification files.\n      </blockquote>")))
 (idp9914048
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        The use of <span><em>combinators</em></span> to compose common\n        operations over data structures in a type-safe way.\n      </blockquote>")))
 (idp9913104
  ((file handling-json-data.html)
   (html
    "<blockquote>\n        Using polymorphic variants to write more extensible libraries\n        and protocols (but still retain the ability to extend them if\n        needed)\n      </blockquote>")))
 (idp9911920
  ((file handling-json-data.html)
   (html
    "<blockquote>\n    We'll start by using the popular and simple JSON data format, and\n    then look at other serialization formats later in in the book. This\n    chapter introduces you to a couple of new techniques that glue\n    together the basic ideas from Part I of the book:\n  </blockquote>")))
 (idp9910560
  ((file handling-json-data.html)
   (html
    "<blockquote>\n    Data serialization, <span><em>i.e.</em></span> converting data to and\n    from a sequence of bytes that's suitable for writing to disk or\n    sending across the network, is an important and common programming\n    task. Sometimes you need to match someone else's data format (such\n    as XML), sometimes you need a highly efficient format, and sometimes\n    you just want something that is easy for humans to read and edit. To\n    this end, OCaml comes with several techniques for data serialization\n    depending on what your problem is.\n  </blockquote>")))
 (idp9187152
  ((file functors.html)
   (html
    "<blockquote>\n          Support for so-called monadic libraries, like the ones\n          discussed in <a href=\"error-handling.html\">Chapter\194\1607, <i>Error Handling</i></a> and\n          <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>.\n          Here, the functor is used to provide a collection of standard\n          helper functions based on the core <code>bind</code> and\n          <code>return</code> operators.\n        </blockquote>")))
 (idp9186272
  ((file functors.html)
   (html
    "<blockquote>\n          Adding hash-based data structures like hash sets and hash\n          heaps.\n        </blockquote>")))
 (idp9184672
  ((file functors.html)
   (html
    "<blockquote>\n          Adding comparison-based data structures like maps and sets,\n          based on the <code>Comparable</code> interface.\n        </blockquote>")))
 (idp9183664
  ((file functors.html)
   (html
    "<blockquote>\n      This pattern comes up quite a bit in Core, and is used to for a\n      variety of purposes.\n    </blockquote>")))
 (idp9178128
  ((file functors.html)
   (html
    "<blockquote>\n      In order to apply the functor, we'll put the definition of\n      <code>Fqueue</code> in a sub-module called\n      <code>T</code>, and then call\n      <code>Foldable.Extend</code> on <code>T</code>.\n    </blockquote>")))
 (idp9174912
  ((file functors.html)
   (html
    "<blockquote>\n      Now we can apply this to <code>Fqueue</code>. We can rewrite\n      the interface of <code>Fqueue</code> as follows.\n    </blockquote>")))
 (idp9168320
  ((file functors.html)
   (html
    "<blockquote>\n      We'll create a new module, <code>Foldable</code> that\n      automates the process of adding helper functions to a\n      fold-supporting container. As you can see,\n      <code>Foldable</code> contains a module signature\n      <code>S</code> which defines the signature that is required\n      to support folding; and a functor <code>Extend</code> that\n      allows one to extend any module that matches\n      <code>Foldable.S</code>.\n    </blockquote>")))
 (idp9166512
  ((file functors.html)
   (html
    "<blockquote>\n      As it happens, many of these helper functions can be derived\n      mechanically from just the fold function we already implemented.\n      Rather than write all of these helper functions by hand for every\n      new container type, we can instead use a functor that will let us\n      add this functionality to any container that has a\n      <code>fold</code> function.\n    </blockquote>")))
 (idp9163488
  ((file functors.html)
   (html
    "<blockquote>\n      One problem with our <code>Fqueue</code> is that the\n      interface is quite skeletal. There are lots of useful helper\n      functions that one might want that aren't there. For example, for\n      lists we have <code>List.iter</code> which runs a function\n      on each node; and a <code>List.find</code> that finds the\n      first element on the list that matches a given predicate. Such\n      helper functions come up for pretty much every container type, and\n      implementing them over and over is a bit of a dull and repetitive\n      affair.\n    </blockquote>")))
 (idp9158560
  ((file functors.html)
   (html
    "<blockquote>\n      Now let's implement <code>Fqueue</code>. A standard trick is\n      for the <code>Fqueue</code> to maintain an input and an\n      output list, so that one can efficiently\n      <code>enqueue</code> on the first list, and can efficiently\n      dequeue from the out list. If you attempt to dequeue when the\n      output list is empty, the input list is reversed and becomes the\n      new output list. Here's an implementation that uses that trick.\n    </blockquote>")))
 (idp9156720
  ((file functors.html)
   (html "<blockquote>\n      Here's a reasonable mli\n    </blockquote>")))
 (idp9155904
  ((file functors.html)
   (html
    "<blockquote>\n      Another common use of functors is to generate type-specific\n      functionality for a given module in a standardized way. Let's see\n      how this works in the context of a functional queue, which is just\n      a functional version of a FIFO (first-in, first-out) queue. Being\n      functional, operations on the queue return new queues, rather than\n      modifying the queues that were passed in.\n    </blockquote>")))
 (idp9152864
  ((file functors.html)
   (html
    "<blockquote>\n        And now, we can use that sexp-converter in the ordinary way:\n      </blockquote>")))
 (idp9149920
  ((file functors.html)
   (html
    "<blockquote>\n        Also note that we have been careful to override the\n        sexp-converter here to ensure that the data structures\n        invariants are still maintained when reading in from an\n        s-expression.\n      </blockquote>")))
 (idp9147104
  ((file functors.html)
   (html
    "<blockquote>\n        We can modify <code>Make_interval</code> to use the\n        <code>Sexpable</code> interface, for both its input and\n        its output. Note the use of destructive substitution to combine\n        multiple signatures together. This is important because it stops\n        the <code>type t</code>'s from the different signatures\n        from interfering with each other.\n      </blockquote>")))
 (idp9144784
  ((file functors.html)
   (html
    "<blockquote>\n        Happily, Core comes with a built in interface for just this\n        purpose called <code>Sexpable</code>, which is defined as\n        follows:\n      </blockquote>")))
 (idp9140528
  ((file functors.html)
   (html
    "<blockquote>\n        The problem is that <code>with sexp</code> adds code for\n        defining the s-expression converters, and that code assumes that\n        <code>Endpoint</code> has the appropriate sexp-conversion\n        functions for <code>Endpoint.t</code>. But all we know\n        about <code>Endpoint</code> is that it satisfies the\n        <code>Comparable</code> interface, which doesn't say\n        anything about s-expressions.\n      </blockquote>")))
 (idp9136432
  ((file functors.html)
   (html
    "<blockquote>\n        Another feature that we might want for our interval module is\n        the ability to serialize the type, in particular, by converting\n        to s-expressions. If we simply invoke the\n        <code>sexplib</code> macros by adding\n        <code>with sexp</code> to the definition of\n        <code>t</code>, though, we'll get an error:\n      </blockquote>")))
 (idp9131408
  ((file functors.html)
   (html
    "<blockquote>\n        The interface is precisely what we want, and we didn't need to\n        define the <code>endpoint</code> type alias in the body of\n        the module. If we instantiate this module, we'll see that it\n        works properly: we can construct new intervals, but\n        <code>t</code> is abstract, and so we can't directly\n        access the constructors and violate the invariants of the data\n        structure.\n      </blockquote>")))
 (idp9127968
  ((file functors.html)
   (html
    "<blockquote>\n        There's now no mention of n <code>endpoint</code>, all\n        occurrences of that type having been replaced by\n        <code>int</code>. As with sharing constraints, we can also\n        use this in the context of a functor.\n      </blockquote>")))
 (idp9125472
  ((file functors.html)
   (html
    "<blockquote>\n        Here's an example of what we get if we use destructive\n        substitution to specialize the <code>Interval_intf</code>\n        interface to integer intervals.\n      </blockquote>")))
 (idp9124288
  ((file functors.html)
   (html
    "<blockquote>\n        The following shows how we could use this with\n        <code>Make_interval</code>.\n      </blockquote>")))
 (idp9118432
  ((file functors.html)
   (html
    "<blockquote>\n        Sharing constraints basically do the job, but they have some\n        downsides. In particular, we've now been stuck with the useless\n        type declaration of <code>endpoint</code> that clutters up\n        both the interface and the implementation. A better solution\n        would be to modify the <code>Interval_intf</code>\n        signature by replacing <code>endpoint</code> with\n        <code>Endpoint.t</code> everywhere it shows up, and\n        deleting the definition of <code>endpoint</code> from the\n        signature. We can do just this using what's called\n        <span><em>destructive substitution</em></span>. Here's the basic\n        syntax.\n      </blockquote>")))
 (idp9114016
  ((file functors.html)
   (html
    "<blockquote>\n        So now, the interface is as it was, except that\n        <code>endpoint</code> is now known to be equal to\n        <code>Endpoint.t</code>. As a result of that type\n        equality, we can now do things like construct intervals again.\n      </blockquote>")))
 (idp9110336
  ((file functors.html)
   (html
    "<blockquote>\n        And we can also use it in the context of a functor, where the\n        right-hand side of the sharing constraint is an element of the\n        functor argument. Thus, we expose an equality between a type in\n        the output of the functor (in this case, the type\n        <code>endpoint</code>) and a type in its input\n        (<code>Endpoint.t</code>).\n      </blockquote>")))
 (idp9102864
  ((file functors.html)
   (html
    "<blockquote>\n        where <code>S</code> is a module type,\n        <code>s</code> is a type inside of <code>S</code>,\n        and <code>t</code> is a type defined outside of\n        <code>S</code>. The result of this expression is a new\n        signature that's been modified so that it exposes the fact that\n        <code>s</code> is equal to <code>t</code>. We can\n        use a sharing constraint to create a specialized version of\n        <code>Interval_intf</code> for integer intervals.\n      </blockquote>")))
 (idp9097824
  ((file functors.html)
   (html
    "<blockquote>\n        To fix this, we need to expose the fact that\n        <code>endpoint</code> is equal to <code>Int.t</code>\n        (or more generally, <code>Endpoint.t</code>, where\n        <code>Endpoint</code> is the argument to the functor). One\n        way of doing this is through a <span><em>sharing\n        constraint</em></span>, which allows you to tell the compiler to\n        expose the fact that a given type is equal to some other type.\n        The syntax for a sharing constraint on a module type is as\n        follows.\n      </blockquote>")))
 (idp9095264
  ((file functors.html)
   (html
    "<blockquote>\n        The resulting module is abstract, but unfortunately, it's too\n        abstract. In particular, we haven't exposed the type\n        <code>endpoint</code>, which means that we can't even\n        construct an interval anymore.\n      </blockquote>")))
 (idp9088992
  ((file functors.html)
   (html
    "<blockquote>\n        This interface includes the type <code>endpoint</code> to\n        represent the type of the endpoints of the interval. Given this\n        interface, we can redo our definition of\n        <code>Make_interval</code>. Notice that we added the type\n        <code>endpoint</code> to the implementation of the module\n        to make the implementation match\n        <code>Interval_intf</code>.\n      </blockquote>")))
 (idp9085648
  ((file functors.html)
   (html
    "<blockquote>\n        To make <code>Int_interval.t</code> abstract, we need to\n        apply an interface to the output of the\n        <code>Make_interval</code>. Here's an explicit interface\n        that we can use for that purpose.\n      </blockquote>")))
 (idp9081648
  ((file functors.html)
   (html
    "<blockquote>\n        There's a problem with <code>Make_interval</code>. The\n        code we wrote depends on the invariant that the upper bound of\n        an interval is greater than its lower bound, but that invariant\n        can be violated. The invariant is enforced by the create\n        function, but because <code>Interval.t</code> is not\n        abstract, we can bypass the <code>create</code> function.\n      </blockquote>")))
 (idp9079888
  ((file functors.html)
   (html
    "<blockquote>\n      This is important, because confusing the two kinds of intervals\n      would be a semantic error, and it's an easy one to make. The\n      ability of functors to mint new types is a useful trick that comes\n      up a lot.\n    </blockquote>")))
 (idp9076672
  ((file functors.html)
   (html
    "<blockquote>\n      Importantly, <code>Rev_int_interval.t</code> is a different\n      type than <code>Int_interval.t</code>, even though its\n      physical representation is the same. Indeed, the type system will\n      prevent us from confusing them.\n    </blockquote>")))
 (idp9073616
  ((file functors.html)
   (html
    "<blockquote>\n      The behavior of <code>Rev_int_interval</code> is of course\n      different from <code>Int_interval</code>, as we can see\n      below.\n    </blockquote>")))
 (idp9071904
  ((file functors.html)
   (html
    "<blockquote>\n      This design gives us the freedom to use any comparison function we\n      want for comparing the endpoints. We could, for example, create a\n      type of int interval with the order of the comparison reversed, as\n      follows:\n    </blockquote>")))
 (idp9069488
  ((file functors.html)
   (html
    "<blockquote>\n      Now we can use the newly defined <code>Int_interval</code>\n      module like any ordinary module.\n    </blockquote>")))
 (idp9066656
  ((file functors.html)
   (html
    "<blockquote>\n      This works because many modules in Core, including\n      <code>Int</code> and <code>String</code>, satisfy an\n      extended version of the <code>Comparable</code> signature\n      described above. Standardized signatures are generally good\n      practice, both because they makes functors easier to use, and\n      because they make the codebase generally easier to navigate.\n    </blockquote>")))
 (idp9063568
  ((file functors.html)
   (html
    "<blockquote>\n      When we choose our interfaces that are aligned with the standards\n      of our libraries, we don't need to construct a custom module to\n      feed to the functor. In this case, for example, we can directly\n      use the <code>Int</code> or <code>String</code>\n      modules provided by Core.\n    </blockquote>")))
 (idp9061632
  ((file functors.html)
   (html
    "<blockquote>\n      We can instantiate the functor by applying it to a module with the\n      right signature. In the following, we provide the functor input as\n      an anonymous module.\n    </blockquote>")))
 (idp9055408
  ((file functors.html)
   (html
    "<blockquote>\n      The functor for creating the interval module is shown below. We\n      represent an interval with a variant type, which is either\n      <code>Empty</code> or <code>Interval (x,y)</code>,\n      where <code>x</code> and <code>y</code> are the bounds\n      of the interval.\n    </blockquote>")))
 (idp9052160
  ((file functors.html)
   (html
    "<blockquote>\n      The comparison function follows the standard OCaml idiom for such\n      functions, returning <code>0</code> if the two elements are\n      equal, a positive number if the first element is larger than the\n      second, and a negative number if the first element is smaller than\n      the second. Thus, we could rewrite the standard comparison\n      functions on top of <code>compare</code> as shown below.\n    </blockquote>")))
 (idp9049456
  ((file functors.html)
   (html
    "<blockquote>\n      First we'll define a module type that captures the information\n      we'll need about the endpoint type. This interface, which we'll\n      call <code>Comparable</code>, contains just two things: a\n      comparison function, and the type of the values to be compared.\n    </blockquote>")))
 (idp9048800
  ((file functors.html)
   (html
    "<blockquote>\n      Let's now consider a more realistic example of how to use\n      functors: a library for computing with intervals. This library\n      will be functorized over the type of the endpoints of the\n      intervals and the ordering of those endpoints.\n    </blockquote>")))
 (idp9041008
  ((file functors.html)
   (html
    "<blockquote>\n      In this case, we applied <code>Increment</code> to a module\n      whose signature is exactly equal to <code>X_int</code>. But\n      we can apply <code>Increment</code> to any module that\n      satisfies the interface <code>X_int</code>, in the same way\n      that a the contents of an <code>ml</code> file can satisfy\n      the <code>mli</code>. That means that the module type can\n      omit some information available in the module, either by dropping\n      fields or by leaving some fields abstract. Here's an example:\n    </blockquote>")))
 (idp9038736
  ((file functors.html)
   (html
    "<blockquote>\n      We can now use <code>Increment</code> to define new modules.\n    </blockquote>")))
 (idp9037456
  ((file functors.html)
   (html
    "<blockquote>\n      We can see that the inferred module type of the output is now\n      written out explicitly, rather than being a reference to the named\n      signature <code>X_int</code>.\n    </blockquote>")))
 (idp9035776
  ((file functors.html)
   (html
    "<blockquote>\n      The following shows what happens when we omit the module type for\n      the output of the functor.\n    </blockquote>")))
 (idp9034192
  ((file functors.html)
   (html
    "<blockquote>\n      One thing that immediately jumps out about functors is that\n      they're considerably more heavyweight syntactically than ordinary\n      functions. For one thing, functors require explicit (module) type\n      annotations, which ordinary functions do not. Here, we've\n      specified the module type <code>X_int</code> for both the\n      input and output of the functor. Technically, only the type on the\n      input is mandatory, although in practice, one often specifies\n      both.\n    </blockquote>")))
 (idp9030928
  ((file functors.html)
   (html
    "<blockquote>\n      More precisely, we'll create a functor that takes a module\n      containing a single integer variable <code>x</code>, and\n      returns a new module with <code>x</code> incremented by one.\n    </blockquote>")))
 (idp9030416
  ((file functors.html)
   (html
    "<blockquote>\n      We'll start by considering the simplest possible example: a\n      functor for incrementing an integer.\n    </blockquote>")))
 (idp9027936
  ((file functors.html)
   (html
    "<blockquote>\n<span><em>Instantiating modules with state</em></span>. Modules\n        can contain mutable state, and that means that you'll\n        occasionally want to have multiple instantiations of a\n        particular module, each with its own separate and independent\n        mutable state. Functors let you automate the construction of\n        such modules.\n      </blockquote>")))
 (idp9026224
  ((file functors.html)
   (html
    "<blockquote>\n<span><em>Auto-extension of modules</em></span>. Sometimes, there\n        is some functionality that you want to build in a standard way\n        for different types, in each case based on a some piece of\n        type-specific logic. For example, you might want to add a slew\n        of comparison operators derived from a base comparison function.\n        To do this by hand would require a lot of repetitive code for\n        each type, but functors let you write this logic just once and\n        apply it to many different types.\n      </blockquote>")))
 (idp9024816
  ((file functors.html)
   (html
    "<blockquote>\n<span><em>Dependency injection</em></span>, or making the\n        implementations of some components of a system swappable. This\n        is particularly useful when you want to mock up parts of your\n        system for testing and simulation purposes.\n      </blockquote>")))
 (idp9023744
  ((file functors.html)
   (html
    "<blockquote>\n    Functors are, roughly speaking, functions from modules to modules,\n    and they can be used to solve a variety of code-structuring\n    problems, including:\n  </blockquote>")))
 (idp9022960
  ((file functors.html)
   (html
    "<blockquote>\n    Up until now, we've seen OCaml's module system play an important but\n    limited role. In particular, we've seen them as a mechanism for\n    organizing code into units with specified interfaces. But modules\n    can do much more than that, acting as a powerful toolset for\n    building generic code and structuring large-scale systems. Much of\n    that power comes from functors.\n  </blockquote>")))
 (idp11074480
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      TODO: the fts(3) interface.\n    </blockquote>")))
 (idp11071024
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        Unions in C are a collection of named structures that can be\n        mapped onto the same memory. They are also supported in the\n        <code>ctypes</code> library via the\n        <code>Ffi.C.Union</code> module, although we won't go into\n        more detail here.\n      </blockquote>")))
 (idp11063776
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        The <code>Ptr.allocate</code> function allocates memory\n        via <code>malloc</code> and creates an OCaml value to\n        point to it. This OCaml value (<code>timep</code> in the\n        example) has a finalizer function which frees the external\n        memory when it is garbage collected. The\n        <code>timep</code> pointer is passed into the\n        <code>time</code> library call, which modifies it\n        in-place. The <code>timep</code> pointer is then passed on\n        to <code>localtime</code>, whose return value is converted\n        into an OCaml string via <code>asctime</code>. The garbage\n        collector can then collect <code>timep</code> during the\n        next collection cycle.\n      </blockquote>")))
 (idp11059840
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        Unlike the ncurses example, some of the FFI types are still\n        exposed in this signature due to the manual memory interface\n        required by the C libraries. To use the OCaml\n        <code>time</code> and <code>localtime</code>\n        functions, we need to allocate some memory and construct values\n        of type <code>time_t ptr</code> to them.\n      </blockquote>")))
 (idp11057584
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        The complete signature for this definition looks like this:\n      </blockquote>")))
 (idp11050528
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        This is a very mechanical translation from the C structure, due\n        to the magic of the <code>*:*</code> combinator provided\n        by the <code>Struct</code> module. We start building the\n        definition via the <code>structure</code> allocator. Then\n        the types are added in sequence, with each application recording\n        the position in the <code>tm</code> structure. When all\n        the fields have been added, the structure is finalized via the\n        <code>seals</code> call. The definitions of\n        <code>time</code> and <code>localtime</code> should\n        now be familiar:\n      </blockquote>")))
 (idp11045712
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        The <code>time_t</code>, and most other standard POSIX\n        types, are already provided by the\n        <code>Ffi.PosixTypes</code> module. Let's start by\n        defining the OCaml mapping to <code>struct tm</code>:\n      </blockquote>")))
 (idp11041440
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        This example is more complicated than ncurses for a couple of\n        reasons. We need to allocate some memory to store a\n        <code>time_t</code> value, and pass that memory into the\n        <code>time</code> library call to obtain the current\n        timezone. This <code>time_t</code> is then passed to the\n        <code>localtime</code> library call, which returns a\n        pointer to the <code>struct tm</code>.\n      </blockquote>")))
 (idp11037168
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        The UNIX standard C library defines several useful time and date\n        functions in <code>&lt;time.h&gt;</code> (usually found in\n        <code>/usr/include</code> on a Linux or MacOS X system).\n        The <code>localtime</code> function has the following\n        signature and return value:\n      </blockquote>")))
 (idp11034432
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        Structures in C can contain a mixture of types, and, like OCaml\n        records, their order is significant. The\n        <code>Ffi.C.Type.Struct</code> module defines combinators\n        to make this as easy as arrays and basic types. Let's start with\n        an example by binding some time-related UNIX functions.\n      </blockquote>")))
 (idp11032160
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        The array functions are similar to the standard library\n        <code>Array</code> module. The conversion between arrays\n        and lists involves reallocating the values, and can be expensive\n        for very large data structures. Notice that you can also convert\n        an array into a <code>ptr</code> pointer to the head of\n        buffer, which can be useful if you need to pass the pointer and\n        size arguments separately to a C function.\n      </blockquote>")))
 (idp11029280
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n        Arrays in C are contiguous blocks of the same value. Any of the\n        basic types defined earlier can be allocated as blocks via the\n        <code>Ffi.C.Type.Array</code> module.\n      </blockquote>")))
 (idp11024528
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      Sequences of <code>'a typ</code> values are constructed by\n      using the <code>@-&gt;</code> and\n      <code>returning</code> functions. You can even exchange\n      function pointers between OCaml and C by wrapping the OCaml\n      callback using <code>funptr</code>. The library takes care\n      of the garbage collector interface to ensure that the OCaml value\n      isn't moved around while the C library is holding a reference to\n      the value.\n    </blockquote>")))
 (idp11020416
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      Strings in C are null-terminator character arrays, whereas OCaml\n      strings have a fixed-length and can contain null values. The\n      <code>string</code> mapping safely copies between these two\n      strings. if you need an abstract C type (for example, from a\n      forward declaration of a <code>struct</code>), then just\n      define an <code>abstract t</code>. Arrays and pointers can\n      be built out of primitive types by using the corresponding\n      constructor functions.\n    </blockquote>")))
 (idp11018768
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The module also defines some more advanced C types\n    </blockquote>")))
 (idp11011632
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      These functions all return an <code>'a typ</code>, where the\n      <code>'a</code> component is the OCaml representation of the\n      C type. For example, OCaml only supports double-precision floating\n      point numbers, and so both of the C <code>float</code> and\n      <code>double</code> functions map to the OCaml\n      <code>float</code> type. The <code>Ffi.Unsigned</code>\n      and <code>Ffi.Signed</code> modules provide some optimized\n      implementations of specific C types, such as\n      <code>llong</code> (for <code>long long</code> 64-bit\n      values).\n    </blockquote>")))
 (idp11008400
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>Ffi.C.Type</code> module defines constructors for\n      the familiar C basic types and lets you build\n      <code>'a typ</code> values.\n    </blockquote>")))
 (idp11004464
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>Ctypes</code> library provides an\n      <code>FFi.C</code> module that lets you describe not only\n      basic C types, but also more complex structures and unions. It\n      defines abstract OCaml types for all of these in\n      <code>FFi.C</code>:\n    </blockquote>")))
 (idp10999888
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      Running <code>./hello</code> should now display a Hello\n      World in your terminal with a box around the &quot;World&quot;.\n      Notice that the compilation line includes\n      <code>-cclib -lncurses</code>. This tells the OCaml compiler\n      to link the output binary to the ncurses library, which in turns\n      makes the symbols available to the program when it starts. If you\n      omit that line, you'll get an error when you try to run the\n      binary:\n    </blockquote>")))
 (idp10998640
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      This code can be compiled by:\n    </blockquote>")))
 (idp10994880
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      Notice that the <code>window</code> type is left abstract to\n      external users, so that it can only be constructed via\n      <code>Ncurses.initscr</code>. This interface is now safe to\n      use in example code. Here's what an ncurses hello world looks\n      like:\n    </blockquote>")))
 (idp10991120
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      These function calls all have different arguments, but the basic C\n      types are provided by the <code>Ffi.C</code> module and can\n      be directly used. The module signature for\n      <code>ncurses.mli</code> looks much like a normal OCaml\n      signature:\n    </blockquote>")))
 (idp10984864
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>foreign</code> function takes two parameters: the\n      C function call name, and a definition of the arguments and return\n      type. The definition is built up using the combinators defined in\n      <code>Ctypes.Ffi.C</code>. The <code>@-&gt;</code>\n      operator adds an argument to the parameter list, and the\n      <code>returning</code> function declares the return value.\n      The remainder of the <code>Ncurses</code> implementation\n      expands on these definitions for the other library functions.\n    </blockquote>")))
 (idp10976592
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>window</code> type is declared as a\n      <code>void</code> pointer. We also need a value to pass to\n      the <code>ctypes</code> library to represent this type, and\n      so the <code>window</code> value is built using the\n      <code>Ctypes.Ffi.C.ptr</code> function. The actual pointer\n      type from C is a <code>WINDOW</code> and not\n      <code>void</code>, but we'll show you shortly how we can\n      hide the details of the <code>window</code> type in the\n      OCaml module signature. The next step is to use these values to\n      build a foreign function call to <code>initscr</code>.\n    </blockquote>")))
 (idp10973424
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>ctypes</code> library provides an OCaml interface\n      that lets you declare these C functions as OCaml values. The\n      library takes care of converting the OCaml arguments into the C\n      calling convention, invoking the foreign call within the\n      <code>ncurses</code> library, and finally returning the\n      result as an OCaml value.\n    </blockquote>")))
 (idp10967408
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      The <code>WINDOW</code> typedef is a forward declaration of\n      a C structure that holds the internal ncurses library state. The\n      specific contents of the structure don't matter, as you need to\n      pass pointers to the structure to the various library calls. The\n      <code>initscr</code> function initialises this library state\n      and returns it as a <code>WINDOW</code> pointer, and the\n      <code>newwin</code> function allows further sub-windows to\n      be created. This pointer is passed to various terminal drawing\n      functions such as <code>mvwaddrstr</code>. The terminal is\n      only updated when <code>refresh</code> or\n      <code>wrefresh</code> are called, and all other drawing\n      calls just manipulate data structures without taking effect on the\n      screen.\n    </blockquote>")))
 (idp10964160
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      Ncurses is a library to build terminal-independent text interfaces\n      in a reasonably efficient way. The manual page (usually via\n      <code>man ncurses</code>) explains the basics of the C\n      interface. Below is an excerpt of the header interface found in\n      <code>&lt;ncurses.h</code>&gt;.\n    </blockquote>")))
 (idp10961520
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      It will then be available via the <code>ctypes</code>\n      ocamlfind package.\n    </blockquote>")))
 (idp10959472
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      TODO <code>ctypes</code> is not yet available on OPAM, but\n      will be soon. For now, install it manually:\n    </blockquote>")))
 (idp10955856
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n      We'll introduce the foreign function interface via the simplest\n      method, which doesn't require writing any C code. The\n      <code>ctypes</code> library lets you describe the C\n      interface in pure OCaml, and it takes care of opening the foreign\n      library and invoking the correct function calls . We'll use the\n      <code>ncurses</code> terminal-drawing toolkit as our firts\n      example, as it's widely available on most systems.\n    </blockquote>")))
 (idp10953488
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n    This chapter walks you through the basics interfacing with C\n    libraries, and then moves onto how to embed your code for a variety\n    of other platforms.\n  </blockquote>")))
 (idp10952688
  ((file foreign-function-interface.html)
   (html
    "<blockquote>\n    OCaml has several options available to interact with non-OCaml code.\n    The compiler toolchain can link to external system libraries, and\n    also produce standalone object code. This object code can be turned\n    into shared libraries that that let your OCaml code be called from\n    C, or linked in more exotic ways to embed it directly into\n    applications or even kernel modules.\n  </blockquote>")))
 (idp10803136
  ((file first-class-modules.html)
   (html
    "<blockquote>This chapter is under construction and not yet ready for public review, and so omitted from this milestone. This chaper is present as a placeholder so that cross-references from other chapters resolve correctly in the print version.</blockquote>")))
 (idp7932064
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        In this case, <code>ocamlbuild</code> will notice the\n        error and complain:\n      </blockquote>")))
 (idp7929616
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        The problem manifests in a different way if we create circular\n        references between files. We could create such a situation by\n        adding a reference to Freq from <code>counter.ml</code>,\n        <span><em>e.g.</em></span>, by adding the following line:\n      </blockquote>")))
 (idp7928240
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        then when we try to build, we'll get this error:\n      </blockquote>")))
 (idp7925504
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        The simplest case of this is that a module can not directly\n        refer to itself (although definitions within a module can refer\n        to each other in the ordinary way). So, if we tried to add a\n        reference to <code>Counter</code> from within\n        <code>counter.ml</code>:\n      </blockquote>")))
 (idp7924800
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        The same is true at the module level. By default, circular\n        dependencies between modules are not allowed, and indeed,\n        circular dependencies among files are never allowed. Recursive\n        modules are possible, but are a rare case and we won't discuss\n        them further here.\n      </blockquote>")))
 (idp7920672
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        In most cases, OCaml doesn't allow circular dependencies,\n        <span><em>i.e.</em></span>, a collection of definitions that all\n        refer to each other. If you want to create such definitions, you\n        typically have to mark them specially. For example, when\n        defining a set of mutually recursive values (like the definition\n        of <code>is_even</code> and <code>is_odd</code> in\n        <a href=\"variables-and-functions.html#recursive-functions\">the section called \226\128\156Recursive functions\226\128\157</a>), you need to\n        define them using <code>let rec</code> rather than\n        ordinary <code>let</code>.\n      </blockquote>")))
 (idp7919024
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        Order is similarly important in other parts of the signature,\n        including the order in which record fields are declared and the\n        order of arguments (including labeled and optional arguments) to\n        a function.\n      </blockquote>")))
 (idp7917072
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        will lead to a compilation error:\n      </blockquote>")))
 (idp7912912
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        Type definitions that show up in an <code>mli</code> need\n        to match up with corresponding definitions in the\n        <code>ml</code>. Consider again the example of the type\n        <code>median</code>. The order of the declaration of\n        variants matters to the OCaml compiler, so the definition of\n        <code>median</code> in the implementation listing those\n        options in a different order:\n      </blockquote>")))
 (idp7911440
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        A missing type definition will lead to a similar error.\n      </blockquote>")))
 (idp7909856
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        Now, if we try to compile without actually adding the\n        implementation, we'll get this error:\n      </blockquote>")))
 (idp7907184
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        We might decide that we want a new function in\n        <code>Counter</code> for pulling out the frequency count\n        of a given string. We can update the <code>mli</code> by\n        adding the following line.\n      </blockquote>")))
 (idp7905568
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        There's no denying that learning to decode such error messages\n        is difficult at first, and takes some getting used to. But in\n        time, decoding these errors becomes second nature.\n      </blockquote>")))
 (idp7902896
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        This error message is a bit intimidating at first, and it takes\n        a bit of thought to see why the first type for touch (which\n        comes from the implementation) doesn't match the second one\n        (which comes from the interface). The key thing to remember is\n        that <code>t</code> is a\n        <code>Core.Std.Map.t</code>, at which point you can see\n        that the error is a mismatch in the order of arguments to\n        <code>touch</code>.\n      </blockquote>")))
 (idp7899344
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        and then try to compile <code>Counter</code> (by writing\n        <code>ocamlbuild -use-ocamlfind counter.cmo</code>. The\n        <code>cmo</code> file is a compiled object file,\n        containing the bytecode-compiled version of a module), we'll get\n        the following error:\n      </blockquote>")))
 (idp7896544
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n        The simplest kind of error is where the type specified in the\n        signature does not match up with the type in the implementation\n        of the module. As an example, if we replace the\n        <code>val</code> declaration in\n        <code>counter.mli</code> by swapping the types of the\n        first two arguments:\n      </blockquote>")))
 (idp7893888
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      When OCaml compiles a program with an <code>ml</code> and an\n      <code>mli</code>, it will complain if it detects a mismatch\n      between the two. Here are some of the common errors you'll run\n      into.\n    </blockquote>")))
 (idp7889920
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      And if we then put <code>open Common</code> after\n      <code>open Core.Std</code> at the top of each file in our\n      project, then references to <code>List</code> will\n      automatically go to <code>Ext_list</code> instead.\n    </blockquote>")))
 (idp7886096
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      And we can now use <code>Ext_list</code> as a replacement\n      for <code>List</code>. If we want to use\n      <code>Ext_list</code> in preference to\n      <code>List</code> in our project, we can create a file of\n      common definitions:\n    </blockquote>")))
 (idp7881664
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that the order of declarations in the <code>mli</code>\n      does not need to match the order of declarations in the\n      <code>ml</code>. Also, the order of declarations in the\n      <code>ml</code> is quite important in that it determines\n      what values are shadowed. If we wanted to replace a function in\n      <code>List</code> with a new function of the same name, the\n      declaration of that function in the <code>ml</code> would\n      have to come after the <code>include List</code>\n      declaration.\n    </blockquote>")))
 (idp7878352
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Now, what about the interface of this new module? It turns out\n      that include works on the signature language as well, so we can\n      pull essentially the same trick to write an <code>mli</code>\n      for this new module. The only trick is that we need to get our\n      hands on the signature for the list module, which can be done\n      using <code>module type of</code>.\n    </blockquote>")))
 (idp7875248
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      To consider a more realistic example, imagine you wanted to build\n      an extended version of the <code>List</code> module, where\n      you've added some functionality not present in the module as\n      distributed in Core. <code>include</code> allows us to do\n      just that.\n    </blockquote>")))
 (idp7871344
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The difference between <code>include</code> and\n      <code>open</code> is that we've done more than change how\n      identifiers are searched for: we've changed what's in the module.\n      If we'd used <code>open</code>, we'd have gotten a quite\n      different result.\n    </blockquote>")))
 (idp7868032
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can use the <code>include</code> directive to create a\n      new, extended version of the <code>Interval</code> module.\n    </blockquote>")))
 (idp7865328
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      While opening a module affects the environment used to search for\n      identifiers, <span><em>including</em></span> a module is a way of\n      actually adding new identifiers to a module proper. Consider the\n      following simple module for representing a range of intervals.\n    </blockquote>")))
 (idp7862176
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          Because the module name <code>C</code> only exists for a\n          short scope, it's easy to read and remember what\n          <code>C</code> stands for. Rebinding modules to very\n          short names at the toplevel of your module is usually a\n          mistake.\n        </blockquote>")))
 (idp7860464
  ((file files-modules-and-programs.html)
   (html "<blockquote>\n          you could write:\n        </blockquote>")))
 (idp7858624
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          An alternative to local opens that makes your code terser\n          without giving up on explicitness is to locally rebind the\n          name of a module. So, instead of writing:\n        </blockquote>")))
 (idp7856832
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          There's another even more lightweight syntax for local opens,\n          which is particularly useful for small expressions:\n        </blockquote>")))
 (idp7855200
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          In the above, <code>of_int</code> and the infix\n          operators are the ones from <code>Int64</code> module.\n        </blockquote>")))
 (idp7853296
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          If you do need to do an open, it's better to do a\n          <span><em>local open</em></span>. There are two syntaxes for\n          local opens. For example, you can write:\n        </blockquote>")))
 (idp7851056
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n          Opening modules at the toplevel of a module should be done\n          quite sparingly, and generally only with modules that have\n          been specifically designed to be opened, like\n          <code>Core.Std</code> or\n          <code>Option.Monad_infix</code>.\n        </blockquote>")))
 (idp7850080
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Here's some general advice on how to deal with opens.\n    </blockquote>")))
 (idp7848672
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n<code>open</code> is essential when you want to modify your\n      environment for a standard library like Core, but it's generally\n      good style to keep opening of modules to a minimum. Opening a\n      module is basically a tradeoff between terseness and explicitness\n      --- the more modules you open, the harder it is to look at an\n      identifier and figure out where it's defined.\n    </blockquote>")))
 (idp7845760
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We've already seen the <code>open</code> statement in use in\n      the <code>open Core.Std</code> statements at the top of each\n      source file. Opening a module adds its contents to the environment\n      that the compiler looks in for finding identifiers. Here's a\n      trivial example that gives you a sense of how this works.\n    </blockquote>")))
 (idp7842176
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      So far, we've been referring to values and types within a module\n      by using the module name as an explicit qualifier.\n      <span><em>e.g.</em></span>, we write <code>List.map</code> to\n      refer to the <code>map</code> function in the\n      <code>List</code> module Sometimes, though, you want to be\n      able to refer to the contents of a module without that kind of\n      explicit qualification. This is what the <code>open</code>\n      statement is for.\n    </blockquote>")))
 (idp7841168
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We've used OCaml's <code>open</code> statement many times\n      already in the `open\n    </blockquote>")))
 (idp7839376
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      One useful primitive in OCaml's module language is the\n      <code>open</code> statement. We've seen that already in the\n      <code>open Core.Std</code> that has been at the top of our\n      source files.\n    </blockquote>")))
 (idp7835216
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can also combine this with the use of the include statement to\n      add some extra functionality to such a module. Thus, we could have\n      rewritten the definition of <code>Hostname</code> above as\n      follows to add a function <code>Hostname.mine</code> that\n      returns the hostname of the present machine.\n    </blockquote>")))
 (idp7833648
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The above code has a fairly obvious bug, and indeed, the compiler\n      will refuse to compile it, spitting out the following error.\n    </blockquote>")))
 (idp7830448
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We could have written this slightly differently, by giving the\n      signature its own toplevel <code>module type</code>\n      declaration, making it possible to create multiple distinct types\n      with the same underlying implementation in a lightweight way.\n    </blockquote>")))
 (idp7829040
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The basic structure of a module declaration like this is:\n    </blockquote>")))
 (idp7827152
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that the <code>to_string</code> and\n      <code>of_string</code> functions above are implemented\n      simply as the identity function, which means they have no runtime\n      effect. They are there purely as part of the discipline that they\n      enforce on the code through the type system.\n    </blockquote>")))
 (idp7825296
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Here's how you might create such an abstract type, within a\n      sub-module:\n    </blockquote>")))
 (idp7824528
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      A better approach is to mint new abstract types for each\n      identifier, where those types are under the covers just\n      implemented as strings. That way, the type system will prevent you\n      from confusing a username with a hostname, and if you do need to\n      convert, you can do so using explicit conversions to and from the\n      string type.\n    </blockquote>")))
 (idp7823072
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Up until now, we've only considered modules that correspond to\n      files, like <code>counter.ml</code>. But modules (and module\n      signatures) can be nested inside other modules. As a simple\n      example, consider a program that needs to deal with multiple\n      identifier like usernames and hostnames. If you just represent\n      these as strings, then it becomes easy to confuse one with the\n      other.\n    </blockquote>")))
 (idp7821216
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The decision of whether a given type should be abstract or\n      concrete is an important one. Abstract types give you more control\n      over how values are created and accessed, and make it easier to\n      enforce invariants beyond what is enforced by the type itself;\n      concrete types let you expose more detail and structure to client\n      code in a lightweight way. The right choice depends very much on\n      the context.\n    </blockquote>")))
 (idp7818160
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Now, to expose this usefully in the interface, we need to expose\n      both the function and the type <code>median</code> with its\n      definition. Note that values (of which functions are an example)\n      and types have distinct namespaces, so there's no name clash here.\n      The following two lines added to <code>freq.mli</code> does\n      the trick.\n    </blockquote>")))
 (idp7814768
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      For example, imagine we wanted to add a function to\n      <code>Counter</code> for returning the line with the median\n      frequency count. If the number of lines is even, then there is no\n      precise median and the function would return the lines before and\n      after the median instead. We'll use a custom type to represent the\n      fact that there are two possible return values. Here's a possible\n      implementation.\n    </blockquote>")))
 (idp7812448
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      In our frequency-count example, the module\n      <code>Counter</code> had an abstract type\n      <code>Counter.t</code> for representing a collection of\n      frequency counts. Sometimes, you'll want to make a type in your\n      interface <span><em>concrete</em></span>, by including the type\n      definition in the interface.\n    </blockquote>")))
 (idp7807824
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that in the above we use <code>String.Map</code> in\n      some places and simply <code>Map</code> in others. This has\n      to do with the fact that for some operations, like creating a\n      <code>Map.t</code>, you need access to type-specialized\n      information, and for others, like looking something up in\n      <code>Map.t</code>, you don't. This is covered in more\n      detail in <a href=\"maps-and-hashtables.html\">Chapter\194\16012, <i>Maps and Hashtables</i></a>.\n    </blockquote>")))
 (idp7804704
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Now we can turn to optimizing the implementation of\n      <code>Counter</code>. Here's an alternate and far more\n      efficient implementation, based on the <code>Map</code>\n      datastructure in Core.\n    </blockquote>")))
 (idp7799360
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      This is because <code>freq.ml</code> depends on the fact\n      that frequency counts are represented as association lists, a fact\n      that we've just hidden. We just need to fix\n      <code>build_counts</code> to use\n      <code>Counter.empty</code> instead of <code>[]</code>\n      and <code>Counter.to_list</code> to get the association list\n      out at the end for processing and printing. The resulting\n      implementation is shown below.\n    </blockquote>")))
 (idp7797424
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      If we now try to compile <code>freq.ml</code>, we'll get the\n      following error:\n    </blockquote>")))
 (idp7795088
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Here's a rewrite of <code>counter.ml</code> to match this\n      interface.\n    </blockquote>")))
 (idp7792128
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that we needed to add <code>empty</code> and\n      <code>to_list</code> to <code>Counter</code>, since\n      otherwise, there would be no way to create a\n      <code>Counter.t</code> or get data out of one.\n    </blockquote>")))
 (idp7789360
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      To hide the fact that frequency counts are represented as\n      association lists, we'll need to make the type of frequency counts\n      <span><em>abstract</em></span>. A type is abstract if its name is\n      exposed in the interface, but its definition is not. Here's an\n      abstract interface for <code>Counter</code>:\n    </blockquote>")))
 (idp7787232
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      This is equivalent to the <code>mli</code> that we\n      generated, but is a little more verbose. In general, you want to\n      use autogenerated <code>mli</code>'s as a starting point\n      only. There's no replacement for a careful consideration of what\n      should be included in the interface of your module and of how that\n      should be organized, documented and formatted.\n    </blockquote>")))
 (idp7785424
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Which will generate the file\n      <code>_build/counter.inferred.mli</code>, with the following\n      contents.\n    </blockquote>")))
 (idp7784192
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      If you don't want to construct an mli entirely by hand, you can\n      ask OCaml to autogenerate one for you from the source, which you\n      can then adjust to fit your needs. In this case, we can write:\n    </blockquote>")))
 (idp7781344
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that <code>ocamlbuild</code> will detect the presence\n      of the <code>mli</code> file automatically and include it in\n      the build.\n    </blockquote>")))
 (idp7779216
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Using this syntax, we can write the signature of\n      <code>counter.ml</code> as follows.\n    </blockquote>")))
 (idp7775504
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      For <code>counter.mli</code>, we'll start by writing down an\n      interface that describes what's currently available in\n      <code>counter.ml</code>, without hiding anything.\n      <code>val</code> declarations are used to specify values in\n      a signature. The syntax of a <code>val</code> declaration is\n      as follows:\n    </blockquote>")))
 (idp7772080
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The implementation details of a module can be hidden by attaching\n      an <span><em>interface</em></span>. (Note that the terms\n      <span><em>interface</em></span>, <span><em>signature</em></span> and\n      <span><em>module type</em></span> are all used interchangeably.) A\n      module defined by a file <code>filename.ml</code> can be\n      constrained by a signature placed in a file called\n      <code>filename.mli</code>.\n    </blockquote>")))
 (idp7770128
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      you'll see that it depends on the fact that the empty set of\n      frequency counts is represented as an empty list. We'd like to\n      prevent this kind of dependency so we can change the\n      implementation of <code>Counter</code> without needing to\n      change client code like that in <code>freq.ml</code>.\n    </blockquote>")))
 (idp7766128
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      While we've pushed some of the logic to the\n      <code>Counter</code> module, the code in\n      <code>freq.ml</code> can still depend on the details of the\n      implementation of <code>Counter</code>. Indeed, if you look\n      at the definition of <code>build_counts</code>:\n    </blockquote>")))
 (idp7760896
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can now rewrite <code>freq.ml</code> to use\n      <code>Counter</code>. Note that the resulting code can still\n      be built with <code>ocamlbuild</code>, which will discover\n      dependencies and realize that <code>counter.ml</code> needs\n      to be compiled.\n    </blockquote>")))
 (idp7759104
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The file <code>counter.ml</code> will be compiled into a\n      module named <code>Counter</code>. The name of the module is\n      derived automatically from the filename. Note that the module name\n      is capitalized even if the file is not.\n    </blockquote>")))
 (idp7756048
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We'll start by creating a file, <code>counter.ml</code> that\n      contains the logic for maintaining the association list used to\n      describe the counts. The key function, called\n      <code>touch</code>, updates the association list with the\n      information that a given line should be added to the frequency\n      counts.\n    </blockquote>")))
 (idp7755296
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can fix this problem by replacing association lists with a more\n      efficient data structure. To do that, we'll first factor out the\n      key functionality into a separate module with an explicit\n      interface. We can consider alternative (and more efficient)\n      implementations once we have a clear interface to program against.\n    </blockquote>")))
 (idp7753248
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Let's consider how we can use modules to refactor the\n      implementation of <code>freq.ml</code>. Remember that the\n      variable <code>counts</code> contains an association list\n      representing the counts of the lines seen so far. But updating an\n      association list takes time linear in the length of the list,\n      meaning that the time complexity of processing a file is quadratic\n      in the number of distinct lines in the file.\n    </blockquote>")))
 (idp7750560
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Source files in OCaml are tied into the module system, with each\n      file compiling down into a module whose name is derived from the\n      name of the file. We've encountered modules before, for example,\n      when we used functions like <code>find</code> and\n      <code>add</code> from the <code>List.Assoc</code>\n      module. At it's simplest, you can think of a module as a\n      collection of definitions that are stored within a namespace.\n    </blockquote>")))
 (idp7748400
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      As a general matter, production executables should usually be\n      built using the native-code compiler, but it sometimes makes sense\n      to use bytecode for development builds. And, of course, bytecode\n      makes sense when targeting a platform not supported by the\n      native-code compiler.\n    </blockquote>")))
 (idp7745968
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Aside from performance, executables generated by the two compilers\n      have nearly identical behavior. There are a few things to be aware\n      of. First, the bytecode compiler can be used on more\n      architectures, and has some tools that are not available for\n      native code. For example, the OCaml debugger only works with\n      bytecode (although the <code>gdb</code>, the Gnu Debugger,\n      works with OCaml native-code applications). The bytecode compiler\n      is also quicker than the native-code compiler. In addition, in\n      order to run a bytecode executable you typically need to have\n      OCaml installed on the system in question. That's not strictly\n      required, though, since you can build a bytecode executable with\n      an embedded runtime, using the <code>-custom</code> compiler\n      flag.\n    </blockquote>")))
 (idp7742864
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      OCaml ships with two compilers: the <code>ocamlc</code>\n      bytecode compiler and the <code>ocamlopt</code> native-code\n      compiler. Programs compiled with <code>ocamlc</code> are\n      interpreted by a virtual machine, while programs compiled with\n      <code>ocamlopt</code> are compiled to native machine code to\n      be run on a specific operating system and processor architecture.\n    </blockquote>")))
 (idp7740016
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can now run the our program from the command-line. The\n      following line extracts strings from the\n      <code>ocamlopt</code> binary, reporting the most frequently\n      occurring ones. Note that the specific results will very from\n      platform to platform, since the binary itself will differ between\n      platforms.\n    </blockquote>")))
 (idp7737760
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      If we'd invoked <code>ocamlbuild</code> with a target of\n      <code>freq.native</code> instead of\n      <code>freq.byte</code>, we would have gotten native-code\n      instead.\n    </blockquote>")))
 (idp7736128
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We can then invoke <code>ocamlbuild</code> to build the\n      executable.\n    </blockquote>")))
 (idp7732336
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The purpose of the <code>_tags</code> file is to specify\n      which compilation options are required for which files. In this\n      case, we're telling <code>ocamlbuild</code> to link in the\n      <code>core</code> package and to turn on threading,\n      generation of annotation files, and debugging support for all\n      files (since the condition <code>true</code> evaluates to\n      <code>true</code> on all files).\n    </blockquote>")))
 (idp7728544
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      While this works well enough for a one-file project, more\n      complicated builds will require a tool to orchestrate the build.\n      One great tool for this task is <code>ocamlbuild</code>,\n      which is shipped with the OCaml compiler. We'll talk more about\n      <code>ocamlbuild</code> in\n      <a href=\"packaging.html\">Appendix\194\160B, <i>Packaging</i></a>, but for now, we'll just\n      walk through the steps required for this simple application.\n      First, create a <code>_tags</code> file containing the\n      following lines:\n    </blockquote>")))
 (idp7723984
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Here we're using <code>ocamlfind</code>, a tool which itself\n      invokes other parts of the ocaml toolchain (in this case,\n      <code>ocamlc</code>) with the appropriate flags to link in\n      particular libraries and packages. Here,\n      <code>-package core</code> is asking\n      <code>ocamlfind</code> to link in the Core library,\n      <code>-linkpkg</code> is required to do the final linking in\n      of packages for building a runnable executable, and\n      <code>-thread</code> turns on threading support, which is\n      required for Core.\n    </blockquote>")))
 (idp7722096
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      But in this case, this command will fail with the error\n      <code>Unbound module Core</code>. We need a somewhat more\n      complex invocation to get Core linked in:\n    </blockquote>")))
 (idp7720960
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      If we weren't using Core or any other external libraries, we could\n      build the executable like this:\n    </blockquote>")))
 (idp7717392
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Unlike C, programs in OCaml do not have a unique\n      <code>main</code> function. When an OCaml program is\n      evaluated, all the statements in the implementation files are\n      evaluated in order. These implementation files can contain\n      arbitrary expressions, not just function definitions. In this\n      example, the declaration starting with <code>let () =</code>\n      plays the role of the <code>main</code> declaration, kicking\n      off the processing. But really the entire file is evaluated at\n      startup, and so in some sense the full codebase is one big\n      <code>main</code> function.\n    </blockquote>")))
 (idp7714432
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      With <code>build_counts</code> defined, we then call the\n      function to build the association list, sort that list by\n      frequency in descending order, grab the first 10 elements off the\n      list, and then iterate over those ten elements and print them to\n      the screen. These operations are tied together using the\n      <code>|&gt;</code> operator, as described in\n      <a href=\"variables-and-functions.html\">Chapter\194\1602, <i>Variables and Functions</i></a>.\n    </blockquote>")))
 (idp7710704
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      The function <code>build_counts</code> reads in lines from\n      <code>stdin</code>, constructing from those lines an\n      association list with the frequencies of each line. It does this\n      by invoking <code>In_channel.fold_lines</code> (similar to\n      the function <code>List.fold</code> described in\n      <a href=\"lists-and-patterns.html\">Chapter\194\1603, <i>Lists and Patterns</i></a>), which reads\n      through the lines one by one, calling the provided fold function\n      for each line to update the accumulator. That accumulator is\n      initialized to the empty list.\n    </blockquote>")))
 (idp7708096
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Now we can write down <code>freq.ml</code>.\n    </blockquote>")))
 (idp7706944
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      Note that <code>List.Assoc.add</code> doesn't modify the\n      original list, but instead allocates a new list with the requisite\n      key/value added.\n    </blockquote>")))
 (idp7702416
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      This implementation will use two functions from the\n      <code>List.Assoc</code> module, which provides utility\n      functions for interacting with association lists,\n      <span><em>i.e.</em></span>, lists of key/value pairs. In\n      particular, we use the function\n      <code>List.Assoc.find</code>, which looks up a key in an\n      association list, and <code>List.add</code>, which adds a\n      new binding to an association list, as shown below.\n    </blockquote>")))
 (idp7700432
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n      We'll start with an example: a utility that reads lines from\n      <code>stdin</code> and computes a frequency count of the\n      lines that have been read in. At the end, the 10 lines with the\n      highest frequency counts are written out. We'll start with a\n      simple implementation, which we'll save as the file\n      <code>freq.ml</code>.\n    </blockquote>")))
 (idp7698976
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n    In this chapter, we'll show you how to build an OCaml program from a\n    collection of files, as well as the basics of working with modules\n    and module signatures.\n  </blockquote>")))
 (idp7698192
  ((file files-modules-and-programs.html)
   (html
    "<blockquote>\n    We've so far experienced OCaml largely through the toplevel. As you\n    move from exercises to real-world programs, you'll need to leave the\n    toplevel behind and start building programs from files. Files are\n    more than just a convenient way to store and manage your code; in\n    OCaml, they also act as boundaries that divide your program into\n    conceptual units.\n  </blockquote>")))
 (idp10801680
  ((file fast-binary-serialization.html)
   (html
    "<blockquote>This chapter is under construction and not yet ready for public review, and so omitted from this milestone. This chaper is present as a placeholder so that cross-references from other chapters resolve correctly in the print version.</blockquote>")))
 (idp8496720
  ((file error-handling.html)
   (html
    "<blockquote>\n        And then we can re-raise that exception:\n      </blockquote>")))
 (idp8493024
  ((file error-handling.html)
   (html
    "<blockquote>\n        And <code>Result</code> and <code>Or_error</code>\n        have similar <code>try_with</code> functions. So, we could\n        write:\n      </blockquote>")))
 (idp8490896
  ((file error-handling.html)
   (html
    "<blockquote>\n        Both exceptions and error-aware types are necessary parts of\n        programming in OCaml. As such, you often need to move between\n        these two worlds. Happily, Core comes with some useful helper\n        functions to help you do just that. For example, given a piece\n        of code that can throw an exception, you can capture that\n        exception into an option as follows:\n      </blockquote>")))
 (idp8488560
  ((file error-handling.html)
   (html
    "<blockquote>\n        You can also capture a backtrace within your program by calling\n        <code>Exn.backtrace</code>, which returns the backtrace of\n        the most recently thrown exception. This is useful for reporting\n        detailed information on errors that did not cause your program\n        to fail.\n      </blockquote>")))
 (idp8486160
  ((file error-handling.html)
   (html
    "<blockquote>\n        We can get more information from OCaml if we turn on stack\n        backtraces. A backtrace is essentially a summary of the stack of\n        calls that were executed to get to the point where the exception\n        was thrown. Backtraces can be enabled by setting the\n        <code>OCAMLRUNPARAM</code> environment variable as shown.\n      </blockquote>")))
 (idp8485488
  ((file error-handling.html)
   (html
    "<blockquote>\n        The example in question is short enough that it's quite easy to\n        see where the error came from. But in a complex program, simply\n        knowing which exception was thrown is usually not enough\n        information to figure out what went wrong.\n      </blockquote>")))
 (idp8484128
  ((file error-handling.html)
   (html
    "<blockquote>\n        If we build and run this program, we'll get a pretty\n        uninformative error:\n      </blockquote>")))
 (idp8482176
  ((file error-handling.html)
   (html
    "<blockquote>\n        A big part of the point of exceptions is to give useful\n        debugging information. But at first glance, OCaml's exceptions\n        can be less than informative. Consider the following simple\n        program.\n      </blockquote>")))
 (idp8478688
  ((file error-handling.html)
   (html
    "<blockquote>\n        At which point, it makes sense to simply use the non-exception\n        throwing function, <code>List.Assoc.find</code>, instead.\n      </blockquote>")))
 (idp8476432
  ((file error-handling.html)
   (html
    "<blockquote>\n        This kind of problem is hard to detect in advance, because the\n        type system doesn't tell you what exceptions a given function\n        might throw. For this reason, it's generally better to avoid\n        relying on the identity of the exception to determine the nature\n        of a failure. A better approach is to narrow the scope of the\n        exception handler, so that when it fires it's very clear what\n        part of the code failed.\n      </blockquote>")))
 (idp8472832
  ((file error-handling.html)
   (html
    "<blockquote>\n        Let's think about the behavior of this code in the presence of\n        exceptions. In particular, what happens if\n        <code>compute_weight</code> throws an exception? Ideally,\n        <code>lookup_weight</code> should propagate that exception\n        on, but if the exception happens to be\n        <code>Not_found</code>, then that's not what will happen:\n      </blockquote>")))
 (idp8470624
  ((file error-handling.html)
   (html
    "<blockquote>\n        We can implement <code>lookup_weight</code> as follows.\n      </blockquote>")))
 (idp8467040
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>lookup_weight ~compute_weight alist key</code>\n        should return a floating-point weight by applying\n        <code>compute_weight</code> to the data associated with\n        <code>key</code> by <code>alist</code>. If\n        <code>key</code> is not found, then it shoudl return 0.\n      </blockquote>")))
 (idp8463456
  ((file error-handling.html)
   (html
    "<blockquote>\n        OCaml's exception-handling system allows you to tune your\n        error-recovery logic to the particular error that was thrown.\n        For example, <code>List.find_exn</code> throws\n        <code>Not_found</code> when the element in question\n        can'tbe found. You can take advantage of this in your code, for\n        example, let's define a function called\n        <code>lookup_weight</code>, with the following signature.\n      </blockquote>")))
 (idp8460720
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>In_channel.with_file</code> is actually built on top\n        of <code>protect</code> so that it can clean up after\n        itself in the presence of exceptions.\n      </blockquote>")))
 (idp8458064
  ((file error-handling.html)
   (html
    "<blockquote>\n        This is a common enough problem that\n        <code>In_channel</code> has a function called\n        <code>with_file</code> that automates this pattern.\n      </blockquote>")))
 (idp8452560
  ((file error-handling.html)
   (html
    "<blockquote>\n        We can fix this using Core's <code>protect</code>\n        function. The purpose of <code>protect</code> is to ensure\n        that the <code>finally</code> thunk will be called when\n        <code>f</code> exits, whether it exits normally or with an\n        exception. This is similar to the <code>try/finally</code>\n        construct available in many programming languages, but it is\n        implemented in a library, rather than being a built-in\n        primitive. Here's how it could be used to fix\n        <code>load_config</code>.\n      </blockquote>")))
 (idp8450544
  ((file error-handling.html)
   (html
    "<blockquote>\n        The problem with this code is that the function that loads the\n        s-expression and parses it into a <code>Config.t</code>\n        might throw an exception if the config file in question is\n        malformed. Unfortunately, that means that the\n        <code>In_channel.t</code> that was opened will never be\n        closed, leading to a file-descriptor leak.\n      </blockquote>")))
 (idp8448896
  ((file error-handling.html)
   (html
    "<blockquote>\n        One headache with exceptions is that they can terminate your\n        execution at unexpected places, leaving your program in an\n        awkward state. Consider the following code snippet:\n      </blockquote>")))
 (idp8447264
  ((file error-handling.html)
   (html
    "<blockquote>\n        Otherwise, the original exception continues up the stack of\n        function calls, to be handled by the next outer exception\n        handler. If the exception is never caught, it terminates the\n        program.\n      </blockquote>")))
 (idp8445232
  ((file error-handling.html)
   (html
    "<blockquote>\n        But if the evaluation of the body throws an exception, then the\n        exception will be fed to the pattern match statements following\n        the <code>with</code>. If the exception matches a pattern,\n        then we consider the exception caught, and the\n        <code>try/with</code> clause evaluates to the expression\n        on the right-hand side of the matching pattern.\n      </blockquote>")))
 (idp8442864
  ((file error-handling.html)
   (html
    "<blockquote>\n        A <code>try/with</code> clause first evaluates its body,\n        <code>&lt;expr&gt;</code>. If no exception is thrown, then\n        the result of evaluating the body is what the entire\n        <code>try/with</code> clause evaluates to.\n      </blockquote>")))
 (idp8440176
  ((file error-handling.html)
   (html
    "<blockquote>\n        In OCaml, an exception handler is declared using a\n        <code>try</code>/<code>with</code> statement. Here's\n        the basic syntax.\n      </blockquote>")))
 (idp8439152
  ((file error-handling.html)
   (html
    "<blockquote>\n        So far, we've only seen exceptions fully terminate the execution\n        of a computation. But often, we want a program to be able to\n        respond to and recover from an exception. This is achieved\n        through the use of <span><em>exception handlers</em></span>.\n      </blockquote>")))
 (idp8436976
  ((file error-handling.html)
   (html
    "<blockquote>\n        This shows what's special about <code>assert</code>, which\n        is that it captures the line number and character offset of the\n        source location from which the assertion was made.\n      </blockquote>")))
 (idp8434256
  ((file error-handling.html)
   (html
    "<blockquote>\n        In this case, the assert can never be triggered because we have\n        a check that makes sure that the lists are of the same length\n        before we call <code>loop</code>. If we change the code so\n        that we drop this test, then we can trigger the assert.\n      </blockquote>")))
 (idp8433088
  ((file error-handling.html)
   (html
    "<blockquote>\n        Here we use <code>assert false</code>, which means that\n        the assert is guaranteed to trigger. In general, one can put an\n        arbitrary condition in the assertion.\n      </blockquote>")))
 (idp8429152
  ((file error-handling.html)
   (html
    "<blockquote>\n        Another important way of throwing an exception is the\n        <code>assert</code> directive. <code>assert</code>\n        is used for situations where a violation of the condition in\n        question indicates a bug. Consider the following piece of code\n        for zipping together two lists.\n      </blockquote>")))
 (idp8427360
  ((file error-handling.html)
   (html
    "<blockquote>\n        There are several other useful functions for raising exceptions,\n        which can be found in the API documentation for the\n        <code>Common</code> and <code>Exn</code> modules in\n        Core.\n      </blockquote>")))
 (idp8425168
  ((file error-handling.html)
   (html
    "<blockquote>\n        OCaml and Core provide a number of helper functions to simplify\n        the task of throwing exceptions. The simplest one is\n        <code>failwith</code>, which could be defined as follows:\n      </blockquote>")))
 (idp8422976
  ((file error-handling.html)
   (html
    "<blockquote>\n      This is all part of the support for s-expressions provided by the\n      Sexplib library and syntax-extension, which is described in more\n      detail in\n      <a href=\"data-serialization-with-s-expressions\" target=\"_top\">xref</a>.\n    </blockquote>")))
 (idp8421040
  ((file error-handling.html)
   (html
    "<blockquote>\n      The period in front of <code>Wrong_date</code> is there\n      because the representation generated by\n      <code>with sexp</code> includes the full module path of the\n      module where the exception in question is defined. In this case,\n      since we've declared the exception at the toplevel, that module\n      path is trivial.\n    </blockquote>")))
 (idp8418784
  ((file error-handling.html)
   (html
    "<blockquote>\n      But if we declare the exception using <code>with sexp</code>\n      (and the constituent types have sexp converters), we'll get\n      something with more information.\n    </blockquote>")))
 (idp8417200
  ((file error-handling.html)
   (html
    "<blockquote>\n      OCaml can't always generate a useful textual representation of an\n      exception. For example:\n    </blockquote>")))
 (idp8414672
  ((file error-handling.html)
   (html
    "<blockquote>\n      This all matters because it means that the return type of\n      <code>raise</code> can be whatever it needs to be to fit in\n      to the context it is called in. Thus, the type system will let us\n      throw an exception anywhere in a program.\n    </blockquote>")))
 (idp8413568
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>forever</code> doesn't return a value for a different\n      reason: it is an infinite loop.\n    </blockquote>")))
 (idp8409328
  ((file error-handling.html)
   (html
    "<blockquote>\n      The return type of <code>'a</code> suggests that\n      <code>raise</code> could return a value of any type. That\n      seems impossible, and it is. Really, <code>raise</code> has\n      this type because it never returns at all. This behavior isn't\n      restricted to functions like <code>raise</code> that\n      terminate by throwing exceptions. Here's another example of a\n      function that doesn't return a value.\n    </blockquote>")))
 (idp8407312
  ((file error-handling.html)
   (html
    "<blockquote>\n      In the above example, <code>raise</code> throws the\n      exception, thus terminating the computation. The type of raise is\n      a bit surprising when you first see it:\n    </blockquote>")))
 (idp8406160
  ((file error-handling.html)
   (html
    "<blockquote>\n      Note that we named the function <code>find_exn</code> to\n      warn the user that the function routinely throws exceptions, a\n      convention that is used heavily in Core.\n    </blockquote>")))
 (idp8403520
  ((file error-handling.html)
   (html
    "<blockquote>\n      Here's an example of a function for looking up a key in an\n      <span><em>association list</em></span>, <span><em>i.e.</em></span> a\n      list of key/value pairs which uses this newly-defined exception:\n    </blockquote>")))
 (idp8401440
  ((file error-handling.html)
   (html
    "<blockquote>\n      In addition to built-in exceptions like\n      <code>Divide_by_zero</code>, OCaml lets you define your own.\n    </blockquote>")))
 (idp8398512
  ((file error-handling.html)
   (html
    "<blockquote>\n      If we put a <code>printf</code> in the middle of the\n      computation, we can see that <code>List.map</code> is\n      interrupted part way through it's execution, never getting to the\n      end of the list.\n    </blockquote>")))
 (idp8396912
  ((file error-handling.html)
   (html
    "<blockquote>\n      And an exception can terminate a computation even if it happens\n      nested somewhere deep within it.\n    </blockquote>")))
 (idp8395552
  ((file error-handling.html)
   (html
    "<blockquote>\n      You can trigger an exception by, for example, dividing an integer\n      by zero:\n    </blockquote>")))
 (idp8394816
  ((file error-handling.html)
   (html
    "<blockquote>\n      Exceptions in OCaml are not that different from exceptions in many\n      other languages, like Java, C# and Python. Exceptions are a way to\n      terminate a computation and report an error, while providing a\n      mechanism to catch and handle (and possibly recover from)\n      exceptions that are triggered by sub-computations.\n    </blockquote>")))
 (idp8391104
  ((file error-handling.html)
   (html
    "<blockquote>\n        These error-handling functions are valuable because they let you\n        express your error handling both explicitly and concisely. We've\n        only discussed these functions in the context of the\n        <code>Option</code> module, but similar functionality is\n        available in both <code>Result</code> and\n        <code>Or_error</code>.\n      </blockquote>")))
 (idp8385584
  ((file error-handling.html)
   (html
    "<blockquote>\n        There are other useful idioms encoded in the functions in\n        <code>Option</code>. One example is\n        <code>Option.both</code>, which takes two optional values\n        and produces a new optional pair that is <code>None</code>\n        if either of its arguments are <code>None</code>. Using\n        <code>Option.both</code>, we can make\n        <code>compute_bounds</code> even shorter.\n      </blockquote>")))
 (idp8383584
  ((file error-handling.html)
   (html
    "<blockquote>\n        This use of <code>bind</code> isn't really materially\n        better than the one we started with, and indeed, for small\n        examples like this, direct matching of options is generally\n        better than using <code>bind</code>. But for large complex\n        examples with many stages of error-handling, the bind idiom\n        becomes clearer and easier to manage.\n      </blockquote>")))
 (idp8379040
  ((file error-handling.html)
   (html
    "<blockquote>\n        The above code is a little bit hard to swallow, however, on a\n        syntactic level. We can make it easier to read, and drop some of\n        the parenthesis, by using the infix operator form of bind, which\n        we get access to by locally opening\n        <code>Option.Monad_infix</code>. The module is called\n        <code>Monad_infix</code> because the bind operator is part\n        of a sub-interface called <code>Monad</code>, which we'll\n        talk about more in\n        <a href=\"concurrent-programming-with-async.html\">Chapter\194\16017, <i>Concurrent Programming with Async</i></a>.\n      </blockquote>")))
 (idp8372080
  ((file error-handling.html)
   (html
    "<blockquote>\n        As you can see, <code>bind None f</code> returns\n        <code>None</code> without calling <code>f</code>,\n        and <code>bind (Some x) f</code> returns\n        <code>f x</code>. Perhaps surprisingly,\n        <code>bind</code> can be used as a way of sequencing\n        together error-producing functions so that the first one to\n        produce an error terminates the computation. Here's a rewrite of\n        <code>compute_bounds</code> to use a nested series of\n        <code>bind</code>s.\n      </blockquote>")))
 (idp8367040
  ((file error-handling.html)
   (html
    "<blockquote>\n        As you write more error handling code in OCaml, you'll discover\n        that certain patterns start to emerge. A number of these common\n        patterns have been codified by functions in modules like\n        <code>Option</code> and <code>Result</code>. One\n        particularly useful pattern is built around the function\n        <code>bind</code>, which is both an ordinary function and\n        an infix operator <code>&gt;&gt;=</code>. Here's the\n        definition of <code>bind</code> for options.\n      </blockquote>")))
 (idp8363200
  ((file error-handling.html)
   (html
    "<blockquote>\n        The type <code>'a Or_error.t</code> is just a shorthand\n        for <code>('a,Error.t) Result.t</code>, and it is, after\n        <code>option</code>, the most common way of returning\n        errors in Core.\n      </blockquote>")))
 (idp8360608
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>Error</code> also supports operations for\n        transforming errors. For example, it's often useful to augment\n        an error with some extra information about the context of the\n        error or to combine multiple errors together.\n        <code>Error.tag</code> and\n        <code>Error.of_list</code> fulfill these roles, as you can\n        see below.\n      </blockquote>")))
 (idp8358880
  ((file error-handling.html)
   (html
    "<blockquote>\n        We can use this same idiom for generating an error.\n      </blockquote>")))
 (idp8356240
  ((file error-handling.html)
   (html
    "<blockquote>\n        Note that the time isn't actually serialized into an\n        s-expression until the error is printed out. We're not\n        restricted to doing this kind of error reporting with built-in\n        types. This will be discussed in more detail in\n        <a href=\"data-serialization-with-s-expressions\" target=\"_top\">xref</a>,\n        but Sexplib comes with a language extension that can\n        auto-generate sexp-converters for newly generated types, as\n        shown below.\n      </blockquote>")))
 (idp8353600
  ((file error-handling.html)
   (html
    "<blockquote>\n        S-expressions are supported by the Sexplib library that is\n        distributed with Core, and is the most common serialization\n        format used in Core. Indeed, most types in Core come with\n        built-in s-expression converters. Here's an example of creating\n        an error using the sexp converter for times,\n        <code>Time.sexp_of_t</code>.\n      </blockquote>")))
 (idp8351392
  ((file error-handling.html)
   (html
    "<blockquote>\n        The most common way to create <code>Error.t</code>s is\n        using <span><em>s-expressions</em></span>. An s-expression is a\n        balanced parenthetical expression where the leaves of the\n        expressions are strings. Thus, the following is a simple\n        s-expression:\n      </blockquote>")))
 (idp8349680
  ((file error-handling.html)
   (html
    "<blockquote>\n        In this case, we can benefit from the laziness of\n        <code>Error</code>, since the thunk won't be called unless\n        the <code>Error.t</code> is converted to a string.\n      </blockquote>")))
 (idp8346160
  ((file error-handling.html)
   (html
    "<blockquote>\n        But you can also construct an <code>Error.t</code> from a\n        <span><em>thunk</em></span>, <span><em>i.e.</em></span>, a\n        function that takes a single argument of type\n        <code>unit</code>.\n      </blockquote>")))
 (idp8343168
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>Error</code> gets around this issue through\n        laziness. In particular, an <code>Error.t</code> allows\n        you to put off generation of the error string until and unless\n        you need it, which means a lot of the time you never have to\n        construct it at all. You can of course construct an error\n        directly from a string:\n      </blockquote>")))
 (idp8342448
  ((file error-handling.html)
   (html
    "<blockquote>\n        It might not be obvious at first why efficiency is an issue at\n        all. But generating error messages is an expensive business. An\n        ASCII representation of a value can be quite time-consuming to\n        construct, particularly if it includes expensive-to-convert\n        numerical data.\n      </blockquote>")))
 (idp8341280
  ((file error-handling.html)
   (html
    "<blockquote>\n        Core's answer to this question is the <code>Error.t</code>\n        type, which tries to forge a good compromise between efficiency,\n        convenience, and control over the presentation of errors.\n      </blockquote>")))
 (idp8340704
  ((file error-handling.html)
   (html
    "<blockquote>\n        But which type to choose? Is it better to represent errors as\n        strings? Some more structured representation like XML? Or\n        something else entirely?\n      </blockquote>")))
 (idp8339392
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>Result.t</code> gives you complete freedom to choose\n        the type of value you use to represent errors, but it's often\n        useful to standardize on an error type. Among other things, this\n        makes it easier to write utility functions to automate common\n        error handling patterns.\n      </blockquote>")))
 (idp8336384
  ((file error-handling.html)
   (html
    "<blockquote>\n        without first opening the <code>Result</code> module.\n      </blockquote>")))
 (idp8331024
  ((file error-handling.html)
   (html
    "<blockquote>\n        A <code>Result.t</code> is essentially an option augmented\n        with the ability to store other information in the error case.\n        Like <code>Some</code> and <code>None</code> for\n        options, the constructors <code>Ok</code> and\n        <code>Error</code> are promoted to the toplevel by\n        <code>Core.Std</code>. As such, we can write:\n      </blockquote>")))
 (idp8328944
  ((file error-handling.html)
   (html
    "<blockquote>\n<code>Result.t</code> is meant to address this deficiency.\n        The type is defined as follows.\n      </blockquote>")))
 (idp8327680
  ((file error-handling.html)
   (html
    "<blockquote>\n        Options aren't always a sufficiently expressive way to report\n        errors. Specifically, when you encode an error as\n        <code>None</code>, there's nowhere to say anything about\n        the nature of the error.\n      </blockquote>")))
 (idp8325440
  ((file error-handling.html)
   (html
    "<blockquote>\n      The use of options to encode errors underlines the fact that it's\n      not clear whether a particular outcome, like not finding something\n      on a list, is an error or is just another valid outcome. This\n      depends on the larger context of your program, and thus is not\n      something that a general purpose library can know in advance. One\n      of the advantages of error-aware return types is that they work\n      well in both situations.\n    </blockquote>")))
 (idp8322096
  ((file error-handling.html)
   (html
    "<blockquote>\n      On the other hand, in <code>find_mismatches</code> below,\n      errors encountered during the computation do not propagate to the\n      return value of the function. <code>find_mismatches</code>\n      takes two hash tables as arguments, and searches for keys that\n      have different data in one table than in the other. As such, the\n      failure to find a key in one table isn't a failure of any sort.\n    </blockquote>")))
 (idp8319728
  ((file error-handling.html)
   (html
    "<blockquote>\n      The match statement is used to handle the error cases, propagating\n      a None in <code>hd</code> or <code>last</code> into\n      the return value of <code>compute_bounds</code>.\n    </blockquote>")))
 (idp8315328
  ((file error-handling.html)
   (html
    "<blockquote>\n      Consider the <code>compute_bounds</code> function defined\n      below. The function takes a list and a comparison function, and\n      returns upper and lower bounds for the list by finding the\n      smallest and largest element on the list.\n      <code>List.hd</code> and <code>List.last</code>, which\n      return <code>None</code> when they encounter an empty list,\n      are used to extract the largest and smallest element of the list.\n    </blockquote>")))
 (idp8314656
  ((file error-handling.html)
   (html
    "<blockquote>\n      Having errors be explicit in the return values of your functions\n      tells the caller that there is an error that needs to be handled.\n      The caller can then handle the error explicitly, either recovering\n      from the error or propagating it onward.\n    </blockquote>")))
 (idp8312976
  ((file error-handling.html)
   (html
    "<blockquote>\n      The option in the return type indicates that the function may not\n      succeed in finding a suitable element, as you can see below.\n    </blockquote>")))
 (idp8310256
  ((file error-handling.html)
   (html
    "<blockquote>\n      The best way in OCaml to signal an error is to include that error\n      in your return value. Consider the type of the\n      <code>find</code> function in the <code>List</code>\n      module.\n    </blockquote>")))
 (idp8308848
  ((file error-handling.html)
   (html
    "<blockquote>\n    We'll start by describing the two basic approaches for reporting\n    errors in OCaml: error-aware return types and exceptions.\n  </blockquote>")))
 (idp8308160
  ((file error-handling.html)
   (html
    "<blockquote>\n    Thankfully, OCaml has powerful tools for handling errors reliably\n    and with a minimum of pain. In this chapter we'll discuss some of\n    the different approaches in OCaml to handling errors, and give some\n    advice on how to design interfaces that make error handling easier.\n  </blockquote>")))
 (idp8307424
  ((file error-handling.html)
   (html
    "<blockquote>\n    Nobody likes dealing with errors. It's tedious, it's easy to get\n    wrong, and it's usually just not as fun as planning out how your\n    program is going to succeed. But error handling is important, and\n    however much you don't like thinking about it, having your software\n    fail due to poor error handling code is worse.\n  </blockquote>")))
 (idp10450944
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        This can be very useful in designing config file formats that\n        are both reasonably terse and easy to generate and maintain. It\n        can also be useful for backwards compatibility: if you add a new\n        field to your config record, but you make that field optiona,\n        then you should still be able to parse older version of your\n        config.\n      </blockquote>")))
 (idp10448992
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        As you can see, the fields that are at their default values are\n        simply omitted from the s-expression. On the other hand, if we\n        convert a config with other values, then those values will be\n        included in the s-expression.\n      </blockquote>")))
 (idp10445936
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        We could make the generated s-expression also drop exported\n        values, by using the <code>sexp_drop_default</code>\n        directive.\n      </blockquote>")))
 (idp10444368
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        When we convert that back out to an s-expression, you'll notice\n        that no data is dropped.\n      </blockquote>")))
 (idp10442000
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        One could imagine making some of these paramters optional; in\n        particular, by default, we might want the web server to bind to\n        port 80, and to listen as localhost. The sexp-syntax allows this\n        to do this, as follows.\n      </blockquote>")))
 (idp10440432
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        Consider the following type which represents the configuration\n        of a very simple web-server.\n      </blockquote>")))
 (idp10437584
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        The <code>sexp_option</code> declaration is really just an\n        example of how one might want to deal with default values. With\n        <code>sexp_option</code>, your type on the OCaml side is\n        an option, with <code>None</code> representing the case\n        where no value is provided. But you might want to allow other\n        ways of filling in default values.\n      </blockquote>")))
 (idp10433280
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        But what if we want a field to be optional,\n        <span><em>i.e.</em></span>, we want to allow it to be omitted\n        from the record entirely? In that case, we can mark it with\n        <code>sexp_option</code>:\n      </blockquote>")))
 (idp10427696
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        Another common directive is <code>sexp_option</code>,\n        which is used to to make a record field optional in the\n        s-expressoin. Normally, optional values are represented either\n        as <code>()</code> for <code>None</code>, or as\n        <code>(x)</code> for <code>Some x</code>, and a\n        record field containing an option would be rendered accordingly.\n        For example:\n      </blockquote>")))
 (idp10423504
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        You might prefer to make the syntax a bit less parenthesis-laden\n        by dropping the parentheses around the list.\n        <code>sexp_list</code> gives us this alternate syntax:\n      </blockquote>")))
 (idp10421712
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        Sometimes, sexp-converters have more parentheses than one would\n        ideally like. Consider, for example, the following variant type:\n      </blockquote>")))
 (idp10417728
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        And if we now convert a value of this type to an s-expression,\n        we'll see the contents of field <code>a</code> marked as\n        opaque:\n      </blockquote>")))
 (idp10415312
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        But with <code>sexp_opaque</code>, we won't:\n      </blockquote>")))
 (idp10411056
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        The most commonly used directive is\n        <code>sexp_opaque</code>, whose purpose is to mark a given\n        component of a type as being unconvertible. Anything marked with\n        <code>sexp_opaque</code> will be presented as the atom\n        <code>&lt;opaque&gt;</code> by the to-sexp converter, and\n        will trigger an exception from the from-sexp converter. Note\n        that the type of a component marked as opaque doesn't need to\n        have a sexp-converter defined. Here, if we define a type without\n        a sexp-converter, and then try to use it another type with a\n        sexp-converter, we'll error out:\n      </blockquote>")))
 (idp10408864
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      Sexplib supports a collection of directives for modifying the\n      default behavior of the auto-generated sexp-converters. These\n      directives allow you to customize the way in which types are\n      represented as s-expressions without having to write a custom\n      parser.\n    </blockquote>")))
 (idp10406352
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        In the above error, &quot;example.scm:3:4&quot; tells us that\n        the error occurred on &quot;example.scm&quot;, line 3, character\n        4, which is a much better start for figuring out what has gone\n        wrong.\n      </blockquote>")))
 (idp10404624
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        and run it again, we'll get the following much more helpful\n        error message:\n      </blockquote>")))
 (idp10402256
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        But there's hope! If we make small change to the\n        <code>run</code> function as follows:\n      </blockquote>")))
 (idp10401504
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        If all you have is the error message and the string, it's not\n        terribly informative. In particular, you know that the parsing\n        error-ed out on the atom &quot;not-an-integer&quot;, but you\n        don't know which one! In a large file, this kind of bad error\n        message can be pure misery.\n      </blockquote>")))
 (idp10400192
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        you'll get the following error:\n      </blockquote>")))
 (idp10398976
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        If you were to run this on a malformatted file, say, this one:\n      </blockquote>")))
 (idp10396960
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        There are two steps to deserializing a type from an\n        s-expression: first, converting the bytes in a file to an\n        s-expression, and the second, converting that s-expression into\n        the type in question. One problem with this is that it can be\n        hard to localize errors to the right place using this scheme.\n        Consider the following example:\n      </blockquote>")))
 (idp10394464
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        We call the function <code>of_sexp_error</code> to raise\n        an exception because that improves the error reporting that\n        Sexplib can provide when a conversion fails.\n      </blockquote>")))
 (idp10391632
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        This trick of overriding an existing function definition with a\n        new one is perfectly acceptable in OCaml. Function definitions\n        are only recursive if the <code>rec</code> keyword is\n        specified, and so in this case the inner\n        <code>t_of_sexp</code> call will go to the earlier\n        auto-generated definition that resulted from the\n        <code>type t with sexp</code> definition.\n      </blockquote>")))
 (idp10389552
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        We can fix this problem by overriding the autogenerated function\n        and writing a custom sexp-converter that is based on the\n        auto-generated converter.\n      </blockquote>")))
 (idp10383872
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n        One easy mistake to make when dealing with sexp converters is to\n        ignore the fact that those converters can violate the invariants\n        of your code. For example, the <code>Int_interval</code>\n        module depends for the correctness of the\n        <code>is_empty</code> check on the fact that for any value\n        <code>Range (x,y)</code>, <code>y</code> is greater\n        than or equal to <code>x</code>. The\n        <code>create</code> function preserves this invariant, but\n        the <code>t_of_sexp</code> function does not.\n      </blockquote>")))
 (idp10380848
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      at which point <code>test_interval.ml</code> will compile\n      again, and if we run it, we'll get the following output:\n    </blockquote>")))
 (idp10377968
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      But Sexplib has a shorthand for this as well, so that we can just\n      use the same <code>with</code> shorthand in the\n      <code>mli</code>.\n    </blockquote>")))
 (idp10376496
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      We could export the types by hand in the signature:\n    </blockquote>")))
 (idp10375040
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      then we'll get the following error:\n    </blockquote>")))
 (idp10371888
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      But we're still missing something: we haven't created an\n      <code>mli</code> signature for\n      <code>Int_interval</code> yet. Note that we need to\n      explicitly export the s-expression converters that were created\n      within the ml. If we don't:\n    </blockquote>")))
 (idp10370064
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      We can now use this module as follows:\n    </blockquote>")))
 (idp10367792
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      The most important functionality provided by Sexplib is the\n      auto-generation of converters for new types. We've seen a bit of\n      how this works already, but let's walk through a complete example.\n      Here's the source for the beginning of a library for representing\n      integer intervals.\n    </blockquote>")))
 (idp10365168
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      In the above, we use <code>Exn.handle_uncaught</code> to\n      make sure that the exception gets printed out in full detail. You\n      should generally wrap every Core program in this handler to get\n      good error messages for any unexpected exceptions.\n    </blockquote>")))
 (idp10362608
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      If we introduce an error into our s-expression, by, say, deleting\n      the open-paren in front of <code>bar</code>, we'll get a\n      parse error:\n    </blockquote>")))
 (idp10361344
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      Note that the comments were dropped from the file upon reading.\n      This is expected, since there's no place in the\n      <code>Sexp.t</code> type to store comments.\n    </blockquote>")))
 (idp10359792
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      Again, loading the file as an s-expression drops the comments.\n    </blockquote>")))
 (idp10358080
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      The following example shows all of these in action.\n    </blockquote>")))
 (idp10356640
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n<code>#;</code>, which comments out the first complete\n          s-expression that follows.\n        </blockquote>")))
 (idp10354400
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n<code>#|</code> and <code>|#</code>, which are\n          delimiters for commenting out a block\n        </blockquote>")))
 (idp10352896
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n<code>;</code>, which comments out everything to the end\n          of a line\n        </blockquote>")))
 (idp10351888
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      All in, the s-expression format actually supports three comment\n      syntaxes:\n    </blockquote>")))
 (idp10350256
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      can be loaded using sexplib. As you can see, the commented data is\n      not part of the resulting s-expression.\n    </blockquote>")))
 (idp10347648
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n      The textual representation of s-expressions is pretty\n      straightforward. An s-expression is written down as a nested\n      parenthetical expression, with whitespace-separated strings as the\n      atoms. Quotes are used for atoms that contain parenthesis or\n      spaces themselves; backslash is the escape character; and\n      semicolons are used to introduce single-line comments. Thus, the\n      following file, <code>example.scm</code>:\n    </blockquote>")))
 (idp10343616
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    Many of the examples in the subsequent chapters depend on\n    <code>camlp4</code>, but the examples all invoke it\n    automatically for you via the <code>-pp</code> flag to the\n    OCaml compiler. If you're interested in building your own\n    generators, investigate the <code>type_conv</code> library\n    which provides the basic extension mechanism used by the rest of\n    this chapter.\n  </blockquote>")))
 (idp10342112
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    OCaml doesn't directly support converting static type definitions to\n    and from other data formats. Instead, it supplies a powerful syntax\n    extension mechanism known as <code>camlp4</code>. This lets\n    you extend the grammar of the language to mark types as requiring\n    special action, and then mechanically generate boilerplate code over\n    those types (such as converting to and from other data formats).\n  </blockquote>")))
 (idp10339376
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    The syntax extensions in Core almost all have this same basic\n    structure: they auto-generate code based on type definitions,\n    implementing functionality that you could in theory have implemented\n    by hand, but with far less programmer effort.\n  </blockquote>")))
 (idp10336656
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    The <code>with sexp</code> is detected by a\n    <code>Sexplib</code> syntax extension and replaced with the\n    extra conversion functions you see above. You can ignore\n    <code>t_of_sexp__</code>, which is a helper function that is\n    needed in very rare cases.\n  </blockquote>")))
 (idp10332128
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    Given how mechanical the code is, you could imagine writing a\n    program that inspected the type definition and auto-generated the\n    conversion code for you. As it turns out, we can do just that using\n    <code>Sexplib</code>. The <code>Sexplib</code> package,\n    which is included with Core, provides both a library for\n    manipulating s-exressions and a syntax extension for generating such\n    conversion functions. With that synax extension enabled, any type\n    that has <code>with sexp</code> as an annotation will trigger\n    the generation of the functions we want for free.\n  </blockquote>")))
 (idp10330320
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    This is somewhat tiresome to write, and it gets more so when you\n    consider the parser, <span><em>i.e.</em></span>,\n    <code>t_of_sexp</code>, which is considerably more complex.\n    Writing this kind of parsing and printing code by hand is mechanical\n    and error prone, not to mention a drag.\n  </blockquote>")))
 (idp10328176
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    But what if you want a function to convert some brand new type to an\n    s-expression? You can of course write it yourself manually:\n  </blockquote>")))
 (idp10326816
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    Notice that <code>List.sexp_of_t</code> is polymorphic, and\n    takes as its first argument another conversion function to handle\n    the elements of the list to be converted. Core uses this scheme more\n    generally for defining sexp-converters for polymorphic types.\n  </blockquote>")))
 (idp10324960
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    In addition, most of the base types in Core support conversion to\n    and from s-expressions. For example, we can write:\n  </blockquote>")))
 (idp10322400
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    The <code>Sexp</code> module in Core comes with functionality\n    for parsing and printing s-expressions.\n  </blockquote>")))
 (idp10321840
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    An s-expression can be thought of as a tree where each node contains\n    a list of its children, and where the leaves of the tree are\n    strings.\n  </blockquote>")))
 (idp10320368
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    The OCaml type of an s-expression is quite simple:\n  </blockquote>")))
 (idp10318672
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    S-expressions are nested paranthetical expressions whose atomic\n    values are strings. They were first popularized by the Lisp\n    programming language in the 1960s, and have remained one of the\n    simplest and most effective ways to encode structured data. An\n    example s-expression might look like this:\n  </blockquote>")))
 (idp10317920
  ((file data-serialization-with-s-expressions.html)
   (html
    "<blockquote>\n    We've already shown you how to parse third-party data formats into\n    OCaml in earlier chapters. Sometimes though, you just want to\n    quickly convert an OCaml type to and from a human-readable and\n    editable form in your own code, and not worry about\n    interoperability. Core's solution to this problem is to use\n    s-expressions.\n  </blockquote>")))
 (idp10799040
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Now, if we run this with a suitably small timeout, we'll see that\n      some queries succeed and some fail, and the timeouts are reported\n      as such.\n    </blockquote>")))
 (idp10795344
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In the following, we use <code>choose</code> to ensure that\n      the <code>interrupt</code> deferred becomes determined if\n      and only if the timeout-deferred is chosen. Here's the code.\n    </blockquote>")))
 (idp10791184
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>choose</code> provides no guarantee that the\n      <code>choice</code> built around the first deferred to\n      become determined will in fact be chosen. But\n      <code>choose</code> does guarantee that only one\n      <code>choice</code> will be chosen, and only the chosen\n      <code>choice</code> will execute the attached closure.\n    </blockquote>")))
 (idp10786448
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      We can get more precise handling of timeouts using Async's\n      <code>choose</code> operator, which lets you pick between a\n      collection of different deferreds, reacting to exactly one of\n      them. Each deferred is combined, using the function\n      <code>choice</code>, with a function that is called if and\n      only if that is the chosen deferred. Here's the type signature of\n      <code>choice</code> and <code>choose</code>:\n    </blockquote>")))
 (idp10784160
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      This will work, and will cause the connection to shut-down cleanly\n      when we time out; but our code no longer explicitly knows whether\n      or not the timeout has kicked in. In particular, the error message\n      on a timeout will now be <code>Unexpected failure</code>\n      rather than <code>Timed out</code>, which it was in our\n      previous implementation. This is a minor issue in this case, but\n      if we wanted to have special behavior in the case of a timeout, it\n      would be a more serious issue.\n    </blockquote>")))
 (idp10780736
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Next, we'll modify <code>get_definition_with_timeout</code>\n      to create a deferred to pass in to\n      <code>get_definition</code> which will become determined\n      when our timeout expires.\n    </blockquote>")))
 (idp10776704
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The following code shows how you can change\n      <code>get_definition</code> and\n      <code>get_definition_with_timeout</code> to cancel the\n      <code>get</code> call if the timeout expires.\n    </blockquote>")))
 (idp10772304
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      A problem with this code is that the HTTP query kicked off by\n      <code>get_definition</code> is not actually shut down when\n      the timeout fires. As such,\n      <code>get_definition_with_timeout</code> essentially leaks\n      an open connection. Happily, Cohttp does provide a way of shutting\n      down a client. You can pass a deferred under the label\n      <code>interrupt</code> to\n      <code>Cohttp_async.Client.get</code>. Once\n      <code>interrupt</code> is determined, the client connection\n      will terminated and the corresponding connections closed.\n    </blockquote>")))
 (idp10770352
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      We use <code>&gt;&gt;|</code> above to transform the\n      deferred values we're waiting for so that\n      <code>Deferred.any</code> can choose between values of the\n      same type.\n    </blockquote>")))
 (idp10766912
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Let's use this to add timeouts to our DuckDuckGo searches. We'll\n      do this by writing a wrapper for <code>get_definition</code>\n      that takes a timeout (in the form of a\n      <code>Time.Span.t</code>) as an argument, and returns either\n      the definition, or, if that takes too long, the timeout.\n    </blockquote>")))
 (idp10764272
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Sometimes, however, we want to wait only for the first of multiple\n      events to occur. This happens particularly often when dealing with\n      timeouts. In that case, we can use the call\n      <code>Deferred.any</code>, which, given a list of deferreds,\n      returns a single deferred that will become determined once any of\n      the values on the list is determined.\n    </blockquote>")))
 (idp10759136
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In a concurrent program, one often needs to combine results from\n      multiple distinct concurrent sub-computations going on in the same\n      program. We already saw this in our DuckDuckGo example, where we\n      used <code>Deferred.all</code> and\n      <code>Deferred.all_unit</code> to wait for a list of\n      deferreds to become determined. Another useful primitive is\n      <code>Deferred.both</code>, which lets you wait until two\n      deferreds of different types have returned, returning both values\n      as a tuple. Here, we use the function <code>sec</code>,\n      which is shorthand for creating a time-span equal to a given\n      number of seconds.\n    </blockquote>")))
 (idp10754112
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Note that in this code, we're relying on the fact that\n        <code>Cohttp_async.Client.get</code> will clean up after\n        itself after an exception, in particular by closing its file\n        descriptors. If you need to implement such functionality\n        directly, you may want to use the\n        <code>Monitor.protect</code> call, which is analogous to\n        the <code>protect</code> call described in\n        <a href=\"error-handling.html#cleaning-up-in-the-presence-of-exceptions\">the section called \226\128\156Cleaning up in the presence of exceptions\226\128\157</a>.\n      </blockquote>")))
 (idp10752944
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Now, only the query that went to <code>localhost</code>\n        failed.\n      </blockquote>")))
 (idp10751184
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Now, if we run that same query, we'll get individualized\n        handling of the connection failures:\n      </blockquote>")))
 (idp10748576
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Now we just need to change the code for\n        <code>print_result</code> so that it can handle the new\n        type.\n      </blockquote>")))
 (idp10746480
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Here, we use <code>try_with</code> to capture the\n        exception, which we then use map (the\n        <code>&gt;&gt;|</code> operator) to convert the error into\n        the form we want: a pair whose first element is the word being\n        searched for, and the second element is the (possibly erroneous)\n        result.\n      </blockquote>")))
 (idp10742656
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        As you can see, we got a &quot;Connection refused&quot; failure\n        which ends the entire program, even though one of the two\n        queries would have gone through successfully. We can handle the\n        failures of individual connections separately by using the\n        <code>try_with</code> function within each call to\n        <code>get_definition</code>, as follows.\n      </blockquote>")))
 (idp10740192
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        and then making the appropriate changes to get the list of\n        servers on the command-line, and to distribute the search\n        queries round-robin over the list of servers. Now, let's see\n        what happens if we rebuild the application and run it giving it\n        a list of servers, some of which won't respond to the query.\n      </blockquote>")))
 (idp10737744
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        First we'll need to change <code>query_uri</code> to take\n        an argument specifying the server to connect to, as follows.\n      </blockquote>")))
 (idp10737024
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The search code as it is fails rarely, so let's make make a\n        change that can cause it to fail more predictably, by making it\n        possible to distribute the requests over multiple servers. Then,\n        we'll handle the errors that occur when one of those servers is\n        mis-specified.\n      </blockquote>")))
 (idp10736368
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Let's now go back and improve the exception handling of our\n        DuckDuckGo client. In particular, we'll change it so that any\n        individual queries that fail are reported as such, without\n        preventing other queries from succeeding.\n      </blockquote>")))
 (idp10732016
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        In practice, you should rarely use monitors directly, instead\n        using functions like <code>try_with</code> and\n        <code>Monitor.protect</code> that are built on top of\n        monitors. One example of a library that uses monitors directly\n        is <code>Tcp.Server.create</code>, which tracks both\n        exceptions thrown by the logic that handles the network\n        connection and by the callback for responding to an individual\n        request, in either case responding to an exception by closing\n        the connection. It is for building this kind of custom error\n        handling that monitors can be helpful.n\n      </blockquote>")))
 (idp10729744
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        If instead we use <code>Ignore_me</code>, the exception\n        will be ignored, and we again see that the deferred never\n        returns, but the exception was caught and ignored.\n      </blockquote>")))
 (idp10725696
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        If we pass in an exception other than\n        <code>Ignore_me</code>, like, say, the built-in exception\n        <code>Not_found</code>, then the exception will be passed\n        to the parent monitor and delivered as usual.\n      </blockquote>")))
 (idp10724336
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Note that we use <code>Monitor.extract_exn</code> to grab\n        the underlying exception that was thrown. Async wraps exceptions\n        it catches with extra information, including the monitor trace,\n        so you need to grab the underlying exception to match on it.\n      </blockquote>")))
 (idp10720192
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Here's an example of a monitor which passes some exceptions\n        through to the parent, and handles others. Exceptions are sent\n        to the parent using <code>Monitor.send_exn</code>, with\n        <code>Monitor.current</code> being called to find the\n        current monitor, which is the parent of the newly created\n        monitor.\n      </blockquote>")))
 (idp10717984
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The message &quot;an error happened&quot; is printed out, but\n        the deferred returned by <code>swallow_error</code> is\n        never determined. This makes sense, since the calculation never\n        actually completes, so there's no value to return. You can break\n        out of this in utop by hitting <code>Control-C</code>.\n      </blockquote>")))
 (idp10714800
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Monitors can do more than just augment the error-trace of an\n        exception. You can also use a monitor to explicitly handle\n        errors delivered to that monitor. The\n        <code>Monitor.errors</code> call is a particularly\n        important one. It detaches the monitor from its parent, handing\n        back the stream of errors that would otherwise have been\n        delivered to the parent monitor. This allows one to do custom\n        handling of errors, which may include re-raising errors to the\n        parent. Here is a very simple example of function that captures\n        and ignores errors in the processes it spawns.\n      </blockquote>")))
 (idp10714016
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        In addition to the ordinary stack-trace, the exception displays\n        the trace of monitors through which the exception traveled,\n        starting at the one we created, called &quot;blow up\n        monitor&quot;. The other monitors you see come from utop's\n        special handling of deferreds.\n      </blockquote>")))
 (idp10708464
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Monitors are arranged in a tree -- when a new monitor is created\n        (say, using <code>Monitor.create</code>) it is a child of\n        the current monitor. You can explicitly run jobs within a\n        monitor using <code>within</code>, which takes a thunk\n        that returns a non-deferred value, or\n        <code>within'</code>, which takes a thunk that returns a\n        deferred. Here's an example.\n      </blockquote>")))
 (idp10706272
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        In Async, a monitor is a context that determines what to do when\n        there is an unhandled exception. Every Async job runs within the\n        context of some monitor, which, when the job is running, is\n        referred to as the current monitor. When a new Async job is\n        scheduled, say, using <code>bind</code> or\n        <code>map</code>, it inherits the current monitor of the\n        job that spawned it.\n      </blockquote>")))
 (idp10703600
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>try_with</code> is a a great way of handling\n        exceptions in Async, but it's not the whole story. All of\n        Async's exception-handling mechanisms,\n        <code>try_with</code> included, are built on top of\n        Async's system of <span><em>monitors</em></span>, which are\n        inspired by the error-handling mechanism in Erlang of the same\n        name. Monitors are fairly low-level and are only occasionally\n        used directly, but it's nontheless worth understanding how they\n        work.\n      </blockquote>")))
 (idp10697712
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>try_with f</code> takes as its argument a\n      deferred-returning thunk <code>f</code>, and returns a\n      deferred that becomes determined either as <code>Ok</code>\n      of whatever <code>f</code> returned, or\n      <code>Error exn</code> if <code>f</code> threw an\n      exception before its return value became determined.\n    </blockquote>")))
 (idp10695104
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      We can capture this kind of asynchronous error use the\n      <code>try_with</code> function provided by Async:\n    </blockquote>")))
 (idp10693072
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      This didn't work because <code>try/with</code> only captures\n      exceptions that are thrown in the code directly executed within\n      it, while <code>maybe_raise</code> schedules an Async job to\n      run in the future, and it's that job that throws an exception.\n    </blockquote>")))
 (idp10689728
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      So, how could we capture and handle such an exception? You might\n      try to do this using OCaml's built-in <code>try/with</code>\n      statement, but as you can see below, that doesn't quite do the\n      trick.\n    </blockquote>")))
 (idp10688416
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In utop, the exception thrown by <code>maybe_raise ()</code>\n      terminates the evaluation of just that expression, but in a\n      stand-alone program, an uncaught exception would bring down the\n      entire process.\n    </blockquote>")))
 (idp10684560
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Let's get a better sense of how exceptions work in Async by\n      creating an asynchronous computation that (sometimes) fails with\n      an exception. The function <code>maybe_raise</code> below\n      blocks for half a second, and then either throws an exception or\n      returns unit, alternating between the two behaviors on subsequent\n      calls.\n    </blockquote>")))
 (idp10682864
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      When programming with external resources, errors are everywhere:\n      everything from a flaky server to a network outage to exhausting\n      of local resources can lead to a run-time error. When programming\n      in OCaml, some of these errors will show up explicitly in a\n      function's return type, and of them will show up as exceptions. We\n      covered exception handling in OCaml in\n      <a href=\"error-handling.html#exceptions\">the section called \226\128\156Exceptions\226\128\157</a>, but as we'll see,\n      exception handling in a concurrent program presents some new\n      challenges.\n    </blockquote>")))
 (idp10679712
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        And that's all we need to create a simple but usable definition\n        searcher.\n      </blockquote>")))
 (idp10677296
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Finally, we create a command line interface using\n        <code>Command.async_basic</code>.\n      </blockquote>")))
 (idp10672592
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The difference is that we both dispatch the query and print out\n        the result in the closure passed to <code>map</code>,\n        rather than waiting for all of the results to get back and then\n        printing them out together. We use\n        <code>Deferred.all_unit</code>, which takes a list of\n        <code>unit</code> deferreds and returns a single\n        <code>unit</code> deferred that becomes determined when\n        every deferred on the input list is determined. We can see the\n        type of this function in utop.\n      </blockquote>")))
 (idp10669824
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Note that the list returned by <code>Deferred.all</code>\n        reflects the order of the deferreds passed to it. As such, the\n        definitions will be printed out in the same order that the\n        search wrods are passed in, no matter what orders the queries\n        return in. We could rewrite this code to print out the results\n        as they're received (and thus potentially out of order) as\n        follows.\n      </blockquote>")))
 (idp10665440
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        We used <code>List.map</code> to call\n        <code>get_definition</code> on each word, and\n        <code>Deferred.all</code> to wait for all the results.\n        Here's the type of <code>Deferred.all</code>:\n      </blockquote>")))
 (idp10663632
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The next function dispatches the searches in parallel, waits for\n        the results, and then prints.\n      </blockquote>")))
 (idp10657712
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        We use the <code>Wrapper</code> module from the\n        <code>textwrap</code> package to do the line-wrapping. It\n        may not be obvious that this routine is using Async, but it\n        does: the version of <code>printf</code> that's called\n        here is actually Async's specialized <code>printf</code>\n        that goes through the Async scheduler rather than printing\n        directly. The original definition of <code>printf</code>\n        is shadowed by this ne one when you open\n        <code>Async.Std</code>. An important side effect of this\n        is that if you write an Async program and forget to start the\n        scheduler, calls like <code>printf</code> won't actually\n        generate any output!\n      </blockquote>")))
 (idp10655664
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Running a single search isn't that interesting from a\n        concurrency perspective, so let's write code for dispatching\n        multiple searches in parallel. First, we need code for\n        formatting and printing out the search result.\n      </blockquote>")))
 (idp10653584
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        In this case, the HTTP body probably isn't very large, so we\n        call <code>Pipe.to_list</code> to collect the strings from\n        the pipe as a single deferred list of strings. We then join\n        those strings using <code>String.concat</code> and pass\n        the result through our parsing function.\n      </blockquote>")))
 (idp10651552
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The <code>get</code> call takes as a required argument a\n        URI, and returns a deferred value is returned, containing a\n        <code>Cohttp.Response.t</code> (which we ignore) and a\n        pipe reader to which the body of the request will be written to\n        as it is received.\n      </blockquote>")))
 (idp10648896
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        To better understand what's going on, it's useful to look at the\n        type for <code>Cohttp_async.Client.get</code>, which we\n        can do in utop.\n      </blockquote>")))
 (idp10646864
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Now let's look at the code for dispatching the search queries\n        over HTTP, using the Cohttp library.\n      </blockquote>")))
 (idp10641744
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        We expect the response from DuckDuckGo to come across as a JSON\n        record, which is represented by the <code>Assoc</code> tag\n        in Yojson's JSON variant. We expect the definition itself to\n        come across under either the key &quot;Abstract&quot; or\n        &quot;Definition&quot;, and so the code below looks under both\n        keys, returning the first one for which a non-empty value is\n        defined.\n      </blockquote>")))
 (idp10639664
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The HTTP response from DuckDuckGo is in JSON, a common (and\n        thankfully simple) format that is specified in\n        <a href=\"http://www.ietf.org/rfc/rfc4627.txt\" target=\"_top\">RFC4627</a>.\n        We'll parse the JSON data using the Yojson library, which we\n        already introduced in\n        <a href=\"handling-json-data\" target=\"_top\">xref</a>.\n      </blockquote>")))
 (idp10635648
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        A <code>Uri.t</code> is constructed from the\n        <code>Uri.of_string</code> function, and a query parameter\n        <code>q</code> is added with the desired search query. The\n        library takes care of encoding the URI correctly when outputting\n        it in the network protocol.\n      </blockquote>")))
 (idp10633840
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        We'll need a function for generating the URI's that we're going\n        to use to query the DuckDuckGo servers.\n      </blockquote>")))
 (idp10631616
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        You're probably familiar with HTTP URLs, which identify\n        endpoints across the World Wide Web. These are actually part of\n        a more general family known as Uniform Resource Identifiers\n        (URIs). The full URI specification is defined in\n        <a href=\"http://tools.ietf.org/html/rfc3986\" target=\"_top\">RFC3986</a>,\n        and is rather complicated. Luckily, the <code>uri</code>\n        library provides a strongly-typed interface which takes care of\n        much of the hassle.\n      </blockquote>")))
 (idp10630064
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Now let's dive into the implementation.\n    </blockquote>")))
 (idp10627888
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>cohttp</code>, a library for creating HTTP clients\n          and servers. We need Async support, which comes with the\n          <code>cohttp.async</code> package.\n        </blockquote>")))
 (idp10625568
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>yojson</code>, a JSON parsing library that was\n          described in\n          <a href=\"handling-json-data.html#parsing-json-with-yojson\">the section called \226\128\156Parsing JSON with Yojson\226\128\157</a>\n</blockquote>")))
 (idp10623824
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>uri</code>, a library for handling URI's, or\n          &quot;Uniform Resource Identifiers&quot;, of which HTTP URL's\n          are an example.\n        </blockquote>")))
 (idp10622288
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>textwrap</code>, a library for wrapping long\n          lines. We'll use this for printing out our results.\n        </blockquote>")))
 (idp10620464
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Our code is going to rely on a number of other libraries, all of\n      which can be installed using OPAM. Refer to\n      <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a> if you need help on the\n      installation. Here's the list of libraries we'll need.\n    </blockquote>")))
 (idp10619824
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      DuckDuckGo is a search engine with a freely available search\n      interface. In this section, we'll use Async to write a small\n      command-line utility for querying DuckDuckGo to extract\n      definitions for a collection of terms.\n    </blockquote>")))
 (idp10614944
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        This differs from the ordinary <code>Command.basic</code>\n        call in that the main function must return a\n        <code>Deferred.t</code>, and that the running of the\n        command (using <code>Command.run</code>) automatically\n        starts the async scheduler, without requiring an explicit call\n        to <code>Scheduler.go</code>.\n      </blockquote>")))
 (idp10609696
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The command-line parsing for this program is based on the\n        <code>Command</code> library that we introduced in\n        <a href=\"command-line-parsing.html\">Chapter\194\16013, <i>Command Line Parsing</i></a>. When you open\n        <code>Async.Std</code>, the <code>Command</code>\n        module has added to it the <code>async_basic</code> call:\n      </blockquote>")))
 (idp10608208
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Importantly, the deferred returned by\n        <code>Pipe.transfer</code> becomes determined once the\n        reader has been closed and the last element is transferred from\n        the reader to the writer. Once that deferred becomes determined,\n        the server will shut down that client connection. So, when a\n        client disconnects, the rest of the shutdown happens\n        transparently.\n      </blockquote>")))
 (idp10606048
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The two pipes being connected are generated by the\n        <code>Reader.pipe</code> and\n        <code>Writer.pipe</code> call respectively. Note that\n        pushback is preserved throughout the process, so that if the\n        writer gets blocked, the the writer's pipe will stop pulling\n        data from the reader's pipe, which will prevent the reader from\n        reading in more data.\n      </blockquote>")))
 (idp10601376
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        In the function <code>run</code> above, we're taking\n        advantage of one of the many utility functions provided for\n        pipes in the <code>Pipe</code> module. In particular,\n        we're using <code>Pipe.transfer</code> to set up a process\n        that takes data from a reader-pipe and moves it to a\n        writer-pipe. Here's the type of\n        <code>Pipe.transfer</code>:\n      </blockquote>")))
 (idp10599584
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The deferred returned by write completes on its own once the\n        value written into the pipe has been read out:\n      </blockquote>")))
 (idp10597264
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        If we just try and write to the writer, we'll see that we block\n        indefinitely in utop. You can break out of the wait by hitting\n        <code>Control-C</code>.\n      </blockquote>")))
 (idp10593744
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>r</code> and <code>w</code> are really just\n        read and write handles to the same underlying object. Note that\n        <code>r</code> and <code>w</code> have weakly\n        polymorphic types. That's because a pipe is mutable and so can\n        contain elements of only one type, which will be settled by the\n        compiler once we try to use the pipe for anything.\n      </blockquote>")))
 (idp10592176
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Pipes are created in connected read/write pairs, as you can see\n        below.\n      </blockquote>")))
 (idp10589856
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        The most notable change in this function is the use of Async's\n        <code>Pipe</code>. A <code>Pipe</code> is a\n        communication channel that's used for connecting different parts\n        of your program. You can think of it as a consumer/producer\n        queue that uses deferreds for communicating when the pipe is\n        ready to be read from or written to. Our use of pipes is fairly\n        minimal here, but they are an important part of Async, so it's\n        worth discussing them in some detail.\n      </blockquote>")))
 (idp10587312
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Here's the improved code below.\n      </blockquote>")))
 (idp10585872
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n            Simplify the code using Async's <code>Pipe</code>\n            interface.\n          </blockquote>")))
 (idp10584896
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n            Add a flag to specify the port to listen on, and a flag to\n            make the server echo back the capitalized version of\n            whatever was sent to it.\n          </blockquote>")))
 (idp10583360
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n            Add a proper command-line interface with\n            <code>Command</code>\n</blockquote>")))
 (idp10582320
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Let's try to go a little bit farther with our echo server. Let's\n        walk through a few small improvements:\n      </blockquote>")))
 (idp10579792
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Thus, we got the compilation to go through by explicitly marking\n      in the source that the call to <code>loop_forever</code>\n      never returns.\n    </blockquote>")))
 (idp10577408
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      We can resolve the error by calling the function\n      <code>never_returns</code>.\n    </blockquote>")))
 (idp10573232
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The type <code>never_returns</code> is uninhabited, so a\n      function can't return a value of type\n      <code>never_returns</code>, which means only functions that\n      never return can have it as their return type! Now, if we rewrite\n      our <code>do_stuff</code> function, we'll get a helpful type\n      error.\n    </blockquote>")))
 (idp10568544
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      With a name like <code>loop_forever</code>, the meaning is\n      clear enough in this case. But with something like\n      <code>Scheduler.go</code>, the fact that it never returns is\n      less clear, and so we use the type-system to make it more explicit\n      by giving it a return type of <code>never_returns</code>. To\n      make it clearer how this works, let's do the same trick with\n      <code>loop_forever</code>.\n    </blockquote>")))
 (idp10566704
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      This can be surprising when you call a function like this\n      expecting it to return unit, and really it never returns. The\n      type-checker won't necessarily complain in such a case.\n    </blockquote>")))
 (idp10562000
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      You might wonder what's going on with the call to\n      <code>never_returns</code> above.\n      <code>never_returns</code> is an idiom that comes from\n      <code>Core</code> that is used to mark functions that don't\n      return. Typically, a function that doesn't return is inferred as\n      having return type <code>'a</code>.\n    </blockquote>")))
 (idp10559040
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Now that we have the echo server, we can try it out using\n      <code>netcat</code>.\n    </blockquote>")))
 (idp10558432
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      It's worth noting that even though we didn't spend much explicit\n      effort on thinking about multiple clients, this server is able to\n      handle many concurrent clients without further modification.\n    </blockquote>")))
 (idp10557056
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      One of the most common newbie errors with Async is to forget to\n      run the scheduler. It can be a bewildering mistake, because\n      without the scheduler, your program won't do anything at all; even\n      calls to <code>printf</code> won't actually reach the\n      terminal.\n    </blockquote>")))
 (idp10555520
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Finally, we need to initiate the server and start the Async\n      scheduler.\n    </blockquote>")))
 (idp10554032
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The most important argument to\n      <code>Tcp.Server.create</code> is the final one, which is\n      the client connection handler. Notably, the above code does\n      nothing explicit to close down the client connections when the\n      communication is done. That's because the server will\n      automatically shut down the connection once the deferred returned\n      by the handler becomes determined.\n    </blockquote>")))
 (idp10551856
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The result of calling <code>Tcp.Server.create</code> is a\n      <code>Tcp.Server.t</code>, which is a handle to the server\n      that lets you shut the server down. We don't use that\n      functionality here, so we explicitly ignore [server] to suppress\n      the unused-variables error. We put in a type annotation around the\n      ignored value to make the nature of the value we're ignoring\n      explicit.\n    </blockquote>")))
 (idp10547552
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n<code>copy_blocks</code> provides the logic for handling a\n      client connection, but we still need to set up a server to receive\n      such connections and dispatch to <code>copy_blocks</code>.\n      For this, we'll use Async's <code>Tcp</code> module, which\n      has a collection of utilities for creating simple TCP clients and\n      servers.\n    </blockquote>")))
 (idp10546304
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      One important aspect of how this is written is that it uses\n      <span><em>pushback</em></span>, which is to say that if the writer\n      can't make progress writing, the reader will stop reading. If you\n      don't implement pushback in your servers, then a stopped client\n      can cause your program to leak memory, since you'll need to\n      allocate space for the data that's been read in but not yet\n      written out.\n    </blockquote>")))
 (idp10543264
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Bind is used in the above code to sequence the operations: first,\n      we call <code>Reader.read</code> to get a block of input,\n      then, when that's complete and if a new block was returned, we\n      write that block to the writer. Finally, we wait until the\n      writer's buffers are flushed, waiting on the deferred returned by\n      <code>Writer.flushed</code>, at which point we recur. If we\n      hit an end-of-file condition, the loop is ended. The deferred\n      returned by a call to <code>copy_blocks</code> becomes\n      determined only once the end-of-file condition is hit.\n    </blockquote>")))
 (idp10539840
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The first step is to create a function that can copy data from an\n      input to an output. Here, we'll use Async's\n      <code>Reader</code> and <code>Writer</code> modules\n      which provide a convenient abstraction for working with input and\n      output channels.\n    </blockquote>")))
 (idp10538752
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Now that we have the basics of Async under our belt, let's look at\n      a small complete stand-alone Async program. In particular, we'll\n      write an echo server, <span><em>i.e.</em></span>, a program that\n      accepts connections from clients and spits back every line of text\n      sent to it.\n    </blockquote>")))
 (idp10536032
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        This code isn't particularly long, but it is a bit subtle. This\n        is typical of code that involves ivars and\n        <code>upon</code>, and because of this, you should stick\n        to the simpler map/bind/return style of working with deferreds\n        when you can.\n      </blockquote>")))
 (idp10531232
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Our delayer implementation is organized around a queue of\n        thunks, where every call to <code>schedule</code> adds a\n        thunk to the queue, and also schedules a job in the future to\n        grab a thunk off the queue and run it. The waiting will be done\n        using the function <code>after</code> which takes a time\n        span and returns a deferred which becomes determined after that\n        time span elapses. The role of the <code>ivar</code> here\n        is to take the value returned by the thunk and use it to fill\n        the deferred returned by the provided thunk.\n      </blockquote>")))
 (idp10528480
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Like <code>bind</code> and <code>return</code>,\n        <code>upon</code> schedules a callback to be executed when\n        the deferred it is passed is determined; but unlike those calls,\n        it doesn't create a new deferred for this callback to fill.\n      </blockquote>")))
 (idp10520848
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        An action is handed to <code>schedule</code> in the form\n        of a deferred-returning thunk (a thunk is a function whose\n        argument is of type <code>unit</code>). A deferred is\n        handed back to the caller of <code>schedule</code> that\n        will eventually be filled with the contents of the deferred\n        value returned by the thunk to be scheduled. We can implement\n        this using an <code>ivar</code> which we fill after the\n        thunk is called and the deferred it returns becomes determined.\n        Instead of using <code>bind</code> or\n        <code>map</code> for scheduling these events, we'll use a\n        different operator called <code>upon</code>. Here's the\n        signature of <code>upon</code>:\n      </blockquote>")))
 (idp10518976
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        As an example, imagine we wanted a way of scheduling a sequence\n        of actions that would run after a fixed delay. In addition, we'd\n        like to guarantee that these delayed actions are executed in the\n        same order they were scheduled in. One could imagine building a\n        module for handling this with the following interface.\n      </blockquote>")))
 (idp10518272
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Ivars are something of a low-level feature; operators like map,\n        bind and return are typically easier to use and think about. But\n        ivars can be useful when you want to build complicated\n        synchronization patterns that can't be constructed naturally\n        otherwise.\n      </blockquote>")))
 (idp10514096
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        There are three fundamental operations for working with an ivar;\n        you can create one, using <code>Ivar.create</code>, you\n        can read off the deferred that corresponds to the ivar in\n        question, using <code>Ivar.read</code>, and you can fill\n        an ivar, thus causing that deferred to become determined, using\n        <code>Ivar.fill</code>. These operations are illustrated\n        below.\n      </blockquote>")))
 (idp10510864
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n        Deferreds are usually built using combinations of\n        <code>bind</code>, <code>map</code> and\n        <code>return</code>, but sometimes you want to construct a\n        deferred that you can determine explicitly with user-code. This\n        is done using an <span><em>ivar</em></span>, which is a handle\n        that lets you control precisely when a deferred becomes\n        determined.\n      </blockquote>")))
 (idp10506592
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      and comes with its own infix equivalent,\n      <code>&gt;&gt;|</code>. Using it, we can rewrite\n      <code>count_lines</code> again a bit more succinctly:\n    </blockquote>")))
 (idp10502864
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Calling <code>bind</code> and <code>return</code>\n      together is a fairly common pattern, and as such there is a\n      standard shortcut for it called <code>Deferred.map</code>,\n      which has the following signature:\n    </blockquote>")))
 (idp10499504
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Together, <code>bind</code> and <code>return</code>\n      form a design pattern in functional programming known as a\n      <span><em>monad</em></span>. You'll run across this signature in\n      many applications beyond just threads. Indeed, we already ran\n      across monads in\n      <a href=\"error-handling.html#bind-and-other-error-handling-idioms\">the section called \226\128\156<code>bind</code> and other error-handling\n      idioms\226\128\157</a>.\n    </blockquote>")))
 (idp10496272
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Using <code>return</code>, we can make\n      <code>count_lines</code> compile.\n    </blockquote>")))
 (idp10493952
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The issue here is that bind expects a function that returns a\n      deferred, but we've provided it a function that simply returns the\n      result. To make these signatures match, we need a function for\n      taking an ordinary value and wrapping it in a deferred. This\n      function is a standard part of Async, and is called\n      <code>return</code>:\n    </blockquote>")))
 (idp10492672
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      This looks reasonable enough, but when we try to compile it, we\n      get the following error.\n    </blockquote>")))
 (idp10490816
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Now let's look at another potential use of bind. In this case,\n      we'll write a function that counts the number of lines in a file.\n    </blockquote>")))
 (idp10490160
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In the above we've dropped the parenthesis around the function on\n      the right-hand side of the bind, and we've didn't add a level of\n      indentation for the contents of that function. This is standard\n      practice for using the bind operator.\n    </blockquote>")))
 (idp10485360
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Writing out <code>Deferred.bind</code> explicitly can be\n      rather verbose, and so <code>Async.Std</code> includes an\n      infix operator for it: <code>&gt;&gt;=</code>. Using this\n      operator, we can rewrite <code>uppercase_file</code> as\n      follows.\n    </blockquote>")))
 (idp10483424
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Here's a simple use of bind for a function that replaces a file\n      with an uppercase version of its contents.\n    </blockquote>")))
 (idp10477424
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Thus, <code>Deferred.bind d f</code> takes a deferred value\n      <code>d</code> and a function f that is to be run with value\n      of <code>d</code> once it's determined. The call to\n      <code>Deferred.bind</code> returns a new deferred that\n      becomes determined when the deferred returned by\n      <code>f</code> is determined. It also implicitly registers\n      with the scheduler an <span><em>Async job</em></span> that is\n      responsible for running <code>f</code> once\n      <code>d</code> is determined.\n    </blockquote>")))
 (idp10474992
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In order to do real work with deferreds, we need a way of\n      sequencing deferred computations, which we do using\n      <code>Deferred.bind</code>. First, let's consider the\n      type-signature of bind.\n    </blockquote>")))
 (idp10471408
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      The value in <code>contents</code> isn't yet determined in\n      part because there's nothing running that could do the necessary\n      I/O. When using Async, processing of I/O and other events is\n      handled by the Async scheduler. When writing a stand-along\n      program, you need to start the scheduler explicitly, but utop\n      knows about Async, and can start the scheduler automatically. More\n      than that, utop knows about deferred values, and when you type in\n      an expression of type <code>Deferred.t</code>, it will make\n      sure the scheduler is running and block until the deferred is\n      determined. Thus, we can write:\n    </blockquote>")))
 (idp10468160
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      A deferred is essentially a handle to a value that may be computed\n      in the future. As such, if we call\n      <code>Reader.file_contents</code>, the resulting deferred\n      will initially be empty, as you can see by calling\n      <code>Deferred.peek</code> on the resulting deferred.\n    </blockquote>")))
 (idp10465360
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Note that we opened <code>Async.Std</code>, which adds a\n      number of new identifiers and modules into our environment that\n      make using Async more convenient. Opening\n      <code>Async.Std</code> is standard practice for writing\n      programs using Async, much like opening\n      <code>Core.Std</code> is for using Core.\n    </blockquote>")))
 (idp10462224
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      In Async, well-behaved functions never block. Instead, they return\n      a value of type <code>Deferred.t</code> that acts as a\n      placeholder that will eventually be filled in with the result. As\n      an example, consider the signature of the Async equivalent of\n      <code>In_channel.read_all</code>.\n    </blockquote>")))
 (idp10460288
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Since the function returns a concrete string, it has to block\n      until the read completes. The blocking nature of the call means\n      that no progress can be made on anything else until the read is\n      completed, as you can see below.\n    </blockquote>")))
 (idp10458800
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n      Consider a typical function for doing I/O in Core.\n    </blockquote>")))
 (idp10456944
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n    This chapter covers the Async library, which offers a hybrid model\n    that aims to provide the best of both worlds, avoiding the\n    performance compromises and synchronization woes of preemptive\n    threads without the confusing inversion of control that usually\n    comes with event-driven systems.\n  </blockquote>")))
 (idp10456128
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n    Single-threaded event-driven systems, on the other hand, execute a\n    single task at a time and do not require the same kind of complex\n    synchronization that preemptive threads do. However, the inverted\n    control structure of an event-driven program often means that your\n    own control flow has to be threaded awkwardly through the system's\n    event loop, leading to a maze of event callbacks.\n  </blockquote>")))
 (idp10455344
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n    Each of these mechanisms has its own trade-offs. Preemptive threads\n    require significant memory and other resources per thread. Also, the\n    operating system can arbitrarily interleave the execution of\n    preemptive threads, requiring the programmer to carefully protect\n    shared resources with locks and condition variables, which can be\n    exceedingly error-prone.\n  </blockquote>")))
 (idp10454432
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n    A common approach to concurrency is to use preemptive system\n    threads, which is the most common solution in languages like Java or\n    C#. In this model, each task that may require simultaneous waiting\n    is given an operating system thread of its own, so it can block\n    without stopping the entire program. Other language runtimes such as\n    Javascript are single-threaded, and applications register function\n    callbacks to be triggered upon external events such as a timeout or\n    browser click.\n  </blockquote>")))
 (idp10453136
  ((file concurrent-programming-with-async.html)
   (html
    "<blockquote>\n    The logic of building programs that interact with the outside world\n    is often dominated by waiting: waiting for the click of a mouse, or\n    for data to be fetched from disk, or for space to be available on an\n    outgoing network buffer. Even mildly sophisticated sophisticated\n    interactive applications are typically\n    <span><em>concurrent</em></span>, needing to wait for multiple\n    different events at the same time, responding immediately to\n    whatever event happens first.\n  </blockquote>")))
 (idp9908448
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        It will help to check out how other applications that install\n        tab-completion scripts and following their lead, as the details\n        are very OS-specific.\n      </blockquote>")))
 (idp9907024
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        Sadly, <code>bash</code> doesn't support installing a\n        generic handler for all Command-based applications. This means\n        that you have to install the completion script for every\n        application, but you should be able to automate this in the\n        build and packaging system for your application.\n      </blockquote>")))
 (idp9905760
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        Command completion support works for flags and grouped commands,\n        and is very useful when building larger command-line interfaces.\n      </blockquote>")))
 (idp9903680
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The first line above redirects the earlier output into your\n        <code>bash_completion.d</code> directory. The\n        <code>bash -l</code> loads the new configuration as a\n        fresh login shell, and then the final line shows the four valid\n        commands by pressing the tab key.\n      </blockquote>")))
 (idp9901312
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        You don't need to worry about what this script actually does\n        (unless you have an unhealthy fascination with shell scripting,\n        that is). Instead, redirect the output to a file in your\n        <code>bash_completion.d</code> directory, named after the\n        command you're installing.\n      </blockquote>")))
 (idp9897872
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        For example, let's try it on our calendar example from earlier,\n        assuming that the binary is called <code>cal</code> in the\n        current directory:\n      </blockquote>")))
 (idp9896416
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The Command library has a declarative description of all the\n        possible valid options, and it can use this information to\n        generate a shell script which provides completion support for\n        that command. To generate the fragment, just run the command\n        with the <code>COMMAND_OUTPUT_INSTALLATION_BASH</code>\n        environment variable set to any value.\n      </blockquote>")))
 (idp9892416
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      One last bit of information you'll need to find is the location of\n      the <code>bash_completion.d</code> directory. This is where\n      all the shell fragments that contain the completion logic are\n      held. On Linux, this is often in\n      <code>/etc/bash_completion.d</code>, and in Homebrew on Mac\n      OS X it would be\n      <code>/usr/local/etc/bash_completion.d</code> by default.\n    </blockquote>")))
 (idp9889520
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Once you have bash completion installed and configured, check that\n      it works by typing the <code>ssh</code> command, and\n      pressing <code>tab</code>. This should show you the list of\n      known hosts from your <code>~/.ssh/known_hosts</code> file.\n      If it lists those, then you can continue on, but if it lists the\n      files in your current directory instead, then check your OS\n      documentation to configure completion correctly.\n    </blockquote>")))
 (idp9868048
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Bash autocompletion isn't always installed by default, so check\n      your OS package manager to see if you have it available.\n    </blockquote>")))
 (idp9865840
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The precise mechanism for autocompletion varies depending on what\n      shell you are using, but we'll assume you are using the most\n      common one: <code>bash</code>. This is the default\n      interactive shell on most Linux distributions and Mac OS X, but\n      you may need to switch to it on *BSD or Windows (when using\n      Cygwin). The rest of this section assumes that you're using\n      <code>bash</code>.\n    </blockquote>")))
 (idp9864304
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Modern UNIX shells usually have a tab-completion feature to\n      interactively help you figure out how to build a command-line.\n      These work by pressing the <code>&lt;tab&gt;</code> key in\n      the middle of typing a command, and seeing the options that pop\n      up. You've probably used this most often to find the files in the\n      current directory, but it can actually be extended for other parts\n      of the command too.\n    </blockquote>")))
 (idp9860848
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        This example goes back to our non-interactive calendar addition\n        program, but adds a <code>step</code> combinator to turn\n        the normal arguments into labelled ones. This is reflected in\n        the callback function below, and can help prevent errors with\n        command-line arguments with similar types but different names.\n      </blockquote>")))
 (idp9857824
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The <code>step</code> chaining combinator lets you control\n        the types of your callbacks very easily. This can either help\n        you fit in with existing interfaces, or make things more\n        explicit by adding labelled arguments.\n      </blockquote>")))
 (idp9853840
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The first half of the <code>Spec.t</code> shows that the\n        callback type is <code>Date.t -&gt; int</code>, whereas\n        the resulting value that is expected from the next specification\n        in the chain is a <code>Date.t -&gt; int option</code>.\n      </blockquote>")))
 (idp9849616
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        Notice that the &quot;program logic&quot; in the final callback\n        doesn't see any of this, and is exactly the same as in our\n        original version. The <code>step</code> combinator has\n        transformed an <code>int option</code> argument into an\n        <code>int</code>. This is reflected in the type of the\n        specification:\n      </blockquote>")))
 (idp9845264
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        There are two main changes from the simple example that accepts\n        a date and an integer. Firstly, the <code>days</code>\n        argument is now an optional integer instead of a required\n        argument. The <code>step</code> combinator takes the date\n        and days parameters, and interactively reads an integer if no\n        day value was supplied. It then returns an\n        <code>int</code> instead of the\n        <code>int option</code> that was passed in.\n      </blockquote>")))
 (idp9842192
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The <code>step</code> combinator lets you control the\n        normal course of parsing by supplying a function that maps\n        callback arguments to a new set of values. For instance, let's\n        suppose we want our first calendar application to prompt for the\n        number of days to add if a value wasn't supplied on the\n        command-line.\n      </blockquote>")))
 (idp9838672
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        While this does look scary, the key line to scan is the last\n        one, where it's telling you that you have supplied too many\n        arguments in the callback function\n        (<code>unit -&gt; unit</code> vs <code>unit</code>).\n        If you started with a working program and made this single\n        change, you typically don't even need to read the type error, as\n        the filename and location information is sufficient to make the\n        obvious fix.\n      </blockquote>")))
 (idp9835728
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        For example, if we remove the <code>verbose</code> flag\n        above and compile, we'll get this impressively long type error:\n      </blockquote>")))
 (idp9834992
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        Both of these flags will now be applied and passed to all the\n        callback functions. This makes code refactoring a breeze by\n        using the compiler to spot places where you use commands. Just\n        add a parameter to the common definition, run the compiler, and\n        fix type errors until everything works again.\n      </blockquote>")))
 (idp9832384
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        The definitions of the specifications are very similar to the\n        earlier example, except that they append a\n        <code>common</code> parameter after each specification. We\n        can supply these flags when defining the groups:\n      </blockquote>")))
 (idp9829296
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        If you want to factor out common command-line operations, the\n        <code>++</code> operator will append two specifications\n        together. Let's add some dummy verbosity and debug flags to our\n        calendar application to illustrate this.\n      </blockquote>")))
 (idp9824336
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The final line is the important one. It shows that the callback\n      function for a spec should consume identical arguments to the\n      supplied <code>main</code> function, except that there is an\n      additional <code>unit</code> argument. This final\n      <code>unit</code> is there in case there are no command-line\n      arguments, as at least one parameter is required for the callback.\n      That's why you have to supply an additional <code>()</code>\n      to the callback function in the previous examples.\n    </blockquote>")))
 (idp9822080
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The type of <code>Command.basic</code> should make more\n      sense now:\n    </blockquote>")))
 (idp9817568
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      One forms a command by combining a spec of type\n      <code>('main, unit) Spec.t</code> with a main function of\n      type <code>'main</code>. All the combinators we've shown so\n      far incrementally build up the type of <code>'main</code>\n      according to the command-line parameters it expects, so the\n      resulting type of <code>'main</code> is something like:\n    </blockquote>")))
 (idp9812992
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The empty specification is simple as it doesn't add any parameters\n      to the callback type. The second example adds an\n      <code>int</code> anonymous parameter that is reflected in\n      the inferred type. Notice that the return value of this fragment\n      has been inferred to be <code>'_a</code> instead of the\n      usual <code>'a</code>. The underscore denotes a\n      <span><em>weakly polymorphic type</em></span> which cannot be\n      generalized further. You should never see this in normal use, but\n      you may encounter this if you define specifications in the\n      top-level of a module. You can work around this so-called\n      <span><em>value restriction</em></span> by moving the definitions\n      under a <code>let</code> binding.\n    </blockquote>")))
 (idp9809760
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Such a value transforms a main function of type\n      <code>arg1 -&gt; ... -&gt; argN -&gt; 'r</code> by supplying\n      all the argument values, leaving a main function that returns a\n      value of type <code>'r</code>. Let's look at some examples\n      of specs, and their types:\n    </blockquote>")))
 (idp9806128
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The type of a specification transforms a\n      <code>'main_in</code> to a <code>'main_out</code>\n      value. For instance, a value of <code>Spec.t</code> might\n      have type:\n    </blockquote>")))
 (idp9805408
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n          how to auto-complete a partial command line\n        </blockquote>")))
 (idp9804560
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n          what the command does and how to call it\n        </blockquote>")))
 (idp9803728
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n          how to parse the command line\n        </blockquote>")))
 (idp9801296
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You can think of <code>('a, 'b) t</code> as a function of\n      type <code>'a -&gt; 'b</code>, but embellished with\n      information about:\n    </blockquote>")))
 (idp9799168
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The type of <code>Command.t</code> looks deceptively simple:\n    </blockquote>")))
 (idp9797568
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The Command module's safety relies on the specification's output\n      values precisely matching the callback function which invokes the\n      main program. Any mismatch here will inevitably result in a\n      dynamic failure, and so Command uses some interesting type\n      abstraction to guarantee they remain in sync. You don't have to\n      understand this section to use the more advanced combinators, but\n      it'll help you debug type errors as you use\n      <code>Command</code> more.\n    </blockquote>")))
 (idp9794512
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The use of the spec combinators has been somewhat magic so far: we\n      just build them up with the '+&gt;' combinator and things seem to\n      work. As your programs get larger and more complex, you'll want to\n      factor out common functionality between specifications. Some other\n      times, you'll need to interrupt the parsing to perform special\n      processing, such as requesting an interactive passphrase from the\n      user before proceeding. We'll show you some new combinators that\n      let you do this now.\n    </blockquote>")))
 (idp9791904
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      We can invoke the two commands we just defined to verify that they\n      work and see the date parsing in action.\n    </blockquote>")))
 (idp9790400
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      And that's all you need to add sub-command support! The help page\n      for our calendar now reflects the two commands we just added:\n    </blockquote>")))
 (idp9787440
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Once we've tested this and made sure it works, we can define\n      another command that takes the difference of two dates. Both of\n      the commands are now grouped as sub-commands using\n      <code>Command.group</code>.\n    </blockquote>")))
 (idp9785168
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Let's build the beginning of a calendar tool that does a few\n      operations over dates from the command line. We first define a\n      command that adds days to an input date and prints the resulting\n      date.\n    </blockquote>")))
 (idp9783120
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>group</code> signature accepts a list of basic\n      <code>Command.t</code> values and their corresponding names.\n      When executed, it looks for the appropriate sub-command from the\n      name list, and dispatches it to the right command handler.\n    </blockquote>")))
 (idp9777792
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>config</code>, <code>remote</code> and\n      <code>install</code> keywords form a logical grouping of\n      commands, and factor out flags and arguments that are specific to\n      that particular operation. It's really simple to extend your\n      application to do this in Command: just swap\n      <code>Command.basic</code> for\n      <code>Command.group</code>:\n    </blockquote>")))
 (idp9776448
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You'll have run across this style already when using the OPAM\n      package manager (or, in the non-OCaml world, the Git or Mercurial\n      commands). OPAM exposes commands in this form:\n    </blockquote>")))
 (idp9775664
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You can get pretty far by combining flags and anonymous arguments\n      to assemble complex command-line interfaces. After a while though,\n      too many options can make the program very confusing for newcomers\n      to your application. One way to solve this is by grouping common\n      operations together and adding some hierarchy to the command-line\n      interface.\n    </blockquote>")))
 (idp9771632
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Notice that the <code>get_file_data</code> function now\n      pattern matches across the <code>checksum</code> flag and\n      the <code>file</code> anonymous argument. It selects the\n      flag in preference to the anonymous argument, but emits a warning\n      if there's ambiguity and both are specified.\n    </blockquote>")))
 (idp9770960
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The flags affect the type of the callback function in exactly the\n      same way as anonymous arguments do. This lets you change the\n      specification and ensure that all the callback functions are\n      updated appropriately, without runtime errors.\n    </blockquote>")))
 (idp9750624
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>-s</code> flag in our specification requires a\n      <code>string</code> argument, and the parser outputs an\n      error message if it isn't supplied. Here's a list of some of the\n      functions that you can wrap flags in to control how they are\n      parsed:\n    </blockquote>")))
 (idp9744144
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The example specification uses the <code>flag</code> command\n      now. The first argument to <code>flag</code> is its name on\n      the command-line, and the <code>doc</code> argument supplies\n      the help text. The <code>doc</code> string is formatted so\n      that the first word is the short name that appears in the usage\n      text, with the remainder being the full help text. Notice that the\n      <code>-t</code> flag has no argument, and so we prepend its\n      <code>doc</code> text with a blank space. The help text for\n      the above code looks like this:\n    </blockquote>")))
 (idp9738736
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Let's add two arguments to our <code>md5</code> command that\n      mimic the Linux version. A <code>-s</code> flag specifies\n      the string to be hashed directly on the command-line, and a\n      <code>-t</code> runs a benchmarking self-test. The complete\n      example is:\n    </blockquote>")))
 (idp9737952
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You aren't just limited to anonymous arguments on the\n      command-line, and you'll find that flags are useful once your\n      program has more options. A flag is a named field that can be\n      followed by an optional argument. These flags can appear in any\n      order on the command-line, or multiple times, depending on how\n      they're declared in the specification.\n    </blockquote>")))
 (idp9725312
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      There are several other transformations you can do on anonymous\n      arguments. We've shown you <code>maybe</code>, and you can\n      also obtain lists of arguments or supply default values. Try\n      altering the example above to take a list of files and output\n      checksums for all of them, just as the <code>md5</code>\n      command does.\n    </blockquote>")))
 (idp9721616
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      This is because the type of the callback function has changed. It\n      now wants a <code>string option</code> instead of a\n      <code>string</code> since the value is optional. We can\n      quickly adapt our example to use the new information and read from\n      standard input if no file is specified.\n    </blockquote>")))
 (idp9719232
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The anonymous parameter has been prefixed with a\n      <code>maybe</code> that indicates the value is now optional.\n      If you compile the example, you'll get a type error though:\n    </blockquote>")))
 (idp9716864
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      A more realistic <code>md5</code> function might also read\n      from the standard input if a filename isn't specified. We can\n      change our specification with a single line to reflect this by\n      writing:\n    </blockquote>")))
 (idp9685376
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You aren't just limited to parsing command lines as strings of\n      course. <code>Command.Spec</code> defines several other\n      conversion functions that validate and parse input into various\n      types:\n    </blockquote>")))
 (idp9681808
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The function also needs an extra <code>unit</code> argument\n      after <code>file</code>. This is simply so that the command\n      specifications can work even when they are empty\n      (<code>Command.Spec.empty</code>). Every OCaml function\n      needs at least one argument, so the final <code>unit</code>\n      guarantees that it will not be evaluated immediately as a value if\n      there are no other arguments.\n    </blockquote>")))
 (idp9679328
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The final argument is the callback function where all the actual\n      work happens after the command-line parsing is complete. This\n      function will be applied with the parsed command-line arguments,\n      and should perform the actual work. In our example, we had just\n      one anonymous argument, so the callback function just has a single\n      <code>string</code> parameter applied to it:\n    </blockquote>")))
 (idp9675040
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>basic</code> function takes a few more arguments\n      in addition to the specification. The <code>summary</code>\n      is a one-line description to go at the top of the command help\n      screen, while <code>readme</code> is for longer help text\n      when the command is called with <code>-help</code>. The\n      <code>readme</code> argument is a function that is only\n      evaluated when the help text is actually needed.\n    </blockquote>")))
 (idp9671760
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      This specification is then bundled together with the callback\n      functions using <code>Command.basic</code>. For our\n      <code>md5</code> example, we have:\n    </blockquote>")))
 (idp9667344
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The specification above begins with an <code>empty</code>\n      value, and then chains more parameters via the\n      <code>+&gt;</code> combinator. Our example uses the\n      <code>anon</code> function to define a single anonymous\n      parameter. Anonymous parameters are assigned a string name that is\n      used in help text, and an OCaml type that they are parsed into\n      from the raw command-line string. The example\n      <code>filename</code> argument above is extracted from the\n      command-line and kept as an OCaml <code>string</code>.\n    </blockquote>")))
 (idp9665264
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      Let's build the specification for a single argument that is\n      specified directly on the command-line (this is known as an\n      <span><em>anonymous</em></span> argument).\n    </blockquote>")))
 (idp9663760
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      So how does all this work? Most of the interesting logic lies in\n      how the specifications are defined. The\n      <code>Command.Spec</code> module defines several combinators\n      that can be chained together to define flags and anonymous\n      arguments, what types they should map to, and whether to take\n      special actions (such as interactive input) if certain fields are\n      encountered.\n    </blockquote>")))
 (idp9660944
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      When we invoke this binary without any arguments, it outputs a\n      help screen that informs you that a required argument\n      <code>filename</code> is missing. Supplying the argument to\n      the command results in <code>do_hash</code> being called,\n      and the MD5 output being displayed to the standard output.\n    </blockquote>")))
 (idp9656368
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>version</code> and <code>build_info</code>\n      optional arguments to <code>Command.run</code> let you\n      specify versions in the command-line help. You can leave these\n      blank, or get your build system to generate them directly from\n      your version control system (e.g. by running\n      <code>hg tip</code> to generate a build revision number, in\n      the case of Mercurial).\n    </blockquote>")))
 (idp9652800
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      The <code>do_hash</code> function accepts a filename\n      parameter and prints the human-readable MD5 string to the console\n      standard output. The subsequent <code>command</code> value\n      declares how to invoke <code>do_hash</code> by parsing the\n      command-line arguments. When you compile this program and run it,\n      you can query the version information simply by:\n    </blockquote>")))
 (idp9650000
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      You can compile this file the usual way with\n      <code>ocamlfind</code>, but passing an additional\n      <code>cryptokit</code> package. You may need to install\n      Cryptokit via OPAM if you didn't do so earlier.\n    </blockquote>")))
 (idp9647120
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n      We'll begin by cloning the <code>md5</code> binary that is\n      present on most Linux distributions and Mac OS X. It reads in the\n      contents of a file, applies the MD5 one-way hash function to the\n      data, and outputs an ASCII hex representation of the result.\n    </blockquote>")))
 (idp9642080
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n    This chapter demonstrates how to use <code>Command</code> to\n    extend the cryptographic utility from\n    <a href=\"object-oriented-programming.html\">Chapter\194\16010, <i>Object Oriented Programming</i></a> and builds a\n    simple equivalents to the <code>md5</code> and\n    <code>shasum</code> utilities. It also demonstrates how\n    <span><em>functional combinators</em></span> can be used to declare\n    complex data structures in a type-safe and elegant way.\n  </blockquote>")))
 (idp9640608
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n    The <code>Command</code> library also scales as you add more\n    features to your programs. It's simple to use for small\n    applications, but provides a sophisticated subcommand mode that\n    groups related commands together as the application grows more\n    options. You may also be familiar with this command-line style from\n    the Git or Mercurial version control systems.\n  </blockquote>")))
 (idp9639152
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n    It's tedious and error-prone to code all this manually for every\n    program you write. Core simplifies this by letting you declare all\n    your command-line options in one place, using the\n    <code>Command</code> library. This then takes care of parsing\n    the arguments, generating help text and provides interactive\n    auto-completion to the user of the library.\n  </blockquote>")))
 (idp9638512
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        interactive auto-completion of commands to assist the user.\n      </blockquote>")))
 (idp9637664
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        help needs to be shown for all the available options.\n      </blockquote>")))
 (idp9636784
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        sensible error messages have to be generated in response to\n        incorrect inputs.\n      </blockquote>")))
 (idp9635888
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n        program options and file inputs need to be parsed from the\n        command line arguments.\n      </blockquote>")))
 (idp9634656
  ((file command-line-parsing.html)
   (html
    "<blockquote>\n    Many of the OCaml programs that you'll write will end up as binaries\n    that will be run directly from a command prompt. Any non-trivial\n    command-line program needs a few features:\n  </blockquote>")))
 (idp7165328
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      That's it for our guided tour! There are plenty of features left\n      to touch upon and lots of details to explain, but the hope is that\n      this has given you enough of a feel for the language that you have\n      a sense as to what to expect, and will be comfortable reading\n      examples in the rest of the book.\n    </blockquote>")))
 (idp7163088
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        More work is needed to make a really usable command-line\n        program, including a proper command-line parsing interface and\n        better error handling, all of which is covered in\n        <a href=\"command-line-parsing.html\">Chapter\194\16013, <i>Command Line Parsing</i></a>.\n      </blockquote>")))
 (idp7160560
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The <code>.native</code> suffix indicates that we're\n        building a native-code executable, which we'll discuss more in\n        <a href=\"files-modules-and-programs.html\">Chapter\194\1604, <i>Files, Modules and Programs</i></a>. Once the\n        build completes, we can use the resulting program like any\n        command-line utility. In this example, we can just type in a\n        sequence of numbers, one per line, hitting control-d to exit\n        when the input is complete.\n      </blockquote>")))
 (idp7158832
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        With our <code>_tags</code> file in place, we can build\n        our executable by issuing this command.\n      </blockquote>")))
 (idp7155072
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        We can use <code>ocamlbuild</code> to compile the program.\n        We'll need to create a file, in the same directory as\n        <code>sum.ml</code>, called <code>_tags</code>. We\n        can put the following in <code>_tags</code> to indicate\n        that we're building against Core, and that threads should be\n        enabled, which is required by Core.\n      </blockquote>")))
 (idp7150240
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      After <code>read_and_accumulate</code> returns, the total\n      needs to be printed. This is done using the\n      <code>printf</code> command, which provides support for\n      type-safe format strings, similar to what you'll find in a variety\n      of languages. The format string is parsed by the compiler and used\n      to determine the number and type of the remaining arguments that\n      are required. In this case, there is a single formatting\n      directive, <code>%F</code>, so <code>printf</code>\n      expects one additional argument of type <code>float</code>.\n    </blockquote>")))
 (idp7147104
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      This is our first use of OCaml's input and output routines. The\n      function <code>read_and_accumulate</code> is a recursive\n      function that uses <code>In_channel.input_line</code> to\n      read in lines one by one from the standard input, invoking itself\n      at each iteration with its updated accumulated sum. Note that\n      <code>input_line</code> returns an optional value, with\n      <code>None</code> indicating the end of the input.\n    </blockquote>")))
 (idp7144816
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Here's the code, which you can save in a file called\n      <code>sum.ml</code>.\n    </blockquote>")))
 (idp7144160
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      So far, we've played with the basic features of the language using\n      the toplevel. Now we'll create a simple, complete stand-along\n      program that does something useful: sum up a list of numbers read\n      in from the standard input.\n    </blockquote>")))
 (idp7139680
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        OCaml also supports while loops, as shown in the following\n        function for finding the first non-negative position in an\n        array. Note that <code>while</code> (like\n        <code>for</code>) is also a keyword.\n      </blockquote>")))
 (idp7137808
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Here's an example run of this code.\n      </blockquote>")))
 (idp7134800
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        From a syntactic perspective, you should note the keywords that\n        distinguish a for loop: <code>for</code>,\n        <code>to</code>, <code>do</code> and\n        <code>done</code>.\n      </blockquote>")))
 (idp7130784
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Along with mutable data structures, OCaml gives you constructs\n        like while and for loops for interacting with them. Here, for\n        example, is some code that uses a for loop for permuting an\n        array. We use the <code>Random</code> module as our source\n        of randomness. <code>Random</code> starts out with a\n        deterministic seed, but you can call\n        <code>Random.self_init</code> to choose a new seed at\n        random.\n      </blockquote>")))
 (idp7129216
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        This isn't the most idiomatic (or the fastest) way to sum up a\n        list, but it shows how you can use a ref in place of a mutable\n        variable.\n      </blockquote>")))
 (idp7126144
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Even though a <code>ref</code> is just another record\n        type, it's notable because it is the standard way of simulating\n        the traditional mutable variable you'll find in most imperative\n        languages. For example, we can sum over the elements of a list\n        imperatively by calling <code>List.iter</code> to call a\n        simple function on every element of a list, using a ref to\n        accumulate the results.\n      </blockquote>")))
 (idp7124384
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Here, <code>!</code> and <code>:=</code> are infix\n        operators that we're defining, where the parenthetical syntax\n        marks them as such.\n      </blockquote>")))
 (idp7120736
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The definition of all this is quite straightforward. Here is the\n        complete implementation of the <code>ref</code> type. The\n        <code>'a</code> before the ref indicates that the\n        <code>ref</code> type is polymorphic, in the same way that\n        lists are polymorphic, meaning it can contain values of any\n        type.\n      </blockquote>")))
 (idp7118848
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        There are a handful of useful functions and operators defined\n        for refs to make them more convenient to work with.\n      </blockquote>")))
 (idp7116592
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        We can declare a single mutable value by using a\n        <code>ref</code>, which is a record type with a single\n        mutable field that is defined in the standard library.\n      </blockquote>")))
 (idp7112800
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Here's an example of <code>create</code> and\n        <code>update</code> in action.\n      </blockquote>")))
 (idp7108304
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        If it doesn't convey any information, then what is\n        <code>unit</code> good for? Most of the time,\n        <code>unit</code> acts as a placeholder. Thus, we use\n        <code>unit</code> for the return value of a function like\n        <code>update</code> that operates by side effect rather\n        than by returning a value, and for the argument to a function\n        like <code>create</code> that doesn't require any\n        information to be passed into it in order to run. This is\n        similar to the role that <code>void</code> plays in\n        languages like C and Java.\n      </blockquote>")))
 (idp7104544
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        A new and somewhat odd type has cropped up in this example:\n        <code>unit</code>. What makes <code>unit</code>\n        different is that there is only one value of type\n        <code>unit</code>, which is written <code>()</code>.\n        Because there is only one value of type <code>unit</code>\n        that value doesn't really convey any information.\n      </blockquote>")))
 (idp7103904
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Note the use in the above code of single semi-colons to sequence\n        operations. When we were working purely functionally, this\n        wasn't necessary, but you start needing it when your code is\n        acting by side-effect.\n      </blockquote>")))
 (idp7100272
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>create</code> returns a\n        <code>running_sum</code> corresponding to the empty set,\n        and <code>update rsum x</code> changes\n        <code>rsum</code> to reflect the addition of\n        <code>x</code> to its set of samples, by updating the\n        number of samples, the sum, and the sum of squares.\n      </blockquote>")))
 (idp7097808
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        We also need functions to create and update\n        <code>running_sum</code>s:\n      </blockquote>")))
 (idp7095360
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The fields in <code>running_sum</code> are designed to be\n        easy to extend incrementally, and sufficient to compute means\n        and standard deviations, as shown below.\n      </blockquote>")))
 (idp7093584
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The array is an important mutable data structure, but it's not\n        the only one. Records, which are immutable by default, can be\n        declared with specific fields as being mutable. Here's a small\n        example of a data structure for storing a running statistical\n        summary of a collection of numbers. Here's the basic data\n        structure:\n      </blockquote>")))
 (idp7090112
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        the <code>.(i)</code> syntax is used to refer to an\n        element of an array, and the <code>&lt;-</code> syntax is\n        for modification. Because the elements of the array are counted\n        starting at zero, element <code>.(2)</code> is the third\n        element.\n      </blockquote>")))
 (idp7088240
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Perhaps the simplest mutable data structure in OCaml is the\n        array. Arrays in OCaml are very similar to arrays in other\n        languages like C: indexing starts at 0, and accessing or\n        modifying an array element is a constant-time operation. Arrays\n        are more compact in terms of memory utilization than most other\n        data structures in OCaml, including lists. Here's an example:\n      </blockquote>")))
 (idp7086640
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Functional code is the default in OCaml, with variable bindings\n      and most data structures being immutable. But OCaml also has\n      excellent support for imperative programming, including mutable\n      data structures like arrays and hashtables and control-flow\n      constructs like for and while loops.\n    </blockquote>")))
 (idp7084224
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      So far, we've only written so-called <span><em>pure</em></span> or\n      <span><em>functional</em></span> code, meaning that we didn't write\n      any code that modified a variable or value after its creation.\n      Indeed, almost all of the data structures we've encountered so far\n      are <span><em>immutable</em></span>, meaning there's no way in the\n      language to modify them at all. This is a quite different style\n      from <span><em>imperative</em></span> programming, where\n      computations are structured as sequences of instructions that\n      operate by modifying state as they go.\n    </blockquote>")))
 (idp7080720
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      The purpose of <code>List.exists</code> is to check if there\n      are any elements of the given list in question on which the\n      provided function evaluates to <code>true</code>. In this\n      case, we're using <code>List.exists</code> to check if there\n      is a scene element within which our point resides.\n    </blockquote>")))
 (idp7077824
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      We also made our first use of an <span><em>anonymous\n      function</em></span> in the call to <code>List.exists</code>.\n      An anonymous function is a function that is defined but not named,\n      in this case, using the <code>fun</code> keyword. Anonymous\n      functions are common in OCaml, particularly when using iteration\n      functions like <code>List.exists</code>.\n    </blockquote>")))
 (idp7073408
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      You might at this point notice that the use of\n      <code>match</code> here is reminiscent of how we used\n      <code>match</code> with <code>option</code> and\n      <code>list</code>. This is no accident:\n      <code>option</code> and <code>list</code> are really\n      just examples of variant types that happen to be important enough\n      to be defined in the standard library (and in the case of lists,\n      to have some special syntax).\n    </blockquote>")))
 (idp7066960
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      The <code>|</code> character separates the different cases\n      of the variant (the first <code>|</code> is optional), and\n      each case has a tag, like <code>Circle</code>,\n      <code>Rect</code> and <code>Segment</code>, to\n      distinguish that case from the others. Here's how we might write a\n      function for testing whether a point is in the interior of some\n      element of a list of <code>scene_element</code>s.\n    </blockquote>")))
 (idp7064912
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Now, imagine that you want to combine multiple objects of these\n      types together as a description of a multi-object scene. You need\n      some unified way of representing these objects together in a\n      single type. One way of doing this is using a\n      <span><em>variant</em></span> type:\n    </blockquote>")))
 (idp7063232
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      And we can of course include our newly defined types as components\n      in larger types, as in the following types, each of which is a\n      description of a different geometric object.\n    </blockquote>")))
 (idp7061680
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      We can also use dot-notation for accessing record fields:\n    </blockquote>")))
 (idp7059648
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      We can write the pattern match even more tersely, using what's\n      called <span><em>field punning</em></span>. In particular, when the\n      name of the field and the name of the variable coincide, we don't\n      have to write them both down. Thus, the magnitude function can be\n      rewritten as follows.\n    </blockquote>")))
 (idp7058048
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      And we can get access to the contents of these types using pattern\n      matching:\n    </blockquote>")))
 (idp7055504
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>point2d</code> is a <span><em>record</em></span> type,\n      which you can think of as a tuple where the individual fields are\n      named, rather than being defined positionally. Record types are\n      easy enough to construct:\n    </blockquote>")))
 (idp7053872
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      So far, we've looked only at data structures that were predefined\n      in the language, like lists and tuples. But OCaml also allows us\n      to define new datatypes. Here's a toy example of a datatype\n      representing a point in 2-dimensional space:\n    </blockquote>")))
 (idp7049488
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        In OCaml, however, nulls are explicit. A value of type\n        <code>string * string</code> always actually contains two\n        well-defined values of type <code>string</code>. If you\n        want to allow, say, the first of those to be absent, then you\n        need to change the type to\n        <code>string option * string</code>. As we'll see in\n        <a href=\"error-handling.html\">Chapter\194\1607, <i>Error Handling</i></a>, this explicitness\n        allows the compiler to provide a great deal of help in making\n        sure you're correctly handing the possibility of missing data.\n      </blockquote>")))
 (idp7047568
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Options are important because they are the standard way in OCaml\n        to encode a value that might not be there --- there's no such\n        thing as a <code>NullPointerException</code> in OCaml.\n        This is different from most other languages, including Java and\n        C#, where most if not all datatypes are\n        <span><em>nullable</em></span>, meaning that, whatever their type\n        is, any given value also contains the possibility of being a\n        null value. In such languages, null is lurking everywhere.\n      </blockquote>")))
 (idp7046160
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        This kind of nested let binding is a common way of building up a\n        complex expression, with each <code>let</code> breaking\n        off and naming an individual component, and then combining them\n        in one final expression.\n      </blockquote>")))
 (idp7044688
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        We can also have multiple let statements in a row, each one\n        adding a new variable binding to what came before.\n      </blockquote>")))
 (idp7044192
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Note that the scope of the let binding is terminated by the\n        double-semicolon.\n      </blockquote>")))
 (idp7040080
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        As a side note, this is our first use of <code>let</code>\n        to define a new variable within the body of a function. A\n        <code>let</code> bounded with an <code>in</code> can\n        be used to introduce a new binding within any local scope,\n        including a function body. The <code>in</code> marks the\n        beginning of the scope within which the new variable can be\n        used. Thus, we could write:\n      </blockquote>")))
 (idp7036464
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        We use a <code>match</code> statement for handling the two\n        possible states of an option.\n      </blockquote>")))
 (idp7033264
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        To examine the contents of an option, we use pattern matching,\n        as we did with tuples and lists. Consider the following simple\n        function for printing a log entry given an optional time and a\n        message. If no time is provided (<span><em>i.e.</em></span>, if\n        the time is <code>None</code>), the current time is\n        computed and used in its place.\n      </blockquote>")))
 (idp7028336
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The function <code>divide</code> either returns\n        <code>None</code>, if the divisor is zero, or\n        <code>Some</code> of the result of the division,\n        otherwise. <code>Some</code> and <code>None</code>\n        are constructors, like <code>::</code> and\n        <code>[]</code> for lists, which let you build optional\n        values. You can think of an option as a specialized list that\n        can only have zero or one element.\n      </blockquote>")))
 (idp7026720
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Another common data structure in OCaml is the option. An option\n        is used to express that a value might or might not be present.\n        For example,\n      </blockquote>")))
 (idp7024144
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          In the last few examples, our list processing code involved a\n          lot of recursive functions. In practice, this isn't usually\n          necessary. Most of the time, you'll find yourself happy to use\n          the iteration functions found in the <code>List</code>\n          module. But it's good to know how to use recursion when you\n          need to do something new that's not already supported.\n        </blockquote>")))
 (idp7019888
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Note that this code used another variant of the list pattern,\n          <code>[hd]</code>, to match a list with a single\n          element. We can do this to match a list with any fixed number\n          of elements, <span><em>e.g.</em></span>,\n          <code>[x;y;z]</code> will match any list with exactly\n          three elements, and will bind those elements to the variables\n          <code>x</code>, <code>y</code> and\n          <code>z</code>.\n        </blockquote>")))
 (idp7017936
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          This indicates that we're missing a case, in particular we\n          don't handle one-element lists. That's easy enough to fix by\n          adding another case to the match:\n        </blockquote>")))
 (idp7016560
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Again, the first arm of the match is the base case, and the\n          second is the inductive. Unfortunately, this code has a\n          problem. If you type it into the toplevel, you'll see this\n          error:\n        </blockquote>")))
 (idp7014352
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          We can introduce more complicated list patterns as well.\n          Here's a function for destuttering a list,\n          <span><em>i.e.</em></span>, for removing sequential duplicates.\n        </blockquote>")))
 (idp7013808
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          This suggests a reasonable mental model for what OCaml is\n          actually doing to evaluate a recursive function.\n        </blockquote>")))
 (idp7011552
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Logically, you can think of the evaluation of a simple\n          recursive function like <code>sum</code> almost as if it\n          were a mathematical equation whose meaning you were unfolding\n          step by step.\n        </blockquote>")))
 (idp7008432
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Following the common OCaml idiom, we use <code>hd</code>\n          to refer to the head of the list and <code>tl</code> to\n          refer to the tail. Note that we had to use the\n          <code>rec</code> keyword to allow <code>sum</code>\n          to refer to itself. As you might imagine, the base case and\n          inductive case are different arms of the match.\n        </blockquote>")))
 (idp7006592
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          When writing recursive list functions, this separation between\n          the base cases and the inductive cases is often done using\n          pattern matching. Here's a simple example of a function that\n          sums the elements of a list.\n        </blockquote>")))
 (idp7005008
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Recursive functions, or, functions that call themselves, are\n          an important technique in OCaml and in any functional\n          language. The typical approach to designing a recursive\n          function is to separate the logic into a set of <span><em>base\n          cases</em></span>, that can be solved directly, and a set of\n          <span><em>inductive cases</em></span>, where the function\n          breaks the problem down into smaller pieces and then calls\n          itself to solve those smaller problems.\n        </blockquote>")))
 (idp7000704
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          The first pattern, <code>first :: the_rest</code>,\n          covers the case where <code>languages</code> has at\n          least one element, since every list except for the empty list\n          can be written down with one or more <code>::</code>'s.\n          The second pattern, <code>[]</code>, matches only the\n          empty list. These cases are exhaustive (every list is either\n          empty, or has at least one element), and the compiler can\n          detect that exhaustiveness, which is why it doesn't spit out a\n          warning.\n        </blockquote>")))
 (idp6998160
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Note that we included a comment in the above code. OCaml\n          comments are bounded by <code>(*</code> and\n          <code>*)</code>, and can be nested arbitrarily and cover\n          multiple lines. There's no equivalent of C-style single line\n          comments that are prefixed by <code>//</code>.\n        </blockquote>")))
 (idp6995072
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Here's a new version of\n          <code>my_favorite_language</code> that uses\n          <code>match</code> and doesn't trigger a compiler\n          warning.\n        </blockquote>")))
 (idp6991648
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          A <code>match</code> statement is a kind of juiced-up\n          version of the switch statement found in <code>C</code>\n          and <code>Java</code>. It essentially lets you list a\n          sequence of patterns (separated by <code>|</code>\n          characters --- the one before the first case is optional), and\n          the compiler then dispatches to the code following the first\n          matched pattern. And, as we've already seen, we can name new\n          variables in our patterns that correspond to sub-structures of\n          the value being matched.\n        </blockquote>")))
 (idp6990464
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          You can avoid these warnings, and more importantly make sure\n          that your code actually handles all of the possible cases, by\n          using a <code>match</code> statement instead.\n        </blockquote>")))
 (idp6987200
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          The warning comes because the compiler can't be certain that\n          the pattern match won't lead to a runtime error. Indeed, the\n          warning gives an example of a list, (<code>[]</code>,\n          the empty list) that doesn't match the provided pattern.\n          Indeed, if we try to run\n          <code>my_favorite_language</code>, we'll see that it\n          works on non-empty list, and fails on empty ones.\n        </blockquote>")))
 (idp6985312
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          If you try the above example in the toplevel, however, you'll\n          see that it spits out a warning:\n        </blockquote>")))
 (idp6981472
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          By pattern matching using <code>::</code>, we've\n          isolated and named the first element of the list\n          (<code>my_favorite</code>) and the remainder of the list\n          (<code>the_rest</code>). If you know Lisp or Scheme,\n          what we've done is the equivalent of using the functions\n          <code>car</code> and <code>cdr</code> to isolate\n          the first element of a list and the remainder of that list.\n        </blockquote>")))
 (idp6978720
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          The elements of a list can be accessed through pattern\n          matching. List patterns are based on the two list\n          constructors, <code>[]</code> and <code>::</code>.\n          Here's a simple example.\n        </blockquote>")))
 (idp6976624
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          It's important to remember that this is not a constant-time\n          operation. Concatenating two lists takes time proportional to\n          the length of the first list.\n        </blockquote>")))
 (idp6973184
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          The <code>::</code> operator can only be used for adding\n          one element to the front of the list, with the list\n          terminating at <code>[]</code>, the empty list. There's\n          also a list concatenation operator, <code>@</code>,\n          which can concatenate two lists.\n        </blockquote>")))
 (idp6970256
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          The bracket notation for lists is really just syntactic sugar\n          for <code>::</code>. Thus, the following declarations\n          are all equivalent. Note that <code>[]</code> is used to\n          represent the empty list.\n        </blockquote>")))
 (idp6968768
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Here, we're creating a new and extended list, not changing the\n          list we started with, as you can see below.\n        </blockquote>")))
 (idp6966560
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          In addition to constructing lists using brackets, we can use\n          the operator <code>::</code> for adding elements to the\n          front of a list.\n        </blockquote>")))
 (idp6964064
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          We'll learn more about labeled arguments and why they're\n          important in\n          <a href=\"variables-and-functions.html\">Chapter\194\1602, <i>Variables and Functions</i></a>.\n        </blockquote>")))
 (idp6960864
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          In this example, the function <code>String.length</code>\n          is passed under the <span><em>labeled argument</em></span>\n<code>~f</code>. Labels allow you to specify function\n          arguments by name rather than by position. As you can see\n          below, we can change the order of labeled arguments without\n          changing the function's behavior.\n        </blockquote>")))
 (idp6959008
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>List.map</code> takes two arguments: a list and a\n          function for transforming the elements of that list. Note that\n          <code>List.map</code> creates a new list and does not\n          modify the original.\n        </blockquote>")))
 (idp6957520
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Here's something a little more complicated. We can compute the\n          list of the lengths of each language as follows.\n        </blockquote>")))
 (idp6955392
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Core comes with a <code>List</code> module that has a\n          rich collection of functions for working with lists. We can\n          access values from within a module by using dot-notation.\n          Here, for example, is how we compute the length of a list.\n        </blockquote>")))
 (idp6951904
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Note that you can't mix elements of different types on the same\n        list, as we did with tuples.\n      </blockquote>")))
 (idp6950272
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Where tuples let you combine a fixed number of items,\n        potentially of different types, lists let you hold any number of\n        items of the same type. For example:\n      </blockquote>")))
 (idp6948688
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        This is just a first taste of pattern matching. Pattern matching\n        is a pervasive tool in OCaml, and as you'll see, it has\n        surprising power.\n      </blockquote>")))
 (idp6947584
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The <code>**</code> operator used above is for raising a\n        floating-point number to a power.\n      </blockquote>")))
 (idp6945120
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Pattern matching can also show up in function arguments. Here's\n        a function for computing the distance between two points on the\n        plane, where each point is represented as a pair of\n        <code>float</code>s. The pattern matching syntax lets us\n        get at the values we need with a minimum of fuss.\n      </blockquote>")))
 (idp6944608
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Note that the same syntax is used both for constructing and for\n        pattern matching on tuples.\n      </blockquote>")))
 (idp6940608
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Here, the <code>(x,y)</code> on the left-hand side of the\n        <code>let</code> binding is the pattern. This pattern lets\n        us mint the new variables <code>x</code> and\n        <code>y</code>, each bound to different components of the\n        value being matched, which can now be used in subsequent\n        expressions.\n      </blockquote>")))
 (idp6939104
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        You can extract the components of a tuple using OCaml's pattern\n        matching syntax. For example:\n      </blockquote>")))
 (idp6936032
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        For the mathematically inclined, the <code>*</code>\n        character is used because the set of all pairs of type\n        <code>t * s</code> corresponds to the Cartesian product of\n        the set of elements of type <code>t</code> and the set of\n        elements of type <code>s</code>.\n      </blockquote>")))
 (idp6931696
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        So far we've encountered a handful of basic types like\n        <code>int</code>, <code>float</code> and\n        <code>string</code> as well as function types like\n        <code>string -&gt; int</code>. But we haven't yet talked\n        about any data structures. We'll start by looking at a\n        particularly simple data structure, the tuple. A tuple is an\n        ordered collection of values that can each be of different type.\n        You can create a tuple by joining values together with a comma:\n      </blockquote>")))
 (idp6927600
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The distinction here is that type errors will stop you whether\n        or not the offending code is ever actually executed. Merely\n        defining <code>add_potato</code> is an error, whereas\n        <code>is_a_multiple</code> only fails when it's called,\n        and then, only when it's called with an input that triggers the\n        exception.\n      </blockquote>")))
 (idp6925680
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        are compile-time errors, whereas an error that can't be caught\n        by the type system, like division by zero, leads to a runtime\n        exception.\n      </blockquote>")))
 (idp6924000
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Working in the toplevel somewhat obscures the difference between\n        run-time and compile time errors, but that difference is still\n        there. Generally, type errors, like this one:\n      </blockquote>")))
 (idp6923280
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        There's a big difference in OCaml (and really in any compiled\n        language) between errors that are caught at compile time and\n        those that are caught at run-time. It's better to catch errors\n        as early as possible in the development process, and compilation\n        time is best of all.\n      </blockquote>")))
 (idp6917936
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        In this example, <code>big_number</code> requires that\n        <code>'a</code> be instantiated as <code>int</code>,\n        whereas <code>&quot;short&quot;</code> and\n        <code>&quot;loooooong&quot;</code> require that\n        <code>'a</code> be instantiated as\n        <code>string</code>, and they can't both be right at the\n        same time.\n      </blockquote>")))
 (idp6912672
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Both <code>long_string</code> and\n        <code>big_number</code> are functions, and each is passed\n        to <code>first_if_true</code> with two other arguments of\n        the appropriate type (strings in the first example, and integers\n        in the second). But we can't mix and match two different\n        concrete types for <code>'a</code> in the same use of\n        <code>first_if_true</code>.\n      </blockquote>")))
 (idp6911248
  ((file a-guided-tour.html)
   (html "<blockquote>\n        as well as:\n      </blockquote>")))
 (idp6909184
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        The generic type of <code>first_if_true</code> allows us\n        to write:\n      </blockquote>")))
 (idp6901920
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        we see that rather than choose a single concrete type, OCaml has\n        introduced a <span><em>type variable</em></span>\n<code>'a</code> to express that the type is generic. In\n        particular, the type of the <code>test</code> argument is\n        <code>('a -&gt; bool)</code>, which means that test is a\n        one-argument function whose return value is\n        <code>bool</code>, and whose argument could be of any type\n        <code>'a</code>. But, whatever type <code>'a</code>\n        is, it has to be the same as the type of the other two\n        arguments, <code>x</code> and <code>y</code>, and of\n        the return value of <code>first_if_true</code>. This kind\n        of genericity is called <span><em>parametric\n        polymorphism</em></span>, and is very similar to generics in C#\n        and Java.\n      </blockquote>")))
 (idp6892736
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>first_if_true</code> takes as its arguments a\n        function <code>test</code>, and two values,\n        <code>x</code> and <code>y</code>, where\n        <code>x</code> is to be returned if\n        <code>test x</code> evaluates to <code>true</code>,\n        and <code>y</code> otherwise. So what's the type of\n        <code>first_if_true</code>? There are no obvious clues\n        such as arithmetic operators or literals to tell you what the\n        type of <code>x</code> and <code>y</code> are. That\n        makes it seem like one could use this\n        <code>first_if_true</code> on values of any type. Indeed,\n        if we look at the type returned by the toplevel:\n      </blockquote>")))
 (idp6891248
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Sometimes, there isn't enough information to fully determine the\n        concrete type of a given value. Consider this function:\n      </blockquote>")))
 (idp6889504
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        In the above, we've marked every argument to the function with\n        its type, with the final annotation indicating the type of the\n        return value. Such type annotations can actually go around any\n        value in an OCaml program, and can be useful for figuring out\n        why a given program is failing to compile.\n      </blockquote>")))
 (idp6886736
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Over time, you'll build a rough intuition for how the OCaml\n        inference engine works, which makes it easier to reason through\n        your programs. One way of making it easier to understand the\n        types is to add explicit type annotations. These annotations\n        never change the behavior of an OCaml program, but they can\n        serve as useful documentation, as well as catch unintended type\n        changes. Here's an annotated version of\n        <code>sum_if_true</code>:\n      </blockquote>")))
 (idp6885600
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        Together, that nails down the types of all the variables, which\n        determines the overall type of <code>sum_if_true</code>.\n      </blockquote>")))
 (idp6883632
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n            The fact that <code>+</code> returns an int implies\n            that the return value of <code>sum_if_true</code> must\n            be int.\n          </blockquote>")))
 (idp6880368
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>test x</code> is used as the condition in an\n            <code>if</code> statement, so the return type of\n            <code>test</code> must be <code>bool</code>.\n          </blockquote>")))
 (idp6875856
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n<code>test</code> is passed <code>x</code> as an\n            argument. Since <code>x</code> has type\n            <code>int</code>, the input type of\n            <code>test</code> must be <code>int</code>.\n          </blockquote>")))
 (idp6870624
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n            OCaml requires that both arms of an <code>if</code>\n            statement return the same type, so the expression\n            <code>if test x then x else 0</code> requires that\n            <code>x</code> must be the same type as\n            <code>0</code>, which is <code>int</code>. By\n            the same logic we can conclude that <code>y</code> has\n            type <code>int</code>.\n          </blockquote>")))
 (idp6868992
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        As an example, let's walk through the process of inferring the\n        type of <code>sum_if_true</code>.\n      </blockquote>")))
 (idp6867872
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        OCaml determines the type of an expression using a technique\n        called <span><em>type inference</em></span>, by which it infers\n        the type of a given expression based on what it already knows\n        about the types of other related variables, and on constraints\n        on the types that arise from the structure of the code.\n      </blockquote>")))
 (idp6867264
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n        As the types we encounter get more complicated, you might ask\n        yourself how OCaml is able to figure them out, given that we\n        didn't write down any explicit type information.\n      </blockquote>")))
 (idp6862688
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Note that in the definition of <code>even</code> we used\n      <code>=</code> in two different ways: once as the part of\n      the let binding that separates the thing being defined from its\n      definition; and once as an equality test, when comparing\n      <code>x mod 2</code> to <code>0</code>. These two uses\n      of <code>=</code> are basically unrelated.\n    </blockquote>")))
 (idp6860768
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      If we look at the inferred type signature in detail, we see that\n      the first argument is a function that takes an integer and returns\n      a boolean, and that the remaining two arguments are integers.\n      Here's an example of this function in action.\n    </blockquote>")))
 (idp6858912
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      We can even write functions that take other functions as\n      arguments. Here's an example of a function that takes three\n      arguments: a test function and two integer arguments. The function\n      returns the sum of the integers that pass the test.\n    </blockquote>")))
 (idp6855728
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      The notation for the type-signature of a multi-argument functions\n      may be a little surprising at first, but we'll explain where it\n      comes from when we get to function currying in\n      <a href=\"variables-and-functions.html#multi-argument-functions\">the section called \226\128\156Multi-argument functions\226\128\157</a>. For the\n      moment, think of the arrows as separating different arguments of\n      the function, with the type after the final arrow being the return\n      value of the function. Thus,\n      <code>int -&gt; int -&gt; float</code> describes a function\n      that takes two <code>int</code> arguments and returns a\n      <code>float</code>.\n    </blockquote>")))
 (idp6851888
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      As a side note, the above is our first use of OCaml modules. Here,\n      <code>FLoat.of_int</code> refers to the\n      <code>of_int</code> function contained in the\n      <code>FLoat</code> module, and not, as you might expect from\n      an object-oriented language, accessing a method of an object. The\n      <code>Float</code> module in particular contains\n      <code>of_int</code> as well as many other useful functions\n      for dealing with floats.\n    </blockquote>")))
 (idp6848272
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Now that we're creating more interesting values like functions,\n      the types have gotten more interesting too.\n      <code>int -&gt; int</code> is a function type, in this case\n      indicating a function that takes an <code>int</code> and\n      returns an <code>int</code>. We can also write functions\n      that take multiple arguments.\n    </blockquote>")))
 (idp6845632
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      When using <code>let</code> to define a function, the first\n      identifier after the <code>let</code> is the function name,\n      and each subsequent identifier is a different argument to the\n      function. Thus, <code>square</code> is a function with a\n      single argument. If no arguments are given, then we just have the\n      ordinary definition of a variable that we saw earlier.\n    </blockquote>")))
 (idp6844400
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Functions in OCaml are values like any other, which is why we bind\n      one to a variable using the same <code>let</code> keyword\n      used for binding a variable to a simple value such as an integer.\n    </blockquote>")))
 (idp6842208
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      The <code>let</code> syntax can also be used for creating\n      functions.\n    </blockquote>")))
 (idp6837584
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      After a new variable is created, the toplevel tells us the name of\n      the variable (<code>x</code> or <code>y</code>), in\n      addition to its type (<code>int</code>) and value\n      (<code>7</code> or <code>14</code>).\n    </blockquote>")))
 (idp6835216
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      We can also create a variable to name the value of a given\n      expression, using the <code>let</code> keyword (also known\n      as a <span><em>let binding</em></span>).\n    </blockquote>")))
 (idp6829280
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          OCaml carefully distinguishes between\n          <code>float</code>, the type for floating point numbers\n          and <code>int</code> the type for integers. The types\n          have different literals (<code>6.</code> instead of\n          <code>6</code>) and different infix operators\n          (<code>+.</code> instead of <code>+</code>), and\n          OCaml doesn't automatically cast between types. This can be a\n          bit of a nuisance, but it has its benefits, since it prevents\n          some kinds of bugs that arise in other languages due to\n          unexpected differences between the behavior of\n          <code>int</code> and <code>float</code>.\n        </blockquote>")))
 (idp6828240
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          OCaml allows you to place underscores in the middle of your\n          integer literals, as a way of improving readability. Note that\n          underscores can be placed anywhere in within the number, not\n          just every three digits.\n        </blockquote>")))
 (idp6827280
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          Function arguments are separated by spaces, instead of by\n          parenthesis and commas, which is more like the UNIX shell than\n          C or Java.\n        </blockquote>")))
 (idp6826368
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          After evaluating an expression, the toplevel spits out both\n          the type of the result and the result itself.\n        </blockquote>")))
 (idp6824096
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n          We needed to type <code>;;</code> in order to tell the\n          toplevel that it should evaluate an expression. This is a\n          peculiarity of the toplevel that is not required in\n          stand-alone programs (though it is sometimes helpful to\n          include <code>;;</code> to improve OCaml's error\n          reporting.)\n        </blockquote>")))
 (idp6823024
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      By and large, this is pretty similar to what you'd find in any\n      programming language, but there are a few things that jump right\n      out at you.\n    </blockquote>")))
 (idp6821504
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Now that we have Core open, let's try a few simple numerical\n      calculations.\n    </blockquote>")))
 (idp6818192
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n      Let's spin up <code>utop</code>. Throughout the book we're\n      going to use Core, a more full-featured and capable replacement\n      for OCaml's standard library. Accordingly, we'll start by opening\n      the <code>Core.Std</code> module to get access to Core's\n      libraries. If you don't open <code>Core.Std</code> many of\n      the examples below will fail.\n    </blockquote>")))
 (idp6813568
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    Then type in <code>utop</code>, and you'll be in an\n    interactive toplevel environment. OCaml phrases are only evaluated\n    when you enter a double semicolon (<code>;;</code>), so you\n    can split your typing over multiple lines. You can exit\n    <code>utop</code> by pressing <code>control-D</code> and\n    return. For complete instructions, please refer to\n    <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a>.\n  </blockquote>")))
 (idp6811568
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    Note that the above commands will take some time to run. When\n    they're done, create a file called <code>~/.ocamlinit</code>\n    in your home directory:\n  </blockquote>")))
 (idp115984
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    The easiest way to get the examples running is to set up the OPAM\n    package manager, which is explained in\n    <a href=\"installation.html\">Appendix\194\160A, <i>Installation</i></a>. In a nutshell, you need to\n    have a working C compilation environment and the PCRE library\n    installed, and then:\n  </blockquote>")))
 (idp114048
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    Before getting started, do make sure you have a working OCaml\n    installation and toplevel as you read through this chapter so you\n    can try out the examples.\n  </blockquote>")))
 (idp110656
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    We'll present this guided tour using the Core standard library and\n    the <code>utop</code> OCaml toplevel, a shell that lets you\n    type in expressions and evaluate them interactively.\n    <code>utop</code> is an easier-to-use version of the standard\n    toplevel (which you can start by typing <code>ocaml</code> at\n    the command line). These instructions will assume you're using\n    <code>utop</code> specifically.\n  </blockquote>")))
 (idp110000
  ((file a-guided-tour.html)
   (html
    "<blockquote>\n    This chapter gives an overview of OCaml by walking through a series\n    of small examples that cover most of the major features of the\n    language. This should give a sense of what OCaml can do, without\n    getting too deep in any one topic.\n  </blockquote>"))))
