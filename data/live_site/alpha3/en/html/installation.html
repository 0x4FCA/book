<html>

    <head>
    
        <meta charset="utf-8"/>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="robots" content="NOINDEX, NOARCHIVE, NOFOLLOW"/>
        
        <title>Appendix A. Installation / Real World OCaml</title>
        
        <link rel="stylesheet" href="../../media/css/main.css"/>
        
        <script src="../../media/js/require.js" data-main="../../media/js/main.js"> </script>
        <script>
            require.config({
                config: {
                    gitHub: {
                        user: 'ocamllabs',
                        repo: 'rwo\u002Dcomments',
                        milestone: 'alpha3',
                        page: 'installation.html'
                    }
                }
            });
        </script>
        
    
    </head>
    
    <body>
    
        <div class="body">
        
            <header class="header">
                <h1><img src="../../media/img/header.png" width="213" height="59" alt="Real World OCaml, by Jason Hickey, Anil Madhavapeddy and Yaron Minsky"/></h1>
            </header>
    
            <nav class="navigation">
                <ul>
                    <li>
                        <a href="index.html">Table of Contents</a>
                    </li>
                    
                        <li>
                            <a href="prologue.html">Prologue</a>
                            
                                
                            
                        </li>
                    
                        <li>
                            <a href="pt01.html">I. Basic Concepts</a>
                            
                                
                            
                        </li>
                    
                        <li>
                            <a href="pt02.html">II. Practical Examples</a>
                            
                                
                            
                        </li>
                    
                        <li>
                            <a href="pt03.html">III. Advanced Topics</a>
                            
                                
                            
                        </li>
                    
                        <li>
                            <a href="installation.html" class="here">A. Installation</a>
                            
                                 
                                    <ul>
                                        
                                            <li>
                                                <a href="installation.html#getting-ocaml">Getting OCaml</a>
                                            </li>
                                        
                                            <li>
                                                <a href="installation.html#getting-opam">Getting OPAM</a>
                                            </li>
                                        
                                            <li>
                                                <a href="installation.html#setting-up-opam">Setting up OPAM</a>
                                            </li>
                                        
                                            <li>
                                                <a href="installation.html#developing-with-opam">Developing with OPAM</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </li>
                    
                </ul>
            </nav>
        
            <article class="page">
        
                <h1>Appendix A. Installation</h1>
                
                

    <p id="idp9434416">
    The easiest way to use OCaml is via the binary packages available in
    many operating systems. For day-to-day code development however,
    it's much easier to use a source-code manager that lets you modify
    individual libraries and automatically recompile all the
    dependencies.
  </p><p id="idp9435104">
    An important difference between OCaml and scripting languages such
    as Python or Ruby is that the static type safety that means that you
    can't just mix-and-match compiled libraries. Interfaces are checked
    when libraries are compiled, so when an interface is changed, all
    the dependent libraries must also be recompiled. Source-based
    package managers automate this process for you and make development
    life much easier.
  </p><p id="idp9435952">
    To work through Real World OCaml, you'll need three major components
    installed:
  </p><ul><li><p id="idp9436960">
        The OCaml compiler itself.
      </p></li><li><p id="idp9437792">
        The OPAM source package manager, through which we'll install
        several extra libraries.
      </p></li><li><p id="idp9438688">
        The <code>utop</code> interactive toplevel, a modern
        interactive toplevel with command history and tab completion.
      </p></li></ul><p id="idp9440176">
    Let's get started with how to install OCaml on various operating
    systems, and we'll get OPAM and <code>utop</code> running
    after that.
  </p><section><h1 id="getting-ocaml">Getting OCaml</h1><p id="idp9442576">
      The OCaml compiler is available as a binary distribution on many
      operating systems. This is the simplest and preferred installation
      route, but we'll also describe how to do a manual installation as
      a last resort.
    </p><section><h1 id="macos-x">MacOS X</h1><p id="idp9444304">
        The
        <a href="http://github.com/mxcl/homebrew" target="_top">Homebrew</a>
        package manager has an OCaml installer, which is usually updated
        pretty quickly to the latest stable release.
      </p><pre id="idp9445568">
$ brew install ocaml
$ brew install pcre
</pre><p id="idp9446288">
        The Perl-compatible Regular Expression library (PCRE) is used by
        the Core suite. It's not strictly needed to use OCaml, but is a
        commonly used library that we're installing now to save time
        later.
      </p><p id="idp9446928">
        Another popular package manager on MacOS X is
        <a href="http://macports.org" target="_top">MacPorts</a>, which also
        has an OCaml port:
      </p><pre id="idp9448144">
$ port install ocaml
$ port install ocaml-pcre
</pre></section><section><h1 id="linux">Linux</h1><p id="idp9450144">
        On Debian Linux, you should install OCaml via binary packages.
        You'll need at least OCaml version 3.12.1 to bootstrap OPAM,
        which means using Debian Wheezy or greater. Don't worry about
        getting the absolute latest version of the compiler, as you just
        need one new enough to compile the OPAM package manager, after
        which you use OPAM to manage your compiler installation.
      </p><pre id="idp9450976">
$ sudo apt-get install ocaml ocaml-native-compilers camlp4-extra
$ sudo apt-get install git libpcre3-dev curl build-essential m4 
</pre><p id="idp9451776">
        Notice that we've installed a few more packages than just the
        OCaml compiler here. The second command line installs enough
        system packages to let you build your own OCaml packages. You
        may find that some OCaml libraries require more system libraries
        (for example, <code>libssl-dev</code>), but we'll
        highlight these in the book when we introduce the library.
      </p><p id="idp9453264">
        TODO: Fedora / RHEL
      </p><p id="idp9453696">
        TODO: Arch Linux
      </p></section><section><h1 id="windows">Windows</h1><p id="idp9455408">
        Windows is not currently supported by the examples in Real World
        OCaml, although it is being worked on. Until that's ready, we
        recommend using a virtual machine running Debian Linux on your
        local machine.
      </p></section><section><h1 id="building-from-source">Building from source</h1><p id="idp9457264">
        To install OCaml from source code, first make sure that you have
        a C compilation environment (usually either
        <code>gcc</code> or <code>llvm</code> installed)
      </p><pre id="idp9459200">
$ curl -OL http://caml.inria.fr/pub/distrib/ocaml-4.00/ocaml-4.00.1.tar.gz
$ tar -zxvf ocaml-4.00.1.tar.gz
$ cd ocaml-4.00.1
$ ./configure
$ make world world.opt
$ sudo make install
</pre><p id="idp9460048">
        The final step requires administrator privilege to install in
        your system directory. You can also install it in your home
        directory by passing the <code>prefix</code> option to the
        configuration script:
      </p><pre id="idp9461376">
$ ./configure -prefix $HOME/my-ocaml
</pre><p id="idp9462080">
        Once the installation is completed into this custom location,
        you will need to add <code>$HOME/my-ocaml/bin</code> to
        your <code>PATH</code>, normally by editing the
        <code>~/.bash_profile</code> file. You shouldn't really to
        do this unless you have special reasons, so try to install
        binary packages before trying a source installation.
      </p></section></section><section><h1 id="getting-opam">Getting OPAM</h1><p id="idp9466192">
      OPAM manages multiple simultaneous OCaml compiler and library
      installations, tracks library versions across upgrades, and
      recompiles dependencies automatically if they get out of date.
      It's used throughout Real World OCaml as the mechanism to retrieve
      and use third-party libraries.
    </p><p id="idp9466912">
      Before installing OPAM, make sure that you have the OCaml compiler
      installed as described above. Once installed, the entire OPAM
      database is held in your home directory (normally
      <code>$HOME/.opam</code>). If something goes wrong, just
      delete this <code>.opam</code> directory and start over from
      a clean slate. If youre using a version of OPAM you've installed
      previously, please ensure you have at least version 0.9.3 or
      greater.
    </p><aside class="important"><h1>
    OCamlfind and OPAM
    </h1><p id="idp9469856">
      OPAM maintains multiple compiler and library installations, but
      this can clash with a global installation of the
      <code>ocamlfind</code> tool. Uninstall any existing copies
      of <code>ocamlfind</code> before installing OPAM.
      <span><em>Reviewers</em></span>: this has since been fixed in
      OCaml-4.01.0.
    </p></aside><section><h1 id="macos-x-1">MacOS X</h1><p id="idp9473520">
        Source installation of OPAM will take a minute or so on a modern
        machine. There is a Homebrew package for the latest OPAM:
      </p><pre id="idp9474064">
$ brew update
$ brew install opam
</pre><p id="idp9474768">
        And on MacPorts, install it like this:
      </p><pre id="idp9475216">
$ port install opam
</pre></section><section><h1 id="debian-linux">Debian Linux</h1><p id="idp9477120">
        There are experimental binary packages available for Debian
        Wheezy/amd64. Just add the following line to your
        <code>/etc/apt/sources.list</code>:
      </p><pre id="idp9478368">
deb http://www.recoil.org/~avsm/ wheezy main
</pre><p id="idp9479088">
        When this is done, update your packages and install OPAM. You
        can ignore the warning about unsigned packages, which will
        disappear when OPAM is upstreamed into Debian mainline.
      </p><pre id="idp9479696">
# apt-get update
# apt-get install opam
</pre><aside class="note"><h1>
      Note to reviewers
      </h1><p id="idp9481104">
        The OPAM instructions will be simplified when integrated
        upstream into Debian and Fedora, which is ongoing. Until then,
        we're leaving source-code installation instructions here. Please
        leave a comment with any amended instructions you encounter
      </p></aside><p id="idp9481920">
        If the binary packages aren't suitable, you need to install the
        latest OPAM release from source. The distribution only requires
        the OCaml compiler to be installed, so this should be pretty
        straightforward. Download the latest version, which is always
        marked with a <code>stable</code> tag on the project
        <a href="https://github.com/OCamlPro/opam/tags" target="_top">homepage</a>.
      </p><pre id="idp9484096">
$ curl -OL https://github.com/OCamlPro/opam/archive/latest.tar.gz
$ tar -zxvf latest.tar.gz
$ cd opam-latest
$ ./configure &amp;&amp; make
$ sudo make install
</pre></section><section><h1 id="fedorarhel">Fedora/RHEL</h1><p id="idp9486240">
        TODO
      </p></section><section><h1 id="arch-linux">Arch Linux</h1><p id="idp9487888">
        TODO
      </p></section></section><section><h1 id="setting-up-opam">Setting up OPAM</h1><p id="idp9489712">
      The entire OPAM package database is held in the
      <code>.opam</code> directory in your home directory,
      including compiler installations. On Linux and MacOS X, this will
      be the <code>~/.opam</code> directory. You shouldn't switch
      to an admin user to install packages as nothing will be installed
      outside of this directory. If you run into problems, just delete
      the whole <code>~/.opam</code> directory and follow the
      installations instructions from the <code>opam init</code>
      stage again.
    </p><p id="idp9493408">
      Begin by initialising the OPAM package database.
    </p><pre id="idp9493872">
$ opam init
$ opam list
</pre><p id="idp9494576">
      You only need to run this command once, and it will create the
      <code>~/.opam</code> directory and sync with the latest
      package list from the online OPAM database.
      <code>opam list</code> will list these, but don't install
      any just yet.
    </p><p id="idp9496624">
      The most important package we need to install is Core, which is
      the replacement standard library that all of the examples in this
      book use. Before doing this, let's make sure you have exactly the
      right compiler version you need. We've made some minor
      modifications to the way the OCaml compiler displays type
      signatures, and the next command will install a patched
      <code>4.00.1</code> compiler with this functionality
      enabled.
    </p><pre id="idp9498592">
$ opam switch 4.00.1+short-types
</pre><p id="idp9499296">
      This step will take about 5-10 minutes on a modern machine, and
      will download and install (within the <code>~/.opam</code>
      directory) a custom OCaml compiler. OPAM supports multiple such
      installations, and you'll find this very useful if you ever decide
      to hack on the internals of the compiler itself, or you want to
      experiment with the latest release without sacrificing your
      current installation. You only need to install this compiler once,
      and future updates will be much faster as they only recompile
      libraries within the compiler installation.
    </p><p id="idp9500992">
      The new compiler will be installed into
      <code>~/.opam/4.00.1+short-types</code> and any libraries
      you install for it will be tracked separately from your system
      installation. You can have any number of compilers installed
      simultaneously, but only one can be active at any time. Browse
      through the available compilers by running
      <code>opam switch list</code>.
    </p><p id="idp9503152">
      When the compilation finishes, you'll see some instructions about
      environment variables. OPAM never installs files into your system
      directories (which would require administrator privileges).
      Instead, it puts them into your home directory by default, and can
      output a set of shell commands which configures your shell with
      the right <code>PATH</code> variables so that packages will
      just work. This requires just one command:
    </p><pre id="idp9504704">
$ eval `opam config env`
</pre><p id="idp9505408">
      This evaluates the results of running
      <code>opam config env</code> in your current shell, and sets
      the variables so that subsequent commands will use them. This only
      works with your current shell, and it can be automated for all
      future shells by adding the line to your login scripts. On MacOS X
      or Debian, this is usually the <code>~/.bash_profile</code>
      file if you're using the default shell. If you've switched to
      another shell, it might be <code>~/.zshrc</code> instead.
      OPAM isn't unusual in this approach; the SSH
      <code>ssh-agent</code> also works similarly, so if you're
      having any problems just hunt around in your configuration scripts
      to see how that's being invoked.
    </p><p id="idp9509280">
      Finally, we're ready to install the Core libraries. Run this:
    </p><pre id="idp9509760">
$ opam install core core_extended async
</pre><p id="idp9510480">
      This will take about five minutes to install, and install a series
      of packages. OPAM figures out the dependencies you need
      automatically, but the three packages that really matter are:
    </p><ul><li><p id="idp9511600">
<code>core</code> is the main, well-supported Core
          distribution from Jane Street.
        </p></li><li><p id="idp9513152">
<code>core_extended</code> contains a number of
          experimental, but useful, extension libraries that are under
          review for inclusion in Core. We use some of these in places,
          but much less than Core itself.
        </p></li><li><p id="idp9514832">
<code>async</code> is the network programming library
          that we use in Part II to communicate with other hosts. You
          can skip this for the initial installation until you get to
          Part II, if you prefer.
        </p></li></ul><section><h1 id="editing-environment">Editing Environment</h1><p id="idp9517488">
        There's one last tool you need before getting started on the
        examples. The default <code>ocaml</code> command gives us
        an interactive command-line to experiment with code without
        compiling it. However, it's quite a spartan experience and so we
        use a more modern alternative.
      </p><pre id="idp9518896">
$ opam install utop
</pre><p id="idp9519584">
        The <code>utop</code> package us an interactive
        command-line interface to OCaml that has tab-completion,
        persistent history and integration with Emacs so that you can
        run it within your editing environment.
      </p><p id="idp9520928">
        Remember from earlier that OPAM never installs files directly
        into your system directories, and this applies to
        <code>utop</code> too. You'll find the binary in
        <code>~/.opam/4.00.1+short-types/bin</code>. However, just
        typing in <code>utop</code> from your shell should just
        work, due to the <code>opam config env</code> step which
        configures your shell. Don't forget to automate this as
        described earlier, as it makes life much easier when developing
        OCaml code!
      </p></section><section><h1 id="command-line">Command Line</h1><p id="idp9525888">
        TODO: explain OCamlfind here.
      </p><p id="idp9526336">
        The <code>utop</code> tool provides a convenient
        interactive toplevel, with full command history, command macros
        and module name completion. The <code>~/.ocamlinit</code>
        file in your home directory initialises <code>utop</code>
        with common libraries and syntax extensions, so you don't need
        to type them in every time. A good default you should create for
        the examples in this book is:
      </p><div class="highlight"><pre><span class="o">#</span><span class="n">use</span> <span class="s2">&quot;topfind&quot;</span>
<span class="o">#</span><span class="n">camlp4o</span>
<span class="o">#</span><span class="n">thread</span>
<span class="o">#</span><span class="n">require</span> <span class="s2">&quot;core.top&quot;</span><span class="o">;;</span>
<span class="o">#</span><span class="n">require</span> <span class="s2">&quot;async&quot;</span><span class="o">;;</span>
</pre></div><p id="idp9530272">
        When you run <code>utop</code> with this initialization
        file, it should start up with Core opened and ready to use.
      </p><p id="idp9531488">
<span><em>TODO</em></span>: the <code>.ocamlinit</code>
        handling in OPAM is being finalised and is tracked in
        <a href="https://github.com/OCamlPro/opam/issues/185" target="_top">issue
        185</a>.
      </p></section><section><h1 id="editors">Editors</h1><p id="idp9535056">
        TODO: Emacs users have tuareg and
        <a href="http://www.typerex.org/" target="_top">Typerex</a>.
      </p><p id="idp9536224">
        TODO: Vim users can use the built-in style, and
        <a href="http://github.com/avsm/ocaml-annot" target="_top">ocaml-annot</a>
        may also be useful.
      </p><p id="idp9537440">
        TODO: Eclipse plugins: which one is maintained?
      </p></section></section><section><h1 id="developing-with-opam">Developing with OPAM</h1><p id="idp9539264">
      TODO: Package listings are obtained by adding
      <span><em>remotes</em></span> that provide package descriptions,
      installation instructions and URLs.
    </p></section>


                
            </article>
            
            
    
                <nav class="pagination">
                    
                        <a rel="previous" href="object-subtyping-and-inheritance.html">
                            &lt; Previous
                        </a>
                    
                    
                </nav>
            
            
            
            <footer class="footer">
                <p>Copyright 2012-2013, Jason Hickey, Anil Madhavapeddy and Yaron Minsky.</p>
            </footer>
            
        </div>
    
    </body>

</html>