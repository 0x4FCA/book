BYTE_ENABLED = true

#
# Include path
#
OPAM_DIR = $(dir $(HOME)/.opam/system/lib)
OPAM_DIR_NAMES[] =
	res
	fieldslib
	oUnit
	sexplib
	bin_prot
	variantslib
	core
	async_core
	async_extra
	async_unix
	async

OCAMLINCLUDES += $(dir $(addprefix $(OPAM_DIR)/, $(OPAM_DIR_NAMES)))

OCAML_OTHER_LIBS[] += unix threads nums bigarray
OCAML_LIBS +=
    foreach(name => ..., $(OPAM_DIR_NAMES))
        value $(OPAM_DIR)/$(name)/$(name)

OCAMLFLAGS = -thread

OCamlProgram(dlist, dlist_example)
OCamlProgram(hashmap, hashmap_example dlist_example)
OCamlProgram(memo, memo_example hashmap_example dlist_example)
OCamlProgram(hashcons, hashcons hashmap_example dlist_example)
OCamlProgram(concurrent_hash_map, concurrent_hash_map)

OCAML_TOP_OTHER_LIBS[] = $(addsuffix .cma, $(OCAML_OTHER_LIBS))

OCAML_TOP_NAMES[] =
	res
	fieldslib
	oUnit
	sexplib
	bin_prot
	variantslib
	core

OCAML_TOP_LIBS =
    foreach(name => ..., $(OCAML_TOP_NAMES))
        file($(OPAM_DIR)/$(name)/$(name).cma)

OCAML_TOP_LIBS[] +=
	$(OPAM_DIR)/findlib/findlib.cma
	$(OPAM_DIR)/findlib/findlib_top.cma

ocamltop: $(OCAML_TOP_LIBS)
	ocamlmktop -thread -o $@ $(OCAML_TOP_OTHER_LIBS) $(OCAML_TOP_LIBS)

.DEFAULT: dlist hashmap memo hashcons concurrent_hash_map ocamltop
